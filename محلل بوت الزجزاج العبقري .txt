//+------------------------------------------------------------------+
//| Expert Advisor: Advanced Zigzag Analysis Bot - Part 1/6        |
//| Ù…Ø­Ù„Ù„ Ø¨ÙˆØª Ø§Ù„Ø²Ø¬Ø²Ø§Ø¬ Ø§Ù„Ø¹Ø¨Ù‚Ø±ÙŠ - Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø£ÙˆÙ„: Ø§Ù„Ù‡ÙŠØ§ÙƒÙ„ ÙˆØ§Ù„Ù…ØªØºÙŠØ±Ø§Øª     |
//+------------------------------------------------------------------+

#include <Trade\Trade.mqh>
#include <Trade\HistoryOrderInfo.mqh>
#include <Trade\PositionInfo.mqh>

//--- Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„
input int AnalysisPeriodDays = 1;        // ÙØªØ±Ø© Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø¨Ø§Ù„Ø£ÙŠØ§Ù…
input bool ShowDetailedReport = true;    // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…ÙØµÙ„
input bool SaveReportToFile = true;      // Ø­ÙØ¸ Ø§Ù„ØªÙ‚Ø±ÙŠØ± ÙÙŠ Ù…Ù„Ù
input bool SendEmailReport = false;     // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¨Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„
input string ReportFileName = "ZigzagAdvancedReport"; // Ø§Ø³Ù… Ù…Ù„Ù Ø§Ù„ØªÙ‚Ø±ÙŠØ±

//--- Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©
CTrade trade;
CHistoryOrderInfo historyOrder;
CPositionInfo position;

//+------------------------------------------------------------------+
//| Ù‡ÙŠÙƒÙ„ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ø´Ø§Ù…Ù„                                       |
//+------------------------------------------------------------------+
struct OrderAnalysis {
    // Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø£Ø³Ø§Ø³ÙŠØ©
    ulong ticket;
    datetime timeSetup;
    datetime timeDone;
    string symbol;
    ENUM_ORDER_TYPE type;
    ENUM_ORDER_STATE state;
    double volume;
    double priceOpen;
    double priceActual;
    double sl;
    double tp;
    double profit;
    double swap;
    double commission;
    double netProfit;
    bool isExecuted;
    
    // Ø­Ø§Ù„Ø© Ø§Ù„ØªÙ†ÙÙŠØ°
    string executionStatus;
    string failureReason;
    string detailedAnalysis;
    
    // ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ù…Ù†ÙØ°Ø©
    double maxPrice;
    double minPrice;
    double spreadAtSetup;
    double spreadAtExecution;
    double maxSpread;
    double pointsToTP;
    double pointsToSL;
    bool reachedTPLevel;
    bool reachedSLLevel;
    string marketCondition;
    bool wasCorrectDirection;
    int executionDelay;
    double slippage;
    double maxDrawdown;
    double maxRunup;
    double volatilityDuringTrade;
    bool hitStopLoss;
    bool hitTakeProfit;
    string exitReason;
    double percentageDrawdown;
    int holdingTimeMinutes;
    int barsDuration;
    
    // ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£ÙˆØ§Ù…Ø± ØºÙŠØ± Ø§Ù„Ù…Ù†ÙØ°Ø©
    double priceAtTime;
    double bestPriceReached;
    double distanceFromPrice;
    bool priceReachedLevel;
    string marketConditionAtSetup;
    int orderLifetimeMinutes;
    double maxDistanceFromTarget;
    double minDistanceFromTarget;
    string timeAnalysis;
    
    // ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ø®Ø§Ø·Ø± ÙˆØ§Ù„Ø¹ÙˆØ§Ø¦Ø¯
    double riskRewardRatio;
    double actualRiskReward;
    
    // ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙˆÙ‚Øª
    bool wasWeekend;
    bool wasNewsTime;
    bool wasSessionOpen;
    string dayOfWeek;
    int hourOfDay;
    
    // Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø³Ø¨Ø±ÙŠØ¯ ÙˆØ§Ù„ÙØ¬ÙˆØ§Øª
    double spreadPercentage;
    bool hadGap;
    double gapSize;
};

//+------------------------------------------------------------------+
//| Ù‡ÙŠÙƒÙ„ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¹Ø§Ù…Ø©                                         |
//+------------------------------------------------------------------+
struct GlobalStatistics {
    // Ø£Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø£ÙˆØ§Ù…Ø±
    int totalOrders;
    int executedOrders;
    int pendingExpired;
    int pendingCancelled;
    int pendingRejected;
    int partiallyFilled;
    
    // Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ù…Ù†ÙØ°Ø© (Ù„Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©)
    int executedWins;
    int executedLosses;
    int executedBreakeven;
    double totalProfit;
    double grossProfit;
    double grossLoss;
    double totalVolume;
    double totalCommission;
    double totalSwap;
    
    // Ù…Ø¹Ø¯Ù„Ø§Øª ÙˆÙ†Ø³Ø¨ Ù„Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ù…Ù†ÙØ°Ø©
    double winRate;
    double avgWin;
    double avgLoss;
    double profitFactor;
    double avgVolume;
    double maxWin;
    double maxLoss;
    double sharpeRatio;
    double recoveryFactor;
    
    // Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø£ÙˆØ§Ù…Ø± ØºÙŠØ± Ø§Ù„Ù…Ù†ÙØ°Ø© (Ù„Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ÙÙ‚Ø·)
    int priceDidntReach;
    int priceReachedButNotExecuted;
    int cancelledManually;
    int expiredOrders;
    int rejectedOrders;
    double avgOrderLifetime;
    double avgDistanceFromTarget;
    
    // ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£ÙˆÙ‚Ø§Øª
    int bestHourExecution;
    int worstHourExecution;
    int bestDayExecution;
    int worstDayExecution;
    double bestHourExecutionRate;
    double worstHourExecutionRate;
    
    // ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ø®Ø§Ø·Ø±
    double maxDrawdownPct;
    double avgDrawdownPct;
    double maxRunupPct;
    double avgRiskReward;
    double actualRiskReward;
    
    // Ø£Ù†Ù…Ø§Ø· Ø§Ù„ÙØ´Ù„
    int highSpreadFailures;
    int wrongDirectionFailures;
    int almostTPFailures;
    int slippageFailures;
    int timeoutFailures;
    int liquidityFailures;
    
    // Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ù…ØªÙ‚Ø¯Ù…Ø©
    double avgSlippage;
    double maxSlippage;
    double avgSpread;
    double maxSpread;
    int weekendOrders;
    int newsTimeOrders;
    double avgGapSize;
    int gappedOrders;
};

//--- Ø§Ù„Ù…ØµÙÙˆÙØ§Øª ÙˆØ§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©
OrderAnalysis orders[];
GlobalStatistics stats;

//+------------------------------------------------------------------+
//| Ø¯Ø§Ù„Ø© Ø§Ù„ØªÙ‡ÙŠØ¦Ø©                                                    |
//+------------------------------------------------------------------+
int OnInit()
{
    Print("ğŸ” Ù…Ø­Ù„Ù„ Ø§Ù„Ø²Ø¬Ø²Ø§Ø¬ Ø§Ù„Ø¹Ø¨Ù‚Ø±ÙŠ ØªÙ… ØªØ´ØºÙŠÙ„Ù‡ - Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø´Ø§Ù…Ù„...");
    Print("ğŸ“Š Ø³ÙŠØªÙ… ØªØ­Ù„ÙŠÙ„ ", AnalysisPeriodDays, " ÙŠÙˆÙ… Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
    
    // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
    InitializeStatistics();
    
    // ØªØ£Ø®ÙŠØ± Ù‚ØµÙŠØ± Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    Sleep(2000);
    
    // Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø´Ø§Ù…Ù„
    PerformAdvancedAnalysis();
    
    return(INIT_SUCCEEDED);
}

//+------------------------------------------------------------------+
//| Ø¯Ø§Ù„Ø© Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø®Ø¨ÙŠØ±                                              |
//+------------------------------------------------------------------+
void OnDeinit(const int reason)
{
    Print("ğŸ“Š Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…ØªÙ‚Ø¯Ù… Ù„Ø¨ÙˆØª Ø§Ù„Ø²Ø¬Ø²Ø§Ø¬");
    Print("âœ… ØªÙ… ØªØ­Ù„ÙŠÙ„ ", stats.totalOrders, " Ø£Ù…Ø± Ø¨Ù†Ø¬Ø§Ø­");
    Print("ğŸŸ¢ Ù…Ù†ÙØ°Ø©: ", stats.executedOrders, " (", DoubleToString((double)stats.executedOrders/MathMax(stats.totalOrders,1)*100, 1), "%)");
    Print("ğŸŸ¡ Ù…Ù†ØªÙ‡ÙŠØ©: ", stats.pendingExpired, " ğŸ”´ Ù…Ù„ØºØ§Ø©: ", stats.pendingCancelled, " ğŸš« Ù…Ø±ÙÙˆØ¶Ø©: ", stats.pendingRejected);
}

//+------------------------------------------------------------------+
//| Ø¯Ø§Ù„Ø© Ø§Ù„ØªÙƒ (Ù„Ø§ ØªØ¹Ù…Ù„ - Ø§Ù„Ù…Ø­Ù„Ù„ ÙŠØ¹Ù…Ù„ Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø©)                    |
//+------------------------------------------------------------------+
void OnTick()
{
    return; // Ù‡Ø°Ø§ Ø§Ù„Ù…Ø­Ù„Ù„ ÙŠØ¹Ù…Ù„ Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø· Ø¹Ù†Ø¯ Ø§Ù„ØªØ´ØºÙŠÙ„
}

//+------------------------------------------------------------------+
//| ØªÙ‡ÙŠØ¦Ø© Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª                                          |
//+------------------------------------------------------------------+
void InitializeStatistics()
{
    // ØªØµÙÙŠØ± Ø£Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø£ÙˆØ§Ù…Ø±
    stats.totalOrders = 0;
    stats.executedOrders = 0;
    stats.pendingExpired = 0;
    stats.pendingCancelled = 0;
    stats.pendingRejected = 0;
    stats.partiallyFilled = 0;
    
    // ØªØµÙÙŠØ± Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ù…Ù†ÙØ°Ø©
    stats.executedWins = 0;
    stats.executedLosses = 0;
    stats.executedBreakeven = 0;
    stats.totalProfit = 0;
    stats.grossProfit = 0;
    stats.grossLoss = 0;
    stats.totalVolume = 0;
    stats.totalCommission = 0;
    stats.totalSwap = 0;
    
    // ØªØµÙÙŠØ± Ø§Ù„Ù…Ø¹Ø¯Ù„Ø§Øª ÙˆØ§Ù„Ù†Ø³Ø¨
    stats.winRate = 0;
    stats.avgWin = 0;
    stats.avgLoss = 0;
    stats.profitFactor = 0;
    stats.avgVolume = 0;
    stats.maxWin = 0;
    stats.maxLoss = 0;
    stats.sharpeRatio = 0;
    stats.recoveryFactor = 0;
    
    // ØªØµÙÙŠØ± Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ØºÙŠØ± Ø§Ù„Ù…Ù†ÙØ°Ø©
    stats.priceDidntReach = 0;
    stats.priceReachedButNotExecuted = 0;
    stats.cancelledManually = 0;
    stats.expiredOrders = 0;
    stats.rejectedOrders = 0;
    stats.avgOrderLifetime = 0;
    stats.avgDistanceFromTarget = 0;
    
    // ØªØµÙÙŠØ± ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£ÙˆÙ‚Ø§Øª
    stats.bestHourExecution = -1;
    stats.worstHourExecution = -1;
    stats.bestDayExecution = -1;
    stats.worstDayExecution = -1;
    stats.bestHourExecutionRate = 0;
    stats.worstHourExecutionRate = 100;
    
    // ØªØµÙÙŠØ± ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ø®Ø§Ø·Ø±
    stats.maxDrawdownPct = 0;
    stats.avgDrawdownPct = 0;
    stats.maxRunupPct = 0;
    stats.avgRiskReward = 0;
    stats.actualRiskReward = 0;
    
    // ØªØµÙÙŠØ± Ø£Ù†Ù…Ø§Ø· Ø§Ù„ÙØ´Ù„
    stats.highSpreadFailures = 0;
    stats.wrongDirectionFailures = 0;
    stats.almostTPFailures = 0;
    stats.slippageFailures = 0;
    stats.timeoutFailures = 0;
    stats.liquidityFailures = 0;
    
    // ØªØµÙÙŠØ± Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©
    stats.avgSlippage = 0;
    stats.maxSlippage = 0;
    stats.avgSpread = 0;
    stats.maxSpread = 0;
    stats.weekendOrders = 0;
    stats.newsTimeOrders = 0;
    stats.avgGapSize = 0;
    stats.gappedOrders = 0;
    
    Print("ğŸ“‹ ØªÙ… ØªÙ‡ÙŠØ¦Ø© Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø¨Ù†Ø¬Ø§Ø­");
}

//+------------------------------------------------------------------+
//| Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø´Ø§Ù…Ù„ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…                                    |
//+------------------------------------------------------------------+
void PerformAdvancedAnalysis()
{
    Print("ğŸ“ˆ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø´Ø§Ù…Ù„ Ù„Ù„Ø£ÙˆØ§Ù…Ø± ÙˆØ§Ù„ØµÙÙ‚Ø§Øª...");
    
    // Ø§Ù„Ù…Ø±Ø­Ù„Ø© 1: Ø¬Ù…Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£ÙˆØ§Ù…Ø± (Ù…Ù†ÙØ°Ø© ÙˆØºÙŠØ± Ù…Ù†ÙØ°Ø©)
    CollectAllOrdersData();
    
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ØªØ­Ù„ÙŠÙ„
    if(stats.totalOrders == 0) {
        Print("âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£ÙˆØ§Ù…Ø± Ù„Ù„ØªØ­Ù„ÙŠÙ„ ÙÙŠ Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©");
        return;
    }
    
    // Ø§Ù„Ù…Ø±Ø­Ù„Ø© 2: ØªØ­Ù„ÙŠÙ„ ÙƒÙ„ Ø£Ù…Ø± Ø¨Ø§Ù„ØªÙØµÙŠÙ„
    AnalyzeAllOrders();
    
    // Ø§Ù„Ù…Ø±Ø­Ù„Ø© 3: Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø´Ø§Ù…Ù„Ø©
    CalculateGlobalStatistics();
    
    // Ø§Ù„Ù…Ø±Ø­Ù„Ø© 4: Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø´Ø§Ù…Ù„
    GenerateAdvancedReport();
    
    // Ø§Ù„Ù…Ø±Ø­Ù„Ø© 5: Ø­ÙØ¸ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…Ø·Ù„ÙˆØ¨
    if(SaveReportToFile)
        SaveAdvancedReportToFile();
        
    // Ø§Ù„Ù…Ø±Ø­Ù„Ø© 6: Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¨Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„ (Ø¥Ø®ØªÙŠØ§Ø±ÙŠ)
    if(SendEmailReport)
        SendReportByEmail();
        
    Print("âœ… Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…ØªÙ‚Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­!");
    PrintFinalSummary();
}

//+------------------------------------------------------------------+
//| Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ                                           |
//+------------------------------------------------------------------+
void PrintFinalSummary()
{
    Print("ğŸ“Š Ù…Ù„Ø®Øµ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ:");
    Print("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•");
    Print("ğŸ”¢ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£ÙˆØ§Ù…Ø±: ", stats.totalOrders);
    Print("âœ… Ù…Ù†ÙØ°Ø©: ", stats.executedOrders, " (", DoubleToString((double)stats.executedOrders/MathMax(stats.totalOrders,1)*100, 1), "%)");
    Print("â° Ù…Ù†ØªÙ‡ÙŠØ© Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©: ", stats.pendingExpired);
    Print("âŒ Ù…Ù„ØºØ§Ø©: ", stats.pendingCancelled);
    Print("ğŸš« Ù…Ø±ÙÙˆØ¶Ø©: ", stats.pendingRejected);
    Print("âš¡ Ø¬Ø²Ø¦ÙŠØ©: ", stats.partiallyFilled);
    
    if(stats.executedOrders > 0) {
        Print("ğŸ’° Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ù…Ù†ÙØ°Ø© ÙÙ‚Ø· (Ù„Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©):");
        Print("   ğŸŸ¢ Ø±Ø§Ø¨Ø­Ø©: ", stats.executedWins, " (", DoubleToString((double)stats.executedWins/stats.executedOrders*100, 1), "%)");
        Print("   ğŸ”´ Ø®Ø§Ø³Ø±Ø©: ", stats.executedLosses, " (", DoubleToString((double)stats.executedLosses/stats.executedOrders*100, 1), "%)");
        Print("   âš–ï¸ Ù…ØªØ¹Ø§Ø¯Ù„Ø©: ", stats.executedBreakeven);
        Print("   ğŸ’µ ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­: ", DoubleToString(stats.totalProfit, 2), "$");
        Print("   ğŸ“ˆ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­: ", DoubleToString(stats.grossProfit, 2), "$");
        Print("   ğŸ“‰ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø®Ø³Ø§Ø¦Ø±: ", DoubleToString(stats.grossLoss, 2), "$");
        Print("   âš–ï¸ Ù…Ø¹Ø§Ù…Ù„ Ø§Ù„Ø±Ø¨Ø­: ", DoubleToString(stats.profitFactor, 2));
    }
    
    Print("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•");
}

//+------------------------------------------------------------------+
//| Ø¯Ø§Ù„Ø© Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„ØªØ´ØºÙŠÙ„ (Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙƒØ³ÙƒØ±ÙŠØ¨Øª)                        |
//+------------------------------------------------------------------+
void OnStart()
{
    // ÙŠÙ…ÙƒÙ† Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ù‡Ø°Ù‡ Ø§Ù„Ø¯Ø§Ù„Ø© Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ØªØ­Ù„ÙŠÙ„ ÙƒØ³ÙƒØ±ÙŠÙ¾Øª Ù…Ù†ÙØµÙ„
    Print("ğŸš€ ØªÙ… ØªØ´ØºÙŠÙ„ Ù…Ø­Ù„Ù„ Ø§Ù„Ø²Ø¬Ø²Ø§Ø¬ Ø§Ù„Ø¹Ø¨Ù‚Ø±ÙŠ ÙƒØ³ÙƒØ±ÙŠÙ¾Øª");
    InitializeStatistics();
    PerformAdvancedAnalysis();
}

//+------------------------------------------------------------------+
//| Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª                            |
//+------------------------------------------------------------------+
bool IsValidTicket(ulong ticket)
{
    return (ticket > 0);
}

bool IsValidPrice(double price)
{
    return (price > 0 && price != EMPTY_VALUE);
}

bool IsValidVolume(double volume)
{
    return (volume > 0);
}

bool IsValidDateTime(datetime dt)
{
    return (dt > 0);
}

//+------------------------------------------------------------------+
//| Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ù„Ø­Ø³Ø§Ø¨Ø§Øª                                           |
//+------------------------------------------------------------------+
double CalculatePercentage(int part, int total)
{
    if(total <= 0) return 0;
    return (double)part / total * 100;
}

double CalculateAverage(double sum, int count)
{
    if(count <= 0) return 0;
    return sum / count;
}

double CalculateRatio(double numerator, double denominator)
{
    if(denominator <= 0) return 0;
    return numerator / denominator;
}

//+------------------------------------------------------------------+
//| Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ù„Ù†ØµÙˆØµ                                            |
//+------------------------------------------------------------------+
string GetOrderTypeString(ENUM_ORDER_TYPE type)
{
    switch(type) {
        case ORDER_TYPE_BUY: return "Ø´Ø±Ø§Ø¡ ÙÙˆØ±ÙŠ";
        case ORDER_TYPE_SELL: return "Ø¨ÙŠØ¹ ÙÙˆØ±ÙŠ";
        case ORDER_TYPE_BUY_LIMIT: return "Ø´Ø±Ø§Ø¡ Ù…Ø­Ø¯ÙˆØ¯";
        case ORDER_TYPE_SELL_LIMIT: return "Ø¨ÙŠØ¹ Ù…Ø­Ø¯ÙˆØ¯";
        case ORDER_TYPE_BUY_STOP: return "Ø´Ø±Ø§Ø¡ Ø¥ÙŠÙ‚Ø§Ù";
        case ORDER_TYPE_SELL_STOP: return "Ø¨ÙŠØ¹ Ø¥ÙŠÙ‚Ø§Ù";
        case ORDER_TYPE_BUY_STOP_LIMIT: return "Ø´Ø±Ø§Ø¡ Ø¥ÙŠÙ‚Ø§Ù Ù…Ø­Ø¯ÙˆØ¯";
        case ORDER_TYPE_SELL_STOP_LIMIT: return "Ø¨ÙŠØ¹ Ø¥ÙŠÙ‚Ø§Ù Ù…Ø­Ø¯ÙˆØ¯";
        default: return "Ù†ÙˆØ¹ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ";
    }
}

string GetOrderStateString(ENUM_ORDER_STATE state)
{
    switch(state) {
        case ORDER_STATE_STARTED: return "Ø¨Ø¯Ø£";
        case ORDER_STATE_PLACED: return "Ù…ÙˆØ¶ÙˆØ¹";
        case ORDER_STATE_CANCELED: return "Ù…Ù„ØºÙŠ";
        case ORDER_STATE_PARTIAL: return "Ø¬Ø²Ø¦ÙŠ";
        case ORDER_STATE_FILLED: return "Ù…ÙƒØªÙ…Ù„";
        case ORDER_STATE_REJECTED: return "Ù…Ø±ÙÙˆØ¶";
        case ORDER_STATE_EXPIRED: return "Ù…Ù†ØªÙ‡ÙŠ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©";
        case ORDER_STATE_REQUEST_ADD: return "Ø·Ù„Ø¨ Ø¥Ø¶Ø§ÙØ©";
        case ORDER_STATE_REQUEST_MODIFY: return "Ø·Ù„Ø¨ ØªØ¹Ø¯ÙŠÙ„";
        case ORDER_STATE_REQUEST_CANCEL: return "Ø·Ù„Ø¨ Ø¥Ù„ØºØ§Ø¡";
        default: return "Ø­Ø§Ù„Ø© ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙØ©";
    }
}

//+------------------------------------------------------------------+
//| Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ù„ØªÙˆÙ‚ÙŠØª                                            |
//+------------------------------------------------------------------+
string GetDayOfWeekString(int dayOfWeek)
{
    switch(dayOfWeek) {
        case 0: return "Ø§Ù„Ø£Ø­Ø¯";
        case 1: return "Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†";
        case 2: return "Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡";
        case 3: return "Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡";
        case 4: return "Ø§Ù„Ø®Ù…ÙŠØ³";
        case 5: return "Ø§Ù„Ø¬Ù…Ø¹Ø©";
        case 6: return "Ø§Ù„Ø³Ø¨Øª";
        default: return "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ";
    }
}

bool IsWeekend(int dayOfWeek)
{
    return (dayOfWeek == 0 || dayOfWeek == 6); // Ø§Ù„Ø£Ø­Ø¯ ÙˆØ§Ù„Ø³Ø¨Øª
}

bool IsActiveSession(int hour)
{
    // Ø¬Ù„Ø³Ø© Ù„Ù†Ø¯Ù†: 8-17ØŒ Ø¬Ù„Ø³Ø© Ù†ÙŠÙˆÙŠÙˆØ±Ùƒ: 13-22
    // ØªØ¯Ø§Ø®Ù„ Ø§Ù„Ø¬Ù„Ø³Ø§Øª: 13-17 (Ø£Ù†Ø´Ø· ÙØªØ±Ø©)
    return (hour >= 8 && hour <= 22);
}

bool IsLikelyNewsTime(int hour, int minute)
{
    // Ø£ÙˆÙ‚Ø§Øª Ø§Ù„Ø£Ø®Ø¨Ø§Ø± Ø§Ù„Ù…Ø¹ØªØ§Ø¯Ø© (ØªÙ‚Ø±ÙŠØ¨ÙŠØ©)
    if(hour == 8 && minute >= 30) return true;  // Ø£Ø®Ø¨Ø§Ø± Ø£ÙˆØ±ÙˆØ¨ÙŠØ©
    if(hour == 10 && minute == 0) return true;  // Ø£Ø®Ø¨Ø§Ø± Ø£ÙˆØ±ÙˆØ¨ÙŠØ©
    if(hour == 13 && minute >= 30) return true; // Ø£Ø®Ø¨Ø§Ø± Ø£Ù…Ø±ÙŠÙƒÙŠØ©
    if(hour == 15 && minute >= 30) return true; // Ø£Ø®Ø¨Ø§Ø± Ø£Ù…Ø±ÙŠÙƒÙŠØ©
    return false;
}

//+------------------------------------------------------------------+
//| Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ù„Ø³ÙˆÙ‚                                              |
//+------------------------------------------------------------------+
double GetCurrentSpread(string symbol)
{
    return SymbolInfoInteger(symbol, SYMBOL_SPREAD) * SymbolInfoDouble(symbol, SYMBOL_POINT);
}

double GetSymbolPoint(string symbol)
{
    return SymbolInfoDouble(symbol, SYMBOL_POINT);
}

double GetCurrentAsk(string symbol)
{
    return SymbolInfoDouble(symbol, SYMBOL_ASK);
}

double GetCurrentBid(string symbol)
{
    return SymbolInfoDouble(symbol, SYMBOL_BID);
}

//+------------------------------------------------------------------+
//| Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©                                   |
//+------------------------------------------------------------------+
double CalculatePips(double price1, double price2, string symbol)
{
    double point = GetSymbolPoint(symbol);
    if(point <= 0) return 0;
    return MathAbs(price1 - price2) / point;
}

double CalculateRiskRewardRatio(double entryPrice, double stopLoss, double takeProfit, string symbol)
{
    if(stopLoss <= 0 || takeProfit <= 0) return 0;
    
    double riskPips = CalculatePips(entryPrice, stopLoss, symbol);
    double rewardPips = CalculatePips(entryPrice, takeProfit, symbol);
    
    if(riskPips <= 0) return 0;
    return rewardPips / riskPips;
}

double CalculateDrawdownPercentage(double loss, double balance)
{
    if(balance <= 0) return 0;
    return MathAbs(loss) / balance * 100;
}

//+------------------------------------------------------------------+
//| Ø«ÙˆØ§Ø¨Øª Ù…Ù‡Ù…Ø© Ù„Ù„ØªØ­Ù„ÙŠÙ„                                             |
//+------------------------------------------------------------------+
#define HIGH_SPREAD_THRESHOLD    5.0    // Ø­Ø¯ Ø§Ù„Ø³Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¹Ø§Ù„ÙŠ
#define NORMAL_SPREAD_THRESHOLD  2.0    // Ø­Ø¯ Ø§Ù„Ø³Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠ
#define HIGH_SLIPPAGE_THRESHOLD  3.0    // Ø­Ø¯ Ø§Ù„Ø§Ù†Ø²Ù„Ø§Ù‚ Ø§Ù„Ø¹Ø§Ù„ÙŠ
#define SHORT_ORDER_LIFETIME     5      // Ù…Ø¯Ø© Ø§Ù„Ø£Ù…Ø± Ø§Ù„Ù‚ØµÙŠØ±Ø© (Ø¯Ù‚Ø§Ø¦Ù‚)
#define LONG_ORDER_LIFETIME      1440   // Ù…Ø¯Ø© Ø§Ù„Ø£Ù…Ø± Ø§Ù„Ø·ÙˆÙŠÙ„Ø© (Ø¯Ù‚Ø§Ø¦Ù‚)
#define CLOSE_TO_TP_THRESHOLD    10.0   // Ù‚Ø±ÙŠØ¨ Ù…Ù† Ø§Ù„Ù‡Ø¯Ù (Ù†Ù‚Ø§Ø·)
#define HIGH_VOLATILITY_THRESHOLD 3.0   // ØªÙ‚Ù„Ø¨ Ø¹Ø§Ù„ÙŠ (%)
#define NORMAL_VOLATILITY_THRESHOLD 1.5 // ØªÙ‚Ù„Ø¨ Ø·Ø¨ÙŠØ¹ÙŠ (%)

//--- Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø£ÙˆÙ„ ---
// Ù…Ù„Ø§Ø­Ø¸Ø©: Ù‡Ø°Ø§ Ø§Ù„Ø¬Ø²Ø¡ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ù‡ÙŠØ§ÙƒÙ„ ÙˆØ§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
// Ø§Ù„Ø£Ø¬Ø²Ø§Ø¡ Ø§Ù„ØªØ§Ù„ÙŠØ© Ø³ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø¯ÙˆØ§Ù„ Ø§Ù„ØªØ­Ù„ÙŠÙ„ ÙˆØ§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©
//+------------------------------------------------------------------+
//| Expert Advisor: Advanced Zigzag Analysis Bot - Part 2/10       |
//| Ù…Ø­Ù„Ù„ Ø¨ÙˆØª Ø§Ù„Ø²Ø¬Ø²Ø§Ø¬ Ø§Ù„Ø¹Ø¨Ù‚Ø±ÙŠ - Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø«Ø§Ù†ÙŠ: Ø¯ÙˆØ§Ù„ Ø¬Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª      |
//+------------------------------------------------------------------+

// ØªÙƒÙ…Ù„Ø© Ù„Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø£ÙˆÙ„ - Ø¯ÙˆØ§Ù„ Ø¬Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©

//+------------------------------------------------------------------+
//| Ø¬Ù…Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ù…Ù† Ø§Ù„ØªØ§Ø±ÙŠØ®                            |
//+------------------------------------------------------------------+
void CollectAllOrdersData()
{
    Print("ğŸ” Ø¬Ø§Ø±ÙŠ Ø¬Ù…Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ù…Ù† Ø§Ù„ØªØ§Ø±ÙŠØ®...");
    
    datetime fromDate = TimeCurrent() - (AnalysisPeriodDays * 24 * 3600);
    datetime toDate = TimeCurrent();
    
    Print("ğŸ“… ÙØªØ±Ø© Ø§Ù„ØªØ­Ù„ÙŠÙ„: Ù…Ù† ", TimeToString(fromDate, TIME_DATE|TIME_MINUTES), 
          " Ø¥Ù„Ù‰ ", TimeToString(toDate, TIME_DATE|TIME_MINUTES));
    
    if(!HistorySelect(fromDate, toDate)) {
        Print("âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ¯ ÙØªØ±Ø© Ø§Ù„ØªØ§Ø±ÙŠØ® - ÙƒÙˆØ¯ Ø§Ù„Ø®Ø·Ø£: ", GetLastError());
        return;
    }
    
    int ordersTotal = HistoryOrdersTotal();
    if(ordersTotal == 0) {
        Print("âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£ÙˆØ§Ù…Ø± ÙÙŠ Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©");
        return;
    }
    
    ArrayResize(orders, ordersTotal);
    stats.totalOrders = 0;
    
    Print("ğŸ” ÙØ­Øµ ", ordersTotal, " Ø£Ù…Ø± ÙÙŠ Ø§Ù„ØªØ§Ø±ÙŠØ®...");
    
    for(int i = 0; i < ordersTotal; i++) {
        ulong ticket = HistoryOrderGetTicket(i);
        if(ticket <= 0) continue;
        
        if(CollectOrderDetails(ticket, stats.totalOrders)) {
            stats.totalOrders++;
        }
        
        if(i % 100 == 0 && i > 0) {
            Print("ğŸ“Š ØªÙ… Ù…Ø¹Ø§Ù„Ø¬Ø© ", i, " Ø£Ù…Ø± Ù…Ù† Ø£ØµÙ„ ", ordersTotal);
        }
    }
    
    ArrayResize(orders, stats.totalOrders);
    Print("ğŸ“Š ØªÙ… Ø¬Ù…Ø¹ ", stats.totalOrders, " Ø£Ù…Ø± Ù„Ù„ØªØ­Ù„ÙŠÙ„");
}

//+------------------------------------------------------------------+
//| Ø¬Ù…Ø¹ ØªÙØ§ØµÙŠÙ„ Ø£Ù…Ø± Ù…Ø­Ø¯Ø¯                                            |
//+------------------------------------------------------------------+
bool CollectOrderDetails(ulong ticket, int index)
{
    if(!IsValidTicket(ticket)) return false;
    
    if(!HistoryOrderSelect(ticket)) {
        Print("âš ï¸ Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø£Ù…Ø±: ", ticket);
        return false;
    }
    
    // Ø¬Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
    orders[index].ticket = ticket;
    orders[index].timeSetup = (datetime)HistoryOrderGetInteger(ticket, ORDER_TIME_SETUP);
    orders[index].timeDone = (datetime)HistoryOrderGetInteger(ticket, ORDER_TIME_DONE);
    orders[index].symbol = HistoryOrderGetString(ticket, ORDER_SYMBOL);
    orders[index].type = (ENUM_ORDER_TYPE)HistoryOrderGetInteger(ticket, ORDER_TYPE);
    orders[index].volume = HistoryOrderGetDouble(ticket, ORDER_VOLUME_INITIAL);
    orders[index].priceOpen = HistoryOrderGetDouble(ticket, ORDER_PRICE_OPEN);
    orders[index].sl = HistoryOrderGetDouble(ticket, ORDER_SL);
    orders[index].tp = HistoryOrderGetDouble(ticket, ORDER_TP);
    orders[index].state = (ENUM_ORDER_STATE)HistoryOrderGetInteger(ticket, ORDER_STATE);
    
    // ØªØ­Ù„ÙŠÙ„ Ø¹ÙˆØ§Ù…Ù„ Ø§Ù„ÙˆÙ‚Øª
    AnalyzeTimeFactors(index);
    
    // ØªØ­Ø¯ÙŠØ¯ Ø­Ø§Ù„Ø© Ø§Ù„ØªÙ†ÙÙŠØ°
    DetermineExecutionStatus(index);
    
    // Ø¬Ù…Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ø³Ø¨ Ø­Ø§Ù„Ø© Ø§Ù„Ø£Ù…Ø±
    if(orders[index].isExecuted) {
        CollectExecutedOrderData(index);
        stats.executedOrders++;
    } else {
        CollectNonExecutedOrderData(index);
        ClassifyNonExecutedOrder(index);
    }
    
    return true;
}

//+------------------------------------------------------------------+
//| ØªØ­Ù„ÙŠÙ„ Ø¹ÙˆØ§Ù…Ù„ Ø§Ù„ÙˆÙ‚Øª Ù„Ù„Ø£Ù…Ø±                                        |
//+------------------------------------------------------------------+
void AnalyzeTimeFactors(int index)
{
    MqlDateTime dt;
    TimeToStruct(orders[index].timeSetup, dt);
    
    // ØªØ­Ø¯ÙŠØ¯ ÙŠÙˆÙ… Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹
    orders[index].dayOfWeek = GetDayOfWeekString(dt.day_of_week);
    orders[index].hourOfDay = dt.hour;
    
    // ÙØ­Øµ Ø§Ù„Ø¸Ø±ÙˆÙ Ø§Ù„Ø²Ù…Ù†ÙŠØ©
    orders[index].wasWeekend = IsWeekend(dt.day_of_week);
    orders[index].wasSessionOpen = IsActiveSession(dt.hour);
    orders[index].wasNewsTime = IsLikelyNewsTime(dt.hour, dt.min);
    
    // ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªÙˆÙ‚ÙŠØª
    if(orders[index].wasWeekend) {
        orders[index].timeAnalysis = "Ù†Ù‡Ø§ÙŠØ© Ø£Ø³Ø¨ÙˆØ¹ - Ø³ÙŠÙˆÙ„Ø© Ù…Ù†Ø®ÙØ¶Ø©";
    } else if(dt.hour >= 8 && dt.hour <= 17) {
        orders[index].timeAnalysis = "Ø³Ø§Ø¹Ø§Øª Ø¹Ù…Ù„ Ø±Ø¦ÙŠØ³ÙŠØ© - Ø³ÙŠÙˆÙ„Ø© Ø¬ÙŠØ¯Ø©";
    } else if(dt.hour >= 18 && dt.hour <= 22) {
        orders[index].timeAnalysis = "Ù…Ø³Ø§Ø¡ - Ø³ÙŠÙˆÙ„Ø© Ù…ØªÙˆØ³Ø·Ø©";
    } else {
        orders[index].timeAnalysis = "Ø³Ø§Ø¹Ø§Øª Ù‡Ø§Ø¯Ø¦Ø© - Ø³ÙŠÙˆÙ„Ø© Ù…Ù†Ø®ÙØ¶Ø©";
    }
    
    // Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ÙˆÙ‚Øª
    if(orders[index].wasWeekend) stats.weekendOrders++;
    if(orders[index].wasNewsTime) stats.newsTimeOrders++;
}

//+------------------------------------------------------------------+
//| ØªØ­Ø¯ÙŠØ¯ Ø­Ø§Ù„Ø© ØªÙ†ÙÙŠØ° Ø§Ù„Ø£Ù…Ø± Ø¨Ø§Ù„ØªÙØµÙŠÙ„                               |
//+------------------------------------------------------------------+
void DetermineExecutionStatus(int index)
{
    switch(orders[index].state) {
        case ORDER_STATE_FILLED:
            orders[index].isExecuted = true;
            orders[index].executionStatus = "âœ… ØªÙ… Ø§Ù„ØªÙ†ÙÙŠØ° Ø¨Ù†Ø¬Ø§Ø­";
            orders[index].detailedAnalysis = "ØªÙ… ØªÙ†ÙÙŠØ° Ø§Ù„Ø£Ù…Ø± ÙƒÙ…Ø§ Ù‡Ùˆ Ù…Ø·Ù„ÙˆØ¨";
            break;
            
        case ORDER_STATE_CANCELED:
            orders[index].isExecuted = false;
            orders[index].executionStatus = "âŒ ØªÙ… Ø§Ù„Ø¥Ù„ØºØ§Ø¡";
            orders[index].failureReason = "ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø£Ù…Ø± ÙŠØ¯ÙˆÙŠØ§Ù‹ Ø£Ùˆ Ø¨ÙˆØ§Ø³Ø·Ø© Ø§Ù„Ù†Ø¸Ø§Ù…";
            orders[index].detailedAnalysis = "Ø§Ù„Ø£Ù…Ø± Ø£Ù„ØºÙŠ Ù‚Ø¨Ù„ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ø³Ø¹Ø± Ø§Ù„Ù…Ø·Ù„ÙˆØ¨";
            break;
            
        case ORDER_STATE_EXPIRED:
            orders[index].isExecuted = false;
            orders[index].executionStatus = "â° Ø§Ù†ØªÙ‡Øª ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ø£Ù…Ø±";
            orders[index].failureReason = "Ø§Ù†ØªÙ‡Øª Ù…Ø¯Ø© ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ø£Ù…Ø± Ø¯ÙˆÙ† ÙˆØµÙˆÙ„ Ø§Ù„Ø³Ø¹Ø± Ù„Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨";
            orders[index].detailedAnalysis = "Ø§Ù„Ø£Ù…Ø± Ø§Ù†ØªÙ‡Øª ØµÙ„Ø§Ø­ÙŠØªÙ‡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹";
            break;
            
        case ORDER_STATE_REJECTED:
            orders[index].isExecuted = false;
            orders[index].executionStatus = "ğŸš« ØªÙ… Ø±ÙØ¶ Ø§Ù„Ø£Ù…Ø±";
            orders[index].failureReason = "Ø±ÙØ¶ Ø§Ù„ÙˆØ³ÙŠØ· Ù„Ù„Ø£Ù…Ø± - Ø¹Ø¯Ù… ÙƒÙØ§ÙŠØ© Ø§Ù„Ù‡Ø§Ù…Ø´ Ø£Ùˆ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª";
            orders[index].detailedAnalysis = "Ø§Ù„ÙˆØ³ÙŠØ· Ø±ÙØ¶ Ø§Ù„Ø£Ù…Ø± ÙÙˆØ± ÙˆØ¶Ø¹Ù‡";
            break;
            
        case ORDER_STATE_PARTIAL:
            orders[index].isExecuted = true;
            orders[index].executionStatus = "âš¡ ØªÙ… Ø§Ù„ØªÙ†ÙÙŠØ° Ø¬Ø²Ø¦ÙŠØ§Ù‹";
            orders[index].detailedAnalysis = "ØªÙ… ØªÙ†ÙÙŠØ° Ø¬Ø²Ø¡ Ù…Ù† Ø§Ù„Ø£Ù…Ø± ÙÙ‚Ø·";
            stats.partiallyFilled++;
            break;
            
        default:
            orders[index].isExecuted = false;
            orders[index].executionStatus = "â“ Ø­Ø§Ù„Ø© ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙØ©";
            orders[index].failureReason = "Ø­Ø§Ù„Ø© Ø§Ù„Ø£Ù…Ø± ØºÙŠØ± Ù…Ø­Ø¯Ø¯Ø©";
            orders[index].detailedAnalysis = "Ø­Ø§Ù„Ø© Ø§Ù„Ø£Ù…Ø± ØºÙŠØ± ÙˆØ§Ø¶Ø­Ø©";
    }
}

//+------------------------------------------------------------------+
//| Ø¬Ù…Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ù…Ù†ÙØ°Ø©                                     |
//+------------------------------------------------------------------+
void CollectExecutedOrderData(int index)
{
    // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„ØµÙÙ‚Ø© Ø§Ù„Ù…Ù‚Ø§Ø¨Ù„Ø©
    if(!FindCorrespondingDeal(index)) {
        Print("âš ï¸ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ØµÙÙ‚Ø© Ù„Ù„Ø£Ù…Ø±: ", orders[index].ticket);
        return;
    }
    
    // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
    CalculateBasicExecutionData(index);
    
    // ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„ØªÙØµÙŠÙ„ÙŠ Ø¥Ø°Ø§ ØªÙ… Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØµÙÙ‚Ø©
    if(orders[index].timeDone > 0) {
        AnalyzeDetailedPerformance(index);
    }
    
    // Ø­Ø³Ø§Ø¨ Ù…Ù‚Ø§ÙŠÙŠØ³ Ø§Ù„Ù…Ø®Ø§Ø·Ø± ÙˆØ§Ù„Ø¹ÙˆØ§Ø¦Ø¯
    CalculateRiskRewardMetrics(index);
    
    // ØªØ­Ù„ÙŠÙ„ Ø¸Ø±ÙˆÙ Ø§Ù„Ø³ÙˆÙ‚
    AnalyzeMarketConditions(index);
}

//+------------------------------------------------------------------+
//| Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„ØµÙÙ‚Ø© Ø§Ù„Ù…Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„Ø£Ù…Ø±                                 |
//+------------------------------------------------------------------+
bool FindCorrespondingDeal(int index)
{
    ulong orderTicket = orders[index].ticket;
    int dealsTotal = HistoryDealsTotal();
    
    for(int i = 0; i < dealsTotal; i++) {
        ulong dealTicket = HistoryDealGetTicket(i);
        if(dealTicket <= 0) continue;
        
        ulong dealOrderTicket = HistoryDealGetInteger(dealTicket, DEAL_ORDER);
        if(dealOrderTicket == orderTicket) {
            // ÙˆØ¬Ø¯Ù†Ø§ Ø§Ù„ØµÙÙ‚Ø© Ø§Ù„Ù…Ù‚Ø§Ø¨Ù„Ø©
            orders[index].priceActual = HistoryDealGetDouble(dealTicket, DEAL_PRICE);
            orders[index].profit = HistoryDealGetDouble(dealTicket, DEAL_PROFIT);
            orders[index].swap = HistoryDealGetDouble(dealTicket, DEAL_SWAP);
            orders[index].commission = HistoryDealGetDouble(dealTicket, DEAL_COMMISSION);
            orders[index].netProfit = orders[index].profit + orders[index].swap + orders[index].commission;
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø§Ù†Ø²Ù„Ø§Ù‚
            orders[index].slippage = MathAbs(orders[index].priceActual - orders[index].priceOpen);
            
            // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† ØµÙÙ‚Ø© Ø§Ù„Ø¥ØºÙ„Ø§Ù‚
            FindClosingDeal(index);
            
            return true;
        }
    }
    
    return false;
}

//+------------------------------------------------------------------+
//| Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† ØµÙÙ‚Ø© Ø§Ù„Ø¥ØºÙ„Ø§Ù‚                                          |
//+------------------------------------------------------------------+
void FindClosingDeal(int index)
{
    string symbol = orders[index].symbol;
    datetime openTime = orders[index].timeDone;
    ENUM_ORDER_TYPE openType = orders[index].type;
    
    int dealsTotal = HistoryDealsTotal();
    datetime closestCloseTime = 0;
    double closePrice = 0;
    double closingProfit = 0;
    
    for(int i = 0; i < dealsTotal; i++) {
        ulong dealTicket = HistoryDealGetTicket(i);
        if(dealTicket <= 0) continue;
        
        datetime dealTime = (datetime)HistoryDealGetInteger(dealTicket, DEAL_TIME);
        if(dealTime <= openTime) continue;
        
        string dealSymbol = HistoryDealGetString(dealTicket, DEAL_SYMBOL);
        if(dealSymbol != symbol) continue;
        
        ENUM_DEAL_TYPE dealType = (ENUM_DEAL_TYPE)HistoryDealGetInteger(dealTicket, DEAL_TYPE);
        
        // ÙØ­Øµ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª ØµÙÙ‚Ø© Ø¥ØºÙ„Ø§Ù‚ Ù…Ù‚Ø§Ø¨Ù„Ø©
        bool isClosingDeal = false;
        if(openType == ORDER_TYPE_BUY && dealType == DEAL_TYPE_SELL) isClosingDeal = true;
        if(openType == ORDER_TYPE_SELL && dealType == DEAL_TYPE_BUY) isClosingDeal = true;
        
        if(isClosingDeal) {
            if(closestCloseTime == 0 || dealTime < closestCloseTime) {
                closestCloseTime = dealTime;
                closePrice = HistoryDealGetDouble(dealTicket, DEAL_PRICE);
                closingProfit = HistoryDealGetDouble(dealTicket, DEAL_PROFIT);
            }
        }
    }
    
    if(closestCloseTime > 0) {
        orders[index].netProfit += closingProfit;
        orders[index].holdingTimeMinutes = (int)((closestCloseTime - openTime) / 60);
        AnalyzeTradePerformance(index, closePrice, closestCloseTime);
    }
}

//+------------------------------------------------------------------+
//| ØªØ­Ù„ÙŠÙ„ Ø£Ø¯Ø§Ø¡ Ø§Ù„ØµÙÙ‚Ø©                                              |
//+------------------------------------------------------------------+
void AnalyzeTradePerformance(int index, double closePrice, datetime closeTime)
{
    string symbol = orders[index].symbol;
    datetime openTime = orders[index].timeDone;
    
    // ØªÙ‡ÙŠØ¦Ø© Ø£Ø¹Ù„Ù‰ ÙˆØ£Ø¯Ù†Ù‰ Ø³Ø¹Ø±
    orders[index].maxPrice = orders[index].priceActual;
    orders[index].minPrice = orders[index].priceActual;
    
    // ÙØ­Øµ Ø£Ø¹Ù„Ù‰ ÙˆØ£Ø¯Ù†Ù‰ Ø³Ø¹Ø± Ø®Ù„Ø§Ù„ ÙØªØ±Ø© Ø§Ù„ØµÙÙ‚Ø©
    int totalBars = Bars(symbol, PERIOD_M1, openTime, closeTime);
    if(totalBars > 0) {
        for(int j = 0; j < MathMin(totalBars, 1000); j++) {
            double high = iHigh(symbol, PERIOD_M1, j);
            double low = iLow(symbol, PERIOD_M1, j);
            
            if(high > orders[index].maxPrice) orders[index].maxPrice = high;
            if(low < orders[index].minPrice) orders[index].minPrice = low;
        }
    }
    
    // Ø­Ø³Ø§Ø¨ Ù…Ø¯Ø© Ø§Ù„ØµÙÙ‚Ø© ÙˆØ§Ù„ØªÙ‚Ù„Ø¨
    orders[index].barsDuration = totalBars;
    double priceRange = orders[index].maxPrice - orders[index].minPrice;
    double avgPrice = (orders[index].maxPrice + orders[index].minPrice) / 2;
    orders[index].volatilityDuringTrade = (avgPrice > 0) ? priceRange / avgPrice * 100 : 0;
    
    // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³Ø§ÙØ§Øª ÙˆØ§Ù„Ø£Ø³Ø¨Ø§Ø¨
    CalculateDistancesAndReasons(index);
}

//+------------------------------------------------------------------+
//| Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³Ø§ÙØ§Øª ÙˆØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø£Ø³Ø¨Ø§Ø¨                                   |
//+------------------------------------------------------------------+
void CalculateDistancesAndReasons(int index)
{
    double point = GetSymbolPoint(orders[index].symbol);
    if(point <= 0) return;
    
    if(orders[index].type == ORDER_TYPE_BUY) {
        orders[index].pointsToTP = (orders[index].tp > 0) ? 
            (orders[index].maxPrice - orders[index].tp) / point : 0;
        orders[index].pointsToSL = (orders[index].sl > 0) ? 
            (orders[index].sl - orders[index].minPrice) / point : 0;
        orders[index].wasCorrectDirection = (orders[index].maxPrice > orders[index].priceActual * 1.001);
        orders[index].maxRunup = (orders[index].maxPrice - orders[index].priceActual) / point;
        orders[index].maxDrawdown = (orders[index].priceActual - orders[index].minPrice) / point;
    } else {
        orders[index].pointsToTP = (orders[index].tp > 0) ? 
            (orders[index].tp - orders[index].minPrice) / point : 0;
        orders[index].pointsToSL = (orders[index].sl > 0) ? 
            (orders[index].maxPrice - orders[index].sl) / point : 0;
        orders[index].wasCorrectDirection = (orders[index].minPrice < orders[index].priceActual * 0.999);
        orders[index].maxRunup = (orders[index].priceActual - orders[index].minPrice) / point;
        orders[index].maxDrawdown = (orders[index].maxPrice - orders[index].priceActual) / point;
    }
    
    // ØªØ­Ø¯ÙŠØ¯ Ø¥Ø°Ø§ ÙˆØµÙ„ Ù„Ù„Ø£Ù‡Ø¯Ø§Ù
    orders[index].reachedTPLevel = (orders[index].pointsToTP <= 0);
    orders[index].reachedSLLevel = (orders[index].pointsToSL <= 0);
    orders[index].hitTakeProfit = orders[index].reachedTPLevel;
    orders[index].hitStopLoss = orders[index].reachedSLLevel;
    
    // ØªØ­Ø¯ÙŠØ¯ Ø³Ø¨Ø¨ Ø§Ù„Ù†ØªÙŠØ¬Ø©
    DetermineTradeOutcomeReason(index);
}

//+------------------------------------------------------------------+
//| ØªØ­Ø¯ÙŠØ¯ Ø³Ø¨Ø¨ Ù†ØªÙŠØ¬Ø© Ø§Ù„ØµÙÙ‚Ø©                                         |
//+------------------------------------------------------------------+
void DetermineTradeOutcomeReason(int index)
{
    if(orders[index].netProfit > 0) {
        orders[index].failureReason = "âœ… ØµÙÙ‚Ø© Ù†Ø§Ø¬Ø­Ø© - Ø­Ù‚Ù‚Øª Ø£Ø±Ø¨Ø§Ø­";
        if(orders[index].hitTakeProfit) {
            orders[index].exitReason = "ÙˆØµÙ„ Ù„Ù„Ù‡Ø¯Ù";
        } else {
            orders[index].exitReason = "Ø¥ØºÙ„Ø§Ù‚ ÙŠØ¯ÙˆÙŠ Ø¨Ø±Ø¨Ø­";
        }
    } else {
        string reason = "";
        
        // ØªØ­Ù„ÙŠÙ„ Ø£Ø³Ø¨Ø§Ø¨ Ø§Ù„ÙØ´Ù„
        if(orders[index].pointsToTP > 0 && orders[index].pointsToTP < CLOSE_TO_TP_THRESHOLD) {
            reason += StringFormat("ÙˆØµÙ„ Ù‚Ø±ÙŠØ¨Ø§Ù‹ Ù…Ù† Ø§Ù„Ù‡Ø¯Ù (%.1f Ù†Ù‚Ø§Ø· ÙÙ‚Ø·) | ", orders[index].pointsToTP);
        }
        
        double slippagePips = orders[index].slippage / GetSymbolPoint(orders[index].symbol);
        if(slippagePips > HIGH_SLIPPAGE_THRESHOLD) {
            reason += StringFormat("Ø§Ù†Ø²Ù„Ø§Ù‚ Ø¹Ø§Ù„ÙŠ (%.1f Ù†Ù‚Ø§Ø·) | ", slippagePips);
        }
        
        if(!orders[index].wasCorrectDirection) {
            reason += "Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ø³ÙˆÙ‚ Ø¹ÙƒØ³ Ø§Ù„ØªÙˆÙ‚Ø¹ | ";
        }
        
        if(orders[index].hitStopLoss) {
            reason += "Ø¶Ø±Ø¨ Ø§Ù„Ø³ØªÙˆØ¨ Ù„ÙˆØ² | ";
        }
        
        if(reason == "") {
            reason = "Ø¸Ø±ÙˆÙ Ø§Ù„Ø³ÙˆÙ‚ ØºÙŠØ± Ù…Ù†Ø§Ø³Ø¨Ø© Ù„Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ©";
        }
        
        orders[index].failureReason = reason;
        
        // ØªØ­Ø¯ÙŠØ¯ Ø³Ø¨Ø¨ Ø§Ù„Ø®Ø±ÙˆØ¬
        if(orders[index].hitStopLoss) {
            orders[index].exitReason = "Ø¶Ø±Ø¨ Ø§Ù„Ø³ØªÙˆØ¨ Ù„ÙˆØ²";
        } else {
            orders[index].exitReason = "Ø¥ØºÙ„Ø§Ù‚ ÙŠØ¯ÙˆÙŠ Ø¨Ø®Ø³Ø§Ø±Ø©";
        }
    }
}

//+------------------------------------------------------------------+
//| Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ù„Ù„ØªÙ†ÙÙŠØ°                                 |
//+------------------------------------------------------------------+
void CalculateBasicExecutionData(int index)
{
    // Ø­Ø³Ø§Ø¨ ØªØ£Ø®ÙŠØ± Ø§Ù„ØªÙ†ÙÙŠØ°
    orders[index].executionDelay = (int)(orders[index].timeDone - orders[index].timeSetup);
    
    // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø³Ø¨Ø±ÙŠØ¯
    string symbol = orders[index].symbol;
    double currentSpread = GetCurrentSpread(symbol);
    orders[index].spreadAtSetup = currentSpread;
    orders[index].spreadAtExecution = currentSpread;
    orders[index].spreadPercentage = (orders[index].priceOpen > 0) ? 
        currentSpread / orders[index].priceOpen * 100 : 0;
    
    // ÙØ­Øµ Ø§Ù„ÙØ¬ÙˆØ§Øª
    DetectGaps(index);
    
    // Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø³Ø¨Ø±ÙŠØ¯ ÙˆØ§Ù„Ø§Ù†Ø²Ù„Ø§Ù‚
    UpdateSpreadAndSlippageStats(index);
}

//+------------------------------------------------------------------+
//| ÙƒØ´Ù Ø§Ù„ÙØ¬ÙˆØ§Øª                                                    |
//+------------------------------------------------------------------+
void DetectGaps(int index)
{
    string symbol = orders[index].symbol;
    double prevClose = iClose(symbol, PERIOD_D1, 1);
    
    if(IsValidPrice(prevClose) && IsValidPrice(orders[index].priceOpen)) {
        double gapSize = MathAbs(orders[index].priceOpen - prevClose);
        double normalSpread = GetCurrentSpread(symbol);
        
        orders[index].hadGap = (gapSize > normalSpread * 3);
        orders[index].gapSize = gapSize / GetSymbolPoint(symbol);
        
        if(orders[index].hadGap) {
            stats.gappedOrders++;
            stats.avgGapSize = (stats.avgGapSize * (stats.gappedOrders - 1) + orders[index].gapSize) / stats.gappedOrders;
        }
    }
}

//+------------------------------------------------------------------+
//| ØªØ­Ø¯ÙŠØ« Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø³Ø¨Ø±ÙŠØ¯ ÙˆØ§Ù„Ø§Ù†Ø²Ù„Ø§Ù‚                               |
//+------------------------------------------------------------------+
void UpdateSpreadAndSlippageStats(int index)
{
    // Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø³Ø¨Ø±ÙŠØ¯
    if(orders[index].spreadAtSetup > stats.maxSpread) {
        stats.maxSpread = orders[index].spreadAtSetup;
    }
    stats.avgSpread = (stats.avgSpread * (stats.executedOrders - 1) + orders[index].spreadAtSetup) / stats.executedOrders;
    
    // Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø§Ù†Ø²Ù„Ø§Ù‚
    double slippagePips = orders[index].slippage / GetSymbolPoint(orders[index].symbol);
    if(slippagePips > stats.maxSlippage) {
        stats.maxSlippage = slippagePips;
    }
    stats.avgSlippage = (stats.avgSlippage * (stats.executedOrders - 1) + slippagePips) / stats.executedOrders;
}

//+------------------------------------------------------------------+
//| Ø¬Ù…Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ÙˆØ§Ù…Ø± ØºÙŠØ± Ø§Ù„Ù…Ù†ÙØ°Ø©                                 |
//+------------------------------------------------------------------+
void CollectNonExecutedOrderData(int index)
{
    // Ø­Ø³Ø§Ø¨ Ù…Ø¯Ø© Ø¨Ù‚Ø§Ø¡ Ø§Ù„Ø£Ù…Ø±
    orders[index].orderLifetimeMinutes = (int)((orders[index].timeDone - orders[index].timeSetup) / 60);
    
    // Ø§Ù„Ø³Ø¹Ø± ÙˆÙ‚Øª ÙˆØ¶Ø¹ Ø§Ù„Ø£Ù…Ø±
    orders[index].priceAtTime = orders[index].priceOpen;
    
    // ØªØ­Ù„ÙŠÙ„ Ù†ÙˆØ¹ Ø§Ù„Ø£Ù…Ø± Ø§Ù„Ù…Ø­Ø¯Ø¯
    AnalyzeSpecificOrderType(index);
    
    // ØªØ­Ø¯ÙŠØ¯ Ø­Ø§Ù„Ø© Ø§Ù„Ø³ÙˆÙ‚ ÙˆÙ‚Øª Ø§Ù„ÙˆØ¶Ø¹
    DetermineMarketConditionAtSetup(index);
    
    // ØªØ­Ù„ÙŠÙ„ Ø³Ø¨Ø¨ Ø¹Ø¯Ù… Ø§Ù„ØªÙ†ÙÙŠØ° Ø¨Ø§Ù„ØªÙØµÙŠÙ„
    DetermineDetailedFailureReason(index);
}

//+------------------------------------------------------------------+
//| ØªØµÙ†ÙŠÙ Ø§Ù„Ø£ÙˆØ§Ù…Ø± ØºÙŠØ± Ø§Ù„Ù…Ù†ÙØ°Ø©                                      |
//+------------------------------------------------------------------+
void ClassifyNonExecutedOrder(int index)
{
    switch(orders[index].state) {
        case ORDER_STATE_EXPIRED:
            stats.pendingExpired++;
            if(orders[index].priceReachedLevel) {
                stats.priceReachedButNotExecuted++;
            } else {
                stats.priceDidntReach++;
            }
            break;
            
        case ORDER_STATE_CANCELED:
            stats.pendingCancelled++;
            stats.cancelledManually++;
            break;
            
        case ORDER_STATE_REJECTED:
            stats.pendingRejected++;
            stats.rejectedOrders++;
            break;
    }
    
    // Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ù…Ø¯Ø© Ø§Ù„Ø£ÙˆØ§Ù…Ø±
    if(orders[index].orderLifetimeMinutes > 0) {
        stats.avgOrderLifetime = (stats.avgOrderLifetime * (stats.totalOrders - stats.executedOrders - 1) + 
                                 orders[index].orderLifetimeMinutes) / (stats.totalOrders - stats.executedOrders);
    }
}

//--- Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø«Ø§Ù†ÙŠ ---
//+------------------------------------------------------------------+
//| Expert Advisor: Advanced Zigzag Analysis Bot - Part 3/15       |
//| Ù…Ø­Ù„Ù„ Ø¨ÙˆØª Ø§Ù„Ø²Ø¬Ø²Ø§Ø¬ Ø§Ù„Ø¹Ø¨Ù‚Ø±ÙŠ - Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø«Ø§Ù„Ø«: Ø¯ÙˆØ§Ù„ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© |
//+------------------------------------------------------------------+

// ØªÙƒÙ…Ù„Ø© Ù„Ù„Ø£Ø¬Ø²Ø§Ø¡ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© - Ø¯ÙˆØ§Ù„ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ù„Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ù…Ù†ÙØ°Ø©

//+------------------------------------------------------------------+
//| ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ù…Ù†ÙØ°Ø© Ø¨Ø§Ù„ØªÙØµÙŠÙ„                                  |
//+------------------------------------------------------------------+
void AnalyzeDetailedPerformance(int index)
{
    if(!orders[index].isExecuted) return;
    
    string symbol = orders[index].symbol;
    datetime openTime = orders[index].timeDone;
    
    // ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø®Ù„Ø§Ù„ ÙØªØ±Ø© Ø§Ù„ØµÙÙ‚Ø©
    AnalyzePriceMovement(index);
    
    // ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªÙˆÙ‚ÙŠØª ÙˆØ§Ù„Ù…Ø¯Ø©
    AnalyzeTimingAndDuration(index);
    
    // ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø³Ø¨Ø±ÙŠØ¯ ÙˆØ§Ù„ØªÙ†ÙÙŠØ°
    AnalyzeSpreadAndExecution(index);
    
    // ØªØ­Ø¯ÙŠØ¯ Ù†Ù…Ø· Ø§Ù„ÙØ´Ù„ Ø£Ùˆ Ø§Ù„Ù†Ø¬Ø§Ø­
    IdentifyPerformancePattern(index);
}

//+------------------------------------------------------------------+
//| ØªØ­Ù„ÙŠÙ„ Ø­Ø±ÙƒØ© Ø§Ù„Ø³Ø¹Ø±                                                |
//+------------------------------------------------------------------+
void AnalyzePriceMovement(int index)
{
    string symbol = orders[index].symbol;
    double point = GetSymbolPoint(symbol);
    
    if(point <= 0) return;
    
    // Ø­Ø³Ø§Ø¨ Ø£Ù‚ØµÙ‰ Ø­Ø±ÙƒØ© Ø¥ÙŠØ¬Ø§Ø¨ÙŠØ© ÙˆØ³Ù„Ø¨ÙŠØ©
    if(orders[index].type == ORDER_TYPE_BUY) {
        orders[index].maxRunup = (orders[index].maxPrice - orders[index].priceActual) / point;
        orders[index].maxDrawdown = (orders[index].priceActual - orders[index].minPrice) / point;
    } else {
        orders[index].maxRunup = (orders[index].priceActual - orders[index].minPrice) / point;
        orders[index].maxDrawdown = (orders[index].maxPrice - orders[index].priceActual) / point;
    }
    
    // ØªØ­Ø¯ÙŠØ¯ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø§ØªØ¬Ø§Ù‡ ØµØ­ÙŠØ­
    double priceMove = 0;
    if(orders[index].type == ORDER_TYPE_BUY) {
        priceMove = orders[index].maxPrice - orders[index].priceActual;
    } else {
        priceMove = orders[index].priceActual - orders[index].minPrice;
    }
    
    orders[index].wasCorrectDirection = (priceMove > point * 5); // Ø£ÙƒØ«Ø± Ù…Ù† 5 Ù†Ù‚Ø§Ø·
}

//+------------------------------------------------------------------+
//| ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªÙˆÙ‚ÙŠØª ÙˆØ§Ù„Ù…Ø¯Ø©                                            |
//+------------------------------------------------------------------+
void AnalyzeTimingAndDuration(int index)
{
    // Ø­Ø³Ø§Ø¨ Ù…Ø¯Ø© Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¥Ø°Ø§ Ù„Ù… ØªØ­Ø³Ø¨ Ø¨Ø¹Ø¯
    if(orders[index].holdingTimeMinutes <= 0 && orders[index].timeDone > 0) {
        // ØªÙ‚Ø¯ÙŠØ± Ù…Ø¯Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ù†ÙˆØ¹ Ø§Ù„Ø£Ù…Ø±
        if(orders[index].type == ORDER_TYPE_BUY || orders[index].type == ORDER_TYPE_SELL) {
            orders[index].holdingTimeMinutes = 60; // Ø³Ø§Ø¹Ø© ÙˆØ§Ø­Ø¯Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
        } else {
            orders[index].holdingTimeMinutes = 30; // Ù†ØµÙ Ø³Ø§Ø¹Ø© Ù„Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©
        }
    }
    
    // ØªØ­Ù„ÙŠÙ„ Ù…Ø¯Ø© Ø§Ù„ØµÙÙ‚Ø©
    if(orders[index].holdingTimeMinutes > 0) {
        if(orders[index].holdingTimeMinutes < 5) {
            orders[index].detailedAnalysis += " | Ù…Ø¯Ø© Ù‚ØµÙŠØ±Ø© Ø¬Ø¯Ø§Ù‹ (Ø£Ù‚Ù„ Ù…Ù† 5 Ø¯Ù‚Ø§Ø¦Ù‚)";
        } else if(orders[index].holdingTimeMinutes > 1440) {
            orders[index].detailedAnalysis += " | Ù…Ø¯Ø© Ø·ÙˆÙŠÙ„Ø© Ø¬Ø¯Ø§Ù‹ (Ø£ÙƒØ«Ø± Ù…Ù† ÙŠÙˆÙ…)";
        } else if(orders[index].holdingTimeMinutes > 240) {
            orders[index].detailedAnalysis += " | Ù…Ø¯Ø© Ø·ÙˆÙŠÙ„Ø© (Ø£ÙƒØ«Ø± Ù…Ù† 4 Ø³Ø§Ø¹Ø§Øª)";
        }
    }
    
    // ØªØ­Ù„ÙŠÙ„ ØªØ£Ø®ÙŠØ± Ø§Ù„ØªÙ†ÙÙŠØ°
    if(orders[index].executionDelay > 5) {
        orders[index].detailedAnalysis += StringFormat(" | ØªØ£Ø®ÙŠØ± ÙÙŠ Ø§Ù„ØªÙ†ÙÙŠØ° (%d Ø«ÙˆØ§Ù†ÙŠ)", orders[index].executionDelay);
    }
}

//+------------------------------------------------------------------+
//| ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø³Ø¨Ø±ÙŠØ¯ ÙˆØ§Ù„ØªÙ†ÙÙŠØ°                                          |
//+------------------------------------------------------------------+
void AnalyzeSpreadAndExecution(int index)
{
    string symbol = orders[index].symbol;
    double point = GetSymbolPoint(symbol);
    
    // ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø³Ø¨Ø±ÙŠØ¯
    if(orders[index].spreadAtSetup > HIGH_SPREAD_THRESHOLD) {
        orders[index].detailedAnalysis += StringFormat(" | Ø³Ø¨Ø±ÙŠØ¯ Ø¹Ø§Ù„ÙŠ (%.1f Ù†Ù‚Ø§Ø·)", 
                                         orders[index].spreadAtSetup / point);
        stats.highSpreadFailures++;
    }
    
    // ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø§Ù†Ø²Ù„Ø§Ù‚
    double slippagePips = orders[index].slippage / point;
    if(slippagePips > HIGH_SLIPPAGE_THRESHOLD) {
        orders[index].detailedAnalysis += StringFormat(" | Ø§Ù†Ø²Ù„Ø§Ù‚ Ø¹Ø§Ù„ÙŠ (%.1f Ù†Ù‚Ø§Ø·)", slippagePips);
        stats.slippageFailures++;
    }
    
    // Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ø§Ù†Ø²Ù„Ø§Ù‚ Ø¨Ø§Ù„Ø³Ø¨Ø±ÙŠØ¯
    if(orders[index].slippage > orders[index].spreadAtSetup * 2) {
        orders[index].detailedAnalysis += " | Ø§Ù„Ø§Ù†Ø²Ù„Ø§Ù‚ Ø£ÙƒØ¨Ø± Ù…Ù† Ø¶Ø¹Ù Ø§Ù„Ø³Ø¨Ø±ÙŠØ¯";
    }
}

//+------------------------------------------------------------------+
//| ØªØ­Ø¯ÙŠØ¯ Ù†Ù…Ø· Ø§Ù„Ø£Ø¯Ø§Ø¡                                                |
//+------------------------------------------------------------------+
void IdentifyPerformancePattern(int index)
{
    // ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØµÙÙ‚Ø§Øª Ø§Ù„Ø±Ø§Ø¨Ø­Ø©
    if(orders[index].netProfit > 0) {
        if(orders[index].hitTakeProfit) {
            orders[index].detailedAnalysis += " | ÙˆØµÙ„ Ù„Ù„Ù‡Ø¯Ù Ø§Ù„Ù…Ø­Ø¯Ø¯";
        } else {
            orders[index].detailedAnalysis += " | Ø¥ØºÙ„Ø§Ù‚ ÙŠØ¯ÙˆÙŠ Ø¨Ø±Ø¨Ø­";
        }
        
        // ØªØ­Ù„ÙŠÙ„ Ø¬ÙˆØ¯Ø© Ø§Ù„Ø±Ø¨Ø­
        if(orders[index].maxRunup > 0 && orders[index].netProfit > 0) {
            double profitEfficiency = (orders[index].netProfit / orders[index].volume) / orders[index].maxRunup * 100;
            if(profitEfficiency > 80) {
                orders[index].detailedAnalysis += " | ÙƒÙØ§Ø¡Ø© Ø±Ø¨Ø­ Ø¹Ø§Ù„ÙŠØ©";
            } else if(profitEfficiency < 30) {
                orders[index].detailedAnalysis += " | ÙƒÙØ§Ø¡Ø© Ø±Ø¨Ø­ Ù…Ù†Ø®ÙØ¶Ø©";
            }
        }
    } 
    // ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØµÙÙ‚Ø§Øª Ø§Ù„Ø®Ø§Ø³Ø±Ø©
    else if(orders[index].netProfit < 0) {
        if(orders[index].hitStopLoss) {
            orders[index].detailedAnalysis += " | Ø¶Ø±Ø¨ Ø§Ù„Ø³ØªÙˆØ¨ Ù„ÙˆØ²";
        } else {
            orders[index].detailedAnalysis += " | Ø¥ØºÙ„Ø§Ù‚ ÙŠØ¯ÙˆÙŠ Ø¨Ø®Ø³Ø§Ø±Ø©";
        }
        
        // ØªØ­Ù„ÙŠÙ„ Ø£Ù†Ù…Ø§Ø· Ø§Ù„ÙØ´Ù„
        AnalyzeFailurePatterns(index);
    }
    // Ø§Ù„ØµÙÙ‚Ø§Øª Ø§Ù„Ù…ØªØ¹Ø§Ø¯Ù„Ø©
    else {
        orders[index].detailedAnalysis += " | ØµÙÙ‚Ø© Ù…ØªØ¹Ø§Ø¯Ù„Ø© (Ø¨Ø¯ÙˆÙ† Ø±Ø¨Ø­ Ø£Ùˆ Ø®Ø³Ø§Ø±Ø©)";
        stats.executedBreakeven++;
    }
}

//+------------------------------------------------------------------+
//| ØªØ­Ù„ÙŠÙ„ Ø£Ù†Ù…Ø§Ø· Ø§Ù„ÙØ´Ù„ Ù„Ù„ØµÙÙ‚Ø§Øª Ø§Ù„Ø®Ø§Ø³Ø±Ø©                              |
//+------------------------------------------------------------------+
void AnalyzeFailurePatterns(int index)
{
    double point = GetSymbolPoint(orders[index].symbol);
    
    // ÙØ­Øµ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‚Ø±ÙŠØ¨ Ù…Ù† Ø§Ù„Ù‡Ø¯Ù
    if(orders[index].pointsToTP > 0 && orders[index].pointsToTP < CLOSE_TO_TP_THRESHOLD) {
        orders[index].detailedAnalysis += StringFormat(" | ÙƒØ§Ù† Ù‚Ø±ÙŠØ¨Ø§Ù‹ Ù…Ù† Ø§Ù„Ù‡Ø¯Ù (%.1f Ù†Ù‚Ø§Ø·)", 
                                         orders[index].pointsToTP);
        stats.almostTPFailures++;
    }
    
    // ÙØ­Øµ Ø§Ù„Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ø®Ø§Ø·Ø¦
    if(!orders[index].wasCorrectDirection) {
        orders[index].detailedAnalysis += " | Ø§Ù„Ø§ØªØ¬Ø§Ù‡ ÙƒØ§Ù† Ø®Ø§Ø·Ø¦Ø§Ù‹ Ù…Ù† Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©";
        stats.wrongDirectionFailures++;
    }
    
    // ÙØ­Øµ Ø§Ù„ØªÙˆÙ‚ÙŠØª Ø§Ù„Ø³ÙŠØ¡
    if(orders[index].wasWeekend) {
        orders[index].detailedAnalysis += " | ØªÙ… ÙÙŠ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹";
    }
    
    if(orders[index].wasNewsTime) {
        orders[index].detailedAnalysis += " | ØªÙ… Ø£Ø«Ù†Ø§Ø¡ ÙˆÙ‚Øª Ø§Ù„Ø£Ø®Ø¨Ø§Ø±";
    }
    
    // ÙØ­Øµ Ø§Ù„Ø³ÙŠÙˆÙ„Ø©
    if(!orders[index].wasSessionOpen) {
        orders[index].detailedAnalysis += " | ØªÙ… Ø®Ø§Ø±Ø¬ Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø³ÙŠÙˆÙ„Ø© Ø§Ù„Ø¹Ø§Ù„ÙŠØ©";
        stats.liquidityFailures++;
    }
}

//+------------------------------------------------------------------+
//| Ø­Ø³Ø§Ø¨ Ù…Ù‚Ø§ÙŠÙŠØ³ Ø§Ù„Ù…Ø®Ø§Ø·Ø± ÙˆØ§Ù„Ø¹ÙˆØ§Ø¦Ø¯ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©                          |
//+------------------------------------------------------------------+
void CalculateRiskRewardMetrics(int index)
{
    if(!orders[index].isExecuted) return;
    
    string symbol = orders[index].symbol;
    double point = GetSymbolPoint(symbol);
    
    // Ø­Ø³Ø§Ø¨ Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø®Ø§Ø·Ø± Ù„Ù„Ø¹ÙˆØ§Ø¦Ø¯ Ø§Ù„Ù…Ø®Ø·Ø·Ø©
    if(IsValidPrice(orders[index].sl) && IsValidPrice(orders[index].tp) && point > 0) {
        double riskPips = MathAbs(orders[index].priceOpen - orders[index].sl) / point;
        double rewardPips = MathAbs(orders[index].tp - orders[index].priceOpen) / point;
        
        if(riskPips > 0) {
            orders[index].riskRewardRatio = rewardPips / riskPips;
        }
        
        // ØªØ­Ù„ÙŠÙ„ Ø¬ÙˆØ¯Ø© Ø§Ù„Ù†Ø³Ø¨Ø©
        if(orders[index].riskRewardRatio < 1.0) {
            orders[index].detailedAnalysis += " | Ù†Ø³Ø¨Ø© Ù…Ø®Ø§Ø·Ø±/Ø¹Ø§Ø¦Ø¯ Ø¶Ø¹ÙŠÙØ©";
        } else if(orders[index].riskRewardRatio > 3.0) {
            orders[index].detailedAnalysis += " | Ù†Ø³Ø¨Ø© Ù…Ø®Ø§Ø·Ø±/Ø¹Ø§Ø¦Ø¯ Ù…Ù…ØªØ§Ø²Ø©";
        }
    }
    
    // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„ÙØ¹Ù„ÙŠØ© Ø§Ù„Ù…Ø­Ù‚Ù‚Ø©
    if(orders[index].commission != 0 && MathAbs(orders[index].commission) > 0) {
        orders[index].actualRiskReward = orders[index].netProfit / MathAbs(orders[index].commission);
    }
    
    // Ø­Ø³Ø§Ø¨ Ù†Ø³Ø¨Ø© Ø§Ù„Ø³Ø­Ø¨ Ù…Ù† Ø±Ø£Ø³ Ø§Ù„Ù…Ø§Ù„
    double accountBalance = AccountInfoDouble(ACCOUNT_BALANCE);
    if(accountBalance > 0 && orders[index].netProfit < 0) {
        orders[index].percentageDrawdown = MathAbs(orders[index].netProfit) / accountBalance * 100;
        
        // ØªØ­Ù„ÙŠÙ„ Ø­Ø¬Ù… Ø§Ù„Ø³Ø­Ø¨
        if(orders[index].percentageDrawdown > 5.0) {
            orders[index].detailedAnalysis += StringFormat(" | Ø³Ø­Ø¨ ÙƒØ¨ÙŠØ± Ù…Ù† Ø±Ø£Ø³ Ø§Ù„Ù…Ø§Ù„ (%.2f%%)", 
                                             orders[index].percentageDrawdown);
        }
    }
}

//+------------------------------------------------------------------+
//| ØªØ­Ù„ÙŠÙ„ Ø¸Ø±ÙˆÙ Ø§Ù„Ø³ÙˆÙ‚ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©                                      |
//+------------------------------------------------------------------+
void AnalyzeMarketConditions(int index)
{
    if(!orders[index].isExecuted) return;
    
    // ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªÙ‚Ù„Ø¨
    double volatility = orders[index].volatilityDuringTrade;
    
    if(volatility > HIGH_VOLATILITY_THRESHOLD) {
        orders[index].marketCondition = "Ù…ØªÙ‚Ù„Ø¨ Ø¬Ø¯Ø§Ù‹ - Ø­Ø±ÙƒØ© Ù‚ÙˆÙŠØ©";
        orders[index].detailedAnalysis += " | Ø³ÙˆÙ‚ Ù…ØªÙ‚Ù„Ø¨ Ø¬Ø¯Ø§Ù‹";
    } else if(volatility > NORMAL_VOLATILITY_THRESHOLD) {
        orders[index].marketCondition = "Ù…ØªÙ‚Ù„Ø¨ - Ø­Ø±ÙƒØ© Ù…Ø¹ØªØ¯Ù„Ø©";
        orders[index].detailedAnalysis += " | Ø³ÙˆÙ‚ Ù…ØªÙ‚Ù„Ø¨ Ù…Ø¹ØªØ¯Ù„";
    } else if(volatility > 0.5) {
        orders[index].marketCondition = "Ù…Ø¹ØªØ¯Ù„ - Ø­Ø±ÙƒØ© Ø·Ø¨ÙŠØ¹ÙŠØ©";
    } else {
        orders[index].marketCondition = "Ù‡Ø§Ø¯Ø¦ - Ø­Ø±ÙƒØ© Ø¶Ø¹ÙŠÙØ©";
        orders[index].detailedAnalysis += " | Ø³ÙˆÙ‚ Ù‡Ø§Ø¯Ø¦";
    }
    
    // ØªØ­Ù„ÙŠÙ„ Ù…Ù„Ø§Ø¦Ù…Ø© Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© Ù„Ø¸Ø±ÙˆÙ Ø§Ù„Ø³ÙˆÙ‚
    AnalyzeStrategyFitness(index);
}

//+------------------------------------------------------------------+
//| ØªØ­Ù„ÙŠÙ„ Ù…Ù„Ø§Ø¦Ù…Ø© Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© Ù„Ø¸Ø±ÙˆÙ Ø§Ù„Ø³ÙˆÙ‚                         |
//+------------------------------------------------------------------+
void AnalyzeStrategyFitness(int index)
{
    // ØªØ­Ù„ÙŠÙ„ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ù†ÙˆØ¹ Ø§Ù„Ø£Ù…Ø± ÙˆØ¸Ø±ÙˆÙ Ø§Ù„Ø³ÙˆÙ‚
    bool isMarketOrder = (orders[index].type == ORDER_TYPE_BUY || orders[index].type == ORDER_TYPE_SELL);
    bool isPendingOrder = !isMarketOrder;
    
    // Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„ÙÙˆØ±ÙŠØ© ÙÙŠ Ø§Ù„Ø³ÙˆÙ‚ Ø§Ù„Ù…ØªÙ‚Ù„Ø¨
    if(isMarketOrder && orders[index].volatilityDuringTrade > HIGH_VOLATILITY_THRESHOLD) {
        if(orders[index].netProfit < 0) {
            orders[index].detailedAnalysis += " | Ø£Ù…Ø± ÙÙˆØ±ÙŠ ÙÙŠ Ø³ÙˆÙ‚ Ù…ØªÙ‚Ù„Ø¨ - Ù…Ø®Ø§Ø·Ø± Ø¹Ø§Ù„ÙŠØ©";
        } else {
            orders[index].detailedAnalysis += " | Ø§Ø³ØªÙØ§Ø¯ Ù…Ù† Ø§Ù„ØªÙ‚Ù„Ø¨ Ø§Ù„Ø¹Ø§Ù„ÙŠ";
        }
    }
    
    // Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ù…Ø¹Ù„Ù‚Ø© ÙÙŠ Ø§Ù„Ø³ÙˆÙ‚ Ø§Ù„Ù‡Ø§Ø¯Ø¦
    if(isPendingOrder && orders[index].volatilityDuringTrade < 0.5) {
        orders[index].detailedAnalysis += " | Ø£Ù…Ø± Ù…Ø¹Ù„Ù‚ ÙÙŠ Ø³ÙˆÙ‚ Ù‡Ø§Ø¯Ø¦ - Ù‚Ø¯ ÙŠØ­ØªØ§Ø¬ ÙˆÙ‚Øª Ø£Ø·ÙˆÙ„";
    }
    
    // ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªÙˆÙ‚ÙŠØª
    AnalyzeTimingEffectiveness(index);
}

//+------------------------------------------------------------------+
//| ØªØ­Ù„ÙŠÙ„ ÙØ¹Ø§Ù„ÙŠØ© Ø§Ù„ØªÙˆÙ‚ÙŠØª                                           |
//+------------------------------------------------------------------+
void AnalyzeTimingEffectiveness(int index)
{
    // ØªØ­Ù„ÙŠÙ„ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø³Ø§Ø¹Ø© Ø§Ù„ØªÙ†ÙÙŠØ°
    int hour = orders[index].hourOfDay;
    
    if(hour >= 8 && hour <= 12) {
        orders[index].detailedAnalysis += " | ØªÙ†ÙÙŠØ° ÙÙŠ Ø§Ù„ØµØ¨Ø§Ø­ (Ø¬Ù„Ø³Ø© Ø£ÙˆØ±ÙˆØ¨Ø§)";
    } else if(hour >= 13 && hour <= 17) {
        orders[index].detailedAnalysis += " | ØªÙ†ÙÙŠØ° ÙÙŠ ØªØ¯Ø§Ø®Ù„ Ø§Ù„Ø¬Ù„Ø³Ø§Øª (Ø£ÙØ¶Ù„ Ø³ÙŠÙˆÙ„Ø©)";
    } else if(hour >= 18 && hour <= 22) {
        orders[index].detailedAnalysis += " | ØªÙ†ÙÙŠØ° ÙÙŠ Ø¬Ù„Ø³Ø© Ø£Ù…Ø±ÙŠÙƒØ§";
    } else {
        orders[index].detailedAnalysis += " | ØªÙ†ÙÙŠØ° ÙÙŠ Ø³Ø§Ø¹Ø§Øª Ù‡Ø§Ø¯Ø¦Ø©";
        if(orders[index].netProfit < 0) {
            stats.timeoutFailures++;
        }
    }
    
    // ØªØ­Ù„ÙŠÙ„ ÙŠÙˆÙ… Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹
    if(orders[index].dayOfWeek == "Ø§Ù„Ø¬Ù…Ø¹Ø©") {
        orders[index].detailedAnalysis += " | ÙŠÙˆÙ… Ø§Ù„Ø¬Ù…Ø¹Ø© - Ø³ÙŠÙˆÙ„Ø© Ù…ØªÙ†Ø§Ù‚ØµØ©";
    } else if(orders[index].dayOfWeek == "Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†") {
        orders[index].detailedAnalysis += " | ÙŠÙˆÙ… Ø§Ù„Ø¥Ø«Ù†ÙŠÙ† - Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹";
    }
}

//+------------------------------------------------------------------+
//| ØªØ­Ù„ÙŠÙ„ Ø´Ø§Ù…Ù„ Ù„Ù„ØµÙÙ‚Ø©                                              |
//+------------------------------------------------------------------+
void PerformComprehensiveTradeAnalysis(int index)
{
    if(!orders[index].isExecuted) return;
    
    // ØªØ¬Ù…ÙŠØ¹ ÙƒÙ„ Ø§Ù„ØªØ­Ø§Ù„ÙŠÙ„
    AnalyzeDetailedPerformance(index);
    CalculateRiskRewardMetrics(index);
    AnalyzeMarketConditions(index);
    
    // ØªÙ‚ÙŠÙŠÙ… Ø¹Ø§Ù… Ù„Ù„ØµÙÙ‚Ø©
    string overallAssessment = "";
    
    if(orders[index].netProfit > 0) {
        if(orders[index].riskRewardRatio > 2.0 && orders[index].wasCorrectDirection) {
            overallAssessment = "ØµÙÙ‚Ø© Ù…Ù…ØªØ§Ø²Ø© - Ø±Ø¨Ø­ Ø¬ÙŠØ¯ ÙˆØ¥Ø¯Ø§Ø±Ø© Ù…Ø®Ø§Ø·Ø± Ø³Ù„ÙŠÙ…Ø©";
        } else if(orders[index].wasCorrectDirection) {
            overallAssessment = "ØµÙÙ‚Ø© Ø¬ÙŠØ¯Ø© - Ø±Ø¨Ø­ Ù„ÙƒÙ† ÙŠÙ…ÙƒÙ† ØªØ­Ø³ÙŠÙ† Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø§Ø·Ø±";
        } else {
            overallAssessment = "Ø±Ø¨Ø­ Ù…Ø­Ø¸ÙˆØ¸ - Ø§Ù„Ø§ØªØ¬Ø§Ù‡ Ù„Ù… ÙŠÙƒÙ† Ù…Ø«Ø§Ù„ÙŠØ§Ù‹";
        }
    } else {
        if(orders[index].pointsToTP < 10) {
            overallAssessment = "Ø®Ø³Ø§Ø±Ø© Ù…Ø¤Ø³ÙØ© - ÙƒØ§Ù†Øª Ù‚Ø±ÙŠØ¨Ø© Ù…Ù† Ø§Ù„Ø±Ø¨Ø­";
        } else if(!orders[index].wasCorrectDirection) {
            overallAssessment = "Ø®Ø³Ø§Ø±Ø© Ù…ØªÙˆÙ‚Ø¹Ø© - Ø§Ù„Ø§ØªØ¬Ø§Ù‡ ÙƒØ§Ù† Ø®Ø§Ø·Ø¦Ø§Ù‹";
        } else {
            overallAssessment = "Ø®Ø³Ø§Ø±Ø© Ø¹Ø§Ø¯ÙŠØ© - Ø¶Ù…Ù† Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø§Ø·Ø±";
        }
    }
    
    orders[index].detailedAnalysis += " | Ø§Ù„ØªÙ‚ÙŠÙŠÙ…: " + overallAssessment;
}

//--- Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø«Ø§Ù„Ø« ---
//+------------------------------------------------------------------+
//| Expert Advisor: Advanced Zigzag Analysis Bot - Part 4/15       |
//| Ù…Ø­Ù„Ù„ Ø¨ÙˆØª Ø§Ù„Ø²Ø¬Ø²Ø§Ø¬ Ø§Ù„Ø¹Ø¨Ù‚Ø±ÙŠ - Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø±Ø§Ø¨Ø¹: Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³Ø§ÙØ§Øª ÙˆØ§Ù„Ù†Ù‚Ø§Ø· |
//+------------------------------------------------------------------+

// ØªÙƒÙ…Ù„Ø© Ù„Ù„Ø£Ø¬Ø²Ø§Ø¡ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© - Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³Ø§ÙØ§Øª ÙˆØ§Ù„Ù†Ù‚Ø§Ø· Ø¨Ø§Ù„ØªÙØµÙŠÙ„

//+------------------------------------------------------------------+
//| ØªØ­Ù„ÙŠÙ„ Ù†ÙˆØ¹ Ø§Ù„Ø£Ù…Ø± Ø§Ù„Ù…Ø­Ø¯Ø¯ ÙˆØ­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³Ø§ÙØ§Øª                         |
//+------------------------------------------------------------------+
void AnalyzeSpecificOrderType(int index)
{
    string symbol = orders[index].symbol;
    double currentPrice = 0;
    
    // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ù†ÙˆØ¹ Ø§Ù„Ø£Ù…Ø±
    if(orders[index].type == ORDER_TYPE_BUY_LIMIT || orders[index].type == ORDER_TYPE_BUY_STOP) {
        currentPrice = GetCurrentAsk(symbol);
    } else {
        currentPrice = GetCurrentBid(symbol);
    }
    
    // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³Ø§ÙØ© Ù…Ù† Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù…Ø·Ù„ÙˆØ¨
    orders[index].distanceFromPrice = MathAbs(currentPrice - orders[index].priceOpen);
    
    // ÙØ­Øµ Ù…Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø³Ø¹Ø± ÙˆØµÙ„ Ù„Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨
    CheckIfPriceReachedLevel(index);
    
    // ØªØ­Ù„ÙŠÙ„ Ù…ÙØµÙ„ Ù„ÙƒÙ„ Ù†ÙˆØ¹ Ø£Ù…Ø±
    AnalyzeOrderTypeSpecifics(index, currentPrice);
    
    // Ø­Ø³Ø§Ø¨ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø³Ø§ÙØ©
    CalculateDistanceStatistics(index);
}

//+------------------------------------------------------------------+
//| ÙØ­Øµ Ù…Ø§ Ø¥Ø°Ø§ ÙˆØµÙ„ Ø§Ù„Ø³Ø¹Ø± Ù„Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ Ø®Ù„Ø§Ù„ ÙØªØ±Ø© Ø§Ù„Ø£Ù…Ø±          |
//+------------------------------------------------------------------+
void CheckIfPriceReachedLevel(int index)
{
    string symbol = orders[index].symbol;
    datetime startTime = orders[index].timeSetup;
    datetime endTime = orders[index].timeDone;
    double point = GetSymbolPoint(symbol);
    
    // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù‚ÙŠÙ…
    double highestPrice = orders[index].priceOpen;
    double lowestPrice = orders[index].priceOpen;
    
    // ÙØ­Øµ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ø®Ù„Ø§Ù„ ÙØªØ±Ø© Ø§Ù„Ø£Ù…Ø±
    int totalBars = Bars(symbol, PERIOD_M1, startTime, endTime);
    if(totalBars > 0) {
        // ÙØ­Øµ Ø¹ÙŠÙ†Ø© Ù…Ù† Ø§Ù„Ø´Ù…ÙˆØ¹ Ù„ØªÙˆÙÙŠØ± Ø§Ù„Ø£Ø¯Ø§Ø¡
        int step = MathMax(1, totalBars / 500); // ÙØ­Øµ Ø­Ø¯ Ø£Ù‚ØµÙ‰ 500 Ø´Ù…Ø¹Ø©
        
        for(int j = 0; j < totalBars; j += step) {
            double high = iHigh(symbol, PERIOD_M1, j);
            double low = iLow(symbol, PERIOD_M1, j);
            
            if(IsValidPrice(high) && high > highestPrice) highestPrice = high;
            if(IsValidPrice(low) && low < lowestPrice) lowestPrice = low;
        }
    }
    
    // ØªØ­Ø¯ÙŠØ¯ Ø£ÙØ¶Ù„ Ø³Ø¹Ø± ÙˆØµÙ„ Ø¥Ù„ÙŠÙ‡ Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ø£Ù…Ø±
    DetermineBestPriceReached(index, highestPrice, lowestPrice, point);
    
    // ØªØ­Ù„ÙŠÙ„ Ù…Ø¯Ù‰ Ù‚Ø±Ø¨ ÙˆØµÙˆÙ„ Ø§Ù„Ø³Ø¹Ø± Ù„Ù„Ù‡Ø¯Ù
    AnalyzePriceProximity(index, point);
}

//+------------------------------------------------------------------+
//| ØªØ­Ø¯ÙŠØ¯ Ø£ÙØ¶Ù„ Ø³Ø¹Ø± ÙˆØµÙ„ Ø¥Ù„ÙŠÙ‡                                        |
//+------------------------------------------------------------------+
void DetermineBestPriceReached(int index, double highestPrice, double lowestPrice, double point)
{
    switch(orders[index].type) {
        case ORDER_TYPE_BUY_LIMIT:
        case ORDER_TYPE_SELL_STOP:
            // Ù‡Ø°Ù‡ Ø§Ù„Ø£ÙˆØ§Ù…Ø± ØªØ­ØªØ§Ø¬ Ø§Ù„Ø³Ø¹Ø± ÙŠÙ†Ø®ÙØ¶ Ù„Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨
            orders[index].bestPriceReached = lowestPrice;
            orders[index].priceReachedLevel = (lowestPrice <= orders[index].priceOpen + point); // Ù‡Ø§Ù…Ø´ Ù†Ù‚Ø·Ø© ÙˆØ§Ø­Ø¯Ø©
            orders[index].minDistanceFromTarget = MathAbs(lowestPrice - orders[index].priceOpen) / point;
            break;
            
        case ORDER_TYPE_SELL_LIMIT:
        case ORDER_TYPE_BUY_STOP:
            // Ù‡Ø°Ù‡ Ø§Ù„Ø£ÙˆØ§Ù…Ø± ØªØ­ØªØ§Ø¬ Ø§Ù„Ø³Ø¹Ø± ÙŠØ±ØªÙØ¹ Ù„Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨
            orders[index].bestPriceReached = highestPrice;
            orders[index].priceReachedLevel = (highestPrice >= orders[index].priceOpen - point); // Ù‡Ø§Ù…Ø´ Ù†Ù‚Ø·Ø© ÙˆØ§Ø­Ø¯Ø©
            orders[index].minDistanceFromTarget = MathAbs(highestPrice - orders[index].priceOpen) / point;
            break;
            
        default:
            // Ù„Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„ÙÙˆØ±ÙŠØ©
            orders[index].bestPriceReached = orders[index].priceOpen;
            orders[index].priceReachedLevel = true;
            orders[index].minDistanceFromTarget = 0;
    }
    
    // Ø­Ø³Ø§Ø¨ Ø£Ù‚ØµÙ‰ Ù…Ø³Ø§ÙØ© Ù…Ù† Ø§Ù„Ù‡Ø¯Ù
    orders[index].maxDistanceFromTarget = MathMax(
        MathAbs(highestPrice - orders[index].priceOpen) / point,
        MathAbs(lowestPrice - orders[index].priceOpen) / point
    );
}

//+------------------------------------------------------------------+
//| ØªØ­Ù„ÙŠÙ„ Ù…Ø¯Ù‰ Ù‚Ø±Ø¨ ÙˆØµÙˆÙ„ Ø§Ù„Ø³Ø¹Ø± Ù„Ù„Ù‡Ø¯Ù                                |
//+------------------------------------------------------------------+
void AnalyzePriceProximity(int index, double point)
{
    // ØªØ­Ù„ÙŠÙ„ Ù…Ø¯Ù‰ Ù‚Ø±Ø¨ Ø§Ù„Ø³Ø¹Ø± Ù…Ù† Ø§Ù„Ù‡Ø¯Ù
    if(orders[index].minDistanceFromTarget < 1.0) {
        orders[index].failureReason += "ÙˆØµÙ„ Ø§Ù„Ø³Ø¹Ø± ØªÙ‚Ø±ÙŠØ¨Ø§Ù‹ Ù„Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ (Ø£Ù‚Ù„ Ù…Ù† Ù†Ù‚Ø·Ø© ÙˆØ§Ø­Ø¯Ø©) | ";
        stats.liquidityFailures++; // ÙŠØ¹ØªØ¨Ø± Ù…Ø´ÙƒÙ„Ø© Ø³ÙŠÙˆÙ„Ø©
    } else if(orders[index].minDistanceFromTarget < 5.0) {
        orders[index].failureReason += StringFormat("ÙˆØµÙ„ Ù‚Ø±ÙŠØ¨Ø§Ù‹ Ø¬Ø¯Ø§Ù‹ Ù…Ù† Ø§Ù„Ù…Ø³ØªÙˆÙ‰ (%.1f Ù†Ù‚Ø§Ø·) | ", 
                                                   orders[index].minDistanceFromTarget);
        stats.liquidityFailures++;
    } else if(orders[index].minDistanceFromTarget < 20.0) {
        orders[index].failureReason += StringFormat("ÙˆØµÙ„ Ù‚Ø±ÙŠØ¨Ø§Ù‹ Ù…Ù† Ø§Ù„Ù…Ø³ØªÙˆÙ‰ (%.1f Ù†Ù‚Ø§Ø·) | ", 
                                                   orders[index].minDistanceFromTarget);
    } else {
        orders[index].failureReason += StringFormat("Ù„Ù… ÙŠÙ‚ØªØ±Ø¨ Ù…Ù† Ø§Ù„Ù…Ø³ØªÙˆÙ‰ - Ø£Ù‚Ø±Ø¨ Ù…Ø³Ø§ÙØ© %.1f Ù†Ù‚Ø§Ø· | ", 
                                                   orders[index].minDistanceFromTarget);
    }
    
    // ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªÙ‚Ù„Ø¨ Ø®Ù„Ø§Ù„ ÙØªØ±Ø© Ø§Ù„Ø£Ù…Ø±
    double priceRange = orders[index].maxDistanceFromTarget;
    if(priceRange > 50.0) {
        orders[index].failureReason += "Ø§Ù„Ø³ÙˆÙ‚ ÙƒØ§Ù† Ù…ØªÙ‚Ù„Ø¨Ø§Ù‹ Ø¬Ø¯Ø§Ù‹ Ø®Ù„Ø§Ù„ ÙØªØ±Ø© Ø§Ù„Ø£Ù…Ø± | ";
    } else if(priceRange < 5.0) {
        orders[index].failureReason += "Ø§Ù„Ø³ÙˆÙ‚ ÙƒØ§Ù† Ù‡Ø§Ø¯Ø¦Ø§Ù‹ Ø¬Ø¯Ø§Ù‹ Ø®Ù„Ø§Ù„ ÙØªØ±Ø© Ø§Ù„Ø£Ù…Ø± | ";
    }
}

//+------------------------------------------------------------------+
//| ØªØ­Ù„ÙŠÙ„ ØªÙØ§ØµÙŠÙ„ Ù†ÙˆØ¹ Ø§Ù„Ø£Ù…Ø±                                         |
//+------------------------------------------------------------------+
void AnalyzeOrderTypeSpecifics(int index, double currentPrice)
{
    double point = GetSymbolPoint(orders[index].symbol);
    double priceDiffPips = MathAbs(currentPrice - orders[index].priceOpen) / point;
    
    switch(orders[index].type) {
        case ORDER_TYPE_BUY_LIMIT:
            if(orders[index].priceOpen >= currentPrice) {
                orders[index].failureReason += StringFormat("Ø£Ù…Ø± Ø´Ø±Ø§Ø¡ Ù…Ø­Ø¯ÙˆØ¯ - Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ %.5f Ø£Ù‚Ù„ Ù…Ù† Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ %.5f | ", 
                                                           currentPrice, orders[index].priceOpen);
            } else {
                orders[index].failureReason += StringFormat("Ø£Ù…Ø± Ø´Ø±Ø§Ø¡ Ù…Ø­Ø¯ÙˆØ¯ - Ø§Ù„Ø³Ø¹Ø± ØªØ¬Ø§ÙˆØ² Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø¨Ù€ %.1f Ù†Ù‚Ø§Ø· | ", 
                                                           priceDiffPips);
            }
            break;
            
        case ORDER_TYPE_SELL_LIMIT:
            if(orders[index].priceOpen <= currentPrice) {
                orders[index].failureReason += StringFormat("Ø£Ù…Ø± Ø¨ÙŠØ¹ Ù…Ø­Ø¯ÙˆØ¯ - Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ %.5f Ø£Ø¹Ù„Ù‰ Ù…Ù† Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ %.5f | ", 
                                                           currentPrice, orders[index].priceOpen);
            } else {
                orders[index].failureReason += StringFormat("Ø£Ù…Ø± Ø¨ÙŠØ¹ Ù…Ø­Ø¯ÙˆØ¯ - Ø§Ù„Ø³Ø¹Ø± Ø§Ù†Ø®ÙØ¶ Ø¹Ù† Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø¨Ù€ %.1f Ù†Ù‚Ø§Ø· | ", 
                                                           priceDiffPips);
            }
            break;
            
        case ORDER_TYPE_BUY_STOP:
            if(orders[index].priceOpen <= currentPrice) {
                orders[index].failureReason += StringFormat("Ø£Ù…Ø± Ø´Ø±Ø§Ø¡ Ø¥ÙŠÙ‚Ø§Ù - Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ %.5f Ø£Ø¹Ù„Ù‰ Ù…Ù† Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ %.5f | ", 
                                                           currentPrice, orders[index].priceOpen);
            } else {
                orders[index].failureReason += StringFormat("Ø£Ù…Ø± Ø´Ø±Ø§Ø¡ Ø¥ÙŠÙ‚Ø§Ù - Ø§Ù„Ø³Ø¹Ø± Ù„Ù… ÙŠØµÙ„ Ù„Ù„Ù…Ø³ØªÙˆÙ‰ØŒ ÙŠØ­ØªØ§Ø¬ %.1f Ù†Ù‚Ø§Ø· | ", 
                                                           priceDiffPips);
            }
            break;
            
        case ORDER_TYPE_SELL_STOP:
            if(orders[index].priceOpen >= currentPrice) {
                orders[index].failureReason += StringFormat("Ø£Ù…Ø± Ø¨ÙŠØ¹ Ø¥ÙŠÙ‚Ø§Ù - Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ %.5f Ø£Ù‚Ù„ Ù…Ù† Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ %.5f | ", 
                                                           currentPrice, orders[index].priceOpen);
            } else {
                orders[index].failureReason += StringFormat("Ø£Ù…Ø± Ø¨ÙŠØ¹ Ø¥ÙŠÙ‚Ø§Ù - Ø§Ù„Ø³Ø¹Ø± Ø§Ø±ØªÙØ¹ Ø¹Ù† Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø¨Ù€ %.1f Ù†Ù‚Ø§Ø· | ", 
                                                           priceDiffPips);
            }
            break;
            
        case ORDER_TYPE_BUY:
            orders[index].failureReason += "Ø£Ù…Ø± Ø´Ø±Ø§Ø¡ ÙÙˆØ±ÙŠ - ØªÙ… Ø§Ù„ØªÙ†ÙÙŠØ° ÙÙˆØ±Ø§Ù‹ | ";
            break;
            
        case ORDER_TYPE_SELL:
            orders[index].failureReason += "Ø£Ù…Ø± Ø¨ÙŠØ¹ ÙÙˆØ±ÙŠ - ØªÙ… Ø§Ù„ØªÙ†ÙÙŠØ° ÙÙˆØ±Ø§Ù‹ | ";
            break;
            
        default:
            orders[index].failureReason += "Ù†ÙˆØ¹ Ø£Ù…Ø± ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ | ";
    }
}

//+------------------------------------------------------------------+
//| Ø­Ø³Ø§Ø¨ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø³Ø§ÙØ©                                          |
//+------------------------------------------------------------------+
void CalculateDistanceStatistics(int index)
{
    // ØªØ­Ø¯ÙŠØ« Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø³Ø§ÙØ© Ù„Ù„Ø£ÙˆØ§Ù…Ø± ØºÙŠØ± Ø§Ù„Ù…Ù†ÙØ°Ø©
    if(!orders[index].isExecuted && orders[index].minDistanceFromTarget > 0) {
        // Ø­Ø³Ø§Ø¨ Ù…ØªÙˆØ³Ø· Ø§Ù„Ù…Ø³Ø§ÙØ© Ù…Ù† Ø§Ù„Ù‡Ø¯Ù
        int nonExecutedCount = stats.totalOrders - stats.executedOrders;
        if(nonExecutedCount > 0) {
            stats.avgDistanceFromTarget = (stats.avgDistanceFromTarget * (nonExecutedCount - 1) + 
                                         orders[index].minDistanceFromTarget) / nonExecutedCount;
        }
    }
}

//+------------------------------------------------------------------+
//| ØªØ­Ø¯ÙŠØ¯ Ø­Ø§Ù„Ø© Ø§Ù„Ø³ÙˆÙ‚ ÙˆÙ‚Øª ÙˆØ¶Ø¹ Ø§Ù„Ø£Ù…Ø±                                 |
//+------------------------------------------------------------------+
void DetermineMarketConditionAtSetup(int index)
{
    string symbol = orders[index].symbol;
    double spread = GetCurrentSpread(symbol);
    double point = GetSymbolPoint(symbol);
    double spreadPips = spread / point;
    
    // ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø³Ø¨Ø±ÙŠØ¯
    if(spreadPips > HIGH_SPREAD_THRESHOLD) {
        orders[index].marketConditionAtSetup = "Ø³Ø¨Ø±ÙŠØ¯ Ø¹Ø§Ù„ÙŠ Ø¬Ø¯Ø§Ù‹";
        orders[index].failureReason += StringFormat("Ø³Ø¨Ø±ÙŠØ¯ Ø¹Ø§Ù„ÙŠ Ø¬Ø¯Ø§Ù‹ (%.1f Ù†Ù‚Ø§Ø·) | ", spreadPips);
    } else if(spreadPips > NORMAL_SPREAD_THRESHOLD) {
        orders[index].marketConditionAtSetup = "Ø³Ø¨Ø±ÙŠØ¯ Ø¹Ø§Ù„ÙŠ";
        orders[index].failureReason += StringFormat("Ø³Ø¨Ø±ÙŠØ¯ Ø¹Ø§Ù„ÙŠ (%.1f Ù†Ù‚Ø§Ø·) | ", spreadPips);
    } else if(spreadPips > 1.0) {
        orders[index].marketConditionAtSetup = "Ø³Ø¨Ø±ÙŠØ¯ Ù…ØªÙˆØ³Ø·";
    } else {
        orders[index].marketConditionAtSetup = "Ø³Ø¨Ø±ÙŠØ¯ Ø·Ø¨ÙŠØ¹ÙŠ";
    }
    
    // ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø³ÙŠÙˆÙ„Ø© ÙˆÙ‚Øª ÙˆØ¶Ø¹ Ø§Ù„Ø£Ù…Ø±
    AnalyzeLiquidityAtSetup(index);
    
    // ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªÙˆÙ‚ÙŠØª
    AnalyzeTimingAtSetup(index);
}

//+------------------------------------------------------------------+
//| ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø³ÙŠÙˆÙ„Ø© ÙˆÙ‚Øª ÙˆØ¶Ø¹ Ø§Ù„Ø£Ù…Ø±                                    |
//+------------------------------------------------------------------+
void AnalyzeLiquidityAtSetup(int index)
{
    // ØªØ­Ù„ÙŠÙ„ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ÙˆÙ‚Øª
    if(orders[index].wasWeekend) {
        orders[index].marketConditionAtSetup += " - Ù†Ù‡Ø§ÙŠØ© Ø£Ø³Ø¨ÙˆØ¹";
        orders[index].failureReason += "ÙˆØ¶Ø¹ ÙÙŠ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ (Ø³ÙŠÙˆÙ„Ø© Ù…Ù†Ø®ÙØ¶Ø©) | ";
    }
    
    if(!orders[index].wasSessionOpen) {
        orders[index].marketConditionAtSetup += " - Ø®Ø§Ø±Ø¬ Ø¬Ù„Ø³Ø§Øª Ø§Ù„ØªØ¯Ø§ÙˆÙ„";
        orders[index].failureReason += "ÙˆØ¶Ø¹ Ø®Ø§Ø±Ø¬ Ø³Ø§Ø¹Ø§Øª Ø§Ù„ØªØ¯Ø§ÙˆÙ„ Ø§Ù„Ù†Ø´Ø·Ø© | ";
    }
    
    if(orders[index].wasNewsTime) {
        orders[index].marketConditionAtSetup += " - ÙˆÙ‚Øª Ø£Ø®Ø¨Ø§Ø±";
        orders[index].failureReason += "ÙˆØ¶Ø¹ Ù‚Ø±Ø¨ ÙˆÙ‚Øª Ø§Ù„Ø£Ø®Ø¨Ø§Ø± (ØªÙ‚Ù„Ø¨ Ø¹Ø§Ù„ÙŠ Ù…ØªÙˆÙ‚Ø¹) | ";
    }
    
    // ØªØ­Ù„ÙŠÙ„ Ø­Ø¬Ù… Ø§Ù„ØµÙÙ‚Ø© Ù…Ù‚Ø§Ø±Ù†Ø© Ø¨Ø¸Ø±ÙˆÙ Ø§Ù„Ø³ÙŠÙˆÙ„Ø©
    if(orders[index].volume > 1.0 && !orders[index].wasSessionOpen) {
        orders[index].failureReason += "Ø­Ø¬Ù… ÙƒØ¨ÙŠØ± ÙÙŠ ÙˆÙ‚Øª Ø³ÙŠÙˆÙ„Ø© Ù…Ù†Ø®ÙØ¶Ø© | ";
    }
}

//+------------------------------------------------------------------+
//| ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªÙˆÙ‚ÙŠØª ÙˆÙ‚Øª ÙˆØ¶Ø¹ Ø§Ù„Ø£Ù…Ø±                                    |
//+------------------------------------------------------------------+
void AnalyzeTimingAtSetup(int index)
{
    MqlDateTime dt;
    TimeToStruct(orders[index].timeSetup, dt);
    
    // ØªØ­Ù„ÙŠÙ„ Ø³Ø§Ø¹Ø© Ø§Ù„ÙˆØ¶Ø¹
    if(dt.hour < 6) {
        orders[index].failureReason += "ÙˆØ¶Ø¹ ÙÙŠ Ø³Ø§Ø¹Ø§Øª Ø§Ù„ÙØ¬Ø± Ø§Ù„Ù…Ø¨ÙƒØ±Ø© (Ø³ÙŠÙˆÙ„Ø© Ø¶Ø¹ÙŠÙØ© Ø¬Ø¯Ø§Ù‹) | ";
    } else if(dt.hour > 22) {
        orders[index].failureReason += "ÙˆØ¶Ø¹ ÙÙŠ Ø³Ø§Ø¹Ø§Øª Ù…ØªØ£Ø®Ø±Ø© Ù…Ù† Ø§Ù„Ù„ÙŠÙ„ | ";
    }
    
    // ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙŠÙˆÙ…
    if(dt.day_of_week == 5 && dt.hour > 15) {
        orders[index].failureReason += "ÙˆØ¶Ø¹ ÙÙŠ Ù†Ù‡Ø§ÙŠØ© Ø¬Ù…Ø¹Ø© (Ø¥ØºÙ„Ø§Ù‚ Ø£Ø³Ø¨ÙˆØ¹ÙŠ Ù‚Ø±ÙŠØ¨) | ";
    } else if(dt.day_of_week == 1 && dt.hour < 8) {
        orders[index].failureReason += "ÙˆØ¶Ø¹ ÙÙŠ Ø¨Ø¯Ø§ÙŠØ© Ø¥Ø«Ù†ÙŠÙ† Ù…Ø¨ÙƒØ±Ø§Ù‹ (Ø§ÙØªØªØ§Ø­ Ø£Ø³Ø¨ÙˆØ¹ÙŠ) | ";
    }
    
    // ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…ÙˆØ³Ù… (ØªÙ‚Ø±ÙŠØ¨ÙŠ)
    if(dt.mon == 12 || dt.mon == 1) {
        orders[index].failureReason += "ÙˆØ¶Ø¹ ÙÙŠ Ù…ÙˆØ³Ù… Ø§Ù„Ø£Ø¹ÙŠØ§Ø¯ (Ø³ÙŠÙˆÙ„Ø© Ù‚Ø¯ ØªÙƒÙˆÙ† Ù…Ù†Ø®ÙØ¶Ø©) | ";
    } else if(dt.mon == 8) {
        orders[index].failureReason += "ÙˆØ¶Ø¹ ÙÙŠ Ø£ØºØ³Ø·Ø³ (Ø¹Ø·Ù„Ø§Øª ØµÙŠÙÙŠØ© - Ø³ÙŠÙˆÙ„Ø© Ù…Ù†Ø®ÙØ¶Ø©) | ";
    }
}

//+------------------------------------------------------------------+
//| ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø³Ø¨Ø¨ Ø§Ù„Ù…ÙØµÙ„ Ù„Ø¹Ø¯Ù… Ø§Ù„ØªÙ†ÙÙŠØ°                                |
//+------------------------------------------------------------------+
void DetermineDetailedFailureReason(int index)
{
    string reason = orders[index].failureReason;
    
    // Ø¥Ø¶Ø§ÙØ© ØªØ­Ù„ÙŠÙ„ Ù…ÙØµÙ„ Ø­Ø³Ø¨ ÙˆØµÙˆÙ„ Ø§Ù„Ø³Ø¹Ø± Ù„Ù„Ù…Ø³ØªÙˆÙ‰
    if(orders[index].priceReachedLevel) {
        reason += "âœ‹ Ø§Ù„Ø³Ø¹Ø± ÙˆØµÙ„ Ù„Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ Ù„ÙƒÙ† Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªÙ†ÙÙŠØ° - Ø£Ø³Ø¨Ø§Ø¨ Ù…Ø­ØªÙ…Ù„Ø©: ";
        reason += "Ù†Ù‚Øµ Ø§Ù„Ø³ÙŠÙˆÙ„Ø©ØŒ Ø³Ø±Ø¹Ø© Ø­Ø±ÙƒØ© Ø§Ù„Ø³Ø¹Ø±ØŒ Ø£Ùˆ Ø±ÙØ¶ Ø§Ù„ÙˆØ³ÙŠØ· | ";
        stats.liquidityFailures++;
    } else {
        reason += StringFormat("ğŸ“ Ø§Ù„Ø³Ø¹Ø± Ù„Ù… ÙŠØµÙ„ Ù„Ù„Ù…Ø³ØªÙˆÙ‰ - Ø£Ù‚Ø±Ø¨ Ù…Ø³Ø§ÙØ© %.1f Ù†Ù‚Ø§Ø· | ", 
                              orders[index].minDistanceFromTarget);
    }
    
    // ØªØ­Ù„ÙŠÙ„ Ù…Ø¯Ø© Ø¨Ù‚Ø§Ø¡ Ø§Ù„Ø£Ù…Ø±
    if(orders[index].orderLifetimeMinutes < SHORT_ORDER_LIFETIME) {
        reason += StringFormat("â±ï¸ Ù…Ø¯Ø© Ø§Ù„Ø£Ù…Ø± Ù‚ØµÙŠØ±Ø© Ø¬Ø¯Ø§Ù‹ (%d Ø¯Ù‚Ø§Ø¦Ù‚) - Ù‚Ø¯ Ù„Ø§ ØªÙƒÙÙŠ Ù„ÙˆØµÙˆÙ„ Ø§Ù„Ø³Ø¹Ø± | ", 
                              orders[index].orderLifetimeMinutes);
        stats.timeoutFailures++;
    } else if(orders[index].orderLifetimeMinutes > LONG_ORDER_LIFETIME) {
        reason += StringFormat("â³ Ù…Ø¯Ø© Ø§Ù„Ø£Ù…Ø± Ø·ÙˆÙŠÙ„Ø© Ø¬Ø¯Ø§Ù‹ (%.1f Ø³Ø§Ø¹Ø©) - Ø¸Ø±ÙˆÙ Ø§Ù„Ø³ÙˆÙ‚ ØªØºÙŠØ±Øª | ", 
                              orders[index].orderLifetimeMinutes / 60.0);
    }
    
    // ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ø³Ø§ÙØ© Ù…Ù† Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ
    double currentDistance = orders[index].distanceFromPrice / GetSymbolPoint(orders[index].symbol);
    if(currentDistance > 100.0) {
        reason += StringFormat("ğŸ“Š Ø§Ù„Ø£Ù…Ø± Ø¨Ø¹ÙŠØ¯ Ø¬Ø¯Ø§Ù‹ Ø¹Ù† Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ (%.1f Ù†Ù‚Ø§Ø·) | ", currentDistance);
    } else if(currentDistance < 5.0) {
        reason += StringFormat("ğŸ¯ Ø§Ù„Ø£Ù…Ø± Ù‚Ø±ÙŠØ¨ Ø¬Ø¯Ø§Ù‹ Ù…Ù† Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ (%.1f Ù†Ù‚Ø§Ø·) | ", currentDistance);
    }
    
    // ØªØ­Ù„ÙŠÙ„ Ù†Ù‡Ø§Ø¦ÙŠ Ù„Ù„Ø³Ø¨Ø¨
    AddFinalFailureAnalysis(index, reason);
    
    orders[index].failureReason = reason;
}

//+------------------------------------------------------------------+
//| Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ù„Ø³Ø¨Ø¨ Ø§Ù„ÙØ´Ù„                               |
//+------------------------------------------------------------------+
void AddFinalFailureAnalysis(int index, string &reason)
{
    // ØªØ­Ù„ÙŠÙ„ Ø´Ø§Ù…Ù„ Ù„Ù„Ø£Ø³Ø¨Ø§Ø¨
    bool hasMultipleFactors = false;
    int factorCount = 0;
    
    // Ø¹Ø¯ Ø¹ÙˆØ§Ù…Ù„ Ø§Ù„ÙØ´Ù„
    if(orders[index].wasWeekend) factorCount++;
    if(!orders[index].wasSessionOpen) factorCount++;
    if(orders[index].wasNewsTime) factorCount++;
    if(orders[index].orderLifetimeMinutes < SHORT_ORDER_LIFETIME) factorCount++;
    if(!orders[index].priceReachedLevel) factorCount++;
    
    if(factorCount > 2) {
        reason += "ğŸ“ Ø¹ÙˆØ§Ù…Ù„ Ù…ØªØ¹Ø¯Ø¯Ø© Ø³Ø§Ù‡Ù…Øª ÙÙŠ Ø¹Ø¯Ù… Ø§Ù„ØªÙ†ÙÙŠØ° | ";
        hasMultipleFactors = true;
    }
    
    // Ø§Ù‚ØªØ±Ø§Ø­ Ø­Ù„ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø³Ø¨Ø¨ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
    if(!orders[index].priceReachedLevel && orders[index].minDistanceFromTarget > 20) {
        reason += "ğŸ’¡ Ø§Ù‚ØªØ±Ø§Ø­: Ù…Ø±Ø§Ø¬Ø¹Ø© Ù†Ù‚Ø§Ø· Ø§Ù„Ø¯Ø®ÙˆÙ„ - Ø§Ù„Ø£Ù…Ø± ÙƒØ§Ù† Ø¨Ø¹ÙŠØ¯Ø§Ù‹ Ø¹Ù† Ø§Ù„Ø­Ø±ÙƒØ© Ø§Ù„ÙØ¹Ù„ÙŠØ© | ";
    } else if(orders[index].priceReachedLevel) {
        reason += "ğŸ’¡ Ø§Ù‚ØªØ±Ø§Ø­: ÙØ­Øµ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ÙˆØ³ÙŠØ· Ø£Ùˆ ØªØ­Ø³ÙŠÙ† ØªÙˆÙ‚ÙŠØª ÙˆØ¶Ø¹ Ø§Ù„Ø£ÙˆØ§Ù…Ø± | ";
    } else if(orders[index].orderLifetimeMinutes < SHORT_ORDER_LIFETIME) {
        reason += "ğŸ’¡ Ø§Ù‚ØªØ±Ø§Ø­: Ø²ÙŠØ§Ø¯Ø© Ù…Ø¯Ø© Ø§Ù†ØªÙ‡Ø§Ø¡ ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ø£ÙˆØ§Ù…Ø± | ";
    } else if(hasMultipleFactors) {
        reason += "ğŸ’¡ Ø§Ù‚ØªØ±Ø§Ø­: Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© ØªÙˆÙ‚ÙŠØª ÙˆØ¶Ø¹ Ø§Ù„Ø£ÙˆØ§Ù…Ø± | ";
    }
}

//+------------------------------------------------------------------+
//| ØªØ­Ù„ÙŠÙ„ Ø´Ø§Ù…Ù„ Ù„Ù„Ø£ÙˆØ§Ù…Ø± ØºÙŠØ± Ø§Ù„Ù…Ù†ÙØ°Ø©                                 |
//+------------------------------------------------------------------+
void PerformComprehensiveNonExecutedAnalysis(int index)
{
    if(orders[index].isExecuted) return;
    
    // ØªØ¬Ù…ÙŠØ¹ ÙƒÙ„ Ø§Ù„ØªØ­Ø§Ù„ÙŠÙ„ Ù„Ù„Ø£ÙˆØ§Ù…Ø± ØºÙŠØ± Ø§Ù„Ù…Ù†ÙØ°Ø©
    AnalyzeSpecificOrderType(index);
    DetermineMarketConditionAtSetup(index);
    DetermineDetailedFailureReason(index);
    
    // ØªÙ‚ÙŠÙŠÙ… Ø¹Ø§Ù… Ù„Ù„Ø£Ù…Ø± ØºÙŠØ± Ø§Ù„Ù…Ù†ÙØ°
    string overallAssessment = "";
    
    if(orders[index].priceReachedLevel) {
        if(orders[index].minDistanceFromTarget < 1) {
            overallAssessment = "ÙØ´Ù„ Ù…Ø­Ø¨Ø· - Ø§Ù„Ø³Ø¹Ø± ÙˆØµÙ„ ØªÙ…Ø§Ù…Ø§Ù‹ ÙˆÙ„Ù… ÙŠÙ†ÙØ°";
        } else {
            overallAssessment = "ÙØ´Ù„ Ù…Ø¤Ø³Ù - Ø§Ù„Ø³Ø¹Ø± ÙˆØµÙ„ Ù‚Ø±ÙŠØ¨Ø§Ù‹ Ø¬Ø¯Ø§Ù‹";
        }
    } else if(orders[index].minDistanceFromTarget > 50) {
        overallAssessment = "Ø£Ù…Ø± ØºÙŠØ± ÙˆØ§Ù‚Ø¹ÙŠ - Ø§Ù„Ø³Ø¹Ø± Ù„Ù… ÙŠÙ‚ØªØ±Ø¨ Ø­ØªÙ‰";
    } else if(orders[index].orderLifetimeMinutes < SHORT_ORDER_LIFETIME) {
        overallAssessment = "ÙØ´Ù„ Ù…ØªÙˆÙ‚Ø¹ - Ù…Ø¯Ø© Ù‚ØµÙŠØ±Ø© Ø¬Ø¯Ø§Ù‹";
    } else {
        overallAssessment = "ÙØ´Ù„ Ø·Ø¨ÙŠØ¹ÙŠ - Ø¸Ø±ÙˆÙ Ø§Ù„Ø³ÙˆÙ‚ Ù„Ù… ØªØ³Ø§Ø¹Ø¯";
    }
    
    orders[index].detailedAnalysis = "ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø£Ù…Ø± ØºÙŠØ± Ø§Ù„Ù…Ù†ÙØ°: " + overallAssessment;
}

//--- Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø±Ø§Ø¨Ø¹ ---
//+------------------------------------------------------------------+
//| Expert Advisor: Advanced Zigzag Analysis Bot - Part 5/15       |
//| Ù…Ø­Ù„Ù„ Ø¨ÙˆØª Ø§Ù„Ø²Ø¬Ø²Ø§Ø¬ Ø§Ù„Ø¹Ø¨Ù‚Ø±ÙŠ - Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø®Ø§Ù…Ø³: ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ø®Ø§Ø·Ø± Ø§Ù„Ù…ØªÙ‚Ø¯Ù… |
//+------------------------------------------------------------------+

// ØªÙƒÙ…Ù„Ø© Ù„Ù„Ø£Ø¬Ø²Ø§Ø¡ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© - ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ø®Ø§Ø·Ø± ÙˆØ§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…

//+------------------------------------------------------------------+
//| ØªØ­Ù„ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø¨Ø§Ù„ØªÙØµÙŠÙ„                                    |
//+------------------------------------------------------------------+
void AnalyzeAllOrders()
{
    Print("ğŸ” Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªÙØµÙŠÙ„ÙŠ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£ÙˆØ§Ù…Ø±...");
    
    for(int i = 0; i < stats.totalOrders; i++) {
        if(orders[i].isExecuted) {
            // ØªØ­Ù„ÙŠÙ„ Ø´Ø§Ù…Ù„ Ù„Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ù…Ù†ÙØ°Ø©
            AnalyzeExecutedOrderComprehensive(i);
        } else {
            // ØªØ­Ù„ÙŠÙ„ Ø´Ø§Ù…Ù„ Ù„Ù„Ø£ÙˆØ§Ù…Ø± ØºÙŠØ± Ø§Ù„Ù…Ù†ÙØ°Ø©
            AnalyzeNonExecutedOrderComprehensive(i);
        }
        
        // ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØªÙ‚Ø¯Ù…
        if(i % 50 == 0 && i > 0) {
            Print("ğŸ“Š ØªÙ… ØªØ­Ù„ÙŠÙ„ ", i, " Ø£Ù…Ø± Ù…Ù† Ø£ØµÙ„ ", stats.totalOrders);
        }
    }
    
    Print("âœ… Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªÙØµÙŠÙ„ÙŠ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£ÙˆØ§Ù…Ø±");
}

//+------------------------------------------------------------------+
//| ØªØ­Ù„ÙŠÙ„ Ø´Ø§Ù…Ù„ Ù„Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ù…Ù†ÙØ°Ø©                                     |
//+------------------------------------------------------------------+
void AnalyzeExecutedOrderComprehensive(int index)
{
    // ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„ØªÙØµÙŠÙ„ÙŠ
    PerformComprehensiveTradeAnalysis(index);
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ù„Ù„Ù…Ù†ÙØ°Ø©
    UpdateExecutedOrderStatistics(index);
    
    // ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ø®Ø§Ø·Ø± Ø§Ù„ÙØ±Ø¯ÙŠØ©
    AnalyzeIndividualRisk(index);
    
    // ØªØµÙ†ÙŠÙ Ù†Ù…Ø· Ø§Ù„ØµÙÙ‚Ø©
    ClassifyTradePattern(index);
}

//+------------------------------------------------------------------+
//| ØªØ­Ù„ÙŠÙ„ Ø´Ø§Ù…Ù„ Ù„Ù„Ø£ÙˆØ§Ù…Ø± ØºÙŠØ± Ø§Ù„Ù…Ù†ÙØ°Ø©                                 |
//+------------------------------------------------------------------+
void AnalyzeNonExecutedOrderComprehensive(int index)
{
    // ØªØ­Ù„ÙŠÙ„ Ø´Ø§Ù…Ù„ Ù„Ø¹Ø¯Ù… Ø§Ù„ØªÙ†ÙÙŠØ°
    PerformComprehensiveNonExecutedAnalysis(index);
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ù„ØºÙŠØ± Ø§Ù„Ù…Ù†ÙØ°Ø©
    UpdateNonExecutedOrderStatistics(index);
    
    // ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙØ±ØµØ© Ø§Ù„Ù…ÙÙ‚ÙˆØ¯Ø©
    AnalyzeMissedOpportunity(index);
    
    // ØªØµÙ†ÙŠÙ Ù†Ù…Ø· Ø§Ù„ÙØ´Ù„
    ClassifyFailurePattern(index);
}

//+------------------------------------------------------------------+
//| ØªØ­Ø¯ÙŠØ« Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ù…Ù†ÙØ°Ø©                                 |
//+------------------------------------------------------------------+
void UpdateExecutedOrderStatistics(int index)
{
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ ÙˆØ§Ù„Ø®Ø³Ø§Ø¦Ø±
    stats.totalProfit += orders[index].netProfit;
    stats.totalVolume += orders[index].volume;
    stats.totalCommission += orders[index].commission;
    stats.totalSwap += orders[index].swap;
    
    // ØªØµÙ†ÙŠÙ Ø§Ù„ØµÙÙ‚Ø©
    if(orders[index].netProfit > 0) {
        stats.executedWins++;
        stats.grossProfit += orders[index].netProfit;
        
        // ØªØ­Ø¯ÙŠØ« Ø£ÙƒØ¨Ø± Ø±Ø¨Ø­
        if(orders[index].netProfit > stats.maxWin) {
            stats.maxWin = orders[index].netProfit;
        }
    } else if(orders[index].netProfit < 0) {
        stats.executedLosses++;
        stats.grossLoss += MathAbs(orders[index].netProfit);
        
        // ØªØ­Ø¯ÙŠØ« Ø£ÙƒØ¨Ø± Ø®Ø³Ø§Ø±Ø©
        if(MathAbs(orders[index].netProfit) > stats.maxLoss) {
            stats.maxLoss = MathAbs(orders[index].netProfit);
        }
        
        // ØªØ­Ø¯ÙŠØ« Ø£Ù‚ØµÙ‰ Ø³Ø­Ø¨
        if(orders[index].percentageDrawdown > stats.maxDrawdownPct) {
            stats.maxDrawdownPct = orders[index].percentageDrawdown;
        }
    } else {
        stats.executedBreakeven++;
    }
    
    // ØªØ­Ø¯ÙŠØ« Ø£Ù‚ØµÙ‰ Ø±Ø¨Ø­ Ù…Ø­ØªÙ…Ù„
    if(orders[index].maxRunup > stats.maxRunupPct) {
        stats.maxRunupPct = orders[index].maxRunup;
    }
}

//+------------------------------------------------------------------+
//| ØªØ­Ø¯ÙŠØ« Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø£ÙˆØ§Ù…Ø± ØºÙŠØ± Ø§Ù„Ù…Ù†ÙØ°Ø©                             |
//+------------------------------------------------------------------+
void UpdateNonExecutedOrderStatistics(int index)
{
    // ØªØµÙ†ÙŠÙ Ø³Ø¨Ø¨ Ø¹Ø¯Ù… Ø§Ù„ØªÙ†ÙÙŠØ°
    if(orders[index].priceReachedLevel) {
        stats.priceReachedButNotExecuted++;
    } else {
        stats.priceDidntReach++;
    }
    
    // ØªØ­Ø¯ÙŠØ« Ù…ØªÙˆØ³Ø· Ù…Ø¯Ø© Ø§Ù„Ø£ÙˆØ§Ù…Ø±
    if(orders[index].orderLifetimeMinutes > 0) {
        int nonExecutedCount = stats.totalOrders - stats.executedOrders;
        if(nonExecutedCount > 0) {
            stats.avgOrderLifetime = (stats.avgOrderLifetime * (nonExecutedCount - 1) + 
                                     orders[index].orderLifetimeMinutes) / nonExecutedCount;
        }
    }
}

//+------------------------------------------------------------------+
//| ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ø®Ø§Ø·Ø± Ø§Ù„ÙØ±Ø¯ÙŠØ© Ù„Ù„ØµÙÙ‚Ø©                                   |
//+------------------------------------------------------------------+
void AnalyzeIndividualRisk(int index)
{
    if(!orders[index].isExecuted) return;
    
    // ØªØ­Ù„ÙŠÙ„ Ø­Ø¬Ù… Ø§Ù„Ù…Ø®Ø§Ø·Ø±Ø©
    double accountBalance = AccountInfoDouble(ACCOUNT_BALANCE);
    if(accountBalance > 0) {
        double riskAmount = MathAbs(orders[index].netProfit);
        double riskPercentage = riskAmount / accountBalance * 100;
        
        if(riskPercentage > 5.0) {
            orders[index].detailedAnalysis += StringFormat(" | Ù…Ø®Ø§Ø·Ø±Ø© Ø¹Ø§Ù„ÙŠØ© (%.2f%% Ù…Ù† Ø§Ù„Ø­Ø³Ø§Ø¨)", riskPercentage);
        } else if(riskPercentage > 2.0) {
            orders[index].detailedAnalysis += StringFormat(" | Ù…Ø®Ø§Ø·Ø±Ø© Ù…ØªÙˆØ³Ø·Ø© (%.2f%% Ù…Ù† Ø§Ù„Ø­Ø³Ø§Ø¨)", riskPercentage);
        }
    }
    
    // ØªØ­Ù„ÙŠÙ„ Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø®Ø§Ø·Ø± Ù„Ù„Ø¹ÙˆØ§Ø¦Ø¯
    if(orders[index].riskRewardRatio > 0) {
        if(orders[index].riskRewardRatio < 1.0) {
            orders[index].detailedAnalysis += " | Ù†Ø³Ø¨Ø© Ù…Ø®Ø§Ø·Ø±/Ø¹Ø§Ø¦Ø¯ Ø³ÙŠØ¦Ø© (Ø£Ù‚Ù„ Ù…Ù† 1:1)";
        } else if(orders[index].riskRewardRatio > 3.0) {
            orders[index].detailedAnalysis += " | Ù†Ø³Ø¨Ø© Ù…Ø®Ø§Ø·Ø±/Ø¹Ø§Ø¦Ø¯ Ù…Ù…ØªØ§Ø²Ø© (Ø£ÙƒØ«Ø± Ù…Ù† 3:1)";
        }
    }
    
    // ØªØ­Ù„ÙŠÙ„ ÙØ¹Ø§Ù„ÙŠØ© Ø§Ù„Ø³ØªÙˆØ¨ Ù„ÙˆØ²
    AnalyzeStopLossEffectiveness(index);
    
    // ØªØ­Ù„ÙŠÙ„ ÙØ¹Ø§Ù„ÙŠØ© Ø§Ù„ØªÙŠÙƒ Ø¨Ø±ÙˆÙØª
    AnalyzeTakeProfitEffectiveness(index);
}

//+------------------------------------------------------------------+
//| ØªØ­Ù„ÙŠÙ„ ÙØ¹Ø§Ù„ÙŠØ© Ø§Ù„Ø³ØªÙˆØ¨ Ù„ÙˆØ²                                        |
//+------------------------------------------------------------------+
void AnalyzeStopLossEffectiveness(int index)
{
    if(!IsValidPrice(orders[index].sl)) {
        orders[index].detailedAnalysis += " | Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø³ØªÙˆØ¨ Ù„ÙˆØ² (Ù…Ø®Ø§Ø·Ø±Ø© Ø¹Ø§Ù„ÙŠØ©)";
        return;
    }
    
    double point = GetSymbolPoint(orders[index].symbol);
    double slDistance = MathAbs(orders[index].priceOpen - orders[index].sl) / point;
    
    // ØªØ­Ù„ÙŠÙ„ Ù…Ø³Ø§ÙØ© Ø§Ù„Ø³ØªÙˆØ¨ Ù„ÙˆØ²
    if(slDistance < 10) {
        orders[index].detailedAnalysis += StringFormat(" | Ø³ØªÙˆØ¨ Ù„ÙˆØ² Ù‚Ø±ÙŠØ¨ Ø¬Ø¯Ø§Ù‹ (%.1f Ù†Ù‚Ø§Ø·)", slDistance);
    } else if(slDistance > 100) {
        orders[index].detailedAnalysis += StringFormat(" | Ø³ØªÙˆØ¨ Ù„ÙˆØ² Ø¨Ø¹ÙŠØ¯ Ø¬Ø¯Ø§Ù‹ (%.1f Ù†Ù‚Ø§Ø·)", slDistance);
    }
    
    // ØªØ­Ù„ÙŠÙ„ Ø¥Ø°Ø§ ØªÙ… Ø¶Ø±Ø¨ Ø§Ù„Ø³ØªÙˆØ¨ Ù„ÙˆØ²
    if(orders[index].hitStopLoss) {
        if(orders[index].pointsToSL <= 1) {
            orders[index].detailedAnalysis += " | Ø¶Ø±Ø¨ Ø§Ù„Ø³ØªÙˆØ¨ Ù„ÙˆØ² Ø¨Ø¯Ù‚Ø©";
        } else {
            orders[index].detailedAnalysis += StringFormat(" | ØªØ¬Ø§ÙˆØ² Ø§Ù„Ø³ØªÙˆØ¨ Ù„ÙˆØ² Ø¨Ù€ %.1f Ù†Ù‚Ø§Ø·", orders[index].pointsToSL);
        }
    }
}

//+------------------------------------------------------------------+
//| ØªØ­Ù„ÙŠÙ„ ÙØ¹Ø§Ù„ÙŠØ© Ø§Ù„ØªÙŠÙƒ Ø¨Ø±ÙˆÙØª                                       |
//+------------------------------------------------------------------+
void AnalyzeTakeProfitEffectiveness(int index)
{
    if(!IsValidPrice(orders[index].tp)) {
        orders[index].detailedAnalysis += " | Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªÙŠÙƒ Ø¨Ø±ÙˆÙØª (Ù‚Ø¯ ÙŠÙÙˆØª Ø£Ø±Ø¨Ø§Ø­)";
        return;
    }
    
    double point = GetSymbolPoint(orders[index].symbol);
    double tpDistance = MathAbs(orders[index].tp - orders[index].priceOpen) / point;
    
    // ØªØ­Ù„ÙŠÙ„ Ù…Ø³Ø§ÙØ© Ø§Ù„ØªÙŠÙƒ Ø¨Ø±ÙˆÙØª
    if(tpDistance < 10) {
        orders[index].detailedAnalysis += StringFormat(" | ØªÙŠÙƒ Ø¨Ø±ÙˆÙØª Ù‚Ø±ÙŠØ¨ Ø¬Ø¯Ø§Ù‹ (%.1f Ù†Ù‚Ø§Ø·)", tpDistance);
    } else if(tpDistance > 200) {
        orders[index].detailedAnalysis += StringFormat(" | ØªÙŠÙƒ Ø¨Ø±ÙˆÙØª Ø¨Ø¹ÙŠØ¯ Ø¬Ø¯Ø§Ù‹ (%.1f Ù†Ù‚Ø§Ø·)", tpDistance);
    }
    
    // ØªØ­Ù„ÙŠÙ„ Ø¥Ø°Ø§ ØªÙ… Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù‡Ø¯Ù
    if(orders[index].hitTakeProfit) {
        orders[index].detailedAnalysis += " | ÙˆØµÙ„ Ù„Ù„Ù‡Ø¯Ù Ø¨Ù†Ø¬Ø§Ø­";
    } else if(orders[index].pointsToTP > 0 && orders[index].pointsToTP < 10) {
        orders[index].detailedAnalysis += StringFormat(" | ÙƒØ§Ù† Ù‚Ø±ÙŠØ¨Ø§Ù‹ Ù…Ù† Ø§Ù„Ù‡Ø¯Ù (%.1f Ù†Ù‚Ø§Ø· ÙÙ‚Ø·)", orders[index].pointsToTP);
    } else if(orders[index].pointsToTP > 50) {
        orders[index].detailedAnalysis += " | ÙƒØ§Ù† Ø¨Ø¹ÙŠØ¯Ø§Ù‹ Ø¹Ù† Ø§Ù„Ù‡Ø¯Ù";
    }
}

//+------------------------------------------------------------------+
//| ØªØµÙ†ÙŠÙ Ù†Ù…Ø· Ø§Ù„ØµÙÙ‚Ø©                                               |
//+------------------------------------------------------------------+
void ClassifyTradePattern(int index)
{
    if(!orders[index].isExecuted) return;
    
    string pattern = "";
    
    // ØªØµÙ†ÙŠÙ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù†ØªÙŠØ¬Ø© ÙˆØ§Ù„Ø³Ù„ÙˆÙƒ
    if(orders[index].netProfit > 0) {
        if(orders[index].hitTakeProfit) {
            pattern = "ØµÙÙ‚Ø© Ù…Ø«Ø§Ù„ÙŠØ©";
        } else if(orders[index].wasCorrectDirection) {
            pattern = "ØµÙÙ‚Ø© Ø¬ÙŠØ¯Ø© - Ø¥ØºÙ„Ø§Ù‚ Ù…Ø¨ÙƒØ±";
        } else {
            pattern = "Ø±Ø¨Ø­ Ù…Ø­Ø¸ÙˆØ¸";
        }
    } else {
        if(orders[index].hitStopLoss) {
            pattern = "Ø®Ø³Ø§Ø±Ø© Ù…Ø­ÙƒÙˆÙ…Ø© - Ø³ØªÙˆØ¨ Ù„ÙˆØ²";
        } else if(!orders[index].wasCorrectDirection) {
            pattern = "Ø®Ø³Ø§Ø±Ø© - Ø§ØªØ¬Ø§Ù‡ Ø®Ø§Ø·Ø¦";
        } else if(orders[index].pointsToTP < 10) {
            pattern = "Ø®Ø³Ø§Ø±Ø© Ù…Ø¤Ø³ÙØ© - Ù‚Ø±ÙŠØ¨ Ù…Ù† Ø§Ù„Ù‡Ø¯Ù";
        } else {
            pattern = "Ø®Ø³Ø§Ø±Ø© - Ø¥ØºÙ„Ø§Ù‚ Ù…Ø¨ÙƒØ±";
        }
    }
    
    orders[index].detailedAnalysis += " | Ø§Ù„Ù†Ù…Ø·: " + pattern;
}

//+------------------------------------------------------------------+
//| ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙØ±ØµØ© Ø§Ù„Ù…ÙÙ‚ÙˆØ¯Ø©                                          |
//+------------------------------------------------------------------+
void AnalyzeMissedOpportunity(int index)
{
    if(orders[index].isExecuted) return;
    
    // ØªØ­Ù„ÙŠÙ„ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª ÙØ±ØµØ© Ø¬ÙŠØ¯Ø© Ù…ÙÙ‚ÙˆØ¯Ø©
    if(orders[index].priceReachedLevel) {
        // Ø§Ù„Ø³Ø¹Ø± ÙˆØµÙ„ Ù„ÙƒÙ† Ù„Ù… ÙŠÙ†ÙØ° - ÙØ±ØµØ© Ù…ÙÙ‚ÙˆØ¯Ø©
        orders[index].detailedAnalysis += " | ÙØ±ØµØ© Ù…ÙÙ‚ÙˆØ¯Ø© - Ø§Ù„Ø³Ø¹Ø± ÙˆØµÙ„ Ù„Ù„Ù…Ø³ØªÙˆÙ‰";
        
        // ØªÙ‚Ø¯ÙŠØ± Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ù…Ø­ØªÙ…Ù„ Ø§Ù„Ù…ÙÙ‚ÙˆØ¯
        EstimateMissedProfit(index);
    } else {
        // Ø§Ù„Ø³Ø¹Ø± Ù„Ù… ÙŠØµÙ„ - ØªØ­Ù„ÙŠÙ„ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‚Ø±ÙŠØ¨
        if(orders[index].minDistanceFromTarget < 20) {
            orders[index].detailedAnalysis += " | ÙØ±ØµØ© Ù…Ø­ØªÙ…Ù„Ø© - Ø§Ù„Ø³Ø¹Ø± Ø§Ù‚ØªØ±Ø¨";
        } else {
            orders[index].detailedAnalysis += " | Ø£Ù…Ø± ØºÙŠØ± ÙˆØ§Ù‚Ø¹ÙŠ - Ø§Ù„Ø³Ø¹Ø± Ù„Ù… ÙŠÙ‚ØªØ±Ø¨";
        }
    }
}

//+------------------------------------------------------------------+
//| ØªÙ‚Ø¯ÙŠØ± Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ù…ÙÙ‚ÙˆØ¯                                            |
//+------------------------------------------------------------------+
void EstimateMissedProfit(int index)
{
    if(!IsValidPrice(orders[index].tp)) return;
    
    double point = GetSymbolPoint(orders[index].symbol);
    double potentialPips = MathAbs(orders[index].tp - orders[index].priceOpen) / point;
    double potentialProfit = potentialPips * orders[index].volume * 10; // ØªÙ‚Ø¯ÙŠØ± ØªÙ‚Ø±ÙŠØ¨ÙŠ
    
    orders[index].detailedAnalysis += StringFormat(" | Ø±Ø¨Ø­ Ù…Ø­ØªÙ…Ù„ Ù…ÙÙ‚ÙˆØ¯: %.0f Ù†Ù‚Ø§Ø· (~%.2f$)", 
                                                   potentialPips, potentialProfit);
}

//+------------------------------------------------------------------+
//| ØªØµÙ†ÙŠÙ Ù†Ù…Ø· Ø§Ù„ÙØ´Ù„                                                |
//+------------------------------------------------------------------+
void ClassifyFailurePattern(int index)
{
    if(orders[index].isExecuted) return;
    
    string failureType = "";
    
    if(orders[index].state == ORDER_STATE_REJECTED) {
        failureType = "Ø±ÙØ¶ Ø§Ù„ÙˆØ³ÙŠØ·";
    } else if(orders[index].state == ORDER_STATE_CANCELED) {
        failureType = "Ø¥Ù„ØºØ§Ø¡ ÙŠØ¯ÙˆÙŠ";
    } else if(orders[index].state == ORDER_STATE_EXPIRED) {
        if(orders[index].priceReachedLevel) {
            failureType = "ÙØ´Ù„ ØªÙ‚Ù†ÙŠ - ÙˆØµÙ„ Ø§Ù„Ø³Ø¹Ø±";
        } else if(orders[index].minDistanceFromTarget < 10) {
            failureType = "ÙØ´Ù„ Ø¨Ø³ÙŠØ· - ÙƒØ§Ù† Ù‚Ø±ÙŠØ¨";
        } else {
            failureType = "ÙØ´Ù„ Ø·Ø¨ÙŠØ¹ÙŠ - Ù„Ù… ÙŠØµÙ„ Ø§Ù„Ø³Ø¹Ø±";
        }
    } else {
        failureType = "ÙØ´Ù„ ØºÙŠØ± Ù…Ø­Ø¯Ø¯";
    }
    
    orders[index].detailedAnalysis += " | Ù†ÙˆØ¹ Ø§Ù„ÙØ´Ù„: " + failureType;
}

//+------------------------------------------------------------------+
//| Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø´Ø§Ù…Ù„Ø©                                        |
//+------------------------------------------------------------------+
void CalculateGlobalStatistics()
{
    Print("ğŸ“Š Ø¬Ø§Ø±ÙŠ Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø´Ø§Ù…Ù„Ø©...");
    
    // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¹Ø¯Ù„Ø§Øª ÙˆØ§Ù„Ù†Ø³Ø¨ Ù„Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ù…Ù†ÙØ°Ø© ÙÙ‚Ø·
    CalculateExecutedOrderRatios();
    
    // Ø­Ø³Ø§Ø¨ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø®Ø§Ø·Ø±
    CalculateRiskStatistics();
    
    // ØªØ­Ù„ÙŠÙ„ Ø£Ù†Ù…Ø§Ø· Ø§Ù„ÙˆÙ‚Øª
    AnalyzeTimePatterns();
    
    // ØªØ­Ù„ÙŠÙ„ Ø£Ù†Ù…Ø§Ø· Ø§Ù„ÙØ´Ù„
    AnalyzeFailurePatterns();
    
    // Ø­Ø³Ø§Ø¨ Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©
    CalculateAdvancedPerformanceMetrics();
    
    Print("âœ… ØªÙ… Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø´Ø§Ù…Ù„Ø©");
}

//+------------------------------------------------------------------+
//| Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¹Ø¯Ù„Ø§Øª ÙˆØ§Ù„Ù†Ø³Ø¨ Ù„Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ù…Ù†ÙØ°Ø©                          |
//+------------------------------------------------------------------+
void CalculateExecutedOrderRatios()
{
    if(stats.executedOrders <= 0) return;
    
    // Ù…Ø¹Ø¯Ù„ Ø§Ù„Ù†Ø¬Ø§Ø­ Ù„Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ù…Ù†ÙØ°Ø© ÙÙ‚Ø·
    stats.winRate = CalculatePercentage(stats.executedWins, stats.executedOrders);
    
    // Ù…ØªÙˆØ³Ø·Ø§Øª Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ ÙˆØ§Ù„Ø®Ø³Ø§Ø¦Ø±
    stats.avgWin = CalculateAverage(stats.grossProfit, stats.executedWins);
    stats.avgLoss = CalculateAverage(stats.grossLoss, stats.executedLosses);
    
    // Ù…Ø¹Ø§Ù…Ù„ Ø§Ù„Ø±Ø¨Ø­
    stats.profitFactor = CalculateRatio(stats.grossProfit, stats.grossLoss);
    
    // Ù…ØªÙˆØ³Ø· Ø­Ø¬Ù… Ø§Ù„ØµÙÙ‚Ø©
    stats.avgVolume = CalculateAverage(stats.totalVolume, stats.executedOrders);
    
    // Ù†Ø³Ø¨ Ø£Ø®Ø±Ù‰
    if(stats.executedLosses > 0) {
        stats.avgDrawdownPct = stats.maxDrawdownPct / stats.executedLosses;
    }
    
    if(stats.executedWins > 0) {
        stats.avgRiskReward = CalculateAverage(stats.grossProfit / stats.executedWins, 
                                              stats.grossLoss / MathMax(stats.executedLosses, 1));
    }
}

//+------------------------------------------------------------------+
//| Ø­Ø³Ø§Ø¨ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø®Ø§Ø·Ø±                                          |
//+------------------------------------------------------------------+
void CalculateRiskStatistics()
{
    double totalRiskReward = 0;
    int validRRCount = 0;
    
    for(int i = 0; i < stats.totalOrders; i++) {
        if(orders[i].isExecuted && orders[i].riskRewardRatio > 0) {
            totalRiskReward += orders[i].riskRewardRatio;
            validRRCount++;
        }
    }
    
    if(validRRCount > 0) {
        stats.avgRiskReward = totalRiskReward / validRRCount;
    }
    
    // Ø­Ø³Ø§Ø¨ Ù…Ø¹Ø§Ù…Ù„ Ø´Ø§Ø±Ø¨ ØªÙ‚Ø±ÙŠØ¨ÙŠ
    if(stats.executedOrders > 1 && stats.avgLoss > 0) {
        double avgReturn = stats.totalProfit / stats.executedOrders;
        double returnStdDev = CalculateReturnStandardDeviation();
        if(returnStdDev > 0) {
            stats.sharpeRatio = avgReturn / returnStdDev;
        }
    }
    
    // Ù…Ø¹Ø§Ù…Ù„ Ø§Ù„Ø§Ø³ØªØ±Ø¯Ø§Ø¯
    if(stats.maxDrawdownPct > 0) {
        stats.recoveryFactor = stats.totalProfit / stats.maxDrawdownPct;
    }
}

//+------------------------------------------------------------------+
//| Ø­Ø³Ø§Ø¨ Ø§Ù„Ø§Ù†Ø­Ø±Ø§Ù Ø§Ù„Ù…Ø¹ÙŠØ§Ø±ÙŠ Ù„Ù„Ø¹ÙˆØ§Ø¦Ø¯                                 |
//+------------------------------------------------------------------+
double CalculateReturnStandardDeviation()
{
    if(stats.executedOrders <= 1) return 0;
    
    double avgReturn = stats.totalProfit / stats.executedOrders;
    double sumSquaredDiffs = 0;
    
    for(int i = 0; i < stats.totalOrders; i++) {
        if(orders[i].isExecuted) {
            double diff = orders[i].netProfit - avgReturn;
            sumSquaredDiffs += diff * diff;
        }
    }
    
    return MathSqrt(sumSquaredDiffs / (stats.executedOrders - 1));
}

//+------------------------------------------------------------------+
//| ØªØ­Ù„ÙŠÙ„ Ø£Ù†Ù…Ø§Ø· Ø§Ù„ÙˆÙ‚Øª                                              |
//+------------------------------------------------------------------+
void AnalyzeTimePatterns()
{
    int hourlyStats[24][3]; // [hour][total, executed, profitable]
    int dailyStats[7][3];   // [day][total, executed, profitable]
    
    // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù…ØµÙÙˆÙØ§Øª
    ArrayInitialize(hourlyStats, 0);
    ArrayInitialize(dailyStats, 0);
    
    // Ø¬Ù…Ø¹ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
    for(int i = 0; i < stats.totalOrders; i++) {
        int hour = orders[i].hourOfDay;
        MqlDateTime dt;
        TimeToStruct(orders[i].timeSetup, dt);
        int day = dt.day_of_week;
        
        // Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø³Ø§Ø¹Ø§Øª
        if(hour >= 0 && hour < 24) {
            hourlyStats[hour][0]++; // Ø¥Ø¬Ù…Ø§Ù„ÙŠ
            if(orders[i].isExecuted) {
                hourlyStats[hour][1]++; // Ù…Ù†ÙØ°Ø©
                if(orders[i].netProfit > 0) {
                    hourlyStats[hour][2]++; // Ø±Ø§Ø¨Ø­Ø©
                }
            }
        }
        
        // Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø£ÙŠØ§Ù…
        if(day >= 0 && day < 7) {
            dailyStats[day][0]++; // Ø¥Ø¬Ù…Ø§Ù„ÙŠ
            if(orders[i].isExecuted) {
                dailyStats[day][1]++; // Ù…Ù†ÙØ°Ø©
                if(orders[i].netProfit > 0) {
                    dailyStats[day][2]++; // Ø±Ø§Ø¨Ø­Ø©
                }
            }
        }
    }
    
    // ØªØ­Ø¯ÙŠØ¯ Ø£ÙØ¶Ù„ ÙˆØ£Ø³ÙˆØ£ Ø£ÙˆÙ‚Ø§Øª
    FindBestAndWorstTimes(hourlyStats, dailyStats);
}

//+------------------------------------------------------------------+
//| ØªØ­Ø¯ÙŠØ¯ Ø£ÙØ¶Ù„ ÙˆØ£Ø³ÙˆØ£ Ø£ÙˆÙ‚Ø§Øª Ù„Ù„ØªØ¯Ø§ÙˆÙ„                                |
//+------------------------------------------------------------------+
void FindBestAndWorstTimes(int hourlyStats[][3], int dailyStats[][3])
{
    double bestHourRate = 0;
    double worstHourRate = 100;
    
    // ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø³Ø§Ø¹Ø§Øª
    for(int h = 0; h < 24; h++) {
        if(hourlyStats[h][1] >= 3) { // Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ 3 ØµÙÙ‚Ø§Øª Ù…Ù†ÙØ°Ø©
            double execRate = CalculatePercentage(hourlyStats[h][1], hourlyStats[h][0]);
            if(execRate > bestHourRate) {
                bestHourRate = execRate;
                stats.bestHourExecution = h;
                stats.bestHourExecutionRate = execRate;
            }
            if(execRate < worstHourRate) {
                worstHourRate = execRate;
                stats.worstHourExecution = h;
                stats.worstHourExecutionRate = execRate;
            }
        }
    }
    
    // ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£ÙŠØ§Ù…
    double bestDayRate = 0;
    double worstDayRate = 100;
    
    for(int d = 0; d < 7; d++) {
        if(dailyStats[d][1] >= 3) { // Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ 3 ØµÙÙ‚Ø§Øª Ù…Ù†ÙØ°Ø©
            double execRate = CalculatePercentage(dailyStats[d][1], dailyStats[d][0]);
            if(execRate > bestDayRate) {
                bestDayRate = execRate;
                stats.bestDayExecution = d;
            }
            if(execRate < worstDayRate) {
                worstDayRate = execRate;
                stats.worstDayExecution = d;
            }
        }
    }
}

//+------------------------------------------------------------------+
//| ØªØ­Ù„ÙŠÙ„ Ø£Ù†Ù…Ø§Ø· Ø§Ù„ÙØ´Ù„ Ø§Ù„Ø´Ø§Ù…Ù„Ø©                                      |
//+------------------------------------------------------------------+
void AnalyzeFailurePatterns()
{
    // Ø¹Ø¯ Ø£Ù†Ù…Ø§Ø· Ø§Ù„ÙØ´Ù„ Ù…Ù† Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ø³Ø¨Ù‚
    for(int i = 0; i < stats.totalOrders; i++) {
        if(!orders[i].isExecuted || orders[i].netProfit < 0) {
            // ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø§Ø¯Ø§Øª Ø£Ù†Ù…Ø§Ø· Ø§Ù„ÙØ´Ù„ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ø³Ø¨Ù‚
            string analysis = orders[i].failureReason + orders[i].detailedAnalysis;
            
            if(StringFind(analysis, "Ø³Ø¨Ø±ÙŠØ¯ Ø¹Ø§Ù„ÙŠ", 0) >= 0) {
                stats.highSpreadFailures++;
            }
            if(StringFind(analysis, "Ø§ØªØ¬Ø§Ù‡", 0) >= 0) {
                stats.wrongDirectionFailures++;
            }
            if(StringFind(analysis, "Ù‚Ø±ÙŠØ¨Ø§Ù‹ Ù…Ù† Ø§Ù„Ù‡Ø¯Ù", 0) >= 0) {
                stats.almostTPFailures++;
            }
            if(StringFind(analysis, "Ø§Ù†Ø²Ù„Ø§Ù‚", 0) >= 0) {
                stats.slippageFailures++;
            }
            if(StringFind(analysis, "Ø³ÙŠÙˆÙ„Ø©", 0) >= 0) {
                stats.liquidityFailures++;
            }
            if(StringFind(analysis, "Ø³Ø§Ø¹Ø§Øª Ù‡Ø§Ø¯Ø¦Ø©", 0) >= 0 || StringFind(analysis, "Ù†Ù‡Ø§ÙŠØ© Ø£Ø³Ø¨ÙˆØ¹", 0) >= 0) {
                stats.timeoutFailures++;
            }
        }
    }
}

//+------------------------------------------------------------------+
//| Ø­Ø³Ø§Ø¨ Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©                                    |
//+------------------------------------------------------------------+
void CalculateAdvancedPerformanceMetrics()
{
    // Ø­Ø³Ø§Ø¨ Ù…ØªÙˆØ³Ø· Ø§Ù„Ø§Ù†Ø²Ù„Ø§Ù‚ ÙˆØ§Ù„Ø³Ø¨Ø±ÙŠØ¯ (ØªÙ… ÙÙŠ Ø§Ù„Ø£Ø¬Ø²Ø§Ø¡ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©)
    
    // Ø­Ø³Ø§Ø¨ Ù†Ø³Ø¨Ø© ØªÙ†ÙÙŠØ° Ø§Ù„Ø£ÙˆØ§Ù…Ø±
    double executionRate = CalculatePercentage(stats.executedOrders, stats.totalOrders);
    
    // ØªØ­Ù„ÙŠÙ„ Ø¬ÙˆØ¯Ø© Ø§Ù„ØªÙ†ÙÙŠØ°
    double qualityScore = 0;
    if(stats.executedOrders > 0) {
        qualityScore += (stats.winRate / 100.0) * 40; // 40% Ù„Ù„Ø±Ø¨Ø­ÙŠØ©
        qualityScore += (executionRate / 100.0) * 30; // 30% Ù„Ù…Ø¹Ø¯Ù„ Ø§Ù„ØªÙ†ÙÙŠØ°
        qualityScore += MathMin(stats.profitFactor / 2.0, 1.0) * 30; // 30% Ù„Ù…Ø¹Ø§Ù…Ù„ Ø§Ù„Ø±Ø¨Ø­
    }
    
    // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù†ØªÙŠØ¬Ø© Ù„Ù„ØªØ­Ù„ÙŠÙ„
    Print("ğŸ“Š Ù†Ù‚Ø§Ø· Ø§Ù„Ø¬ÙˆØ¯Ø© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©: ", DoubleToString(qualityScore, 1), "/100");
}

//--- Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø®Ø§Ù…Ø³ ---
//+------------------------------------------------------------------+
//| Expert Advisor: Advanced Zigzag Analysis Bot - Part 6/15       |
//| Ù…Ø­Ù„Ù„ Ø¨ÙˆØª Ø§Ù„Ø²Ø¬Ø²Ø§Ø¬ Ø§Ù„Ø¹Ø¨Ù‚Ø±ÙŠ - Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø³Ø§Ø¯Ø³: ØºÙŠØ± Ø§Ù„Ù…Ù†ÙØ°Ø© Ø§Ù„Ø£ÙˆÙ„    |
//+------------------------------------------------------------------+

// ØªÙƒÙ…Ù„Ø© Ù„Ù„Ø£Ø¬Ø²Ø§Ø¡ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© - ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£ÙˆØ§Ù…Ø± ØºÙŠØ± Ø§Ù„Ù…Ù†ÙØ°Ø© Ø¨Ø§Ù„ØªÙØµÙŠÙ„

//+------------------------------------------------------------------+
//| Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…ØªÙ‚Ø¯Ù… Ø§Ù„Ø´Ø§Ù…Ù„                                   |
//+------------------------------------------------------------------+
void GenerateAdvancedReport()
{
    Print("\n");
    Print("==========================================");
    Print("ğŸ“Š ØªÙ‚Ø±ÙŠØ± Ù…Ø­Ù„Ù„ Ø¨ÙˆØª Ø§Ù„Ø²Ø¬Ø²Ø§Ø¬ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…");
    Print("ğŸ“… ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚Ø±ÙŠØ±: ", TimeToString(TimeCurrent()));
    Print("â±ï¸ ÙØªØ±Ø© Ø§Ù„ØªØ­Ù„ÙŠÙ„: ", AnalysisPeriodDays, " ÙŠÙˆÙ…");
    Print("==========================================");
    
    // Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¹Ø§Ù…Ø©
    GenerateOverallStatistics();
    
    // ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ù…Ù†ÙØ°Ø© (Ù„Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©)
    GenerateExecutedOrdersAnalysis();
    
    // ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£ÙˆØ§Ù…Ø± ØºÙŠØ± Ø§Ù„Ù…Ù†ÙØ°Ø© (Ù„Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ÙÙ‚Ø·)
    GenerateNonExecutedOrdersAnalysis();
    
    // ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ù†Ù…Ø§Ø· ÙˆØ§Ù„ØªÙˆØµÙŠØ§Øª
    GeneratePatternAnalysis();
    
    // Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªÙØµÙŠÙ„ÙŠ Ù„Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„ÙØ±Ø¯ÙŠØ©
    if(ShowDetailedReport) {
        GenerateDetailedOrderAnalysis();
    }
    
    // Ø§Ù„ØªÙˆØµÙŠØ§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©
    GenerateAdvancedRecommendations();
    
    Print("==========================================");
}

//+------------------------------------------------------------------+
//| Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¹Ø§Ù…Ø©                                        |
//+------------------------------------------------------------------+
void GenerateOverallStatistics()
{
    Print("\nğŸ“Š Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¹Ø§Ù…Ø©:");
    Print("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”");
    Print("ğŸ”¢ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£ÙˆØ§Ù…Ø±: ", stats.totalOrders);
    Print("âœ… Ø£ÙˆØ§Ù…Ø± Ù…Ù†ÙØ°Ø©: ", stats.executedOrders, " (", DoubleToString(CalculatePercentage(stats.executedOrders, stats.totalOrders), 1), "%)");
    Print("â° Ø£ÙˆØ§Ù…Ø± Ù…Ù†ØªÙ‡ÙŠØ© Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©: ", stats.pendingExpired, " (", DoubleToString(CalculatePercentage(stats.pendingExpired, stats.totalOrders), 1), "%)");
    Print("âŒ Ø£ÙˆØ§Ù…Ø± Ù…Ù„ØºØ§Ø©: ", stats.pendingCancelled, " (", DoubleToString(CalculatePercentage(stats.pendingCancelled, stats.totalOrders), 1), "%)");
    Print("ğŸš« Ø£ÙˆØ§Ù…Ø± Ù…Ø±ÙÙˆØ¶Ø©: ", stats.pendingRejected, " (", DoubleToString(CalculatePercentage(stats.pendingRejected, stats.totalOrders), 1), "%)");
    Print("âš¡ Ø£ÙˆØ§Ù…Ø± Ø¬Ø²Ø¦ÙŠØ©: ", stats.partiallyFilled);
    Print("ğŸ“ˆ Ù…Ø¹Ø¯Ù„ Ø§Ù„ØªÙ†ÙÙŠØ°: ", DoubleToString(CalculatePercentage(stats.executedOrders, stats.totalOrders), 1), "%");
    
    // Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ÙˆÙ‚Øª
    Print("\nâ° Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ØªÙˆÙ‚ÙŠØª:");
    Print("ğŸŒ… Ø£ÙˆØ§Ù…Ø± Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹: ", stats.weekendOrders);
    Print("ğŸ“° Ø£ÙˆØ§Ù…Ø± ÙˆÙ‚Øª Ø§Ù„Ø£Ø®Ø¨Ø§Ø±: ", stats.newsTimeOrders);
    if(stats.avgOrderLifetime > 0) {
        Print("â±ï¸ Ù…ØªÙˆØ³Ø· Ù…Ø¯Ø© Ø§Ù„Ø£ÙˆØ§Ù…Ø± ØºÙŠØ± Ø§Ù„Ù…Ù†ÙØ°Ø©: ", DoubleToString(stats.avgOrderLifetime, 1), " Ø¯Ù‚ÙŠÙ‚Ø©");
    }
}

//+------------------------------------------------------------------+
//| ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ù…Ù†ÙØ°Ø© (Ù„Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©)                    |
//+------------------------------------------------------------------+
void GenerateExecutedOrdersAnalysis()
{
    if(stats.executedOrders == 0) {
        Print("\nâš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£ÙˆØ§Ù…Ø± Ù…Ù†ÙØ°Ø© Ù„Ù„ØªØ­Ù„ÙŠÙ„");
        return;
    }
    
    Print("\nğŸ’° ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ù…Ù†ÙØ°Ø© (Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©):");
    Print("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”");
    Print("ğŸ“Š Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ù…Ù†ÙØ°Ø©: ", stats.executedOrders);
    Print("ğŸŸ¢ ØµÙÙ‚Ø§Øª Ø±Ø§Ø¨Ø­Ø©: ", stats.executedWins, " (", DoubleToString(stats.winRate, 1), "%)");
    Print("ğŸ”´ ØµÙÙ‚Ø§Øª Ø®Ø§Ø³Ø±Ø©: ", stats.executedLosses, " (", DoubleToString(100 - stats.winRate, 1), "%)");
    Print("âš–ï¸ ØµÙÙ‚Ø§Øª Ù…ØªØ¹Ø§Ø¯Ù„Ø©: ", stats.executedBreakeven);
    Print("ğŸ’µ ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­: ", DoubleToString(stats.totalProfit, 2), "$");
    Print("ğŸ“ˆ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­: ", DoubleToString(stats.grossProfit, 2), "$");
    Print("ğŸ“‰ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø®Ø³Ø§Ø¦Ø±: ", DoubleToString(stats.grossLoss, 2), "$");
    Print("ğŸ”¢ Ù…ØªÙˆØ³Ø· Ø§Ù„Ø±Ø¨Ø­: ", DoubleToString(stats.avgWin, 2), "$");
    Print("ğŸ”» Ù…ØªÙˆØ³Ø· Ø§Ù„Ø®Ø³Ø§Ø±Ø©: ", DoubleToString(stats.avgLoss, 2), "$");
    Print("âš–ï¸ Ù…Ø¹Ø§Ù…Ù„ Ø§Ù„Ø±Ø¨Ø­: ", DoubleToString(stats.profitFactor, 2));
    Print("ğŸ“ Ù…ØªÙˆØ³Ø· Ø­Ø¬Ù… Ø§Ù„ØµÙÙ‚Ø©: ", DoubleToString(stats.avgVolume, 2), " Ù„ÙˆØª");
    Print("ğŸ”º Ø£ÙƒØ¨Ø± Ø±Ø¨Ø­: ", DoubleToString(stats.maxWin, 2), "$");
    Print("ğŸ”» Ø£ÙƒØ¨Ø± Ø®Ø³Ø§Ø±Ø©: ", DoubleToString(stats.maxLoss, 2), "$");
    
    // Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ù…Ø®Ø§Ø·Ø±
    if(stats.maxDrawdownPct > 0) {
        Print("ğŸ“‰ Ø£Ù‚ØµÙ‰ Ø³Ø­Ø¨: ", DoubleToString(stats.maxDrawdownPct, 2), "%");
    }
    if(stats.sharpeRatio != 0) {
        Print("ğŸ“Š Ù†Ø³Ø¨Ø© Ø´Ø§Ø±Ø¨: ", DoubleToString(stats.sharpeRatio, 2));
    }
    if(stats.avgRiskReward > 0) {
        Print("âš–ï¸ Ù…ØªÙˆØ³Ø· Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø®Ø§Ø·Ø±/Ø§Ù„Ø¹Ø§Ø¦Ø¯: ", DoubleToString(stats.avgRiskReward, 2));
    }
}

//+------------------------------------------------------------------+
//| ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£ÙˆØ§Ù…Ø± ØºÙŠØ± Ø§Ù„Ù…Ù†ÙØ°Ø© (Ù„Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ÙÙ‚Ø·)                   |
//+------------------------------------------------------------------+
void GenerateNonExecutedOrdersAnalysis()
{
    int nonExecuted = stats.totalOrders - stats.executedOrders;
    if(nonExecuted == 0) {
        Print("\nâœ… Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£ÙˆØ§Ù…Ø± ØªÙ… ØªÙ†ÙÙŠØ°Ù‡Ø§ - Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£ÙˆØ§Ù…Ø± Ù…Ø¹Ù„Ù‚Ø© ÙØ§Ø´Ù„Ø©");
        return;
    }
    
    Print("\nğŸ“‹ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£ÙˆØ§Ù…Ø± ØºÙŠØ± Ø§Ù„Ù…Ù†ÙØ°Ø© (Ù„Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ÙÙ‚Ø·):");
    Print("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”");
    Print("ğŸ“Š Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£ÙˆØ§Ù…Ø± ØºÙŠØ± Ø§Ù„Ù…Ù†ÙØ°Ø©: ", nonExecuted);
    
    // ØªØµÙ†ÙŠÙ Ø£Ø³Ø¨Ø§Ø¨ Ø¹Ø¯Ù… Ø§Ù„ØªÙ†ÙÙŠØ°
    Print("\nğŸ” ØªØµÙ†ÙŠÙ Ø£Ø³Ø¨Ø§Ø¨ Ø¹Ø¯Ù… Ø§Ù„ØªÙ†ÙÙŠØ°:");
    Print("   ğŸ¯ Ø§Ù„Ø³Ø¹Ø± Ù„Ù… ÙŠØµÙ„ Ù„Ù„Ù…Ø³ØªÙˆÙ‰: ", stats.priceDidntReach, " Ø£ÙˆØ§Ù…Ø±");
    Print("   âš ï¸ Ø§Ù„Ø³Ø¹Ø± ÙˆØµÙ„ Ù„ÙƒÙ† Ù„Ù… ÙŠÙ†ÙØ°: ", stats.priceReachedButNotExecuted, " Ø£ÙˆØ§Ù…Ø±");
    Print("   âœ‹ Ù…Ù„ØºØ§Ø© ÙŠØ¯ÙˆÙŠØ§Ù‹: ", stats.cancelledManually, " Ø£ÙˆØ§Ù…Ø±");
    Print("   â° Ù…Ù†ØªÙ‡ÙŠØ© Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©: ", stats.expiredOrders, " Ø£ÙˆØ§Ù…Ø±");
    Print("   ğŸš« Ù…Ø±ÙÙˆØ¶Ø© Ù…Ù† Ø§Ù„ÙˆØ³ÙŠØ·: ", stats.rejectedOrders, " Ø£ÙˆØ§Ù…Ø±");
    
    if(stats.avgDistanceFromTarget > 0) {
        Print("ğŸ“ Ù…ØªÙˆØ³Ø· Ø§Ù„Ù…Ø³Ø§ÙØ© Ù…Ù† Ø§Ù„Ù‡Ø¯Ù: ", DoubleToString(stats.avgDistanceFromTarget, 1), " Ù†Ù‚Ø·Ø©");
    }
    
    // ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„ØªÙŠ ÙˆØµÙ„ Ù„Ù‡Ø§ Ø§Ù„Ø³Ø¹Ø± Ù„ÙƒÙ† Ù„Ù… ØªÙ†ÙØ°
    if(stats.priceReachedButNotExecuted > 0) {
        double percentageReached = CalculatePercentage(stats.priceReachedButNotExecuted, nonExecuted);
        Print("ğŸš¨ ", stats.priceReachedButNotExecuted, " Ø£ÙˆØ§Ù…Ø± ÙˆØµÙ„ Ù„Ù‡Ø§ Ø§Ù„Ø³Ø¹Ø± Ù„ÙƒÙ† Ù„Ù… ØªÙ†ÙØ° (", DoubleToString(percentageReached, 1), "% Ù…Ù† ØºÙŠØ± Ø§Ù„Ù…Ù†ÙØ°Ø©)");
        Print("ğŸ’¡ Ù‡Ø°Ø§ ÙŠØ´ÙŠØ± Ø¥Ù„Ù‰ Ù…Ø´Ø§ÙƒÙ„ Ù…Ø­ØªÙ…Ù„Ø© ÙÙŠ: Ø§Ù„Ø³ÙŠÙˆÙ„Ø©ØŒ Ø³Ø±Ø¹Ø© Ø§Ù„ØªÙ†ÙÙŠØ°ØŒ Ø£Ùˆ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ÙˆØ³ÙŠØ·");
    }
}

//+------------------------------------------------------------------+
//| ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ù†Ù…Ø§Ø· ÙˆØ§Ù„Ø§ØªØ¬Ø§Ù‡Ø§Øª                                       |
//+------------------------------------------------------------------+
void GeneratePatternAnalysis()
{
    Print("\nğŸ” ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ù†Ù…Ø§Ø· ÙˆØ§Ù„Ø§ØªØ¬Ø§Ù‡Ø§Øª:");
    Print("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”");
    
    // ØªØ­Ù„ÙŠÙ„ Ø£Ù†Ù…Ø§Ø· Ø§Ù„ÙØ´Ù„
    AnalyzeFailurePatternsReport();
    
    // ØªØ­Ù„ÙŠÙ„ Ø£ÙØ¶Ù„ Ø§Ù„Ø£ÙˆÙ‚Ø§Øª
    AnalyzeBestTimingReport();
    
    // ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø³Ø¨Ø±ÙŠØ¯ ÙˆØ§Ù„Ø§Ù†Ø²Ù„Ø§Ù‚
    AnalyzeSpreadSlippageReport();
    
    // ØªØ­Ù„ÙŠÙ„ Ø£Ø­Ø¬Ø§Ù… Ø§Ù„ØµÙÙ‚Ø§Øª
    AnalyzeVolumePatternsReport();
}

//+------------------------------------------------------------------+
//| ØªÙ‚Ø±ÙŠØ± Ø£Ù†Ù…Ø§Ø· Ø§Ù„ÙØ´Ù„                                              |
//+------------------------------------------------------------------+
void AnalyzeFailurePatternsReport()
{
    Print("\nâš ï¸ Ø£Ù†Ù…Ø§Ø· Ø§Ù„ÙØ´Ù„ Ø§Ù„Ù…ÙƒØªØ´ÙØ©:");
    
    if(stats.highSpreadFailures > 0) {
        double percentage = CalculatePercentage(stats.highSpreadFailures, stats.totalOrders);
        Print("   ğŸ“Š ", stats.highSpreadFailures, " ØµÙÙ‚Ø§Øª ØªØ£Ø«Ø±Øª Ø¨Ø§Ù„Ø³Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¹Ø§Ù„ÙŠ (", DoubleToString(percentage, 1), "%)");
        if(percentage > 20) {
            Print("   ğŸ’¡ ØªÙˆØµÙŠØ©: ØªØ¬Ù†Ø¨ Ø§Ù„ØªØ¯Ø§ÙˆÙ„ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø£Ø®Ø¨Ø§Ø± ÙˆØ³Ø§Ø¹Ø§Øª Ø§Ù„Ø³ÙŠÙˆÙ„Ø© Ø§Ù„Ù…Ù†Ø®ÙØ¶Ø©");
        }
    }
    
    if(stats.wrongDirectionFailures > 0) {
        double percentage = CalculatePercentage(stats.wrongDirectionFailures, stats.executedOrders);
        Print("   ğŸ¯ ", stats.wrongDirectionFailures, " ØµÙÙ‚Ø§Øª ÙÙŠ Ø§Ù„Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ø®Ø§Ø·Ø¦ (", DoubleToString(percentage, 1), "% Ù…Ù† Ø§Ù„Ù…Ù†ÙØ°Ø©)");
        if(percentage > 40) {
            Print("   ğŸ’¡ ØªÙˆØµÙŠØ©: Ù…Ø±Ø§Ø¬Ø¹Ø© Ø®ÙˆØ§Ø±Ø²Ù…ÙŠØ© ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø§ØªØ¬Ø§Ù‡ ÙˆØ¥Ø´Ø§Ø±Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„");
        }
    }
    
    if(stats.almostTPFailures > 0) {
        double percentage = CalculatePercentage(stats.almostTPFailures, stats.executedLosses);
        Print("   ğŸ¯ ", stats.almostTPFailures, " ØµÙÙ‚Ø§Øª ÙƒØ§Ù†Øª Ù‚Ø±ÙŠØ¨Ø© Ù…Ù† Ø§Ù„Ù‡Ø¯Ù (", DoubleToString(percentage, 1), "% Ù…Ù† Ø§Ù„Ø®Ø§Ø³Ø±Ø©)");
        if(percentage > 30) {
            Print("   ğŸ’¡ ØªÙˆØµÙŠØ©: ØªÙ‚Ù„ÙŠÙ„ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªÙŠÙƒ Ø¨Ø±ÙˆÙØª Ø£Ùˆ ØªØ­Ø³ÙŠÙ† Ù†Ù‚Ø§Ø· Ø§Ù„Ø®Ø±ÙˆØ¬");
        }
    }
    
    if(stats.slippageFailures > 0) {
        double percentage = CalculatePercentage(stats.slippageFailures, stats.executedOrders);
        Print("   ğŸ“‰ ", stats.slippageFailures, " ØµÙÙ‚Ø§Øª ØªØ£Ø«Ø±Øª Ø¨Ø§Ù„Ø§Ù†Ø²Ù„Ø§Ù‚ Ø§Ù„Ø¹Ø§Ù„ÙŠ (", DoubleToString(percentage, 1), "%)");
        if(percentage > 15) {
            Print("   ğŸ’¡ ØªÙˆØµÙŠØ©: Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø£ÙˆØ§Ù…Ø± Ù…Ø­Ø¯ÙˆØ¯Ø© Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ø³ÙˆÙ‚");
        }
    }
    
    if(stats.liquidityFailures > 0) {
        double percentage = CalculatePercentage(stats.liquidityFailures, stats.totalOrders);
        Print("   ğŸ’§ ", stats.liquidityFailures, " Ø£ÙˆØ§Ù…Ø± ØªØ£Ø«Ø±Øª Ø¨Ù†Ù‚Øµ Ø§Ù„Ø³ÙŠÙˆÙ„Ø© (", DoubleToString(percentage, 1), "%)");
        if(percentage > 25) {
            Print("   ğŸ’¡ ØªÙˆØµÙŠØ©: ØªØ­Ø³ÙŠÙ† ØªÙˆÙ‚ÙŠØª ÙˆØ¶Ø¹ Ø§Ù„Ø£ÙˆØ§Ù…Ø± ÙˆØªØ¬Ù†Ø¨ Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø³ÙŠÙˆÙ„Ø© Ø§Ù„Ù…Ù†Ø®ÙØ¶Ø©");
        }
    }
    
    if(stats.timeoutFailures > 0) {
        double percentage = CalculatePercentage(stats.timeoutFailures, stats.totalOrders);
        Print("   â° ", stats.timeoutFailures, " Ø£ÙˆØ§Ù…Ø± ÙØ´Ù„Øª Ø¨Ø³Ø¨Ø¨ Ø§Ù„ØªÙˆÙ‚ÙŠØª (", DoubleToString(percentage, 1), "%)");
        if(percentage > 20) {
            Print("   ğŸ’¡ ØªÙˆØµÙŠØ©: ØªØ­Ø³ÙŠÙ† Ø®ÙˆØ§Ø±Ø²Ù…ÙŠØ© Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø£ÙˆÙ‚Ø§Øª Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø© Ù„Ù„ØªØ¯Ø§ÙˆÙ„");
        }
    }
}

//+------------------------------------------------------------------+
//| ØªÙ‚Ø±ÙŠØ± Ø£ÙØ¶Ù„ Ø§Ù„Ø£ÙˆÙ‚Ø§Øª                                             |
//+------------------------------------------------------------------+
void AnalyzeBestTimingReport()
{
    Print("\nâ° ØªØ­Ù„ÙŠÙ„ Ø£ÙˆÙ‚Ø§Øª Ø§Ù„ØªØ¯Ø§ÙˆÙ„:");
    
    if(stats.bestHourExecution >= 0) {
        Print("ğŸŒŸ Ø£ÙØ¶Ù„ Ø³Ø§Ø¹Ø© Ù„Ù„ØªÙ†ÙÙŠØ°: ", stats.bestHourExecution, ":00 - Ù…Ø¹Ø¯Ù„ ØªÙ†ÙÙŠØ° ", DoubleToString(stats.bestHourExecutionRate, 1), "%");
    }
    
    if(stats.worstHourExecution >= 0) {
        Print("â›” Ø£Ø³ÙˆØ£ Ø³Ø§Ø¹Ø© Ù„Ù„ØªÙ†ÙÙŠØ°: ", stats.worstHourExecution, ":00 - Ù…Ø¹Ø¯Ù„ ØªÙ†ÙÙŠØ° ", DoubleToString(stats.worstHourExecutionRate, 1), "%");
    }
    
    if(stats.bestDayExecution >= 0) {
        string dayName = GetDayOfWeekString(stats.bestDayExecution);
        Print("ğŸ“… Ø£ÙØ¶Ù„ ÙŠÙˆÙ… Ù„Ù„ØªÙ†ÙÙŠØ°: ", dayName);
    }
    
    if(stats.worstDayExecution >= 0) {
        string dayName = GetDayOfWeekString(stats.worstDayExecution);
        Print("ğŸ“… Ø£Ø³ÙˆØ£ ÙŠÙˆÙ… Ù„Ù„ØªÙ†ÙÙŠØ°: ", dayName);
    }
    
    // ØªØ­Ù„ÙŠÙ„ Ù†Ø³Ø¨Ø© Ø£ÙˆØ§Ù…Ø± Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹
    if(stats.weekendOrders > 0) {
        double weekendPercentage = CalculatePercentage(stats.weekendOrders, stats.totalOrders);
        Print("ğŸŒ… Ø£ÙˆØ§Ù…Ø± Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹: ", stats.weekendOrders, " (", DoubleToString(weekendPercentage, 1), "%)");
        if(weekendPercentage > 15) {
            Print("   ğŸ’¡ ØªÙˆØµÙŠØ©: ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„ØªØ¯Ø§ÙˆÙ„ ÙÙŠ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ù„ØªØ­Ø³ÙŠÙ† Ù…Ø¹Ø¯Ù„ Ø§Ù„ØªÙ†ÙÙŠØ°");
        }
    }
    
    // ØªØ­Ù„ÙŠÙ„ Ø£ÙˆØ§Ù…Ø± ÙˆÙ‚Øª Ø§Ù„Ø£Ø®Ø¨Ø§Ø±
    if(stats.newsTimeOrders > 0) {
        double newsPercentage = CalculatePercentage(stats.newsTimeOrders, stats.totalOrders);
        Print("ğŸ“° Ø£ÙˆØ§Ù…Ø± ÙˆÙ‚Øª Ø§Ù„Ø£Ø®Ø¨Ø§Ø±: ", stats.newsTimeOrders, " (", DoubleToString(newsPercentage, 1), "%)");
        if(newsPercentage > 10) {
            Print("   ğŸ’¡ ØªÙˆØµÙŠØ©: ØªØ¬Ù†Ø¨ ÙˆØ¶Ø¹ Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ù‚Ø±Ø¨ Ø£ÙˆÙ‚Ø§Øª Ø§Ù„Ø£Ø®Ø¨Ø§Ø± Ø§Ù„Ù…Ù‡Ù…Ø©");
        }
    }
}

//+------------------------------------------------------------------+
//| ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø³Ø¨Ø±ÙŠØ¯ ÙˆØ§Ù„Ø§Ù†Ø²Ù„Ø§Ù‚                                        |
//+------------------------------------------------------------------+
void AnalyzeSpreadSlippageReport()
{
    Print("\nğŸ“Š ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø³Ø¨Ø±ÙŠØ¯ ÙˆØ§Ù„Ø§Ù†Ø²Ù„Ø§Ù‚:");
    
    if(stats.avgSpread > 0) {
        Print("ğŸ“ˆ Ù…ØªÙˆØ³Ø· Ø§Ù„Ø³Ø¨Ø±ÙŠØ¯: ", DoubleToString(stats.avgSpread * 10000, 1), " Ù†Ù‚Ø·Ø©");
        Print("ğŸ“ˆ Ø£Ø¹Ù„Ù‰ Ø³Ø¨Ø±ÙŠØ¯: ", DoubleToString(stats.maxSpread * 10000, 1), " Ù†Ù‚Ø·Ø©");
        
        if(stats.maxSpread > NORMAL_SPREAD_THRESHOLD) {
            Print("   âš ï¸ ØªÙ… Ø±ØµØ¯ Ø³Ø¨Ø±ÙŠØ¯ Ø¹Ø§Ù„ÙŠ - Ù‚Ø¯ ÙŠØ¤Ø«Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø¯Ø§Ø¡");
        }
    }
    
    if(stats.avgSlippage > 0) {
        Print("ğŸ“‰ Ù…ØªÙˆØ³Ø· Ø§Ù„Ø§Ù†Ø²Ù„Ø§Ù‚: ", DoubleToString(stats.avgSlippage, 1), " Ù†Ù‚Ø·Ø©");
        Print("ğŸ“‰ Ø£Ø¹Ù„Ù‰ Ø§Ù†Ø²Ù„Ø§Ù‚: ", DoubleToString(stats.maxSlippage, 1), " Ù†Ù‚Ø·Ø©");
        
        if(stats.maxSlippage > HIGH_SLIPPAGE_THRESHOLD) {
            Print("   âš ï¸ ØªÙ… Ø±ØµØ¯ Ø§Ù†Ø²Ù„Ø§Ù‚ Ø¹Ø§Ù„ÙŠ - ÙŠØ¤Ø«Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø±Ø¨Ø­ÙŠØ©");
        }
    }
    
    // ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙØ¬ÙˆØ§Øª
    if(stats.gappedOrders > 0) {
        double gapPercentage = CalculatePercentage(stats.gappedOrders, stats.totalOrders);
        Print("ğŸ•³ï¸ Ø£ÙˆØ§Ù…Ø± Ù…Ø¹ ÙØ¬ÙˆØ§Øª: ", stats.gappedOrders, " (", DoubleToString(gapPercentage, 1), "%)");
        Print("ğŸ“ Ù…ØªÙˆØ³Ø· Ø­Ø¬Ù… Ø§Ù„ÙØ¬ÙˆØ©: ", DoubleToString(stats.avgGapSize, 1), " Ù†Ù‚Ø·Ø©");
        
        if(gapPercentage > 10) {
            Print("   ğŸ’¡ ØªÙˆØµÙŠØ©: Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„ÙØ¬ÙˆØ§Øª ÙˆØªØ¹Ø¯ÙŠÙ„ Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙˆÙÙ‚Ø§Ù‹ Ù„Ù‡Ø§");
        }
    }
}

//+------------------------------------------------------------------+
//| ØªÙ‚Ø±ÙŠØ± Ø£Ù†Ù…Ø§Ø· Ø£Ø­Ø¬Ø§Ù… Ø§Ù„ØµÙÙ‚Ø§Øª                                     |
//+------------------------------------------------------------------+
void AnalyzeVolumePatternsReport()
{
    Print("\nğŸ’° ØªØ­Ù„ÙŠÙ„ Ø£Ø­Ø¬Ø§Ù… Ø§Ù„ØµÙÙ‚Ø§Øª:");
    
    if(stats.avgVolume > 0) {
        Print("ğŸ“Š Ù…ØªÙˆØ³Ø· Ø­Ø¬Ù… Ø§Ù„ØµÙÙ‚Ø©: ", DoubleToString(stats.avgVolume, 2), " Ù„ÙˆØª");
        
        // ØªØ­Ù„ÙŠÙ„ ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø£Ø­Ø¬Ø§Ù…
        int smallVolumeCount = 0;
        int mediumVolumeCount = 0;
        int largeVolumeCount = 0;
        
        for(int i = 0; i < stats.totalOrders; i++) {
            if(orders[i].volume <= 0.1) {
                smallVolumeCount++;
            } else if(orders[i].volume <= 1.0) {
                mediumVolumeCount++;
            } else {
                largeVolumeCount++;
            }
        }
        
        Print("   ğŸ”¹ Ø£Ø­Ø¬Ø§Ù… ØµØºÙŠØ±Ø© (â‰¤0.1): ", smallVolumeCount, " Ø£ÙˆØ§Ù…Ø±");
        Print("   ğŸ”¸ Ø£Ø­Ø¬Ø§Ù… Ù…ØªÙˆØ³Ø·Ø© (0.1-1.0): ", mediumVolumeCount, " Ø£ÙˆØ§Ù…Ø±");
        Print("   ğŸ”¶ Ø£Ø­Ø¬Ø§Ù… ÙƒØ¨ÙŠØ±Ø© (>1.0): ", largeVolumeCount, " Ø£ÙˆØ§Ù…Ø±");
        
        // ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¹Ù„Ø§Ù‚Ø© Ø¨ÙŠÙ† Ø§Ù„Ø­Ø¬Ù… ÙˆØ§Ù„Ù†Ø¬Ø§Ø­
        AnalyzeVolumeSuccessRelation(smallVolumeCount, mediumVolumeCount, largeVolumeCount);
    }
}

//+------------------------------------------------------------------+
//| ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¹Ù„Ø§Ù‚Ø© Ø¨ÙŠÙ† Ø­Ø¬Ù… Ø§Ù„ØµÙÙ‚Ø© ÙˆÙ…Ø¹Ø¯Ù„ Ø§Ù„Ù†Ø¬Ø§Ø­                     |
//+------------------------------------------------------------------+
void AnalyzeVolumeSuccessRelation(int smallCount, int mediumCount, int largeCount)
{
    if(stats.executedOrders == 0) return;
    
    int smallSuccess = 0, mediumSuccess = 0, largeSuccess = 0;
    int smallExecuted = 0, mediumExecuted = 0, largeExecuted = 0;
    
    for(int i = 0; i < stats.totalOrders; i++) {
        if(!orders[i].isExecuted) continue;
        
        if(orders[i].volume <= 0.1) {
            smallExecuted++;
            if(orders[i].netProfit > 0) smallSuccess++;
        } else if(orders[i].volume <= 1.0) {
            mediumExecuted++;
            if(orders[i].netProfit > 0) mediumSuccess++;
        } else {
            largeExecuted++;
            if(orders[i].netProfit > 0) largeSuccess++;
        }
    }
    
    Print("\nğŸ“ˆ Ù…Ø¹Ø¯Ù„Ø§Øª Ø§Ù„Ù†Ø¬Ø§Ø­ Ø­Ø³Ø¨ Ø§Ù„Ø­Ø¬Ù…:");
    if(smallExecuted > 0) {
        double smallRate = CalculatePercentage(smallSuccess, smallExecuted);
        Print("   ğŸ”¹ Ø£Ø­Ø¬Ø§Ù… ØµØºÙŠØ±Ø©: ", DoubleToString(smallRate, 1), "% Ù†Ø¬Ø§Ø­");
    }
    if(mediumExecuted > 0) {
        double mediumRate = CalculatePercentage(mediumSuccess, mediumExecuted);
        Print("   ğŸ”¸ Ø£Ø­Ø¬Ø§Ù… Ù…ØªÙˆØ³Ø·Ø©: ", DoubleToString(mediumRate, 1), "% Ù†Ø¬Ø§Ø­");
    }
    if(largeExecuted > 0) {
        double largeRate = CalculatePercentage(largeSuccess, largeExecuted);
        Print("   ğŸ”¶ Ø£Ø­Ø¬Ø§Ù… ÙƒØ¨ÙŠØ±Ø©: ", DoubleToString(largeRate, 1), "% Ù†Ø¬Ø§Ø­");
    }
}

//+------------------------------------------------------------------+
//| Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªÙØµÙŠÙ„ÙŠ Ù„Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„ÙØ±Ø¯ÙŠØ©                               |
//+------------------------------------------------------------------+
void GenerateDetailedOrderAnalysis()
{
    if(stats.totalOrders == 0) return;
    
    Print("\nğŸ” Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªÙØµÙŠÙ„ÙŠ Ù„Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„ÙØ±Ø¯ÙŠØ©:");
    Print("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”");
    
    // ØªØ­Ø¯ÙŠØ¯ Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ù„Ù„Ø¹Ø±Ø¶ (Ø­Ø¯ Ø£Ù‚ØµÙ‰ 20 Ù„ØªØ¬Ù†Ø¨ Ø§Ù„Ø¥Ø·Ø§Ù„Ø©)
    int maxOrdersToShow = MathMin(stats.totalOrders, 20);
    
    for(int i = 0; i < maxOrdersToShow; i++) {
        PrintDetailedOrderInfo(i);
    }
    
    if(stats.totalOrders > maxOrdersToShow) {
        Print("... ÙˆØªÙ… ØªØ­Ù„ÙŠÙ„ ", (stats.totalOrders - maxOrdersToShow), " Ø£Ù…Ø± Ø¥Ø¶Ø§ÙÙŠ (ØºÙŠØ± Ù…Ø¹Ø±ÙˆØ¶ Ù„ØªÙˆÙÙŠØ± Ø§Ù„Ù…Ø³Ø§Ø­Ø©)");
    }
}

//+------------------------------------------------------------------+
//| Ø·Ø¨Ø§Ø¹Ø© Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù…ÙØµÙ„Ø© Ù„Ø£Ù…Ø± Ù…Ø­Ø¯Ø¯                                  |
//+------------------------------------------------------------------+
void PrintDetailedOrderInfo(int index)
{
    string orderType = GetOrderTypeString(orders[index].type);
    string executionIcon = orders[index].isExecuted ? "âœ…" : "âŒ";
    
    Print("\n", executionIcon, " Ø£Ù…Ø± #", orders[index].ticket, " - ", orders[index].symbol, " ", orderType);
    Print("â° Ø§Ù„ÙˆÙ‚Øª: ", TimeToString(orders[index].timeSetup, TIME_DATE|TIME_MINUTES));
    Print("ğŸ’° Ø§Ù„Ø­Ø¬Ù…: ", DoubleToString(orders[index].volume, 2), " Ù„ÙˆØª");
    Print("ğŸ’² Ø§Ù„Ø³Ø¹Ø±: ", DoubleToString(orders[index].priceOpen, 5));
    
    if(orders[index].isExecuted) {
        PrintExecutedOrderDetails(index);
    } else {
        PrintNonExecutedOrderDetails(index);
    }
    
    Print("ğŸ” Ø§Ù„ØªØ­Ù„ÙŠÙ„: ", orders[index].failureReason);
    if(orders[index].detailedAnalysis != "") {
        Print("ğŸ“‹ ØªÙØ§ØµÙŠÙ„: ", orders[index].detailedAnalysis);
    }
    Print("â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€");
}

//+------------------------------------------------------------------+
//| Ø·Ø¨Ø§Ø¹Ø© ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø£Ù…Ø± Ø§Ù„Ù…Ù†ÙØ°                                      |
//+------------------------------------------------------------------+
void PrintExecutedOrderDetails(int index)
{
    Print("ğŸ’² Ø§Ù„Ø³Ø¹Ø± Ø§Ù„ÙØ¹Ù„ÙŠ: ", DoubleToString(orders[index].priceActual, 5));
    Print("ğŸ’µ Ø§Ù„Ù†ØªÙŠØ¬Ø©: ", DoubleToString(orders[index].netProfit, 2), "$");
    
    if(orders[index].slippage > 0) {
        double slippagePips = orders[index].slippage / GetSymbolPoint(orders[index].symbol);
        Print("ğŸ“Š Ø§Ù„Ø§Ù†Ø²Ù„Ø§Ù‚: ", DoubleToString(slippagePips, 1), " Ù†Ù‚Ø·Ø©");
    }
    
    if(orders[index].holdingTimeMinutes > 0) {
        Print("â±ï¸ Ù…Ø¯Ø© Ø§Ù„Ø§Ø­ØªÙØ§Ø¸: ", orders[index].holdingTimeMinutes, " Ø¯Ù‚ÙŠÙ‚Ø©");
    }
    
    if(orders[index].pointsToTP > 0) {
        Print("ğŸ¯ Ø§Ù„Ù…Ø³Ø§ÙØ© Ù…Ù† Ø§Ù„Ù‡Ø¯Ù: ", DoubleToString(orders[index].pointsToTP, 1), " Ù†Ù‚Ø·Ø©");
    }
    
    if(orders[index].maxRunup > 0) {
        Print("ğŸ“ˆ Ø£Ù‚ØµÙ‰ Ø±Ø¨Ø­ Ù…Ø­ØªÙ…Ù„: ", DoubleToString(orders[index].maxRunup, 1), " Ù†Ù‚Ø·Ø©");
    }
    
    if(orders[index].maxDrawdown > 0) {
        Print("ğŸ“‰ Ø£Ù‚ØµÙ‰ Ø³Ø­Ø¨: ", DoubleToString(orders[index].maxDrawdown, 1), " Ù†Ù‚Ø·Ø©");
    }
}

//+------------------------------------------------------------------+
//| Ø·Ø¨Ø§Ø¹Ø© ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø£Ù…Ø± ØºÙŠØ± Ø§Ù„Ù…Ù†ÙØ°                                  |
//+------------------------------------------------------------------+
void PrintNonExecutedOrderDetails(int index)
{
    Print("ğŸ“‹ Ø§Ù„Ø­Ø§Ù„Ø©: ", orders[index].executionStatus);
    Print("â±ï¸ Ù…Ø¯Ø© Ø§Ù„Ø¨Ù‚Ø§Ø¡: ", orders[index].orderLifetimeMinutes, " Ø¯Ù‚ÙŠÙ‚Ø©");
    
    if(orders[index].minDistanceFromTarget > 0) {
        Print("ğŸ“ Ø£Ù‚Ø±Ø¨ Ù…Ø³Ø§ÙØ© Ù„Ù„Ù‡Ø¯Ù: ", DoubleToString(orders[index].minDistanceFromTarget, 1), " Ù†Ù‚Ø·Ø©");
    }
    
    Print("ğŸ¯ Ù‡Ù„ ÙˆØµÙ„ Ø§Ù„Ø³Ø¹Ø±ØŸ ", orders[index].priceReachedLevel ? "Ù†Ø¹Ù…" : "Ù„Ø§");
    
    if(orders[index].priceReachedLevel && orders[index].bestPriceReached > 0) {
        Print("ğŸ’² Ø£ÙØ¶Ù„ Ø³Ø¹Ø± ÙˆØµÙ„: ", DoubleToString(orders[index].bestPriceReached, 5));
    }
    
    Print("ğŸŒŠ Ø­Ø§Ù„Ø© Ø§Ù„Ø³ÙˆÙ‚: ", orders[index].marketConditionAtSetup);
    Print("â° ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªÙˆÙ‚ÙŠØª: ", orders[index].timeAnalysis);
}

//--- Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø³Ø§Ø¯Ø³ ---
//+------------------------------------------------------------------+
//| Expert Advisor: Advanced Zigzag Analysis Bot - Part 7/15       |
//| Ù…Ø­Ù„Ù„ Ø¨ÙˆØª Ø§Ù„Ø²Ø¬Ø²Ø§Ø¬ Ø§Ù„Ø¹Ø¨Ù‚Ø±ÙŠ - Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø³Ø§Ø¨Ø¹: ØºÙŠØ± Ø§Ù„Ù…Ù†ÙØ°Ø© Ø§Ù„Ø«Ø§Ù†ÙŠ   |
//+------------------------------------------------------------------+

// ØªÙƒÙ…Ù„Ø© Ù„Ù„Ø£Ø¬Ø²Ø§Ø¡ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© - Ø§Ù„ØªÙˆØµÙŠØ§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø© ÙˆØ§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ

//+------------------------------------------------------------------+
//| Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙˆØµÙŠØ§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©                                        |
//+------------------------------------------------------------------+
void GenerateAdvancedRecommendations()
{
    Print("\nğŸ’¡ Ø§Ù„ØªÙˆØµÙŠØ§Øª ÙˆØ§Ù„ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø©:");
    Print("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”");
    
    // ØªØ­Ù„ÙŠÙ„ Ù…Ø¹Ø¯Ù„ Ø§Ù„ØªÙ†ÙÙŠØ° Ø§Ù„Ø¹Ø§Ù…
    AnalyzeExecutionRateRecommendations();
    
    // ØªÙˆØµÙŠØ§Øª Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø£Ù†Ù…Ø§Ø· Ø§Ù„ÙØ´Ù„
    GenerateFailureBasedRecommendations();
    
    // ØªÙˆØµÙŠØ§Øª Ø§Ù„ØªÙˆÙ‚ÙŠØª
    GenerateTimingRecommendations();
    
    // ØªÙˆØµÙŠØ§Øª Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø§Ø·Ø±
    GenerateRiskManagementRecommendations();
    
    // ØªÙˆØµÙŠØ§Øª ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ø¯Ø§Ø¡
    GeneratePerformanceImprovementRecommendations();
    
    // Ø®Ø·Ø© Ø¹Ù…Ù„ Ù…ÙˆØµÙ‰ Ø¨Ù‡Ø§
    GenerateActionPlan();
}

//+------------------------------------------------------------------+
//| ØªØ­Ù„ÙŠÙ„ Ù…Ø¹Ø¯Ù„ Ø§Ù„ØªÙ†ÙÙŠØ° ÙˆØ§Ù„ØªÙˆØµÙŠØ§Øª                                   |
//+------------------------------------------------------------------+
void AnalyzeExecutionRateRecommendations()
{
    double executionRate = CalculatePercentage(stats.executedOrders, stats.totalOrders);
    
    Print("\nğŸ“Š ØªØ­Ù„ÙŠÙ„ Ù…Ø¹Ø¯Ù„ Ø§Ù„ØªÙ†ÙÙŠØ°:");
    Print("ğŸ“ˆ Ù…Ø¹Ø¯Ù„ Ø§Ù„ØªÙ†ÙÙŠØ° Ø§Ù„Ø­Ø§Ù„ÙŠ: ", DoubleToString(executionRate, 1), "%");
    
    if(executionRate < 50) {
        Print("ğŸš¨ Ù…Ø¹Ø¯Ù„ Ø§Ù„ØªÙ†ÙÙŠØ° Ù…Ù†Ø®ÙØ¶ Ø¬Ø¯Ø§Ù‹!");
        Print("   ğŸ’¡ ØªÙˆØµÙŠØ§Øª Ø¹Ø§Ø¬Ù„Ø©:");
        Print("   â€¢ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø´Ø§Ù…Ù„Ø© Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© ÙˆØ¶Ø¹ Ø§Ù„Ø£ÙˆØ§Ù…Ø±");
        Print("   â€¢ ÙØ­Øµ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ÙˆØ³ÙŠØ· ÙˆÙ…Ø³ØªÙˆÙŠØ§Øª Ø§Ù„Ø³ÙŠÙˆÙ„Ø©");
        Print("   â€¢ ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ù…Ø³Ø§ÙØ© Ø¨ÙŠÙ† Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ ÙˆØ§Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©");
        Print("   â€¢ Ø²ÙŠØ§Ø¯Ø© Ù…Ø¯Ø© ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ø£ÙˆØ§Ù…Ø±");
    } else if(executionRate < 70) {
        Print("âš ï¸ Ù…Ø¹Ø¯Ù„ Ø§Ù„ØªÙ†ÙÙŠØ° ÙŠØ­ØªØ§Ø¬ ØªØ­Ø³ÙŠÙ†");
        Print("   ğŸ’¡ ØªÙˆØµÙŠØ§Øª Ù„Ù„ØªØ­Ø³ÙŠÙ†:");
        Print("   â€¢ ØªØ­Ø³ÙŠÙ† ØªÙˆÙ‚ÙŠØª ÙˆØ¶Ø¹ Ø§Ù„Ø£ÙˆØ§Ù…Ø±");
        Print("   â€¢ Ù…Ø±Ø§Ø¬Ø¹Ø© Ù†Ù‚Ø§Ø· Ø§Ù„Ø¯Ø®ÙˆÙ„");
        Print("   â€¢ ØªØ¬Ù†Ø¨ Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø³ÙŠÙˆÙ„Ø© Ø§Ù„Ù…Ù†Ø®ÙØ¶Ø©");
    } else if(executionRate < 85) {
        Print("âœ… Ù…Ø¹Ø¯Ù„ Ø§Ù„ØªÙ†ÙÙŠØ° Ø¬ÙŠØ¯");
        Print("   ğŸ’¡ ØªÙˆØµÙŠØ§Øª Ù„Ù„ØªØ·ÙˆÙŠØ±:");
        Print("   â€¢ ØªØ­Ø³ÙŠÙ†Ø§Øª Ø·ÙÙŠÙØ© ÙÙŠ Ø§Ù„ØªÙˆÙ‚ÙŠØª");
        Print("   â€¢ Ù…Ø±Ø§Ù‚Ø¨Ø© Ø£Ù†Ù…Ø§Ø· Ø¹Ø¯Ù… Ø§Ù„ØªÙ†ÙÙŠØ°");
    } else {
        Print("ğŸŒŸ Ù…Ø¹Ø¯Ù„ Ø§Ù„ØªÙ†ÙÙŠØ° Ù…Ù…ØªØ§Ø²!");
        Print("   ğŸ’¡ Ø­Ø§ÙØ¸ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„Ø­Ø§Ù„ÙŠ ÙˆØ±Ø§Ù‚Ø¨ Ø£ÙŠ ØªØºÙŠÙŠØ±Ø§Øª");
    }
}

//+------------------------------------------------------------------+
//| ØªÙˆØµÙŠØ§Øª Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø£Ù†Ù…Ø§Ø· Ø§Ù„ÙØ´Ù„                                  |
//+------------------------------------------------------------------+
void GenerateFailureBasedRecommendations()
{
    Print("\nğŸ”§ ØªÙˆØµÙŠØ§Øª Ù…Ø¨Ù†ÙŠØ© Ø¹Ù„Ù‰ Ø£Ù†Ù…Ø§Ø· Ø§Ù„ÙØ´Ù„:");
    
    // Ù…Ø´Ø§ÙƒÙ„ Ø§Ù„Ø³Ø¨Ø±ÙŠØ¯
    if(stats.highSpreadFailures > stats.totalOrders * 0.2) {
        Print("ğŸ“Š Ù…Ø´ÙƒÙ„Ø© Ø§Ù„Ø³Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¹Ø§Ù„ÙŠ:");
        Print("   ğŸ’¡ Ø§Ù„Ø­Ù„ÙˆÙ„:");
        Print("   â€¢ ØªØ¬Ù†Ø¨ Ø§Ù„ØªØ¯Ø§ÙˆÙ„ Ù‚Ø¨Ù„ ÙˆØ¨Ø¹Ø¯ Ø§Ù„Ø£Ø®Ø¨Ø§Ø± Ø§Ù„Ù…Ù‡Ù…Ø© Ø¨Ù€ 30 Ø¯Ù‚ÙŠÙ‚Ø©");
        Print("   â€¢ ØªØ¬Ù†Ø¨ Ø³Ø§Ø¹Ø§Øª Ø§ÙØªØªØ§Ø­ ÙˆØ¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø£Ø³ÙˆØ§Ù‚");
        Print("   â€¢ Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙÙ„ØªØ± Ø³Ø¨Ø±ÙŠØ¯: Ù„Ø§ ØªØªØ¯Ø§ÙˆÙ„ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø³Ø¨Ø±ÙŠØ¯ > ", NORMAL_SPREAD_THRESHOLD, " Ù†Ù‚Ø§Ø·");
        Print("   â€¢ Ø§Ù„Ù†Ø¸Ø± ÙÙŠ ØªØºÙŠÙŠØ± Ø§Ù„ÙˆØ³ÙŠØ· Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø³Ø¨Ø±ÙŠØ¯ Ù…Ø±ØªÙØ¹ Ø¨Ø§Ø³ØªÙ…Ø±Ø§Ø±");
    }
    
    // Ù…Ø´Ø§ÙƒÙ„ Ø§Ù„Ø§ØªØ¬Ø§Ù‡
    if(stats.wrongDirectionFailures > stats.executedOrders * 0.4) {
        Print("ğŸ¯ Ù…Ø´ÙƒÙ„Ø© Ø¯Ù‚Ø© Ø§Ù„Ø§ØªØ¬Ø§Ù‡:");
        Print("   ğŸ’¡ Ø§Ù„Ø­Ù„ÙˆÙ„:");
        Print("   â€¢ Ù…Ø±Ø§Ø¬Ø¹Ø© Ù…Ø¤Ø´Ø±Ø§Øª ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø§ØªØ¬Ø§Ù‡");
        Print("   â€¢ Ø¥Ø¶Ø§ÙØ© Ù…Ø¤Ø´Ø±Ø§Øª ØªØ£ÙƒÙŠØ¯ÙŠØ© (RSI, MACD, Moving Averages)");
        Print("   â€¢ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© Ø¹Ù„Ù‰ ÙØªØ±Ø§Øª Ø²Ù…Ù†ÙŠØ© Ù…Ø®ØªÙ„ÙØ©");
        Print("   â€¢ ØªØ­Ø³ÙŠÙ† Ù†Ù‚Ø§Ø· Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…Ø³ØªÙˆÙŠØ§Øª Ø§Ù„Ø¯Ø¹Ù… ÙˆØ§Ù„Ù…Ù‚Ø§ÙˆÙ…Ø©");
    }
    
    // Ù…Ø´Ø§ÙƒÙ„ Ù‚Ø±Ø¨ Ø§Ù„Ù‡Ø¯Ù
    if(stats.almostTPFailures > stats.executedLosses * 0.3) {
        Print("ğŸ¯ Ù…Ø´ÙƒÙ„Ø© Ù‚Ø±Ø¨ Ø§Ù„Ø£Ù‡Ø¯Ø§Ù:");
        Print("   ğŸ’¡ Ø§Ù„Ø­Ù„ÙˆÙ„:");
        Print("   â€¢ ØªÙ‚Ù„ÙŠÙ„ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªÙŠÙƒ Ø¨Ø±ÙˆÙØª Ø¨Ù€ 20-30%");
        Print("   â€¢ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø®Ø±ÙˆØ¬ Ø¬Ø²Ø¦ÙŠ: Ø¥ØºÙ„Ø§Ù‚ 50% Ø¹Ù†Ø¯ 70% Ù…Ù† Ø§Ù„Ù‡Ø¯Ù");
        Print("   â€¢ Ø§Ø³ØªØ®Ø¯Ø§Ù… Trailing Stop Ù„Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø£Ø±Ø¨Ø§Ø­");
        Print("   â€¢ Ù…Ø±Ø§Ø¬Ø¹Ø© Ù…Ø³ØªÙˆÙŠØ§Øª Ø§Ù„Ù…Ù‚Ø§ÙˆÙ…Ø© ÙˆØ§Ù„Ø¯Ø¹Ù… Ù„ØªØ­Ø¯ÙŠØ¯ Ø£Ù‡Ø¯Ø§Ù ÙˆØ§Ù‚Ø¹ÙŠØ©");
    }
    
    // Ù…Ø´Ø§ÙƒÙ„ Ø§Ù„Ø§Ù†Ø²Ù„Ø§Ù‚
    if(stats.slippageFailures > stats.executedOrders * 0.15) {
        Print("ğŸ“‰ Ù…Ø´ÙƒÙ„Ø© Ø§Ù„Ø§Ù†Ø²Ù„Ø§Ù‚:");
        Print("   ğŸ’¡ Ø§Ù„Ø­Ù„ÙˆÙ„:");
        Print("   â€¢ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø£ÙˆØ§Ù…Ø± Ù…Ø­Ø¯ÙˆØ¯Ø© Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ø³ÙˆÙ‚");
        Print("   â€¢ ØªØ¬Ù†Ø¨ Ø§Ù„ØªØ¯Ø§ÙˆÙ„ ÙÙŠ Ø§Ù„Ø£Ø³ÙˆØ§Ù‚ Ø³Ø±ÙŠØ¹Ø© Ø§Ù„Ø­Ø±ÙƒØ©");
        Print("   â€¢ ØªÙ‚Ù„ÙŠÙ„ Ø£Ø­Ø¬Ø§Ù… Ø§Ù„ØµÙÙ‚Ø§Øª ÙÙŠ Ø£ÙˆÙ‚Ø§Øª Ø§Ù„Ø³ÙŠÙˆÙ„Ø© Ø§Ù„Ù…Ù†Ø®ÙØ¶Ø©");
        Print("   â€¢ Ø§Ù„Ù†Ø¸Ø± ÙÙŠ ØªØºÙŠÙŠØ± Ø§Ù„ÙˆØ³ÙŠØ· Ù„Ø£Ø­Ø¯ Ø¨Ø³ÙŠÙˆÙ„Ø© Ø£ÙØ¶Ù„");
    }
    
    // Ù…Ø´Ø§ÙƒÙ„ Ø§Ù„Ø³ÙŠÙˆÙ„Ø©
    if(stats.liquidityFailures > stats.totalOrders * 0.25) {
        Print("ğŸ’§ Ù…Ø´ÙƒÙ„Ø© Ø§Ù„Ø³ÙŠÙˆÙ„Ø©:");
        Print("   ğŸ’¡ Ø§Ù„Ø­Ù„ÙˆÙ„:");
        Print("   â€¢ Ø§Ù„ØªØ±ÙƒÙŠØ² Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø²ÙˆØ§Ø¬ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© (EUR/USD, GBP/USD, USD/JPY)");
        Print("   â€¢ ØªØ¬Ù†Ø¨ Ø§Ù„ØªØ¯Ø§ÙˆÙ„ ÙÙŠ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹");
        Print("   â€¢ Ø§Ù„ØªØ¯Ø§ÙˆÙ„ ÙÙ‚Ø· Ø®Ù„Ø§Ù„ ØªØ¯Ø§Ø®Ù„ Ø§Ù„Ø¬Ù„Ø³Ø§Øª (13:00-17:00 GMT)");
        Print("   â€¢ ØªÙ‚Ù„ÙŠÙ„ Ø£Ø­Ø¬Ø§Ù… Ø§Ù„ØµÙÙ‚Ø§Øª");
    }
    
    // Ù…Ø´Ø§ÙƒÙ„ Ø§Ù„ØªÙˆÙ‚ÙŠØª
    if(stats.timeoutFailures > stats.totalOrders * 0.2) {
        Print("â° Ù…Ø´ÙƒÙ„Ø© Ø§Ù„ØªÙˆÙ‚ÙŠØª:");
        Print("   ğŸ’¡ Ø§Ù„Ø­Ù„ÙˆÙ„:");
        Print("   â€¢ ØªØ­Ø³ÙŠÙ† Ø®ÙˆØ§Ø±Ø²Ù…ÙŠØ© Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø£ÙˆÙ‚Ø§Øª");
        Print("   â€¢ ØªØ¬Ù†Ø¨ Ø§Ù„Ø³Ø§Ø¹Ø§Øª 22:00-06:00 GMT");
        Print("   â€¢ Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ù†Ø´Ø§Ø· ÙÙŠ Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø°Ø±ÙˆØ© 08:00-17:00 GMT");
        Print("   â€¢ Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„ØªÙ‚ÙˆÙŠÙ… Ø§Ù„Ø§Ù‚ØªØµØ§Ø¯ÙŠ ÙˆØªØ¬Ù†Ø¨ Ø£ÙˆÙ‚Ø§Øª Ø§Ù„Ø£Ø®Ø¨Ø§Ø±");
    }
}

//+------------------------------------------------------------------+
//| ØªÙˆØµÙŠØ§Øª Ø§Ù„ØªÙˆÙ‚ÙŠØª                                                 |
//+------------------------------------------------------------------+
void GenerateTimingRecommendations()
{
    Print("\nâ° ØªÙˆØµÙŠØ§Øª ØªØ­Ø³ÙŠÙ† Ø§Ù„ØªÙˆÙ‚ÙŠØª:");
    
    // ØªØ­Ù„ÙŠÙ„ Ø£ÙØ¶Ù„ Ø§Ù„Ø£ÙˆÙ‚Ø§Øª
    if(stats.bestHourExecution >= 0 && stats.bestHourExecutionRate > 0) {
        Print("ğŸŒŸ Ø£ÙØ¶Ù„ Ø£ÙˆÙ‚Ø§Øª Ø§Ù„ØªØ¯Ø§ÙˆÙ„:");
        Print("   â€¢ Ø§Ù„Ø³Ø§Ø¹Ø© ", stats.bestHourExecution, ":00 - Ù…Ø¹Ø¯Ù„ Ù†Ø¬Ø§Ø­ ", DoubleToString(stats.bestHourExecutionRate, 1), "%");
        Print("   ğŸ’¡ Ø²ÙŠØ§Ø¯Ø© Ù†Ø´Ø§Ø· Ø§Ù„ØªØ¯Ø§ÙˆÙ„ ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ø³Ø§Ø¹Ø©");
        
        // Ø§Ù‚ØªØ±Ø§Ø­ Ù†Ø§ÙØ°Ø© Ø²Ù…Ù†ÙŠØ© Ù…ÙˆØ³Ø¹Ø©
        int startHour = MathMax(0, stats.bestHourExecution - 1);
        int endHour = MathMin(23, stats.bestHourExecution + 1);
        Print("   ğŸ’¡ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ© Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø©: ", startHour, ":00 - ", endHour, ":00");
    }
    
    if(stats.worstHourExecution >= 0 && stats.worstHourExecutionRate < 50) {
        Print("â›” Ø£ÙˆÙ‚Ø§Øª ÙŠÙÙ†ØµØ­ Ø¨ØªØ¬Ù†Ø¨Ù‡Ø§:");
        Print("   â€¢ Ø§Ù„Ø³Ø§Ø¹Ø© ", stats.worstHourExecution, ":00 - Ù…Ø¹Ø¯Ù„ Ù†Ø¬Ø§Ø­ Ù…Ù†Ø®ÙØ¶ ", DoubleToString(stats.worstHourExecutionRate, 1), "%");
        Print("   ğŸ’¡ ØªØ¬Ù†Ø¨ Ø§Ù„ØªØ¯Ø§ÙˆÙ„ ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ø³Ø§Ø¹Ø© Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø­Ø°Ø± Ø¥Ø¶Ø§ÙÙŠ");
    }
    
    // ØªÙˆØµÙŠØ§Øª Ø§Ù„Ø£ÙŠØ§Ù…
    if(stats.bestDayExecution >= 0) {
        string bestDay = GetDayOfWeekString(stats.bestDayExecution);
        Print("ğŸ“… Ø£ÙØ¶Ù„ ÙŠÙˆÙ… Ù„Ù„ØªØ¯Ø§ÙˆÙ„: ", bestDay);
        Print("   ğŸ’¡ Ø²ÙŠØ§Ø¯Ø© Ø§Ù„ØªØ±ÙƒÙŠØ² ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ…");
    }
    
    if(stats.worstDayExecution >= 0) {
        string worstDay = GetDayOfWeekString(stats.worstDayExecution);
        Print("ğŸ“… ÙŠÙˆÙ… ÙŠØ­ØªØ§Ø¬ Ø­Ø°Ø±: ", worstDay);
        Print("   ğŸ’¡ ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ù…Ø®Ø§Ø·Ø± Ø£Ùˆ ØªØ¬Ù†Ø¨ Ø§Ù„ØªØ¯Ø§ÙˆÙ„ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ…");
    }
    
    // ØªÙˆØµÙŠØ§Øª Ø¹Ø§Ù…Ø© Ù„Ù„ØªÙˆÙ‚ÙŠØª
    Print("\nğŸ• ØªÙˆØµÙŠØ§Øª Ø§Ù„ØªÙˆÙ‚ÙŠØª Ø§Ù„Ø¹Ø§Ù…Ø©:");
    Print("   â€¢ Ø£ÙØ¶Ù„ Ø§Ù„Ø£ÙˆÙ‚Ø§Øª: ØªØ¯Ø§Ø®Ù„ Ø¬Ù„Ø³Ø© Ù„Ù†Ø¯Ù† ÙˆÙ†ÙŠÙˆÙŠÙˆØ±Ùƒ (13:00-17:00 GMT)");
    Print("   â€¢ ØªØ¬Ù†Ø¨: 30 Ø¯Ù‚ÙŠÙ‚Ø© Ù‚Ø¨Ù„ ÙˆØ¨Ø¹Ø¯ Ø§Ù„Ø£Ø®Ø¨Ø§Ø± Ø§Ù„Ø§Ù‚ØªØµØ§Ø¯ÙŠØ© Ø§Ù„Ù…Ù‡Ù…Ø©");
    Print("   â€¢ ØªØ¬Ù†Ø¨: Ø¢Ø®Ø± 30 Ø¯Ù‚ÙŠÙ‚Ø© Ù…Ù† Ø¬Ù„Ø³Ø© Ø§Ù„Ø¬Ù…Ø¹Ø©");
    Print("   â€¢ ØªØ¬Ù†Ø¨: Ø£ÙˆÙ„ Ø³Ø§Ø¹Ø© Ù…Ù† Ø§ÙØªØªØ§Ø­ Ø§Ù„Ø£Ø­Ø¯");
    Print("   â€¢ Ù…Ø±Ø§Ù‚Ø¨Ø©: Ø§Ù„ØªÙ‚ÙˆÙŠÙ… Ø§Ù„Ø§Ù‚ØªØµØ§Ø¯ÙŠ ÙŠÙˆÙ…ÙŠØ§Ù‹");
}

//+------------------------------------------------------------------+
//| ØªÙˆØµÙŠØ§Øª Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø§Ø·Ø±                                           |
//+------------------------------------------------------------------+
void GenerateRiskManagementRecommendations()
{
    Print("\nğŸ›¡ï¸ ØªÙˆØµÙŠØ§Øª Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø§Ø·Ø±:");
    
    // ØªØ­Ù„ÙŠÙ„ Ø£Ø­Ø¬Ø§Ù… Ø§Ù„ØµÙÙ‚Ø§Øª
    if(stats.avgVolume > 0) {
        Print("ğŸ’° Ø¥Ø¯Ø§Ø±Ø© Ø£Ø­Ø¬Ø§Ù… Ø§Ù„ØµÙÙ‚Ø§Øª:");
        Print("   â€¢ Ø§Ù„Ø­Ø¬Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ Ø§Ù„Ù…ØªÙˆØ³Ø·: ", DoubleToString(stats.avgVolume, 2), " Ù„ÙˆØª");
        
        if(stats.maxDrawdownPct > 10) {
            Print("   âš ï¸ Ø£Ù‚ØµÙ‰ Ø³Ø­Ø¨ Ù…Ø±ØªÙØ¹ (", DoubleToString(stats.maxDrawdownPct, 1), "%)");
            Print("   ğŸ’¡ ØªÙ‚Ù„ÙŠÙ„ Ø£Ø­Ø¬Ø§Ù… Ø§Ù„ØµÙÙ‚Ø§Øª Ø¨Ù†Ø³Ø¨Ø© 30-50%");
        } else if(stats.maxDrawdownPct > 5) {
            Print("   âš ï¸ Ø³Ø­Ø¨ Ù…ØªÙˆØ³Ø· (", DoubleToString(stats.maxDrawdownPct, 1), "%)");
            Print("   ğŸ’¡ ØªÙ‚Ù„ÙŠÙ„ Ø£Ø­Ø¬Ø§Ù… Ø§Ù„ØµÙÙ‚Ø§Øª Ø¨Ù†Ø³Ø¨Ø© 20%");
        }
    }
    
    // ØªØ­Ù„ÙŠÙ„ Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø®Ø§Ø·Ø± Ù„Ù„Ø¹ÙˆØ§Ø¦Ø¯
    if(stats.avgRiskReward > 0) {
        Print("âš–ï¸ Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø®Ø§Ø·Ø± Ù„Ù„Ø¹ÙˆØ§Ø¦Ø¯:");
        Print("   â€¢ Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©: 1:", DoubleToString(stats.avgRiskReward, 1));
        
        if(stats.avgRiskReward < 1.5) {
            Print("   âš ï¸ Ø§Ù„Ù†Ø³Ø¨Ø© Ù…Ù†Ø®ÙØ¶Ø© - Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø£Ù‡Ø¯Ø§Ù Ø£Ùˆ ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ø³ØªÙˆØ¨ Ù„ÙˆØ²");
        } else if(stats.avgRiskReward > 3.0) {
            Print("   âœ… Ø§Ù„Ù†Ø³Ø¨Ø© Ù…Ù…ØªØ§Ø²Ø© - Ø­Ø§ÙØ¸ Ø¹Ù„ÙŠÙ‡Ø§");
        }
    }
    
    // ØªÙˆØµÙŠØ§Øª Ø§Ù„Ø³ØªÙˆØ¨ Ù„ÙˆØ² ÙˆØ§Ù„ØªÙŠÙƒ Ø¨Ø±ÙˆÙØª
    Print("ğŸ¯ ØªÙˆØµÙŠØ§Øª Ø§Ù„Ø³ØªÙˆØ¨ Ù„ÙˆØ² ÙˆØ§Ù„ØªÙŠÙƒ Ø¨Ø±ÙˆÙØª:");
    Print("   â€¢ Ø§Ø³ØªØ®Ø¯Ù… Ø³ØªÙˆØ¨ Ù„ÙˆØ² Ø¯Ø§Ø¦Ù…Ø§Ù‹ (Ù„Ø§ ØªØªØ¯Ø§ÙˆÙ„ Ø¨Ø¯ÙˆÙ†Ù‡)");
    Print("   â€¢ Ù†Ø³Ø¨Ø© Ù…Ù‚ØªØ±Ø­Ø©: 1:2 Ø£Ùˆ 1:3 (Ù…Ø®Ø§Ø·Ø±:Ø¹Ø§Ø¦Ø¯)");
    Print("   â€¢ Ø§Ø³ØªØ®Ø¯Ù… Trailing Stop Ø¹Ù†Ø¯ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù€ 50% Ù…Ù† Ø§Ù„Ù‡Ø¯Ù");
    Print("   â€¢ Ø¶Ø¹ Ø§Ù„Ø³ØªÙˆØ¨ Ù„ÙˆØ² Ø®Ù„Ù Ù…Ø³ØªÙˆÙŠØ§Øª Ø§Ù„Ø¯Ø¹Ù…/Ø§Ù„Ù…Ù‚Ø§ÙˆÙ…Ø© Ø§Ù„Ù…Ù‡Ù…Ø©");
    
    // Ø¥Ø¯Ø§Ø±Ø© Ø±Ø£Ø³ Ø§Ù„Ù…Ø§Ù„
    Print("ğŸ’¼ Ø¥Ø¯Ø§Ø±Ø© Ø±Ø£Ø³ Ø§Ù„Ù…Ø§Ù„:");
    Print("   â€¢ Ù„Ø§ ØªØ®Ø§Ø·Ø± Ø¨Ø£ÙƒØ«Ø± Ù…Ù† 1-2% Ù…Ù† Ø§Ù„Ø­Ø³Ø§Ø¨ ÙÙŠ ØµÙÙ‚Ø© ÙˆØ§Ø­Ø¯Ø©");
    Print("   â€¢ Ø£Ù‚ØµÙ‰ Ù…Ø®Ø§Ø·Ø±Ø© ÙŠÙˆÙ…ÙŠØ©: 5% Ù…Ù† Ø§Ù„Ø­Ø³Ø§Ø¨");
    Print("   â€¢ Ø£Ù‚ØµÙ‰ Ù…Ø®Ø§Ø·Ø±Ø© Ø´Ù‡Ø±ÙŠØ©: 15% Ù…Ù† Ø§Ù„Ø­Ø³Ø§Ø¨");
    Print("   â€¢ ØªÙˆÙ‚Ù Ø¹Ù† Ø§Ù„ØªØ¯Ø§ÙˆÙ„ Ø¥Ø°Ø§ Ø®Ø³Ø±Øª 10% ÙÙŠ ÙŠÙˆÙ… ÙˆØ§Ø­Ø¯");
}

//+------------------------------------------------------------------+
//| ØªÙˆØµÙŠØ§Øª ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ø¯Ø§Ø¡                                            |
//+------------------------------------------------------------------+
void GeneratePerformanceImprovementRecommendations()
{
    Print("\nğŸš€ ØªÙˆØµÙŠØ§Øª ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ø¯Ø§Ø¡:");
    
    // ØªØ­Ù„ÙŠÙ„ Ù…Ø¹Ø§Ù…Ù„ Ø§Ù„Ø±Ø¨Ø­
    if(stats.profitFactor > 0) {
        Print("ğŸ“Š ØªØ­Ù„ÙŠÙ„ Ù…Ø¹Ø§Ù…Ù„ Ø§Ù„Ø±Ø¨Ø­:");
        Print("   â€¢ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„ Ø§Ù„Ø­Ø§Ù„ÙŠ: ", DoubleToString(stats.profitFactor, 2));
        
        if(stats.profitFactor < 1.0) {
            Print("   ğŸš¨ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„ Ø£Ù‚Ù„ Ù…Ù† 1 - Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© ØªØ­ØªØ§Ø¬ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø¬Ø°Ø±ÙŠØ©");
            Print("   ğŸ’¡ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªØ¯Ø§ÙˆÙ„ ÙˆÙ…Ø±Ø§Ø¬Ø¹Ø© Ø´Ø§Ù…Ù„Ø© Ù„Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ©");
        } else if(stats.profitFactor < 1.3) {
            Print("   âš ï¸ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„ Ù…Ù†Ø®ÙØ¶ - ØªØ­Ø³ÙŠÙ†Ø§Øª Ø¶Ø±ÙˆØ±ÙŠØ©");
            Print("   ğŸ’¡ ØªØ­Ø³ÙŠÙ† Ù†Ù‚Ø§Ø· Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙˆØ§Ù„Ø®Ø±ÙˆØ¬");
        } else if(stats.profitFactor > 2.0) {
            Print("   âœ… Ø§Ù„Ù…Ø¹Ø§Ù…Ù„ Ù…Ù…ØªØ§Ø² - Ø­Ø§ÙØ¸ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø¯Ø§Ø¡");
        }
    }
    
    // ØªØ­Ù„ÙŠÙ„ Ù…Ø¹Ø¯Ù„ Ø§Ù„Ù†Ø¬Ø§Ø­
    if(stats.winRate > 0) {
        Print("ğŸ¯ ØªØ­Ù„ÙŠÙ„ Ù…Ø¹Ø¯Ù„ Ø§Ù„Ù†Ø¬Ø§Ø­:");
        Print("   â€¢ Ø§Ù„Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø­Ø§Ù„ÙŠ: ", DoubleToString(stats.winRate, 1), "%");
        
        if(stats.winRate < 40) {
            Print("   âš ï¸ Ù…Ø¹Ø¯Ù„ Ù…Ù†Ø®ÙØ¶ - ØªØ­Ø³ÙŠÙ† Ø¥Ø´Ø§Ø±Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„");
        } else if(stats.winRate > 70) {
            Print("   âœ… Ù…Ø¹Ø¯Ù„ Ù…Ù…ØªØ§Ø² - Ù„ÙƒÙ† ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ Ø£ÙƒØ¨Ø± Ù…Ù† Ø§Ù„Ø®Ø³Ø§Ø¦Ø±");
        }
    }
    
    // ØªÙˆØµÙŠØ§Øª ØªÙ‚Ù†ÙŠØ©
    Print("âš™ï¸ ØªÙˆØµÙŠØ§Øª ØªÙ‚Ù†ÙŠØ©:");
    Print("   â€¢ Ø§Ø³ØªØ®Ø¯Ù… VPS Ù„Ø¶Ù…Ø§Ù† Ø§Ø³ØªÙ…Ø±Ø§Ø±ÙŠØ© Ø§Ù„ØªØ¯Ø§ÙˆÙ„");
    Print("   â€¢ Ø±Ø§Ù‚Ø¨ Ø³Ø±Ø¹Ø© Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª ÙˆØ²Ù…Ù† Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©");
    Print("   â€¢ Ø§Ø­ØªÙØ¸ Ø¨Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¨ÙˆØª");
    Print("   â€¢ Ø±Ø§Ø¬Ø¹ Ø§Ù„Ø³Ø¬Ù„Ø§Øª ÙŠÙˆÙ…ÙŠØ§Ù‹ Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ø£Ø®Ø·Ø§Ø¡");
    
    // ØªÙˆØµÙŠØ§Øª Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©
    Print("ğŸ‘€ ØªÙˆØµÙŠØ§Øª Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©:");
    Print("   â€¢ Ø±Ø§Ø¬Ø¹ Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø£Ø³Ø¨ÙˆØ¹ÙŠØ§Ù‹");
    Print("   â€¢ Ø§Ø­ØªÙØ¸ Ø¨Ø³Ø¬Ù„ Ù„Ù„ØªØºÙŠÙŠØ±Ø§Øª ÙˆØ§Ù„ØªØ­Ø³ÙŠÙ†Ø§Øª");
    Print("   â€¢ Ø±Ø§Ù‚Ø¨ Ø£Ø¯Ø§Ø¡ Ø§Ù„ÙˆØ³ÙŠØ· ÙˆØ£ÙˆÙ‚Ø§Øª Ø§Ù„ØªÙ†ÙÙŠØ°");
    Print("   â€¢ ØªØ§Ø¨Ø¹ Ø§Ù„Ø£Ø®Ø¨Ø§Ø± Ø§Ù„Ø§Ù‚ØªØµØ§Ø¯ÙŠØ© Ø§Ù„Ù…Ø¤Ø«Ø±Ø© Ø¹Ù„Ù‰ Ø£Ø²ÙˆØ§Ø¬Ùƒ");
}

//+------------------------------------------------------------------+
//| Ø®Ø·Ø© Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ù…ÙˆØµÙ‰ Ø¨Ù‡Ø§                                          |
//+------------------------------------------------------------------+
void GenerateActionPlan()
{
    Print("\nğŸ“‹ Ø®Ø·Ø© Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ù…ÙˆØµÙ‰ Ø¨Ù‡Ø§:");
    Print("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”");
    
    Print("ğŸ¯ Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ (Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø£ÙˆÙ„):");
    Print("   1. ØªÙ†ÙÙŠØ° ØªÙˆØµÙŠØ§Øª Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø§Ø·Ø± Ø§Ù„Ø¹Ø§Ø¬Ù„Ø©");
    Print("   2. Ø¶Ø¨Ø· Ø£ÙˆÙ‚Ø§Øª Ø§Ù„ØªØ¯Ø§ÙˆÙ„ Ø­Ø³Ø¨ Ø§Ù„ØªØ­Ù„ÙŠÙ„");
    Print("   3. ØªØ·Ø¨ÙŠÙ‚ ÙÙ„Ø§ØªØ± Ø§Ù„Ø³Ø¨Ø±ÙŠØ¯ ÙˆØ§Ù„Ø³ÙŠÙˆÙ„Ø©");
    Print("   4. Ù…Ø±Ø§Ø¬Ø¹Ø© ÙˆØªØ­Ø¯ÙŠØ« Ù…Ø³ØªÙˆÙŠØ§Øª Ø§Ù„Ø³ØªÙˆØ¨ Ù„ÙˆØ² ÙˆØ§Ù„ØªÙŠÙƒ Ø¨Ø±ÙˆÙØª");
    
    Print("\nğŸ“ˆ Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ© (Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø«Ø§Ù†ÙŠ):");
    Print("   1. ØªØ­Ø³ÙŠÙ† Ø®ÙˆØ§Ø±Ø²Ù…ÙŠØ© ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø§ØªØ¬Ø§Ù‡");
    Print("   2. ØªØ·Ø¨ÙŠÙ‚ ØªÙˆØµÙŠØ§Øª ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ø§Ù†Ø²Ù„Ø§Ù‚");
    Print("   3. Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªØ­Ø³ÙŠÙ†Ø§Øª Ø¹Ù„Ù‰ Ø­Ø³Ø§Ø¨ ØªØ¬Ø±ÙŠØ¨ÙŠ");
    Print("   4. Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„ØªØ­Ø³ÙŠÙ†Ø§Øª ÙˆÙ‚ÙŠØ§Ø³ Ø§Ù„Ù†ØªØ§Ø¦Ø¬");
    
    Print("\nğŸ”„ Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø«Ø§Ù„Ø«Ø© (Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø«Ø§Ù„Ø«):");
    Print("   1. ØªØ­Ù„ÙŠÙ„ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªØ­Ø³ÙŠÙ†Ø§Øª");
    Print("   2. ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ù†Ø§Ø¬Ø­Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ");
    Print("   3. Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø£Ø¯Ø§Ø¡ ÙŠÙˆÙ…ÙŠØ§Ù‹");
    Print("   4. ØªØ³Ø¬ÙŠÙ„ Ø£ÙŠ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø£Ùˆ Ù…Ø´Ø§ÙƒÙ„ Ø¬Ø¯ÙŠØ¯Ø©");
    
    Print("\nâœ… Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø±Ø§Ø¨Ø¹Ø© (Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø±Ø§Ø¨Ø¹):");
    Print("   1. ØªÙ‚ÙŠÙŠÙ… Ø´Ø§Ù…Ù„ Ù„Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„Ø¬Ø¯ÙŠØ¯");
    Print("   2. Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ù…Ø¹ Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©");
    Print("   3. ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©");
    Print("   4. ÙˆØ¶Ø¹ Ø®Ø·Ø© Ø§Ù„ØªØ·ÙˆÙŠØ± Ù„Ù„Ø´Ù‡Ø± Ø§Ù„ØªØ§Ù„ÙŠ");
    
    // Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
    Print("\nğŸ“Š Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙØ©:");
    double targetExecutionRate = MathMin(95, CalculatePercentage(stats.executedOrders, stats.totalOrders) + 20);
    double targetWinRate = MathMin(70, stats.winRate + 10);
    double targetProfitFactor = MathMax(1.5, stats.profitFactor + 0.3);
    
    Print("   â€¢ Ù…Ø¹Ø¯Ù„ Ø§Ù„ØªÙ†ÙÙŠØ° Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù: ", DoubleToString(targetExecutionRate, 0), "%");
    Print("   â€¢ Ù…Ø¹Ø¯Ù„ Ø§Ù„Ù†Ø¬Ø§Ø­ Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù: ", DoubleToString(targetWinRate, 0), "%");
    Print("   â€¢ Ù…Ø¹Ø§Ù…Ù„ Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù: ", DoubleToString(targetProfitFactor, 1));
    Print("   â€¢ Ø£Ù‚ØµÙ‰ Ø³Ø­Ø¨ Ù…Ù‚Ø¨ÙˆÙ„: 5%");
    
    // ØªØ­Ø°ÙŠØ±Ø§Øª Ù…Ù‡Ù…Ø©
    Print("\nâš ï¸ ØªØ­Ø°ÙŠØ±Ø§Øª Ù…Ù‡Ù…Ø©:");
    Print("   â€¢ Ù„Ø§ ØªØ·Ø¨Ù‚ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø©");
    Print("   â€¢ Ø§Ø®ØªØ¨Ø± ÙƒÙ„ ØªØ­Ø³ÙŠÙ† Ø¹Ù„Ù‰ Ø­Ø¯Ø©");
    Print("   â€¢ Ø§Ø­ØªÙØ¸ Ø¨Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ù…Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©");
    Print("   â€¢ Ø±Ø§Ù‚Ø¨ Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø¨Ø§Ø³ØªÙ…Ø±Ø§Ø± ÙˆÙƒÙ† Ù…Ø³ØªØ¹Ø¯Ø§Ù‹ Ù„Ù„ØªØ±Ø§Ø¬Ø¹");
    
    Print("\nğŸ¯ Ø§Ù„Ù‡Ø¯Ù Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ:");
    Print("   ØªØ­Ù‚ÙŠÙ‚ ØªØ¯Ø§ÙˆÙ„ Ù…Ø³ØªÙ‚Ø± ÙˆÙ…Ø±Ø¨Ø­ Ù…Ø¹ Ù…Ø®Ø§Ø·Ø± Ù…Ø­ÙƒÙˆÙ…Ø©");
    Print("   ÙˆØ§Ù„ÙˆØµÙˆÙ„ Ù„Ù…Ø¹Ø¯Ù„ ØªÙ†ÙÙŠØ° Ø¹Ø§Ù„ÙŠ ÙˆØ§Ø³ØªÙ‚Ø±Ø§Ø± ÙÙŠ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­");
}

//+------------------------------------------------------------------+
//| Ø­ÙØ¸ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…ØªÙ‚Ø¯Ù… ÙÙŠ Ù…Ù„Ù                                    |
//+------------------------------------------------------------------+
void SaveAdvancedReportToFile()
{
    Print("\nğŸ’¾ Ø¬Ø§Ø±ÙŠ Ø­ÙØ¸ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…ØªÙ‚Ø¯Ù…...");
    
    // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ø³Ù… Ù…Ù„Ù Ù…ÙØµÙ„
    MqlDateTime dt;
    TimeToStruct(TimeCurrent(), dt);
    
    string fileName = StringFormat("%s_Advanced_%04d%02d%02d_%02d%02d.txt", 
                     ReportFileName, 
                     dt.year, dt.mon, dt.day, 
                     dt.hour, dt.min);
    
    // Ù…Ø­Ø§ÙˆÙ„Ø© ÙØªØ­ Ø§Ù„Ù…Ù„Ù Ø¨ØªØ±Ù…ÙŠØ² UTF-8
    int fileHandle = FileOpen(fileName, FILE_WRITE|FILE_TXT|FILE_UNICODE);
    
    if(fileHandle == INVALID_HANDLE) {
        Print("âŒ ÙØ´Ù„ ÙÙŠ ÙØªØ­ Ø§Ù„Ù…Ù„Ù Ø¨Ù€ UNICODEØŒ Ù…Ø­Ø§ÙˆÙ„Ø© Ø¨Ù€ ANSI...");
        fileHandle = FileOpen(StringFormat("ZigzagReport_%04d%02d%02d_%02d%02d.txt", 
                             dt.year, dt.mon, dt.day, dt.hour, dt.min), 
                             FILE_WRITE|FILE_TXT|FILE_ANSI);
    }
    
    if(fileHandle != INVALID_HANDLE) {
        // ÙƒØªØ§Ø¨Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙƒØ§Ù…Ù„
        WriteCompleteReport(fileHandle);
        FileClose(fileHandle);
        
        Print("âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…ØªÙ‚Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­: ", fileName);
        Print("ğŸ“ Ø§Ù„Ù…Ù„Ù Ù…Ø­ÙÙˆØ¸ ÙÙŠ: MQL5\\Files\\", fileName);
    } else {
        Print("âŒ ÙØ´Ù„ ÙÙŠ Ø­ÙØ¸ Ø§Ù„ØªÙ‚Ø±ÙŠØ± - ÙƒÙˆØ¯ Ø§Ù„Ø®Ø·Ø£: ", GetLastError());
        Print("ğŸ’¡ ØªØ£ÙƒØ¯ Ù…Ù† ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„ÙƒØªØ§Ø¨Ø© ÙˆÙˆØ¬ÙˆØ¯ Ù…Ø¬Ù„Ø¯ MQL5\\Files");
    }
}

//+------------------------------------------------------------------+
//| ÙƒØªØ§Ø¨Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙƒØ§Ù…Ù„ ÙÙŠ Ø§Ù„Ù…Ù„Ù                                 |
//+------------------------------------------------------------------+
void WriteCompleteReport(int fileHandle)
{
    // ØªØ±ÙˆÙŠØ³Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ±
    WriteReportHeader(fileHandle);
    
    // Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¹Ø§Ù…Ø©
    WriteGeneralStatisticsToFile(fileHandle);
    
    // ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ù…Ù†ÙØ°Ø©
    WriteExecutedAnalysisToFile(fileHandle);
    
    // ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£ÙˆØ§Ù…Ø± ØºÙŠØ± Ø§Ù„Ù…Ù†ÙØ°Ø©
    WriteNonExecutedAnalysisToFile(fileHandle);
    
    // Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªÙØµÙŠÙ„ÙŠ
    WriteDetailedAnalysisToFile(fileHandle);
    
    // Ø§Ù„ØªÙˆØµÙŠØ§Øª
    WriteRecommendationsToFile(fileHandle);
    
    // Ø®Ø§ØªÙ…Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ±
    WriteReportFooter(fileHandle);
}

//+------------------------------------------------------------------+
//| Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¨Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„                                         |
//+------------------------------------------------------------------+
void SendReportByEmail()
{
    if(!SendEmailReport) return;
    
    Print("ğŸ“§ Ø¬Ø§Ø±ÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¨Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„...");
    
    string subject = "ØªÙ‚Ø±ÙŠØ± Ù…Ø­Ù„Ù„ Ø§Ù„Ø²Ø¬Ø²Ø§Ø¬ Ø§Ù„Ù…ØªÙ‚Ø¯Ù… - " + TimeToString(TimeCurrent(), TIME_DATE);
    string body = CreateEmailBody();
    
    if(SendMail(subject, body)) {
        Print("âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¨Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­");
    } else {
        Print("âŒ ÙØ´Ù„ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¨Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„ - ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„");
    }
}

//+------------------------------------------------------------------+
//| Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„                                            |
//+------------------------------------------------------------------+
string CreateEmailBody()
{
    string body = "ØªÙ‚Ø±ÙŠØ± Ù…Ø­Ù„Ù„ Ø¨ÙˆØª Ø§Ù„Ø²Ø¬Ø²Ø§Ø¬ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…\n";
    body += "=====================================\n\n";
    
    body += "ğŸ“Š Ù…Ù„Ø®Øµ Ø§Ù„Ø£Ø¯Ø§Ø¡:\n";
    body += "Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£ÙˆØ§Ù…Ø±: " + IntegerToString(stats.totalOrders) + "\n";
    body += "Ø£ÙˆØ§Ù…Ø± Ù…Ù†ÙØ°Ø©: " + IntegerToString(stats.executedOrders) + "\n";
    body += "Ù…Ø¹Ø¯Ù„ Ø§Ù„ØªÙ†ÙÙŠØ°: " + DoubleToString(CalculatePercentage(stats.executedOrders, stats.totalOrders), 1) + "%\n";
    
    if(stats.executedOrders > 0) {
        body += "Ù…Ø¹Ø¯Ù„ Ø§Ù„Ù†Ø¬Ø§Ø­: " + DoubleToString(stats.winRate, 1) + "%\n";
        body += "ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­: " + DoubleToString(stats.totalProfit, 2) + "$\n";
        body += "Ù…Ø¹Ø§Ù…Ù„ Ø§Ù„Ø±Ø¨Ø­: " + DoubleToString(stats.profitFactor, 2) + "\n";
    }
    
    body += "\nÙ„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…ÙØµÙ„ØŒ Ø±Ø§Ø¬Ø¹ Ù…Ù„Ù Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø­ÙÙˆØ¸.\n";
    
    return body;
}

//--- Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø³Ø§Ø¨Ø¹ ---
//+------------------------------------------------------------------+
//| Expert Advisor: Advanced Zigzag Analysis Bot - Part 8/15       |
//| Ù…Ø­Ù„Ù„ Ø¨ÙˆØª Ø§Ù„Ø²Ø¬Ø²Ø§Ø¬ Ø§Ù„Ø¹Ø¨Ù‚Ø±ÙŠ - Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø«Ø§Ù…Ù†: Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª     |
//+------------------------------------------------------------------+

// ØªÙƒÙ…Ù„Ø© Ù„Ù„Ø£Ø¬Ø²Ø§Ø¡ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© - Ø¯ÙˆØ§Ù„ ÙƒØªØ§Ø¨Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ± ÙÙŠ Ø§Ù„Ù…Ù„Ù

//+------------------------------------------------------------------+
//| ÙƒØªØ§Ø¨Ø© ØªØ±ÙˆÙŠØ³Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ±                                           |
//+------------------------------------------------------------------+
void WriteReportHeader(int fileHandle)
{
    FileWriteString(fileHandle, "==========================================\n");
    FileWriteString(fileHandle, "ğŸ“Š ØªÙ‚Ø±ÙŠØ± Ù…Ø­Ù„Ù„ Ø¨ÙˆØª Ø§Ù„Ø²Ø¬Ø²Ø§Ø¬ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…\n");
    FileWriteString(fileHandle, "ğŸ“… ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚Ø±ÙŠØ±: " + TimeToString(TimeCurrent()) + "\n");
    FileWriteString(fileHandle, "â±ï¸ ÙØªØ±Ø© Ø§Ù„ØªØ­Ù„ÙŠÙ„: " + IntegerToString(AnalysisPeriodDays) + " ÙŠÙˆÙ…\n");
    FileWriteString(fileHandle, "ğŸ” Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ù…Ø­Ù„Ù„: Ù…ØªÙ‚Ø¯Ù… - Ø´Ø§Ù…Ù„ ÙˆÙ…ÙØµÙ„\n");
    FileWriteString(fileHandle, "==========================================\n\n");
}

//+------------------------------------------------------------------+
//| ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¹Ø§Ù…Ø© ÙÙŠ Ø§Ù„Ù…Ù„Ù                              |
//+------------------------------------------------------------------+
void WriteGeneralStatisticsToFile(int fileHandle)
{
    FileWriteString(fileHandle, "ğŸ“Š Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¹Ø§Ù…Ø©:\n");
    FileWriteString(fileHandle, "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n");
    FileWriteString(fileHandle, "ğŸ”¢ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£ÙˆØ§Ù…Ø±: " + IntegerToString(stats.totalOrders) + "\n");
    FileWriteString(fileHandle, "âœ… Ø£ÙˆØ§Ù…Ø± Ù…Ù†ÙØ°Ø©: " + IntegerToString(stats.executedOrders) + " (" + 
                   DoubleToString(CalculatePercentage(stats.executedOrders, stats.totalOrders), 1) + "%)\n");
    FileWriteString(fileHandle, "â° Ø£ÙˆØ§Ù…Ø± Ù…Ù†ØªÙ‡ÙŠØ© Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©: " + IntegerToString(stats.pendingExpired) + " (" + 
                   DoubleToString(CalculatePercentage(stats.pendingExpired, stats.totalOrders), 1) + "%)\n");
    FileWriteString(fileHandle, "âŒ Ø£ÙˆØ§Ù…Ø± Ù…Ù„ØºØ§Ø©: " + IntegerToString(stats.pendingCancelled) + " (" + 
                   DoubleToString(CalculatePercentage(stats.pendingCancelled, stats.totalOrders), 1) + "%)\n");
    FileWriteString(fileHandle, "ğŸš« Ø£ÙˆØ§Ù…Ø± Ù…Ø±ÙÙˆØ¶Ø©: " + IntegerToString(stats.pendingRejected) + " (" + 
                   DoubleToString(CalculatePercentage(stats.pendingRejected, stats.totalOrders), 1) + "%)\n");
    FileWriteString(fileHandle, "âš¡ Ø£ÙˆØ§Ù…Ø± Ø¬Ø²Ø¦ÙŠØ©: " + IntegerToString(stats.partiallyFilled) + "\n");
    FileWriteString(fileHandle, "ğŸ“ˆ Ù…Ø¹Ø¯Ù„ Ø§Ù„ØªÙ†ÙÙŠØ° Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: " + 
                   DoubleToString(CalculatePercentage(stats.executedOrders, stats.totalOrders), 1) + "%\n\n");
    
    // Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ØªÙˆÙ‚ÙŠØª
    FileWriteString(fileHandle, "â° Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ØªÙˆÙ‚ÙŠØª:\n");
    FileWriteString(fileHandle, "ğŸŒ… Ø£ÙˆØ§Ù…Ø± Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹: " + IntegerToString(stats.weekendOrders) + "\n");
    FileWriteString(fileHandle, "ğŸ“° Ø£ÙˆØ§Ù…Ø± ÙˆÙ‚Øª Ø§Ù„Ø£Ø®Ø¨Ø§Ø±: " + IntegerToString(stats.newsTimeOrders) + "\n");
    if(stats.avgOrderLifetime > 0) {
        FileWriteString(fileHandle, "â±ï¸ Ù…ØªÙˆØ³Ø· Ù…Ø¯Ø© Ø§Ù„Ø£ÙˆØ§Ù…Ø± ØºÙŠØ± Ø§Ù„Ù…Ù†ÙØ°Ø©: " + 
                       DoubleToString(stats.avgOrderLifetime, 1) + " Ø¯Ù‚ÙŠÙ‚Ø©\n");
    }
    FileWriteString(fileHandle, "\n");
}

//+------------------------------------------------------------------+
//| ÙƒØªØ§Ø¨Ø© ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ù…Ù†ÙØ°Ø© ÙÙŠ Ø§Ù„Ù…Ù„Ù                          |
//+------------------------------------------------------------------+
void WriteExecutedAnalysisToFile(int fileHandle)
{
    if(stats.executedOrders == 0) {
        FileWriteString(fileHandle, "âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£ÙˆØ§Ù…Ø± Ù…Ù†ÙØ°Ø© Ù„Ù„ØªØ­Ù„ÙŠÙ„\n\n");
        return;
    }
    
    FileWriteString(fileHandle, "ğŸ’° ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ù…Ù†ÙØ°Ø© (Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©):\n");
    FileWriteString(fileHandle, "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n");
    FileWriteString(fileHandle, "ğŸ“Š Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ù…Ù†ÙØ°Ø©: " + IntegerToString(stats.executedOrders) + "\n");
    FileWriteString(fileHandle, "ğŸŸ¢ ØµÙÙ‚Ø§Øª Ø±Ø§Ø¨Ø­Ø©: " + IntegerToString(stats.executedWins) + " (" + 
                   DoubleToString(stats.winRate, 1) + "%)\n");
    FileWriteString(fileHandle, "ğŸ”´ ØµÙÙ‚Ø§Øª Ø®Ø§Ø³Ø±Ø©: " + IntegerToString(stats.executedLosses) + " (" + 
                   DoubleToString(100 - stats.winRate, 1) + "%)\n");
    FileWriteString(fileHandle, "âš–ï¸ ØµÙÙ‚Ø§Øª Ù…ØªØ¹Ø§Ø¯Ù„Ø©: " + IntegerToString(stats.executedBreakeven) + "\n\n");
    
    // Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ ÙˆØ§Ù„Ø®Ø³Ø§Ø¦Ø±
    FileWriteString(fileHandle, "ğŸ’µ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ ÙˆØ§Ù„Ø®Ø³Ø§Ø¦Ø±:\n");
    FileWriteString(fileHandle, "ğŸ’° ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­: " + DoubleToString(stats.totalProfit, 2) + "$\n");
    FileWriteString(fileHandle, "ğŸ“ˆ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­: " + DoubleToString(stats.grossProfit, 2) + "$\n");
    FileWriteString(fileHandle, "ğŸ“‰ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø®Ø³Ø§Ø¦Ø±: " + DoubleToString(stats.grossLoss, 2) + "$\n");
    FileWriteString(fileHandle, "ğŸ”¢ Ù…ØªÙˆØ³Ø· Ø§Ù„Ø±Ø¨Ø­: " + DoubleToString(stats.avgWin, 2) + "$\n");
    FileWriteString(fileHandle, "ğŸ”» Ù…ØªÙˆØ³Ø· Ø§Ù„Ø®Ø³Ø§Ø±Ø©: " + DoubleToString(stats.avgLoss, 2) + "$\n");
    FileWriteString(fileHandle, "ğŸ”º Ø£ÙƒØ¨Ø± Ø±Ø¨Ø­: " + DoubleToString(stats.maxWin, 2) + "$\n");
    FileWriteString(fileHandle, "ğŸ”» Ø£ÙƒØ¨Ø± Ø®Ø³Ø§Ø±Ø©: " + DoubleToString(stats.maxLoss, 2) + "$\n\n");
    
    // Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡
    FileWriteString(fileHandle, "ğŸ“Š Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡:\n");
    FileWriteString(fileHandle, "âš–ï¸ Ù…Ø¹Ø§Ù…Ù„ Ø§Ù„Ø±Ø¨Ø­: " + DoubleToString(stats.profitFactor, 2) + "\n");
    FileWriteString(fileHandle, "ğŸ“ Ù…ØªÙˆØ³Ø· Ø­Ø¬Ù… Ø§Ù„ØµÙÙ‚Ø©: " + DoubleToString(stats.avgVolume, 2) + " Ù„ÙˆØª\n");
    FileWriteString(fileHandle, "ğŸ’¼ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø­Ø¬Ù… Ø§Ù„Ù…ØªØ¯Ø§ÙˆÙ„: " + DoubleToString(stats.totalVolume, 2) + " Ù„ÙˆØª\n");
    FileWriteString(fileHandle, "ğŸ’¸ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹Ù…ÙˆÙ„Ø§Øª: " + DoubleToString(stats.totalCommission, 2) + "$\n");
    FileWriteString(fileHandle, "ğŸ”„ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³ÙˆØ§Ø¨Ø§Øª: " + DoubleToString(stats.totalSwap, 2) + "$\n");
    
    // Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ù…Ø®Ø§Ø·Ø±
    if(stats.maxDrawdownPct > 0) {
        FileWriteString(fileHandle, "ğŸ“‰ Ø£Ù‚ØµÙ‰ Ø³Ø­Ø¨: " + DoubleToString(stats.maxDrawdownPct, 2) + "%\n");
        FileWriteString(fileHandle, "ğŸ“Š Ù…ØªÙˆØ³Ø· Ø§Ù„Ø³Ø­Ø¨: " + DoubleToString(stats.avgDrawdownPct, 2) + "%\n");
    }
    if(stats.maxRunupPct > 0) {
        FileWriteString(fileHandle, "ğŸ“ˆ Ø£Ù‚ØµÙ‰ Ø±Ø¨Ø­ Ù…Ø­ØªÙ…Ù„: " + DoubleToString(stats.maxRunupPct, 1) + " Ù†Ù‚Ø·Ø©\n");
    }
    if(stats.sharpeRatio != 0) {
        FileWriteString(fileHandle, "ğŸ“Š Ù†Ø³Ø¨Ø© Ø´Ø§Ø±Ø¨: " + DoubleToString(stats.sharpeRatio, 2) + "\n");
    }
    if(stats.avgRiskReward > 0) {
        FileWriteString(fileHandle, "âš–ï¸ Ù…ØªÙˆØ³Ø· Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø®Ø§Ø·Ø±/Ø§Ù„Ø¹Ø§Ø¦Ø¯: " + DoubleToString(stats.avgRiskReward, 2) + "\n");
    }
    if(stats.recoveryFactor != 0) {
        FileWriteString(fileHandle, "ğŸ”„ Ù…Ø¹Ø§Ù…Ù„ Ø§Ù„Ø§Ø³ØªØ±Ø¯Ø§Ø¯: " + DoubleToString(stats.recoveryFactor, 2) + "\n");
    }
    FileWriteString(fileHandle, "\n");
}

//+------------------------------------------------------------------+
//| ÙƒØªØ§Ø¨Ø© ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£ÙˆØ§Ù…Ø± ØºÙŠØ± Ø§Ù„Ù…Ù†ÙØ°Ø© ÙÙŠ Ø§Ù„Ù…Ù„Ù                      |
//+------------------------------------------------------------------+
void WriteNonExecutedAnalysisToFile(int fileHandle)
{
    int nonExecuted = stats.totalOrders - stats.executedOrders;
    if(nonExecuted == 0) {
        FileWriteString(fileHandle, "âœ… Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£ÙˆØ§Ù…Ø± ØªÙ… ØªÙ†ÙÙŠØ°Ù‡Ø§ - Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£ÙˆØ§Ù…Ø± Ù…Ø¹Ù„Ù‚Ø© ÙØ§Ø´Ù„Ø©\n\n");
        return;
    }
    
    FileWriteString(fileHandle, "ğŸ“‹ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£ÙˆØ§Ù…Ø± ØºÙŠØ± Ø§Ù„Ù…Ù†ÙØ°Ø© (Ù„Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ÙÙ‚Ø·):\n");
    FileWriteString(fileHandle, "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n");
    FileWriteString(fileHandle, "ğŸ“Š Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£ÙˆØ§Ù…Ø± ØºÙŠØ± Ø§Ù„Ù…Ù†ÙØ°Ø©: " + IntegerToString(nonExecuted) + "\n\n");
    
    // ØªØµÙ†ÙŠÙ Ø£Ø³Ø¨Ø§Ø¨ Ø¹Ø¯Ù… Ø§Ù„ØªÙ†ÙÙŠØ°
    FileWriteString(fileHandle, "ğŸ” ØªØµÙ†ÙŠÙ Ø£Ø³Ø¨Ø§Ø¨ Ø¹Ø¯Ù… Ø§Ù„ØªÙ†ÙÙŠØ°:\n");
    FileWriteString(fileHandle, "   ğŸ¯ Ø§Ù„Ø³Ø¹Ø± Ù„Ù… ÙŠØµÙ„ Ù„Ù„Ù…Ø³ØªÙˆÙ‰: " + IntegerToString(stats.priceDidntReach) + " Ø£ÙˆØ§Ù…Ø±\n");
    FileWriteString(fileHandle, "   âš ï¸ Ø§Ù„Ø³Ø¹Ø± ÙˆØµÙ„ Ù„ÙƒÙ† Ù„Ù… ÙŠÙ†ÙØ°: " + IntegerToString(stats.priceReachedButNotExecuted) + " Ø£ÙˆØ§Ù…Ø±\n");
    FileWriteString(fileHandle, "   âœ‹ Ù…Ù„ØºØ§Ø© ÙŠØ¯ÙˆÙŠØ§Ù‹: " + IntegerToString(stats.cancelledManually) + " Ø£ÙˆØ§Ù…Ø±\n");
    FileWriteString(fileHandle, "   â° Ù…Ù†ØªÙ‡ÙŠØ© Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©: " + IntegerToString(stats.expiredOrders) + " Ø£ÙˆØ§Ù…Ø±\n");
    FileWriteString(fileHandle, "   ğŸš« Ù…Ø±ÙÙˆØ¶Ø© Ù…Ù† Ø§Ù„ÙˆØ³ÙŠØ·: " + IntegerToString(stats.rejectedOrders) + " Ø£ÙˆØ§Ù…Ø±\n\n");
    
    // Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø³Ø§ÙØ© ÙˆØ§Ù„ÙˆÙ‚Øª
    if(stats.avgDistanceFromTarget > 0) {
        FileWriteString(fileHandle, "ğŸ“ Ù…ØªÙˆØ³Ø· Ø§Ù„Ù…Ø³Ø§ÙØ© Ù…Ù† Ø§Ù„Ù‡Ø¯Ù: " + DoubleToString(stats.avgDistanceFromTarget, 1) + " Ù†Ù‚Ø·Ø©\n");
    }
    
    // ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„ØªÙŠ ÙˆØµÙ„ Ù„Ù‡Ø§ Ø§Ù„Ø³Ø¹Ø±
    if(stats.priceReachedButNotExecuted > 0) {
        double percentageReached = CalculatePercentage(stats.priceReachedButNotExecuted, nonExecuted);
        FileWriteString(fileHandle, "ğŸš¨ ØªØ­Ù„ÙŠÙ„ Ù…Ù‡Ù…: " + IntegerToString(stats.priceReachedButNotExecuted) + 
                       " Ø£ÙˆØ§Ù…Ø± ÙˆØµÙ„ Ù„Ù‡Ø§ Ø§Ù„Ø³Ø¹Ø± Ù„ÙƒÙ† Ù„Ù… ØªÙ†ÙØ° (" + DoubleToString(percentageReached, 1) + "% Ù…Ù† ØºÙŠØ± Ø§Ù„Ù…Ù†ÙØ°Ø©)\n");
        FileWriteString(fileHandle, "ğŸ’¡ Ù‡Ø°Ø§ ÙŠØ´ÙŠØ± Ø¥Ù„Ù‰ Ù…Ø´Ø§ÙƒÙ„ Ù…Ø­ØªÙ…Ù„Ø© ÙÙŠ: Ø§Ù„Ø³ÙŠÙˆÙ„Ø©ØŒ Ø³Ø±Ø¹Ø© Ø§Ù„ØªÙ†ÙÙŠØ°ØŒ Ø£Ùˆ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ÙˆØ³ÙŠØ·\n");
    }
    FileWriteString(fileHandle, "\n");
}

//+------------------------------------------------------------------+
//| ÙƒØªØ§Ø¨Ø© Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªÙØµÙŠÙ„ÙŠ ÙÙŠ Ø§Ù„Ù…Ù„Ù                               |
//+------------------------------------------------------------------+
void WriteDetailedAnalysisToFile(int fileHandle)
{
    FileWriteString(fileHandle, "ğŸ” Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªÙØµÙŠÙ„ÙŠ ÙˆØ§Ù„Ø£Ù†Ù…Ø§Ø·:\n");
    FileWriteString(fileHandle, "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n");
    
    // ØªØ­Ù„ÙŠÙ„ Ø£Ù†Ù…Ø§Ø· Ø§Ù„ÙØ´Ù„
    WriteFailurePatternsToFile(fileHandle);
    
    // ØªØ­Ù„ÙŠÙ„ Ø£ÙˆÙ‚Ø§Øª Ø§Ù„ØªØ¯Ø§ÙˆÙ„
    WriteTimingAnalysisToFile(fileHandle);
    
    // ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø³Ø¨Ø±ÙŠØ¯ ÙˆØ§Ù„Ø§Ù†Ø²Ù„Ø§Ù‚
    WriteSpreadSlippageAnalysisToFile(fileHandle);
    
    // ØªØ­Ù„ÙŠÙ„ Ø£Ø­Ø¬Ø§Ù… Ø§Ù„ØµÙÙ‚Ø§Øª
    WriteVolumeAnalysisToFile(fileHandle);
    
    // Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ù…ØªÙ‚Ø¯Ù…Ø©
    WriteAdvancedStatisticsToFile(fileHandle);
}

//+------------------------------------------------------------------+
//| ÙƒØªØ§Ø¨Ø© Ø£Ù†Ù…Ø§Ø· Ø§Ù„ÙØ´Ù„ ÙÙŠ Ø§Ù„Ù…Ù„Ù                                    |
//+------------------------------------------------------------------+
void WriteFailurePatternsToFile(int fileHandle)
{
    FileWriteString(fileHandle, "âš ï¸ Ø£Ù†Ù…Ø§Ø· Ø§Ù„ÙØ´Ù„ Ø§Ù„Ù…ÙƒØªØ´ÙØ©:\n");
    
    if(stats.highSpreadFailures > 0) {
        double percentage = CalculatePercentage(stats.highSpreadFailures, stats.totalOrders);
        FileWriteString(fileHandle, "   ğŸ“Š ØµÙÙ‚Ø§Øª Ù…ØªØ£Ø«Ø±Ø© Ø¨Ø§Ù„Ø³Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¹Ø§Ù„ÙŠ: " + IntegerToString(stats.highSpreadFailures) + 
                       " (" + DoubleToString(percentage, 1) + "%)\n");
    }
    
    if(stats.wrongDirectionFailures > 0) {
        double percentage = CalculatePercentage(stats.wrongDirectionFailures, stats.executedOrders);
        FileWriteString(fileHandle, "   ğŸ¯ ØµÙÙ‚Ø§Øª ÙÙŠ Ø§Ù„Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ø®Ø§Ø·Ø¦: " + IntegerToString(stats.wrongDirectionFailures) + 
                       " (" + DoubleToString(percentage, 1) + "% Ù…Ù† Ø§Ù„Ù…Ù†ÙØ°Ø©)\n");
    }
    
    if(stats.almostTPFailures > 0) {
        double percentage = CalculatePercentage(stats.almostTPFailures, stats.executedLosses);
        FileWriteString(fileHandle, "   ğŸ¯ ØµÙÙ‚Ø§Øª Ù‚Ø±ÙŠØ¨Ø© Ù…Ù† Ø§Ù„Ù‡Ø¯Ù: " + IntegerToString(stats.almostTPFailures) + 
                       " (" + DoubleToString(percentage, 1) + "% Ù…Ù† Ø§Ù„Ø®Ø§Ø³Ø±Ø©)\n");
    }
    
    if(stats.slippageFailures > 0) {
        double percentage = CalculatePercentage(stats.slippageFailures, stats.executedOrders);
        FileWriteString(fileHandle, "   ğŸ“‰ ØµÙÙ‚Ø§Øª Ù…ØªØ£Ø«Ø±Ø© Ø¨Ø§Ù„Ø§Ù†Ø²Ù„Ø§Ù‚: " + IntegerToString(stats.slippageFailures) + 
                       " (" + DoubleToString(percentage, 1) + "%)\n");
    }
    
    if(stats.liquidityFailures > 0) {
        double percentage = CalculatePercentage(stats.liquidityFailures, stats.totalOrders);
        FileWriteString(fileHandle, "   ğŸ’§ ØµÙÙ‚Ø§Øª Ù…ØªØ£Ø«Ø±Ø© Ø¨Ù†Ù‚Øµ Ø§Ù„Ø³ÙŠÙˆÙ„Ø©: " + IntegerToString(stats.liquidityFailures) + 
                       " (" + DoubleToString(percentage, 1) + "%)\n");
    }
    
    if(stats.timeoutFailures > 0) {
        double percentage = CalculatePercentage(stats.timeoutFailures, stats.totalOrders);
        FileWriteString(fileHandle, "   â° ØµÙÙ‚Ø§Øª ÙØ§Ø´Ù„Ø© Ø¨Ø³Ø¨Ø¨ Ø§Ù„ØªÙˆÙ‚ÙŠØª: " + IntegerToString(stats.timeoutFailures) + 
                       " (" + DoubleToString(percentage, 1) + "%)\n");
    }
    
    FileWriteString(fileHandle, "\n");
}

//+------------------------------------------------------------------+
//| ÙƒØªØ§Ø¨Ø© ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£ÙˆÙ‚Ø§Øª ÙÙŠ Ø§Ù„Ù…Ù„Ù                                   |
//+------------------------------------------------------------------+
void WriteTimingAnalysisToFile(int fileHandle)
{
    FileWriteString(fileHandle, "â° ØªØ­Ù„ÙŠÙ„ Ø£ÙˆÙ‚Ø§Øª Ø§Ù„ØªØ¯Ø§ÙˆÙ„:\n");
    
    if(stats.bestHourExecution >= 0) {
        FileWriteString(fileHandle, "ğŸŒŸ Ø£ÙØ¶Ù„ Ø³Ø§Ø¹Ø© Ù„Ù„ØªÙ†ÙÙŠØ°: " + IntegerToString(stats.bestHourExecution) + 
                       ":00 - Ù…Ø¹Ø¯Ù„ " + DoubleToString(stats.bestHourExecutionRate, 1) + "%\n");
    }
    
    if(stats.worstHourExecution >= 0) {
        FileWriteString(fileHandle, "â›” Ø£Ø³ÙˆØ£ Ø³Ø§Ø¹Ø© Ù„Ù„ØªÙ†ÙÙŠØ°: " + IntegerToString(stats.worstHourExecution) + 
                       ":00 - Ù…Ø¹Ø¯Ù„ " + DoubleToString(stats.worstHourExecutionRate, 1) + "%\n");
    }
    
    if(stats.bestDayExecution >= 0) {
        string dayName = GetDayOfWeekString(stats.bestDayExecution);
        FileWriteString(fileHandle, "ğŸ“… Ø£ÙØ¶Ù„ ÙŠÙˆÙ… Ù„Ù„ØªÙ†ÙÙŠØ°: " + dayName + "\n");
    }
    
    if(stats.worstDayExecution >= 0) {
        string dayName = GetDayOfWeekString(stats.worstDayExecution);
        FileWriteString(fileHandle, "ğŸ“… Ø£Ø³ÙˆØ£ ÙŠÙˆÙ… Ù„Ù„ØªÙ†ÙÙŠØ°: " + dayName + "\n");
    }
    
    // Ù†Ø³Ø¨ Ø§Ù„Ø£ÙˆÙ‚Ø§Øª Ø§Ù„Ø®Ø§ØµØ©
    if(stats.weekendOrders > 0) {
        double weekendPercentage = CalculatePercentage(stats.weekendOrders, stats.totalOrders);
        FileWriteString(fileHandle, "ğŸŒ… Ø£ÙˆØ§Ù…Ø± Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹: " + IntegerToString(stats.weekendOrders) + 
                       " (" + DoubleToString(weekendPercentage, 1) + "%)\n");
    }
    
    if(stats.newsTimeOrders > 0) {
        double newsPercentage = CalculatePercentage(stats.newsTimeOrders, stats.totalOrders);
        FileWriteString(fileHandle, "ğŸ“° Ø£ÙˆØ§Ù…Ø± ÙˆÙ‚Øª Ø§Ù„Ø£Ø®Ø¨Ø§Ø±: " + IntegerToString(stats.newsTimeOrders) + 
                       " (" + DoubleToString(newsPercentage, 1) + "%)\n");
    }
    
    FileWriteString(fileHandle, "\n");
}

//+------------------------------------------------------------------+
//| ÙƒØªØ§Ø¨Ø© ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø³Ø¨Ø±ÙŠØ¯ ÙˆØ§Ù„Ø§Ù†Ø²Ù„Ø§Ù‚ ÙÙŠ Ø§Ù„Ù…Ù„Ù                        |
//+------------------------------------------------------------------+
void WriteSpreadSlippageAnalysisToFile(int fileHandle)
{
    FileWriteString(fileHandle, "ğŸ“Š ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø³Ø¨Ø±ÙŠØ¯ ÙˆØ§Ù„Ø§Ù†Ø²Ù„Ø§Ù‚:\n");
    
    if(stats.avgSpread > 0) {
        FileWriteString(fileHandle, "ğŸ“ˆ Ù…ØªÙˆØ³Ø· Ø§Ù„Ø³Ø¨Ø±ÙŠØ¯: " + DoubleToString(stats.avgSpread * 10000, 1) + " Ù†Ù‚Ø·Ø©\n");
        FileWriteString(fileHandle, "ğŸ“ˆ Ø£Ø¹Ù„Ù‰ Ø³Ø¨Ø±ÙŠØ¯ Ù…Ø³Ø¬Ù„: " + DoubleToString(stats.maxSpread * 10000, 1) + " Ù†Ù‚Ø·Ø©\n");
    }
    
    if(stats.avgSlippage > 0) {
        FileWriteString(fileHandle, "ğŸ“‰ Ù…ØªÙˆØ³Ø· Ø§Ù„Ø§Ù†Ø²Ù„Ø§Ù‚: " + DoubleToString(stats.avgSlippage, 1) + " Ù†Ù‚Ø·Ø©\n");
        FileWriteString(fileHandle, "ğŸ“‰ Ø£Ø¹Ù„Ù‰ Ø§Ù†Ø²Ù„Ø§Ù‚ Ù…Ø³Ø¬Ù„: " + DoubleToString(stats.maxSlippage, 1) + " Ù†Ù‚Ø·Ø©\n");
    }
    
    // ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙØ¬ÙˆØ§Øª
    if(stats.gappedOrders > 0) {
        double gapPercentage = CalculatePercentage(stats.gappedOrders, stats.totalOrders);
        FileWriteString(fileHandle, "ğŸ•³ï¸ Ø£ÙˆØ§Ù…Ø± Ù…Ø¹ ÙØ¬ÙˆØ§Øª Ø³Ø¹Ø±ÙŠØ©: " + IntegerToString(stats.gappedOrders) + 
                       " (" + DoubleToString(gapPercentage, 1) + "%)\n");
        FileWriteString(fileHandle, "ğŸ“ Ù…ØªÙˆØ³Ø· Ø­Ø¬Ù… Ø§Ù„ÙØ¬ÙˆØ©: " + DoubleToString(stats.avgGapSize, 1) + " Ù†Ù‚Ø·Ø©\n");
    }
    
    FileWriteString(fileHandle, "\n");
}

//+------------------------------------------------------------------+
//| ÙƒØªØ§Ø¨Ø© ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ø­Ø¬Ø§Ù… ÙÙŠ Ø§Ù„Ù…Ù„Ù                                   |
//+------------------------------------------------------------------+
void WriteVolumeAnalysisToFile(int fileHandle)
{
    FileWriteString(fileHandle, "ğŸ’° ØªØ­Ù„ÙŠÙ„ Ø£Ø­Ø¬Ø§Ù… Ø§Ù„ØµÙÙ‚Ø§Øª:\n");
    
    if(stats.avgVolume > 0) {
        FileWriteString(fileHandle, "ğŸ“Š Ù…ØªÙˆØ³Ø· Ø­Ø¬Ù… Ø§Ù„ØµÙÙ‚Ø©: " + DoubleToString(stats.avgVolume, 2) + " Ù„ÙˆØª\n");
        FileWriteString(fileHandle, "ğŸ’¼ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø­Ø¬Ù… Ø§Ù„Ù…ØªØ¯Ø§ÙˆÙ„: " + DoubleToString(stats.totalVolume, 2) + " Ù„ÙˆØª\n");
        
        // ØªØ­Ù„ÙŠÙ„ ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø£Ø­Ø¬Ø§Ù…
        int smallVolumeCount = 0, mediumVolumeCount = 0, largeVolumeCount = 0;
        int smallSuccess = 0, mediumSuccess = 0, largeSuccess = 0;
        int smallExecuted = 0, mediumExecuted = 0, largeExecuted = 0;
        
        for(int i = 0; i < stats.totalOrders; i++) {
            if(orders[i].volume <= 0.1) {
                smallVolumeCount++;
                if(orders[i].isExecuted) {
                    smallExecuted++;
                    if(orders[i].netProfit > 0) smallSuccess++;
                }
            } else if(orders[i].volume <= 1.0) {
                mediumVolumeCount++;
                if(orders[i].isExecuted) {
                    mediumExecuted++;
                    if(orders[i].netProfit > 0) mediumSuccess++;
                }
            } else {
                largeVolumeCount++;
                if(orders[i].isExecuted) {
                    largeExecuted++;
                    if(orders[i].netProfit > 0) largeSuccess++;
                }
            }
        }
        
        FileWriteString(fileHandle, "   ğŸ”¹ Ø£Ø­Ø¬Ø§Ù… ØµØºÙŠØ±Ø© (â‰¤0.1): " + IntegerToString(smallVolumeCount) + " Ø£ÙˆØ§Ù…Ø±");
        if(smallExecuted > 0) {
            double smallRate = CalculatePercentage(smallSuccess, smallExecuted);
            FileWriteString(fileHandle, " - Ù†Ø¬Ø§Ø­ " + DoubleToString(smallRate, 1) + "%");
        }
        FileWriteString(fileHandle, "\n");
        
        FileWriteString(fileHandle, "   ğŸ”¸ Ø£Ø­Ø¬Ø§Ù… Ù…ØªÙˆØ³Ø·Ø© (0.1-1.0): " + IntegerToString(mediumVolumeCount) + " Ø£ÙˆØ§Ù…Ø±");
        if(mediumExecuted > 0) {
            double mediumRate = CalculatePercentage(mediumSuccess, mediumExecuted);
            FileWriteString(fileHandle, " - Ù†Ø¬Ø§Ø­ " + DoubleToString(mediumRate, 1) + "%");
        }
        FileWriteString(fileHandle, "\n");
        
        FileWriteString(fileHandle, "   ğŸ”¶ Ø£Ø­Ø¬Ø§Ù… ÙƒØ¨ÙŠØ±Ø© (>1.0): " + IntegerToString(largeVolumeCount) + " Ø£ÙˆØ§Ù…Ø±");
        if(largeExecuted > 0) {
            double largeRate = CalculatePercentage(largeSuccess, largeExecuted);
            FileWriteString(fileHandle, " - Ù†Ø¬Ø§Ø­ " + DoubleToString(largeRate, 1) + "%");
        }
        FileWriteString(fileHandle, "\n");
    }
    
    FileWriteString(fileHandle, "\n");
}

//+------------------------------------------------------------------+
//| ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø© ÙÙŠ Ø§Ù„Ù…Ù„Ù                            |
//+------------------------------------------------------------------+
void WriteAdvancedStatisticsToFile(int fileHandle)
{
    FileWriteString(fileHandle, "ğŸ“ˆ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ù…ØªÙ‚Ø¯Ù…Ø©:\n");
    
    // Ø­Ø³Ø§Ø¨ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø¥Ø¶Ø§ÙÙŠØ©
    double executionRate = CalculatePercentage(stats.executedOrders, stats.totalOrders);
    FileWriteString(fileHandle, "ğŸ“Š Ù…Ø¹Ø¯Ù„ Ø§Ù„ØªÙ†ÙÙŠØ°: " + DoubleToString(executionRate, 1) + "%\n");
    
    if(stats.executedOrders > 0) {
        double breakEvenRate = CalculatePercentage(stats.executedBreakeven, stats.executedOrders);
        FileWriteString(fileHandle, "âš–ï¸ Ù…Ø¹Ø¯Ù„ Ø§Ù„ØªØ¹Ø§Ø¯Ù„: " + DoubleToString(breakEvenRate, 1) + "%\n");
        
        if(stats.totalVolume > 0) {
            double profitPerLot = stats.totalProfit / stats.totalVolume;
            FileWriteString(fileHandle, "ğŸ’° Ø§Ù„Ø±Ø¨Ø­ Ù„ÙƒÙ„ Ù„ÙˆØª: " + DoubleToString(profitPerLot, 2) + "$\n");
        }
        
        if(stats.totalCommission != 0) {
            double netProfitAfterCosts = stats.totalProfit - MathAbs(stats.totalCommission) - MathAbs(stats.totalSwap);
            FileWriteString(fileHandle, "ğŸ’µ Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„ØµØ§ÙÙŠ Ø¨Ø¹Ø¯ Ø§Ù„ØªÙƒØ§Ù„ÙŠÙ: " + DoubleToString(netProfitAfterCosts, 2) + "$\n");
        }
    }
    
    // Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ÙˆÙ‚Øª
    if(stats.avgOrderLifetime > 0) {
        FileWriteString(fileHandle, "â±ï¸ Ù…ØªÙˆØ³Ø· Ø¹Ù…Ø± Ø§Ù„Ø£ÙˆØ§Ù…Ø± ØºÙŠØ± Ø§Ù„Ù…Ù†ÙØ°Ø©: " + DoubleToString(stats.avgOrderLifetime / 60.0, 1) + " Ø³Ø§Ø¹Ø©\n");
    }
    
    // Ù…Ø¹Ø¯Ù„ Ø§Ù„ÙØ´Ù„
    int totalFailures = stats.highSpreadFailures + stats.wrongDirectionFailures + stats.almostTPFailures + 
                       stats.slippageFailures + stats.liquidityFailures + stats.timeoutFailures;
    if(totalFailures > 0) {
        double failureRate = CalculatePercentage(totalFailures, stats.totalOrders);
        FileWriteString(fileHandle, "âš ï¸ Ù…Ø¹Ø¯Ù„ Ø§Ù„ÙØ´Ù„ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: " + DoubleToString(failureRate, 1) + "%\n");
    }
    
    FileWriteString(fileHandle, "\n");
}

//+------------------------------------------------------------------+
//| ÙƒØªØ§Ø¨Ø© Ø§Ù„ØªÙˆØµÙŠØ§Øª ÙÙŠ Ø§Ù„Ù…Ù„Ù                                        |
//+------------------------------------------------------------------+
void WriteRecommendationsToFile(int fileHandle)
{
    FileWriteString(fileHandle, "ğŸ’¡ Ø§Ù„ØªÙˆØµÙŠØ§Øª ÙˆØ§Ù„ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø©:\n");
    FileWriteString(fileHandle, "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n");
    
    // ØªØ­Ù„ÙŠÙ„ Ù…Ø¹Ø¯Ù„ Ø§Ù„ØªÙ†ÙÙŠØ°
    double executionRate = CalculatePercentage(stats.executedOrders, stats.totalOrders);
    FileWriteString(fileHandle, "ğŸ“Š ØªØ­Ù„ÙŠÙ„ Ù…Ø¹Ø¯Ù„ Ø§Ù„ØªÙ†ÙÙŠØ° (" + DoubleToString(executionRate, 1) + "%):\n");
    
    if(executionRate < 50) {
        FileWriteString(fileHandle, "ğŸš¨ Ù…Ø¹Ø¯Ù„ Ø§Ù„ØªÙ†ÙÙŠØ° Ù…Ù†Ø®ÙØ¶ Ø¬Ø¯Ø§Ù‹ - ÙŠØªØ·Ù„Ø¨ ØªØ¯Ø®Ù„ Ø¹Ø§Ø¬Ù„\n");
        FileWriteString(fileHandle, "   ğŸ’¡ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø´Ø§Ù…Ù„Ø© Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© ÙˆØ¶Ø¹ Ø§Ù„Ø£ÙˆØ§Ù…Ø±\n");
        FileWriteString(fileHandle, "   ğŸ’¡ ÙØ­Øµ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ÙˆØ³ÙŠØ· ÙˆÙ…Ø³ØªÙˆÙŠØ§Øª Ø§Ù„Ø³ÙŠÙˆÙ„Ø©\n");
    } else if(executionRate < 70) {
        FileWriteString(fileHandle, "âš ï¸ Ù…Ø¹Ø¯Ù„ Ø§Ù„ØªÙ†ÙÙŠØ° ÙŠØ­ØªØ§Ø¬ ØªØ­Ø³ÙŠÙ†\n");
        FileWriteString(fileHandle, "   ğŸ’¡ ØªØ­Ø³ÙŠÙ† ØªÙˆÙ‚ÙŠØª ÙˆØ¶Ø¹ Ø§Ù„Ø£ÙˆØ§Ù…Ø±\n");
        FileWriteString(fileHandle, "   ğŸ’¡ Ù…Ø±Ø§Ø¬Ø¹Ø© Ù†Ù‚Ø§Ø· Ø§Ù„Ø¯Ø®ÙˆÙ„\n");
    } else {
        FileWriteString(fileHandle, "âœ… Ù…Ø¹Ø¯Ù„ Ø§Ù„ØªÙ†ÙÙŠØ° Ù…Ù‚Ø¨ÙˆÙ„ Ø¥Ù„Ù‰ Ø¬ÙŠØ¯\n");
    }
    
    // ØªÙˆØµÙŠØ§Øª Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø£Ù†Ù…Ø§Ø· Ø§Ù„ÙØ´Ù„
    WriteFailureRecommendationsToFile(fileHandle);
    
    // ØªÙˆØµÙŠØ§Øª Ø§Ù„ØªÙˆÙ‚ÙŠØª
    WriteTimingRecommendationsToFile(fileHandle);
    
    // ØªÙˆØµÙŠØ§Øª Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø§Ø·Ø±
    WriteRiskRecommendationsToFile(fileHandle);
    
    FileWriteString(fileHandle, "\n");
}

//+------------------------------------------------------------------+
//| ÙƒØªØ§Ø¨Ø© ØªÙˆØµÙŠØ§Øª Ø§Ù„ÙØ´Ù„ ÙÙŠ Ø§Ù„Ù…Ù„Ù                                    |
//+------------------------------------------------------------------+
void WriteFailureRecommendationsToFile(int fileHandle)
{
    FileWriteString(fileHandle, "\nğŸ”§ ØªÙˆØµÙŠØ§Øª Ù…Ø¨Ù†ÙŠØ© Ø¹Ù„Ù‰ Ø£Ù†Ù…Ø§Ø· Ø§Ù„ÙØ´Ù„:\n");
    
    if(stats.highSpreadFailures > stats.totalOrders * 0.2) {
        FileWriteString(fileHandle, "ğŸ“Š Ù…Ø´ÙƒÙ„Ø© Ø§Ù„Ø³Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¹Ø§Ù„ÙŠ:\n");
        FileWriteString(fileHandle, "   ğŸ’¡ ØªØ¬Ù†Ø¨ Ø§Ù„ØªØ¯Ø§ÙˆÙ„ Ù‚Ø¨Ù„ ÙˆØ¨Ø¹Ø¯ Ø§Ù„Ø£Ø®Ø¨Ø§Ø± Ø§Ù„Ù…Ù‡Ù…Ø©\n");
        FileWriteString(fileHandle, "   ğŸ’¡ Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙÙ„ØªØ± Ø³Ø¨Ø±ÙŠØ¯\n");
    }
    
    if(stats.wrongDirectionFailures > stats.executedOrders * 0.4) {
        FileWriteString(fileHandle, "ğŸ¯ Ù…Ø´ÙƒÙ„Ø© Ø¯Ù‚Ø© Ø§Ù„Ø§ØªØ¬Ø§Ù‡:\n");
        FileWriteString(fileHandle, "   ğŸ’¡ Ù…Ø±Ø§Ø¬Ø¹Ø© Ù…Ø¤Ø´Ø±Ø§Øª ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø§ØªØ¬Ø§Ù‡\n");
        FileWriteString(fileHandle, "   ğŸ’¡ Ø¥Ø¶Ø§ÙØ© Ù…Ø¤Ø´Ø±Ø§Øª ØªØ£ÙƒÙŠØ¯ÙŠØ©\n");
    }
    
    if(stats.almostTPFailures > stats.executedLosses * 0.3) {
        FileWriteString(fileHandle, "ğŸ¯ Ù…Ø´ÙƒÙ„Ø© Ù‚Ø±Ø¨ Ø§Ù„Ø£Ù‡Ø¯Ø§Ù:\n");
        FileWriteString(fileHandle, "   ğŸ’¡ ØªÙ‚Ù„ÙŠÙ„ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªÙŠÙƒ Ø¨Ø±ÙˆÙØª\n");
        FileWriteString(fileHandle, "   ğŸ’¡ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø®Ø±ÙˆØ¬ Ø¬Ø²Ø¦ÙŠ\n");
    }
}

//+------------------------------------------------------------------+
//| ÙƒØªØ§Ø¨Ø© ØªÙˆØµÙŠØ§Øª Ø§Ù„ØªÙˆÙ‚ÙŠØª ÙÙŠ Ø§Ù„Ù…Ù„Ù                                  |
//+------------------------------------------------------------------+
void WriteTimingRecommendationsToFile(int fileHandle)
{
    FileWriteString(fileHandle, "\nâ° ØªÙˆØµÙŠØ§Øª Ø§Ù„ØªÙˆÙ‚ÙŠØª:\n");
    
    if(stats.bestHourExecution >= 0) {
        FileWriteString(fileHandle, "ğŸŒŸ Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ù†Ø´Ø§Ø· ÙÙŠ Ø§Ù„Ø³Ø§Ø¹Ø© " + IntegerToString(stats.bestHourExecution) + ":00\n");
    }
    
    if(stats.worstHourExecution >= 0) {
        FileWriteString(fileHandle, "â›” ØªØ¬Ù†Ø¨ Ø£Ùˆ ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ù†Ø´Ø§Ø· ÙÙŠ Ø§Ù„Ø³Ø§Ø¹Ø© " + IntegerToString(stats.worstHourExecution) + ":00\n");
    }
    
    FileWriteString(fileHandle, "ğŸ’¡ Ø§Ù„ØªØ±ÙƒÙŠØ² Ø¹Ù„Ù‰ Ø³Ø§Ø¹Ø§Øª ØªØ¯Ø§Ø®Ù„ Ø§Ù„Ø¬Ù„Ø³Ø§Øª (13:00-17:00 GMT)\n");
    FileWriteString(fileHandle, "ğŸ’¡ ØªØ¬Ù†Ø¨ Ù†Ù‡Ø§ÙŠØ§Øª Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ ÙˆØ³Ø§Ø¹Ø§Øª Ø§Ù„Ø³ÙŠÙˆÙ„Ø© Ø§Ù„Ù…Ù†Ø®ÙØ¶Ø©\n");
}

//+------------------------------------------------------------------+
//| ÙƒØªØ§Ø¨Ø© ØªÙˆØµÙŠØ§Øª Ø§Ù„Ù…Ø®Ø§Ø·Ø± ÙÙŠ Ø§Ù„Ù…Ù„Ù                                  |
//+------------------------------------------------------------------+
void WriteRiskRecommendationsToFile(int fileHandle)
{
    FileWriteString(fileHandle, "\nğŸ›¡ï¸ ØªÙˆØµÙŠØ§Øª Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø§Ø·Ø±:\n");
    
    if(stats.maxDrawdownPct > 10) {
        FileWriteString(fileHandle, "âš ï¸ Ø£Ù‚ØµÙ‰ Ø³Ø­Ø¨ Ù…Ø±ØªÙØ¹ (" + DoubleToString(stats.maxDrawdownPct, 1) + "%) - ØªÙ‚Ù„ÙŠÙ„ Ø£Ø­Ø¬Ø§Ù… Ø§Ù„ØµÙÙ‚Ø§Øª\n");
    }
    
    if(stats.avgRiskReward > 0 && stats.avgRiskReward < 1.5) {
        FileWriteString(fileHandle, "âš ï¸ Ù†Ø³Ø¨Ø© Ù…Ø®Ø§Ø·Ø±/Ø¹Ø§Ø¦Ø¯ Ù…Ù†Ø®ÙØ¶Ø© - ØªØ­Ø³ÙŠÙ† Ù†Ù‚Ø§Ø· Ø§Ù„Ø®Ø±ÙˆØ¬\n");
    }
    
    FileWriteString(fileHandle, "ğŸ’¡ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø³ØªÙˆØ¨ Ù„ÙˆØ² Ø¯Ø§Ø¦Ù…Ø§Ù‹\n");
    FileWriteString(fileHandle, "ğŸ’¡ Ø¹Ø¯Ù… Ø§Ù„Ù…Ø®Ø§Ø·Ø±Ø© Ø¨Ø£ÙƒØ«Ø± Ù…Ù† 2% Ù…Ù† Ø§Ù„Ø­Ø³Ø§Ø¨ ÙÙŠ ØµÙÙ‚Ø© ÙˆØ§Ø­Ø¯Ø©\n");
    FileWriteString(fileHandle, "ğŸ’¡ Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø£Ø¯Ø§Ø¡ ÙˆØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ø¬Ø©\n");
}

//+------------------------------------------------------------------+
//| ÙƒØªØ§Ø¨Ø© Ø®Ø§ØªÙ…Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ±                                            |
//+------------------------------------------------------------------+
void WriteReportFooter(int fileHandle)
{
    FileWriteString(fileHandle, "==========================================\n");
    FileWriteString(fileHandle, "ğŸ“‹ Ù…Ù„Ø®Øµ Ø§Ù„ØªÙ‚Ø±ÙŠØ±:\n");
    FileWriteString(fileHandle, "ØªÙ… ØªØ­Ù„ÙŠÙ„ " + IntegerToString(stats.totalOrders) + " Ø£Ù…Ø± Ø¨Ø§Ù„ÙƒØ§Ù…Ù„\n");
    FileWriteString(fileHandle, "Ù…Ø¹Ø¯Ù„ Ø§Ù„ØªÙ†ÙÙŠØ°: " + DoubleToString(CalculatePercentage(stats.executedOrders, stats.totalOrders), 1) + "%\n");
    if(stats.executedOrders > 0) {
        FileWriteString(fileHandle, "Ù…Ø¹Ø¯Ù„ Ø§Ù„Ù†Ø¬Ø§Ø­ Ù„Ù„Ù…Ù†ÙØ°Ø©: " + DoubleToString(stats.winRate, 1) + "%\n");
        FileWriteString(fileHandle, "ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­: " + DoubleToString(stats.totalProfit, 2) + "$\n");
    }
    FileWriteString(fileHandle, "\nğŸ” ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù‡Ø°Ø§ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¨ÙˆØ§Ø³Ø·Ø© Ù…Ø­Ù„Ù„ Ø§Ù„Ø²Ø¬Ø²Ø§Ø¬ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…\n");
    FileWriteString(fileHandle, "ğŸ“… ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡: " + TimeToString(TimeCurrent()) + "\n");
    FileWriteString(fileHandle, "==========================================\n");
}

//--- Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø«Ø§Ù…Ù† 
---
//+------------------------------------------------------------------+
//| Expert Advisor: Advanced Zigzag Analysis Bot - Part 9/15       |
//| Ù…Ø­Ù„Ù„ Ø¨ÙˆØª Ø§Ù„Ø²Ø¬Ø²Ø§Ø¬ Ø§Ù„Ø¹Ø¨Ù‚Ø±ÙŠ - Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„ØªØ§Ø³Ø¹: Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ© |
//+------------------------------------------------------------------+

// ØªÙƒÙ…Ù„Ø© Ù„Ù„Ø£Ø¬Ø²Ø§Ø¡ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© - Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ© ÙˆØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ø¯Ø§Ø¡

//+------------------------------------------------------------------+
//| Ø¥Ù†Ø´Ø§Ø¡ ØªÙ‚Ø±ÙŠØ± Ù…ÙØµÙ„ Ù„ÙƒÙ„ Ø£Ù…Ø± ÙÙŠ Ø§Ù„Ù…Ù„Ù                             |
//+------------------------------------------------------------------+
void WriteDetailedOrdersToFile(int fileHandle)
{
    if(stats.totalOrders == 0) return;
    
    FileWriteString(fileHandle, "ğŸ” Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…ÙØµÙ„ Ù„ÙƒÙ„ Ø£Ù…Ø±:\n");
    FileWriteString(fileHandle, "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n");
    
    // ØªØ­Ø¯ÙŠØ¯ Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ù„Ù„Ø¹Ø±Ø¶ Ø§Ù„ØªÙØµÙŠÙ„ÙŠ
    int maxDetailedOrders = MathMin(stats.totalOrders, 50); // Ø­Ø¯ Ø£Ù‚ØµÙ‰ 50 Ø£Ù…Ø± Ù„ØªØ¬Ù†Ø¨ Ù…Ù„ÙØ§Øª Ø¶Ø®Ù…Ø©
    
    for(int i = 0; i < maxDetailedOrders; i++) {
        WriteIndividualOrderToFile(fileHandle, i);
    }
    
    if(stats.totalOrders > maxDetailedOrders) {
        FileWriteString(fileHandle, "... ØªÙ… ØªØ­Ù„ÙŠÙ„ " + IntegerToString(stats.totalOrders - maxDetailedOrders) + 
                       " Ø£Ù…Ø± Ø¥Ø¶Ø§ÙÙŠ (ØºÙŠØ± Ù…Ø¹Ø±ÙˆØ¶ ØªÙØµÙŠÙ„ÙŠØ§Ù‹ Ù„ØªÙˆÙÙŠØ± Ø§Ù„Ù…Ø³Ø§Ø­Ø©)\n\n");
    }
}

//+------------------------------------------------------------------+
//| ÙƒØªØ§Ø¨Ø© ØªÙØ§ØµÙŠÙ„ Ø£Ù…Ø± ÙØ±Ø¯ÙŠ ÙÙŠ Ø§Ù„Ù…Ù„Ù                                |
//+------------------------------------------------------------------+
void WriteIndividualOrderToFile(int fileHandle, int index)
{
    string orderType = GetOrderTypeString(orders[index].type);
    string executionIcon = orders[index].isExecuted ? "âœ…" : "âŒ";
    
    FileWriteString(fileHandle, executionIcon + " Ø£Ù…Ø± #" + IntegerToString(orders[index].ticket) + 
                   " - " + orders[index].symbol + " " + orderType + "\n");
    FileWriteString(fileHandle, "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n");
    
    // Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
    FileWriteString(fileHandle, "ğŸ“‹ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©:\n");
    FileWriteString(fileHandle, "   â° ÙˆÙ‚Øª Ø§Ù„ÙˆØ¶Ø¹: " + TimeToString(orders[index].timeSetup, TIME_DATE|TIME_MINUTES) + "\n");
    FileWriteString(fileHandle, "   â° ÙˆÙ‚Øª Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²: " + TimeToString(orders[index].timeDone, TIME_DATE|TIME_MINUTES) + "\n");
    FileWriteString(fileHandle, "   ğŸ’° Ø§Ù„Ø­Ø¬Ù…: " + DoubleToString(orders[index].volume, 2) + " Ù„ÙˆØª\n");
    FileWriteString(fileHandle, "   ğŸ’² Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù…Ø·Ù„ÙˆØ¨: " + DoubleToString(orders[index].priceOpen, 5) + "\n");
    
    if(IsValidPrice(orders[index].sl)) {
        FileWriteString(fileHandle, "   ğŸ›‘ Ø³ØªÙˆØ¨ Ù„ÙˆØ²: " + DoubleToString(orders[index].sl, 5) + "\n");
    }
    if(IsValidPrice(orders[index].tp)) {
        FileWriteString(fileHandle, "   ğŸ¯ ØªÙŠÙƒ Ø¨Ø±ÙˆÙØª: " + DoubleToString(orders[index].tp, 5) + "\n");
    }
    
    // ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØªÙ†ÙÙŠØ°
    FileWriteString(fileHandle, "\nğŸ“Š ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØªÙ†ÙÙŠØ°:\n");
    FileWriteString(fileHandle, "   ğŸ“‹ Ø§Ù„Ø­Ø§Ù„Ø©: " + orders[index].executionStatus + "\n");
    
    if(orders[index].isExecuted) {
        WriteExecutedOrderDetailsToFile(fileHandle, index);
    } else {
        WriteNonExecutedOrderDetailsToFile(fileHandle, index);
    }
    
    // Ø§Ù„ØªØ­Ù„ÙŠÙ„ ÙˆØ§Ù„ØªÙØ³ÙŠØ±
    FileWriteString(fileHandle, "\nğŸ” Ø§Ù„ØªØ­Ù„ÙŠÙ„ ÙˆØ§Ù„ØªÙØ³ÙŠØ±:\n");
    FileWriteString(fileHandle, "   ğŸ“ Ø§Ù„Ø³Ø¨Ø¨ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ: " + orders[index].failureReason + "\n");
    if(orders[index].detailedAnalysis != "") {
        FileWriteString(fileHandle, "   ğŸ“‹ ØªØ­Ù„ÙŠÙ„ Ù…ÙØµÙ„: " + orders[index].detailedAnalysis + "\n");
    }
    
    // ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªÙˆÙ‚ÙŠØª
    FileWriteString(fileHandle, "\nâ° ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªÙˆÙ‚ÙŠØª:\n");
    FileWriteString(fileHandle, "   ğŸ“… Ø§Ù„ÙŠÙˆÙ…: " + orders[index].dayOfWeek + "\n");
    FileWriteString(fileHandle, "   ğŸ• Ø§Ù„Ø³Ø§Ø¹Ø©: " + IntegerToString(orders[index].hourOfDay) + ":00\n");
    FileWriteString(fileHandle, "   ğŸŒŠ Ø­Ø§Ù„Ø© Ø§Ù„Ø³ÙˆÙ‚: " + orders[index].timeAnalysis + "\n");
    FileWriteString(fileHandle, "   ğŸŒ… Ù†Ù‡Ø§ÙŠØ© Ø£Ø³Ø¨ÙˆØ¹: " + (orders[index].wasWeekend ? "Ù†Ø¹Ù…" : "Ù„Ø§") + "\n");
    FileWriteString(fileHandle, "   ğŸ“° ÙˆÙ‚Øª Ø£Ø®Ø¨Ø§Ø±: " + (orders[index].wasNewsTime ? "Ù†Ø¹Ù…" : "Ù„Ø§") + "\n");
    FileWriteString(fileHandle, "   ğŸ›ï¸ Ø¬Ù„Ø³Ø© Ù†Ø´Ø·Ø©: " + (orders[index].wasSessionOpen ? "Ù†Ø¹Ù…" : "Ù„Ø§") + "\n");
    
    FileWriteString(fileHandle, "\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n");
}

//+------------------------------------------------------------------+
//| ÙƒØªØ§Ø¨Ø© ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø£Ù…Ø± Ø§Ù„Ù…Ù†ÙØ° ÙÙŠ Ø§Ù„Ù…Ù„Ù                            |
//+------------------------------------------------------------------+
void WriteExecutedOrderDetailsToFile(int fileHandle, int index)
{
    FileWriteString(fileHandle, "   ğŸ’² Ø§Ù„Ø³Ø¹Ø± Ø§Ù„ÙØ¹Ù„ÙŠ: " + DoubleToString(orders[index].priceActual, 5) + "\n");
    FileWriteString(fileHandle, "   ğŸ’µ Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ø£ÙˆÙ„ÙŠ: " + DoubleToString(orders[index].profit, 2) + "$\n");
    FileWriteString(fileHandle, "   ğŸ’¸ Ø§Ù„Ø¹Ù…ÙˆÙ„Ø©: " + DoubleToString(orders[index].commission, 2) + "$\n");
    FileWriteString(fileHandle, "   ğŸ”„ Ø§Ù„Ø³ÙˆØ§Ø¨: " + DoubleToString(orders[index].swap, 2) + "$\n");
    FileWriteString(fileHandle, "   ğŸ’° ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­: " + DoubleToString(orders[index].netProfit, 2) + "$\n");
    
    // ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø§Ù†Ø²Ù„Ø§Ù‚
    if(orders[index].slippage > 0) {
        double slippagePips = orders[index].slippage / GetSymbolPoint(orders[index].symbol);
        FileWriteString(fileHandle, "   ğŸ“Š Ø§Ù„Ø§Ù†Ø²Ù„Ø§Ù‚: " + DoubleToString(slippagePips, 1) + " Ù†Ù‚Ø§Ø·\n");
    }
    
    // ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„ØªÙØµÙŠÙ„ÙŠ
    if(orders[index].maxPrice > 0 && orders[index].minPrice > 0) {
        FileWriteString(fileHandle, "\nğŸ“ˆ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ø¯Ø§Ø¡:\n");
        FileWriteString(fileHandle, "   ğŸ“ˆ Ø£Ø¹Ù„Ù‰ Ø³Ø¹Ø±: " + DoubleToString(orders[index].maxPrice, 5) + "\n");
        FileWriteString(fileHandle, "   ğŸ“‰ Ø£Ø¯Ù†Ù‰ Ø³Ø¹Ø±: " + DoubleToString(orders[index].minPrice, 5) + "\n");
        
        if(orders[index].maxRunup > 0) {
            FileWriteString(fileHandle, "   ğŸš€ Ø£Ù‚ØµÙ‰ Ø±Ø¨Ø­ Ù…Ø­ØªÙ…Ù„: " + DoubleToString(orders[index].maxRunup, 1) + " Ù†Ù‚Ø§Ø·\n");
        }
        if(orders[index].maxDrawdown > 0) {
            FileWriteString(fileHandle, "   ğŸ“‰ Ø£Ù‚ØµÙ‰ Ø³Ø­Ø¨: " + DoubleToString(orders[index].maxDrawdown, 1) + " Ù†Ù‚Ø§Ø·\n");
        }
        
        if(orders[index].pointsToTP > 0) {
            FileWriteString(fileHandle, "   ğŸ¯ Ø§Ù„Ù…Ø³Ø§ÙØ© Ù…Ù† Ø§Ù„Ù‡Ø¯Ù: " + DoubleToString(orders[index].pointsToTP, 1) + " Ù†Ù‚Ø§Ø·\n");
        }
        if(orders[index].pointsToSL > 0) {
            FileWriteString(fileHandle, "   ğŸ›‘ Ø§Ù„Ù…Ø³Ø§ÙØ© Ù…Ù† Ø§Ù„Ø³ØªÙˆØ¨: " + DoubleToString(orders[index].pointsToSL, 1) + " Ù†Ù‚Ø§Ø·\n");
        }
        
        FileWriteString(fileHandle, "   ğŸ¯ ÙˆØµÙ„ Ù„Ù„Ù‡Ø¯Ù: " + (orders[index].hitTakeProfit ? "Ù†Ø¹Ù…" : "Ù„Ø§") + "\n");
        FileWriteString(fileHandle, "   ğŸ›‘ Ø¶Ø±Ø¨ Ø§Ù„Ø³ØªÙˆØ¨: " + (orders[index].hitStopLoss ? "Ù†Ø¹Ù…" : "Ù„Ø§") + "\n");
        FileWriteString(fileHandle, "   ğŸ“Š Ø§Ù„Ø§ØªØ¬Ø§Ù‡ ØµØ­ÙŠØ­: " + (orders[index].wasCorrectDirection ? "Ù†Ø¹Ù…" : "Ù„Ø§") + "\n");
    }
    
    // ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ø¯Ø©
    if(orders[index].holdingTimeMinutes > 0) {
        double holdingHours = orders[index].holdingTimeMinutes / 60.0;
        FileWriteString(fileHandle, "   â±ï¸ Ù…Ø¯Ø© Ø§Ù„Ø§Ø­ØªÙØ§Ø¸: " + IntegerToString(orders[index].holdingTimeMinutes) + 
                       " Ø¯Ù‚ÙŠÙ‚Ø© (" + DoubleToString(holdingHours, 1) + " Ø³Ø§Ø¹Ø©)\n");
    }
    
    // ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ø®Ø§Ø·Ø±
    if(orders[index].riskRewardRatio > 0) {
        FileWriteString(fileHandle, "   âš–ï¸ Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø®Ø§Ø·Ø±/Ø§Ù„Ø¹Ø§Ø¦Ø¯: 1:" + DoubleToString(orders[index].riskRewardRatio, 1) + "\n");
    }
    if(orders[index].percentageDrawdown > 0) {
        FileWriteString(fileHandle, "   ğŸ“‰ Ø³Ø­Ø¨ Ù…Ù† Ø±Ø£Ø³ Ø§Ù„Ù…Ø§Ù„: " + DoubleToString(orders[index].percentageDrawdown, 2) + "%\n");
    }
}

//+------------------------------------------------------------------+
//| ÙƒØªØ§Ø¨Ø© ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø£Ù…Ø± ØºÙŠØ± Ø§Ù„Ù…Ù†ÙØ° ÙÙŠ Ø§Ù„Ù…Ù„Ù                        |
//+------------------------------------------------------------------+
void WriteNonExecutedOrderDetailsToFile(int fileHandle, int index)
{
    FileWriteString(fileHandle, "   â±ï¸ Ù…Ø¯Ø© Ø§Ù„Ø¨Ù‚Ø§Ø¡: " + IntegerToString(orders[index].orderLifetimeMinutes) + " Ø¯Ù‚ÙŠÙ‚Ø©\n");
    
    if(orders[index].orderLifetimeMinutes > 60) {
        double lifetimeHours = orders[index].orderLifetimeMinutes / 60.0;
        FileWriteString(fileHandle, "   â±ï¸ Ù…Ø¯Ø© Ø§Ù„Ø¨Ù‚Ø§Ø¡: " + DoubleToString(lifetimeHours, 1) + " Ø³Ø§Ø¹Ø©\n");
    }
    
    // ØªØ­Ù„ÙŠÙ„ ÙˆØµÙˆÙ„ Ø§Ù„Ø³Ø¹Ø±
    FileWriteString(fileHandle, "\nğŸ“ ØªØ­Ù„ÙŠÙ„ ÙˆØµÙˆÙ„ Ø§Ù„Ø³Ø¹Ø±:\n");
    FileWriteString(fileHandle, "   ğŸ¯ Ù‡Ù„ ÙˆØµÙ„ Ø§Ù„Ø³Ø¹Ø± Ù„Ù„Ù…Ø³ØªÙˆÙ‰ØŸ " + (orders[index].priceReachedLevel ? "Ù†Ø¹Ù…" : "Ù„Ø§") + "\n");
    
    if(orders[index].minDistanceFromTarget > 0) {
        FileWriteString(fileHandle, "   ğŸ“ Ø£Ù‚Ø±Ø¨ Ù…Ø³Ø§ÙØ© Ù„Ù„Ù‡Ø¯Ù: " + DoubleToString(orders[index].minDistanceFromTarget, 1) + " Ù†Ù‚Ø§Ø·\n");
    }
    if(orders[index].maxDistanceFromTarget > 0) {
        FileWriteString(fileHandle, "   ğŸ“ Ø£Ø¨Ø¹Ø¯ Ù…Ø³Ø§ÙØ© Ù…Ù† Ø§Ù„Ù‡Ø¯Ù: " + DoubleToString(orders[index].maxDistanceFromTarget, 1) + " Ù†Ù‚Ø§Ø·\n");
    }
    
    if(orders[index].priceReachedLevel && orders[index].bestPriceReached > 0) {
        FileWriteString(fileHandle, "   ğŸ’² Ø£ÙØ¶Ù„ Ø³Ø¹Ø± ÙˆØµÙ„: " + DoubleToString(orders[index].bestPriceReached, 5) + "\n");
    }
    
    // ØªØ­Ù„ÙŠÙ„ Ø¸Ø±ÙˆÙ Ø§Ù„Ø³ÙˆÙ‚ ÙˆÙ‚Øª Ø§Ù„ÙˆØ¶Ø¹
    FileWriteString(fileHandle, "\nğŸŒŠ Ø¸Ø±ÙˆÙ Ø§Ù„Ø³ÙˆÙ‚ ÙˆÙ‚Øª Ø§Ù„ÙˆØ¶Ø¹:\n");
    FileWriteString(fileHandle, "   ğŸ“Š Ø­Ø§Ù„Ø© Ø§Ù„Ø³ÙˆÙ‚: " + orders[index].marketConditionAtSetup + "\n");
    
    // ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ø³Ø§ÙØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
    if(orders[index].distanceFromPrice > 0) {
        double currentDistancePips = orders[index].distanceFromPrice / GetSymbolPoint(orders[index].symbol);
        FileWriteString(fileHandle, "   ğŸ“ Ø§Ù„Ù…Ø³Ø§ÙØ© Ù…Ù† Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ: " + DoubleToString(currentDistancePips, 1) + " Ù†Ù‚Ø§Ø·\n");
    }
}

//+------------------------------------------------------------------+
//| Ø¥Ù†Ø´Ø§Ø¡ ØªÙ‚Ø±ÙŠØ± Ù…Ù„Ø®Øµ ØªÙ†ÙÙŠØ°ÙŠ                                        |
//+------------------------------------------------------------------+
void CreateExecutiveSummaryReport(int fileHandle)
{
    FileWriteString(fileHandle, "ğŸ“Š Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„ØªÙ†ÙÙŠØ°ÙŠ:\n");
    FileWriteString(fileHandle, "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n");
    
    // Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„Ø¹Ø§Ù…
    FileWriteString(fileHandle, "ğŸ¯ Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„Ø¹Ø§Ù…:\n");
    double executionRate = CalculatePercentage(stats.executedOrders, stats.totalOrders);
    string executionGrade = GetPerformanceGrade(executionRate);
    FileWriteString(fileHandle, "   Ù…Ø¹Ø¯Ù„ Ø§Ù„ØªÙ†ÙÙŠØ°: " + DoubleToString(executionRate, 1) + "% (" + executionGrade + ")\n");
    
    if(stats.executedOrders > 0) {
        string profitabilityGrade = GetPerformanceGrade(stats.winRate);
        FileWriteString(fileHandle, "   Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø±Ø¨Ø­ÙŠØ©: " + DoubleToString(stats.winRate, 1) + "% (" + profitabilityGrade + ")\n");
        
        string profitFactorGrade = GetProfitFactorGrade(stats.profitFactor);
        FileWriteString(fileHandle, "   Ù…Ø¹Ø§Ù…Ù„ Ø§Ù„Ø±Ø¨Ø­: " + DoubleToString(stats.profitFactor, 2) + " (" + profitFactorGrade + ")\n");
        FileWriteString(fileHandle, "   ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­: " + DoubleToString(stats.totalProfit, 2) + "$\n");
    }
    
    // Ù†Ù‚Ø§Ø· Ø§Ù„Ù‚ÙˆØ©
    FileWriteString(fileHandle, "\nğŸ’ª Ù†Ù‚Ø§Ø· Ø§Ù„Ù‚ÙˆØ©:\n");
    WriteStrengthsToFile(fileHandle);
    
    // Ù†Ù‚Ø§Ø· Ø§Ù„Ø¶Ø¹Ù
    FileWriteString(fileHandle, "\nâš ï¸ Ù†Ù‚Ø§Ø· ØªØ­ØªØ§Ø¬ ØªØ­Ø³ÙŠÙ†:\n");
    WriteWeaknessesToFile(fileHandle);
    
    // Ø§Ù„ØªÙˆØµÙŠØ§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
    FileWriteString(fileHandle, "\nğŸ¯ Ø§Ù„ØªÙˆØµÙŠØ§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© (Ø£ÙˆÙ„ÙˆÙŠØ© Ø¹Ø§Ù„ÙŠØ©):\n");
    WriteTopRecommendationsToFile(fileHandle);
    
    FileWriteString(fileHandle, "\n");
}

//+------------------------------------------------------------------+
//| ØªØ­Ø¯ÙŠØ¯ Ø¯Ø±Ø¬Ø© Ø§Ù„Ø£Ø¯Ø§Ø¡                                              |
//+------------------------------------------------------------------+
string GetPerformanceGrade(double percentage)
{
    if(percentage >= 90) return "Ù…Ù…ØªØ§Ø²";
    else if(percentage >= 80) return "Ø¬ÙŠØ¯ Ø¬Ø¯Ø§Ù‹";
    else if(percentage >= 70) return "Ø¬ÙŠØ¯";
    else if(percentage >= 60) return "Ù…Ù‚Ø¨ÙˆÙ„";
    else if(percentage >= 50) return "Ø¶Ø¹ÙŠÙ";
    else return "Ø¶Ø¹ÙŠÙ Ø¬Ø¯Ø§Ù‹";
}

//+------------------------------------------------------------------+
//| ØªØ­Ø¯ÙŠØ¯ Ø¯Ø±Ø¬Ø© Ù…Ø¹Ø§Ù…Ù„ Ø§Ù„Ø±Ø¨Ø­                                         |
//+------------------------------------------------------------------+
string GetProfitFactorGrade(double factor)
{
    if(factor >= 2.0) return "Ù…Ù…ØªØ§Ø²";
    else if(factor >= 1.5) return "Ø¬ÙŠØ¯ Ø¬Ø¯Ø§Ù‹";
    else if(factor >= 1.3) return "Ø¬ÙŠØ¯";
    else if(factor >= 1.1) return "Ù…Ù‚Ø¨ÙˆÙ„";
    else if(factor >= 1.0) return "Ø¶Ø¹ÙŠÙ";
    else return "Ø®Ø§Ø³Ø±";
}

//+------------------------------------------------------------------+
//| ÙƒØªØ§Ø¨Ø© Ù†Ù‚Ø§Ø· Ø§Ù„Ù‚ÙˆØ©                                               |
//+------------------------------------------------------------------+
void WriteStrengthsToFile(int fileHandle)
{
    int strengthsCount = 0;
    
    // Ù…Ø¹Ø¯Ù„ Ø§Ù„ØªÙ†ÙÙŠØ° Ø§Ù„Ø¬ÙŠØ¯
    double executionRate = CalculatePercentage(stats.executedOrders, stats.totalOrders);
    if(executionRate >= 70) {
        FileWriteString(fileHandle, "   âœ… Ù…Ø¹Ø¯Ù„ ØªÙ†ÙÙŠØ° Ø¬ÙŠØ¯ (" + DoubleToString(executionRate, 1) + "%)\n");
        strengthsCount++;
    }
    
    // Ù…Ø¹Ø¯Ù„ Ø±Ø¨Ø­ÙŠØ© Ø¬ÙŠØ¯
    if(stats.winRate >= 60) {
        FileWriteString(fileHandle, "   âœ… Ù…Ø¹Ø¯Ù„ Ø±Ø¨Ø­ÙŠØ© Ù…Ù‚Ø¨ÙˆÙ„ (" + DoubleToString(stats.winRate, 1) + "%)\n");
        strengthsCount++;
    }
    
    // Ù…Ø¹Ø§Ù…Ù„ Ø±Ø¨Ø­ Ø¬ÙŠØ¯
    if(stats.profitFactor >= 1.3) {
        FileWriteString(fileHandle, "   âœ… Ù…Ø¹Ø§Ù…Ù„ Ø±Ø¨Ø­ Ø¬ÙŠØ¯ (" + DoubleToString(stats.profitFactor, 2) + ")\n");
        strengthsCount++;
    }
    
    // Ø³Ø­Ø¨ Ù…Ù†Ø®ÙØ¶
    if(stats.maxDrawdownPct < 5.0 && stats.maxDrawdownPct > 0) {
        FileWriteString(fileHandle, "   âœ… Ø£Ù‚ØµÙ‰ Ø³Ø­Ø¨ Ù…Ù†Ø®ÙØ¶ (" + DoubleToString(stats.maxDrawdownPct, 1) + "%)\n");
        strengthsCount++;
    }
    
    // Ø§Ù†Ø²Ù„Ø§Ù‚ Ù…Ù†Ø®ÙØ¶
    if(stats.avgSlippage < 2.0 && stats.avgSlippage > 0) {
        FileWriteString(fileHandle, "   âœ… Ø§Ù†Ø²Ù„Ø§Ù‚ Ù…Ù†Ø®ÙØ¶ (Ù…ØªÙˆØ³Ø· " + DoubleToString(stats.avgSlippage, 1) + " Ù†Ù‚Ø§Ø·)\n");
        strengthsCount++;
    }
    
    // ØªÙˆÙ‚ÙŠØª Ø¬ÙŠØ¯
    if(stats.timeoutFailures < stats.totalOrders * 0.1) {
        FileWriteString(fileHandle, "   âœ… ØªÙˆÙ‚ÙŠØª Ø§Ù„ØªØ¯Ø§ÙˆÙ„ Ù…Ù†Ø§Ø³Ø¨\n");
        strengthsCount++;
    }
    
    if(strengthsCount == 0) {
        FileWriteString(fileHandle, "   âš ï¸ Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ù†Ù‚Ø§Ø· Ù‚ÙˆØ© ÙˆØ§Ø¶Ø­Ø© - ÙŠØ­ØªØ§Ø¬ ØªØ­Ø³ÙŠÙ†Ø§Øª Ø´Ø§Ù…Ù„Ø©\n");
    }
}

//+------------------------------------------------------------------+
//| ÙƒØªØ§Ø¨Ø© Ù†Ù‚Ø§Ø· Ø§Ù„Ø¶Ø¹Ù                                               |
//+------------------------------------------------------------------+
void WriteWeaknessesToFile(int fileHandle)
{
    int weaknessesCount = 0;
    
    // Ù…Ø¹Ø¯Ù„ ØªÙ†ÙÙŠØ° Ù…Ù†Ø®ÙØ¶
    double executionRate = CalculatePercentage(stats.executedOrders, stats.totalOrders);
    if(executionRate < 70) {
        FileWriteString(fileHandle, "   âŒ Ù…Ø¹Ø¯Ù„ ØªÙ†ÙÙŠØ° Ù…Ù†Ø®ÙØ¶ (" + DoubleToString(executionRate, 1) + "%)\n");
        weaknessesCount++;
    }
    
    // Ù…Ø¹Ø¯Ù„ Ø±Ø¨Ø­ÙŠØ© Ù…Ù†Ø®ÙØ¶
    if(stats.winRate < 50 && stats.executedOrders > 0) {
        FileWriteString(fileHandle, "   âŒ Ù…Ø¹Ø¯Ù„ Ø±Ø¨Ø­ÙŠØ© Ù…Ù†Ø®ÙØ¶ (" + DoubleToString(stats.winRate, 1) + "%)\n");
        weaknessesCount++;
    }
    
    // Ù…Ø¹Ø§Ù…Ù„ Ø±Ø¨Ø­ Ø¶Ø¹ÙŠÙ
    if(stats.profitFactor < 1.3 && stats.profitFactor > 0) {
        FileWriteString(fileHandle, "   âŒ Ù…Ø¹Ø§Ù…Ù„ Ø±Ø¨Ø­ Ø¶Ø¹ÙŠÙ (" + DoubleToString(stats.profitFactor, 2) + ")\n");
        weaknessesCount++;
    }
    
    // Ø³Ø­Ø¨ Ø¹Ø§Ù„ÙŠ
    if(stats.maxDrawdownPct > 10.0) {
        FileWriteString(fileHandle, "   âŒ Ø£Ù‚ØµÙ‰ Ø³Ø­Ø¨ Ø¹Ø§Ù„ÙŠ (" + DoubleToString(stats.maxDrawdownPct, 1) + "%)\n");
        weaknessesCount++;
    }
    
    // Ø§Ù†Ø²Ù„Ø§Ù‚ Ø¹Ø§Ù„ÙŠ
    if(stats.avgSlippage > 3.0) {
        FileWriteString(fileHandle, "   âŒ Ø§Ù†Ø²Ù„Ø§Ù‚ Ø¹Ø§Ù„ÙŠ (Ù…ØªÙˆØ³Ø· " + DoubleToString(stats.avgSlippage, 1) + " Ù†Ù‚Ø§Ø·)\n");
        weaknessesCount++;
    }
    
    // Ù…Ø´Ø§ÙƒÙ„ Ø§Ù„ØªÙˆÙ‚ÙŠØª
    if(stats.timeoutFailures > stats.totalOrders * 0.2) {
        FileWriteString(fileHandle, "   âŒ Ù…Ø´Ø§ÙƒÙ„ ÙÙŠ ØªÙˆÙ‚ÙŠØª Ø§Ù„ØªØ¯Ø§ÙˆÙ„\n");
        weaknessesCount++;
    }
    
    // Ù…Ø´Ø§ÙƒÙ„ Ø§Ù„Ø³Ø¨Ø±ÙŠØ¯
    if(stats.highSpreadFailures > stats.totalOrders * 0.2) {
        FileWriteString(fileHandle, "   âŒ ØªØ£Ø«Ø± Ø³Ù„Ø¨ÙŠ Ø¨Ø§Ù„Ø³Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¹Ø§Ù„ÙŠ\n");
        weaknessesCount++;
    }
    
    // Ù…Ø´Ø§ÙƒÙ„ Ø§Ù„Ø§ØªØ¬Ø§Ù‡
    if(stats.wrongDirectionFailures > stats.executedOrders * 0.4) {
        FileWriteString(fileHandle, "   âŒ Ø¯Ù‚Ø© ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø§ØªØ¬Ø§Ù‡ ØªØ­ØªØ§Ø¬ ØªØ­Ø³ÙŠÙ†\n");
        weaknessesCount++;
    }
    
    if(weaknessesCount == 0) {
        FileWriteString(fileHandle, "   âœ… Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†Ù‚Ø§Ø· Ø¶Ø¹Ù ÙˆØ§Ø¶Ø­Ø© - Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø¬ÙŠØ¯ Ø¥Ø¬Ù…Ø§Ù„Ø§Ù‹\n");
    }
}

//+------------------------------------------------------------------+
//| ÙƒØªØ§Ø¨Ø© Ø£Ù‡Ù… Ø§Ù„ØªÙˆØµÙŠØ§Øª                                             |
//+------------------------------------------------------------------+
void WriteTopRecommendationsToFile(int fileHandle)
{
    int recommendationCount = 0;
    
    // ØªØ­Ø³ÙŠÙ† Ù…Ø¹Ø¯Ù„ Ø§Ù„ØªÙ†ÙÙŠØ°
    double executionRate = CalculatePercentage(stats.executedOrders, stats.totalOrders);
    if(executionRate < 70) {
        FileWriteString(fileHandle, "   1ï¸âƒ£ ØªØ­Ø³ÙŠÙ† Ù…Ø¹Ø¯Ù„ Ø§Ù„ØªÙ†ÙÙŠØ°: Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© ÙˆØ¶Ø¹ Ø§Ù„Ø£ÙˆØ§Ù…Ø±\n");
        recommendationCount++;
    }
    
    // ØªØ­Ø³ÙŠÙ† Ø¯Ù‚Ø© Ø§Ù„Ø§ØªØ¬Ø§Ù‡
    if(stats.wrongDirectionFailures > stats.executedOrders * 0.3) {
        FileWriteString(fileHandle, "   " + IntegerToString(recommendationCount + 1) + "ï¸âƒ£ ØªØ­Ø³ÙŠÙ† Ø¯Ù‚Ø© ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø§ØªØ¬Ø§Ù‡: Ø¥Ø¶Ø§ÙØ© Ù…Ø¤Ø´Ø±Ø§Øª ØªØ£ÙƒÙŠØ¯ÙŠØ©\n");
        recommendationCount++;
    }
    
    // ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ø³Ø­Ø¨
    if(stats.maxDrawdownPct > 10.0) {
        FileWriteString(fileHandle, "   " + IntegerToString(recommendationCount + 1) + "ï¸âƒ£ ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ù…Ø®Ø§Ø·Ø±: ØªØµØºÙŠØ± Ø£Ø­Ø¬Ø§Ù… Ø§Ù„ØµÙÙ‚Ø§Øª\n");
        recommendationCount++;
    }
    
    // ØªØ­Ø³ÙŠÙ† Ø§Ù„ØªÙˆÙ‚ÙŠØª
    if(stats.timeoutFailures > stats.totalOrders * 0.2) {
        FileWriteString(fileHandle, "   " + IntegerToString(recommendationCount + 1) + "ï¸âƒ£ ØªØ­Ø³ÙŠÙ† ØªÙˆÙ‚ÙŠØª Ø§Ù„ØªØ¯Ø§ÙˆÙ„: Ø§Ù„ØªØ±ÙƒÙŠØ² Ø¹Ù„Ù‰ Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø³ÙŠÙˆÙ„Ø© Ø§Ù„Ø¹Ø§Ù„ÙŠØ©\n");
        recommendationCount++;
    }
    
    // ØªÙ‚Ù„ÙŠÙ„ ØªØ£Ø«ÙŠØ± Ø§Ù„Ø³Ø¨Ø±ÙŠØ¯
    if(stats.highSpreadFailures > stats.totalOrders * 0.2) {
        FileWriteString(fileHandle, "   " + IntegerToString(recommendationCount + 1) + "ï¸âƒ£ ØªÙ‚Ù„ÙŠÙ„ ØªØ£Ø«ÙŠØ± Ø§Ù„Ø³Ø¨Ø±ÙŠØ¯: ØªØ¬Ù†Ø¨ Ø£ÙˆÙ‚Ø§Øª Ø§Ù„Ø£Ø®Ø¨Ø§Ø±\n");
        recommendationCount++;
    }
    
    if(recommendationCount == 0) {
        FileWriteString(fileHandle, "   âœ… Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø¬ÙŠØ¯ - Ù…ÙˆØ§ØµÙ„Ø© Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© ÙˆØ§Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„ØªØ¯Ø±ÙŠØ¬ÙŠ\n");
    }
}

//+------------------------------------------------------------------+
//| Ø¥Ù†Ø´Ø§Ø¡ ØªÙ‚Ø±ÙŠØ± Ù…Ù‚Ø§Ø±Ù† (Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…Ø³ØªÙ‚Ø¨Ù„ÙŠ)                         |
//+------------------------------------------------------------------+
void CreateComparisonReportPlaceholder(int fileHandle)
{
    FileWriteString(fileHandle, "ğŸ“Š ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ù‚Ø§Ø±Ù†Ø© (Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ÙŠ):\n");
    FileWriteString(fileHandle, "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n");
    FileWriteString(fileHandle, "ğŸ’¡ Ø³ÙŠØªÙ… ØªÙˆÙÙŠØ± ØªÙ‚Ø±ÙŠØ± Ù…Ù‚Ø§Ø±Ù† Ù…Ø¹ Ø§Ù„ÙØªØ±Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©\n");
    FileWriteString(fileHandle, "   ÙÙŠ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ÙŠØ© Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„ØªØ­Ø³Ù†.\n\n");
    
    // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ù„Ù„Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ÙŠØ©
    FileWriteString(fileHandle, "ğŸ“‹ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø±Ø¬Ø¹ÙŠØ© Ù„Ù„Ù…Ù‚Ø§Ø±Ù†Ø©:\n");
    FileWriteString(fileHandle, "   Ù…Ø¹Ø¯Ù„ Ø§Ù„ØªÙ†ÙÙŠØ° Ø§Ù„Ù…Ø±Ø¬Ø¹ÙŠ: " + DoubleToString(CalculatePercentage(stats.executedOrders, stats.totalOrders), 1) + "%\n");
    if(stats.executedOrders > 0) {
        FileWriteString(fileHandle, "   Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ù…Ø±Ø¬Ø¹ÙŠ: " + DoubleToString(stats.winRate, 1) + "%\n");
        FileWriteString(fileHandle, "   Ù…Ø¹Ø§Ù…Ù„ Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ù…Ø±Ø¬Ø¹ÙŠ: " + DoubleToString(stats.profitFactor, 2) + "\n");
        FileWriteString(fileHandle, "   ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ù…Ø±Ø¬Ø¹ÙŠ: " + DoubleToString(stats.totalProfit, 2) + "$\n");
    }
    FileWriteString(fileHandle, "\n");
}

//--- Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„ØªØ§Ø³Ø¹ ---
//+------------------------------------------------------------------+
//| Expert Advisor: Advanced Zigzag Analysis Bot - Part 10/15      |
//| Ù…Ø­Ù„Ù„ Ø¨ÙˆØª Ø§Ù„Ø²Ø¬Ø²Ø§Ø¬ Ø§Ù„Ø¹Ø¨Ù‚Ø±ÙŠ - Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø¹Ø§Ø´Ø±: Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø«Ø§Ù†ÙŠ |
//+------------------------------------------------------------------+

// ØªÙƒÙ…Ù„Ø© Ù„Ù„Ø£Ø¬Ø²Ø§Ø¡ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© - Ø¥Ù†Ø´Ø§Ø¡ ØªÙ‚Ø§Ø±ÙŠØ± Ù…ØªÙ‚Ø¯Ù…Ø© Ø¥Ø¶Ø§ÙÙŠØ©

//+------------------------------------------------------------------+
//| Ø¥Ù†Ø´Ø§Ø¡ ØªÙ‚Ø±ÙŠØ± ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø±Ù…ÙˆØ² Ø§Ù„Ù…ØªØ¯Ø§ÙˆÙ„Ø©                            |
//+------------------------------------------------------------------+
void CreateSymbolAnalysisReport(int fileHandle)
{
    FileWriteString(fileHandle, "ğŸ’± ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø±Ù…ÙˆØ² Ø§Ù„Ù…ØªØ¯Ø§ÙˆÙ„Ø©:\n");
    FileWriteString(fileHandle, "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n");
    
    // Ø¥Ù†Ø´Ø§Ø¡ Ù‚Ø§Ø¦Ù…Ø© Ø¨Ø§Ù„Ø±Ù…ÙˆØ² Ø§Ù„Ù…ØªØ¯Ø§ÙˆÙ„Ø©
    string symbols[];
    int symbolOrders[];
    int symbolExecuted[];
    double symbolProfit[];
    int symbolCount = 0;
    
    // Ø¬Ù…Ø¹ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ÙƒÙ„ Ø±Ù…Ø²
    for(int i = 0; i < stats.totalOrders; i++) {
        string currentSymbol = orders[i].symbol;
        int symbolIndex = FindSymbolIndex(symbols, symbolCount, currentSymbol);
        
        if(symbolIndex == -1) {
            // Ø±Ù…Ø² Ø¬Ø¯ÙŠØ¯
            ArrayResize(symbols, symbolCount + 1);
            ArrayResize(symbolOrders, symbolCount + 1);
            ArrayResize(symbolExecuted, symbolCount + 1);
            ArrayResize(symbolProfit, symbolCount + 1);
            
            symbols[symbolCount] = currentSymbol;
            symbolOrders[symbolCount] = 1;
            symbolExecuted[symbolCount] = orders[i].isExecuted ? 1 : 0;
            symbolProfit[symbolCount] = orders[i].isExecuted ? orders[i].netProfit : 0;
            symbolCount++;
        } else {
            // Ø±Ù…Ø² Ù…ÙˆØ¬ÙˆØ¯
            symbolOrders[symbolIndex]++;
            if(orders[i].isExecuted) {
                symbolExecuted[symbolIndex]++;
                symbolProfit[symbolIndex] += orders[i].netProfit;
            }
        }
    }
    
    // ÙƒØªØ§Ø¨Ø© ØªØ­Ù„ÙŠÙ„ ÙƒÙ„ Ø±Ù…Ø²
    for(int i = 0; i < symbolCount; i++) {
        WriteSymbolAnalysis(fileHandle, symbols[i], symbolOrders[i], symbolExecuted[i], symbolProfit[i]);
    }
    
    FileWriteString(fileHandle, "\n");
}

//+------------------------------------------------------------------+
//| Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† ÙÙ‡Ø±Ø³ Ø§Ù„Ø±Ù…Ø²                                            |
//+------------------------------------------------------------------+
int FindSymbolIndex(string symbols[], int count, string symbol)
{
    for(int i = 0; i < count; i++) {
        if(symbols[i] == symbol) return i;
    }
    return -1;
}

//+------------------------------------------------------------------+
//| ÙƒØªØ§Ø¨Ø© ØªØ­Ù„ÙŠÙ„ Ø±Ù…Ø² Ù…Ø­Ø¯Ø¯                                           |
//+------------------------------------------------------------------+
void WriteSymbolAnalysis(int fileHandle, string symbol, int totalOrders, int executedOrders, double profit)
{
    double executionRate = CalculatePercentage(executedOrders, totalOrders);
    
    FileWriteString(fileHandle, "ğŸ“Š " + symbol + ":\n");
    FileWriteString(fileHandle, "   ğŸ“ˆ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£ÙˆØ§Ù…Ø±: " + IntegerToString(totalOrders) + "\n");
    FileWriteString(fileHandle, "   âœ… Ø£ÙˆØ§Ù…Ø± Ù…Ù†ÙØ°Ø©: " + IntegerToString(executedOrders) + 
                   " (" + DoubleToString(executionRate, 1) + "%)\n");
    
    if(executedOrders > 0) {
        FileWriteString(fileHandle, "   ğŸ’° ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­: " + DoubleToString(profit, 2) + "$\n");
        double avgProfitPerTrade = profit / executedOrders;
        FileWriteString(fileHandle, "   ğŸ“Š Ù…ØªÙˆØ³Ø· Ø§Ù„Ø±Ø¨Ø­ Ù„ÙƒÙ„ ØµÙÙ‚Ø©: " + DoubleToString(avgProfitPerTrade, 2) + "$\n");
        
        // ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ø¯Ø§Ø¡
        string performance = "";
        if(executionRate >= 80 && profit > 0) {
            performance = "Ù…Ù…ØªØ§Ø²";
        } else if(executionRate >= 70 && profit >= 0) {
            performance = "Ø¬ÙŠØ¯";
        } else if(executionRate >= 60) {
            performance = "Ù…Ù‚Ø¨ÙˆÙ„";
        } else {
            performance = "ÙŠØ­ØªØ§Ø¬ ØªØ­Ø³ÙŠÙ†";
        }
        
        FileWriteString(fileHandle, "   ğŸ¯ Ø§Ù„Ø£Ø¯Ø§Ø¡: " + performance + "\n");
    }
    
    FileWriteString(fileHandle, "\n");
}

//+------------------------------------------------------------------+
//| Ø¥Ù†Ø´Ø§Ø¡ ØªÙ‚Ø±ÙŠØ± ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£ÙˆÙ‚Ø§Øª Ø§Ù„Ù…ÙØµÙ„                              |
//+------------------------------------------------------------------+
void CreateDetailedTimeAnalysisReport(int fileHandle)
{
    FileWriteString(fileHandle, "â° ØªØ­Ù„ÙŠÙ„ Ù…ÙØµÙ„ Ù„Ù„Ø£ÙˆÙ‚Ø§Øª:\n");
    FileWriteString(fileHandle, "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n");
    
    // ØªØ­Ù„ÙŠÙ„ Ø³Ø§Ø¹ÙŠ
    CreateHourlyAnalysis(fileHandle);
    
    // ØªØ­Ù„ÙŠÙ„ Ø£ÙŠØ§Ù… Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹
    CreateDailyAnalysis(fileHandle);
    
    // ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£ÙˆÙ‚Ø§Øª Ø§Ù„Ø®Ø§ØµØ©
    CreateSpecialTimeAnalysis(fileHandle);
    
    FileWriteString(fileHandle, "\n");
}

//+------------------------------------------------------------------+
//| Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø³Ø§Ø¹ÙŠ                                           |
//+------------------------------------------------------------------+
void CreateHourlyAnalysis(int fileHandle)
{
    FileWriteString(fileHandle, "ğŸ• Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø³Ø§Ø¹ÙŠ:\n");
    
    int hourlyStats[24][4]; // [hour][total, executed, wins, losses]
    ArrayInitialize(hourlyStats, 0);
    
    // Ø¬Ù…Ø¹ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
    for(int i = 0; i < stats.totalOrders; i++) {
        int hour = orders[i].hourOfDay;
        if(hour >= 0 && hour < 24) {
            hourlyStats[hour][0]++; // Ø¥Ø¬Ù…Ø§Ù„ÙŠ
            if(orders[i].isExecuted) {
                hourlyStats[hour][1]++; // Ù…Ù†ÙØ°Ø©
                if(orders[i].netProfit > 0) {
                    hourlyStats[hour][2]++; // Ø±Ø§Ø¨Ø­Ø©
                } else if(orders[i].netProfit < 0) {
                    hourlyStats[hour][3]++; // Ø®Ø§Ø³Ø±Ø©
                }
            }
        }
    }
    
    // ÙƒØªØ§Ø¨Ø© Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø³Ø§Ø¹ÙŠ
    for(int h = 0; h < 24; h++) {
        if(hourlyStats[h][0] > 0) {
            double execRate = CalculatePercentage(hourlyStats[h][1], hourlyStats[h][0]);
            double winRate = hourlyStats[h][1] > 0 ? CalculatePercentage(hourlyStats[h][2], hourlyStats[h][1]) : 0;
            
            FileWriteString(fileHandle, StringFormat("   %02d:00 - Ø£ÙˆØ§Ù…Ø±:%d, ØªÙ†ÙÙŠØ°:%.1f%%, Ù†Ø¬Ø§Ø­:%.1f%%", 
                           h, hourlyStats[h][0], execRate, winRate));
            
            // ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø£Ø¯Ø§Ø¡
            if(execRate >= 80 && winRate >= 60) {
                FileWriteString(fileHandle, " â­ Ù…Ù…ØªØ§Ø²");
            } else if(execRate >= 70 && winRate >= 50) {
                FileWriteString(fileHandle, " âœ… Ø¬ÙŠØ¯");
            } else if(execRate < 50 || winRate < 40) {
                FileWriteString(fileHandle, " âš ï¸ Ø¶Ø¹ÙŠÙ");
            }
            
            FileWriteString(fileHandle, "\n");
        }
    }
    
    FileWriteString(fileHandle, "\n");
}

//+------------------------------------------------------------------+
//| Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙŠÙˆÙ…ÙŠ                                           |
//+------------------------------------------------------------------+
void CreateDailyAnalysis(int fileHandle)
{
    FileWriteString(fileHandle, "ğŸ“… Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø­Ø³Ø¨ Ø£ÙŠØ§Ù… Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹:\n");
    
    int dailyStats[7][4]; // [day][total, executed, wins, losses]
    ArrayInitialize(dailyStats, 0);
    
    // Ø¬Ù…Ø¹ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
    for(int i = 0; i < stats.totalOrders; i++) {
        MqlDateTime dt;
        TimeToStruct(orders[i].timeSetup, dt);
        int day = dt.day_of_week;
        
        if(day >= 0 && day < 7) {
            dailyStats[day][0]++; // Ø¥Ø¬Ù…Ø§Ù„ÙŠ
            if(orders[i].isExecuted) {
                dailyStats[day][1]++; // Ù…Ù†ÙØ°Ø©
                if(orders[i].netProfit > 0) {
                    dailyStats[day][2]++; // Ø±Ø§Ø¨Ø­Ø©
                } else if(orders[i].netProfit < 0) {
                    dailyStats[day][3]++; // Ø®Ø§Ø³Ø±Ø©
                }
            }
        }
    }
    
    // ÙƒØªØ§Ø¨Ø© Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙŠÙˆÙ…ÙŠ
    string dayNames[7] = {"Ø§Ù„Ø£Ø­Ø¯", "Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†", "Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡", "Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡", "Ø§Ù„Ø®Ù…ÙŠØ³", "Ø§Ù„Ø¬Ù…Ø¹Ø©", "Ø§Ù„Ø³Ø¨Øª"};
    
    for(int d = 0; d < 7; d++) {
        if(dailyStats[d][0] > 0) {
            double execRate = CalculatePercentage(dailyStats[d][1], dailyStats[d][0]);
            double winRate = dailyStats[d][1] > 0 ? CalculatePercentage(dailyStats[d][2], dailyStats[d][1]) : 0;
            
            FileWriteString(fileHandle, "   " + dayNames[d] + " - Ø£ÙˆØ§Ù…Ø±:" + IntegerToString(dailyStats[d][0]) + 
                           ", ØªÙ†ÙÙŠØ°:" + DoubleToString(execRate, 1) + "%, Ù†Ø¬Ø§Ø­:" + DoubleToString(winRate, 1) + "%");
            
            // ØªÙ‚ÙŠÙŠÙ… Ø§Ù„ÙŠÙˆÙ…
            if(d == 5 || d == 6) { // Ø¬Ù…Ø¹Ø© ÙˆØ³Ø¨Øª
                FileWriteString(fileHandle, " (Ù†Ù‡Ø§ÙŠØ© Ø£Ø³Ø¨ÙˆØ¹)");
            } else if(d == 1) { // Ø¥Ø«Ù†ÙŠÙ†
                FileWriteString(fileHandle, " (Ø¨Ø¯Ø§ÙŠØ© Ø£Ø³Ø¨ÙˆØ¹)");
            }
            
            FileWriteString(fileHandle, "\n");
        }
    }
    
    FileWriteString(fileHandle, "\n");
}

//+------------------------------------------------------------------+
//| ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£ÙˆÙ‚Ø§Øª Ø§Ù„Ø®Ø§ØµØ©                                           |
//+------------------------------------------------------------------+
void CreateSpecialTimeAnalysis(int fileHandle)
{
    FileWriteString(fileHandle, "ğŸŒŸ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£ÙˆÙ‚Ø§Øª Ø§Ù„Ø®Ø§ØµØ©:\n");
    
    int newsTimeOrders = 0, newsTimeExecuted = 0, newsTimeWins = 0;
    int weekendOrders = 0, weekendExecuted = 0, weekendWins = 0;
    int overlapOrders = 0, overlapExecuted = 0, overlapWins = 0; // ØªØ¯Ø§Ø®Ù„ Ø§Ù„Ø¬Ù„Ø³Ø§Øª
    
    for(int i = 0; i < stats.totalOrders; i++) {
        // Ø£ÙˆÙ‚Ø§Øª Ø§Ù„Ø£Ø®Ø¨Ø§Ø±
        if(orders[i].wasNewsTime) {
            newsTimeOrders++;
            if(orders[i].isExecuted) {
                newsTimeExecuted++;
                if(orders[i].netProfit > 0) newsTimeWins++;
            }
        }
        
        // Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹
        if(orders[i].wasWeekend) {
            weekendOrders++;
            if(orders[i].isExecuted) {
                weekendExecuted++;
                if(orders[i].netProfit > 0) weekendWins++;
            }
        }
        
        // ØªØ¯Ø§Ø®Ù„ Ø§Ù„Ø¬Ù„Ø³Ø§Øª (13:00-17:00)
        if(orders[i].hourOfDay >= 13 && orders[i].hourOfDay <= 17) {
            overlapOrders++;
            if(orders[i].isExecuted) {
                overlapExecuted++;
                if(orders[i].netProfit > 0) overlapWins++;
            }
        }
    }
    
    // ØªÙ‚Ø±ÙŠØ± Ø£ÙˆÙ‚Ø§Øª Ø§Ù„Ø£Ø®Ø¨Ø§Ø±
    if(newsTimeOrders > 0) {
        double newsExecRate = CalculatePercentage(newsTimeExecuted, newsTimeOrders);
        double newsWinRate = newsTimeExecuted > 0 ? CalculatePercentage(newsTimeWins, newsTimeExecuted) : 0;
        FileWriteString(fileHandle, "   ğŸ“° Ø£ÙˆÙ‚Ø§Øª Ø§Ù„Ø£Ø®Ø¨Ø§Ø±: " + IntegerToString(newsTimeOrders) + 
                       " Ø£ÙˆØ§Ù…Ø± - ØªÙ†ÙÙŠØ°:" + DoubleToString(newsExecRate, 1) + "%, Ù†Ø¬Ø§Ø­:" + DoubleToString(newsWinRate, 1) + "%\n");
    }
    
    // ØªÙ‚Ø±ÙŠØ± Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹
    if(weekendOrders > 0) {
        double weekendExecRate = CalculatePercentage(weekendExecuted, weekendOrders);
        double weekendWinRate = weekendExecuted > 0 ? CalculatePercentage(weekendWins, weekendExecuted) : 0;
        FileWriteString(fileHandle, "   ğŸŒ… Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹: " + IntegerToString(weekendOrders) + 
                       " Ø£ÙˆØ§Ù…Ø± - ØªÙ†ÙÙŠØ°:" + DoubleToString(weekendExecRate, 1) + "%, Ù†Ø¬Ø§Ø­:" + DoubleToString(weekendWinRate, 1) + "%\n");
    }
    
    // ØªÙ‚Ø±ÙŠØ± ØªØ¯Ø§Ø®Ù„ Ø§Ù„Ø¬Ù„Ø³Ø§Øª
    if(overlapOrders > 0) {
        double overlapExecRate = CalculatePercentage(overlapExecuted, overlapOrders);
        double overlapWinRate = overlapExecuted > 0 ? CalculatePercentage(overlapWins, overlapExecuted) : 0;
        FileWriteString(fileHandle, "   ğŸŒŸ ØªØ¯Ø§Ø®Ù„ Ø§Ù„Ø¬Ù„Ø³Ø§Øª (13-17): " + IntegerToString(overlapOrders) + 
                       " Ø£ÙˆØ§Ù…Ø± - ØªÙ†ÙÙŠØ°:" + DoubleToString(overlapExecRate, 1) + "%, Ù†Ø¬Ø§Ø­:" + DoubleToString(overlapWinRate, 1) + "%\n");
    }
    
    FileWriteString(fileHandle, "\n");
}

//+------------------------------------------------------------------+
//| Ø¥Ù†Ø´Ø§Ø¡ ØªÙ‚Ø±ÙŠØ± ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ø®Ø§Ø·Ø± Ø§Ù„Ù…ÙØµÙ„                              |
//+------------------------------------------------------------------+
void CreateDetailedRiskAnalysisReport(int fileHandle)
{
    FileWriteString(fileHandle, "ğŸ›¡ï¸ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ø®Ø§Ø·Ø± Ø§Ù„Ù…ÙØµÙ„:\n");
    FileWriteString(fileHandle, "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n");
    
    // ØªØ­Ù„ÙŠÙ„ ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ ÙˆØ§Ù„Ø®Ø³Ø§Ø¦Ø±
    CreateProfitLossDistribution(fileHandle);
    
    // ØªØ­Ù„ÙŠÙ„ Ø£Ø­Ø¬Ø§Ù… Ø§Ù„ØµÙÙ‚Ø§Øª ÙˆØ§Ù„Ù…Ø®Ø§Ø·Ø±
    CreateVolumRiskAnalysis(fileHandle);
    
    // ØªØ­Ù„ÙŠÙ„ Ù†Ø³Ø¨ Ø§Ù„Ù…Ø®Ø§Ø·Ø± Ù„Ù„Ø¹ÙˆØ§Ø¦Ø¯
    CreateRiskRewardAnalysis(fileHandle);
    
    // ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø³Ø­Ø¨ ÙˆØ§Ù„ØªØ¹Ø§ÙÙŠ
    CreateDrawdownAnalysis(fileHandle);
    
    FileWriteString(fileHandle, "\n");
}

//+------------------------------------------------------------------+
//| ØªØ­Ù„ÙŠÙ„ ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ ÙˆØ§Ù„Ø®Ø³Ø§Ø¦Ø±                                   |
//+------------------------------------------------------------------+
void CreateProfitLossDistribution(int fileHandle)
{
    FileWriteString(fileHandle, "ğŸ“Š ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ ÙˆØ§Ù„Ø®Ø³Ø§Ø¦Ø±:\n");
    
    if(stats.executedOrders == 0) {
        FileWriteString(fileHandle, "   âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙÙ‚Ø§Øª Ù…Ù†ÙØ°Ø© Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªÙˆØ²ÙŠØ¹\n\n");
        return;
    }
    
    // ØªØµÙ†ÙŠÙ Ø§Ù„ØµÙÙ‚Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ø­Ø¬Ù…
    int smallProfits = 0, mediumProfits = 0, largeProfits = 0;
    int smallLosses = 0, mediumLosses = 0, largeLosses = 0;
    double profitThreshold1 = 50.0, profitThreshold2 = 200.0;
    double lossThreshold1 = -50.0, lossThreshold2 = -200.0;
    
    for(int i = 0; i < stats.totalOrders; i++) {
        if(!orders[i].isExecuted) continue;
        
        if(orders[i].netProfit > 0) {
            if(orders[i].netProfit <= profitThreshold1) smallProfits++;
            else if(orders[i].netProfit <= profitThreshold2) mediumProfits++;
            else largeProfits++;
        } else if(orders[i].netProfit < 0) {
            if(orders[i].netProfit >= lossThreshold1) smallLosses++;
            else if(orders[i].netProfit >= lossThreshold2) mediumLosses++;
            else largeLosses++;
        }
    }
    
    FileWriteString(fileHandle, "   ğŸ’° Ø§Ù„Ø£Ø±Ø¨Ø§Ø­:\n");
    FileWriteString(fileHandle, "      ğŸ”¹ ØµØºÙŠØ±Ø© (â‰¤$50): " + IntegerToString(smallProfits) + " ØµÙÙ‚Ø§Øª\n");
    FileWriteString(fileHandle, "      ğŸ”¸ Ù…ØªÙˆØ³Ø·Ø© ($50-200): " + IntegerToString(mediumProfits) + " ØµÙÙ‚Ø§Øª\n");
    FileWriteString(fileHandle, "      ğŸ”¶ ÙƒØ¨ÙŠØ±Ø© (>$200): " + IntegerToString(largeProfits) + " ØµÙÙ‚Ø§Øª\n");
    
    FileWriteString(fileHandle, "   ğŸ“‰ Ø§Ù„Ø®Ø³Ø§Ø¦Ø±:\n");
    FileWriteString(fileHandle, "      ğŸ”¹ ØµØºÙŠØ±Ø© (â‰¥-$50): " + IntegerToString(smallLosses) + " ØµÙÙ‚Ø§Øª\n");
    FileWriteString(fileHandle, "      ğŸ”¸ Ù…ØªÙˆØ³Ø·Ø© (-$50 Ø¥Ù„Ù‰ -$200): " + IntegerToString(mediumLosses) + " ØµÙÙ‚Ø§Øª\n");
    FileWriteString(fileHandle, "      ğŸ”¶ ÙƒØ¨ÙŠØ±Ø© (<-$200): " + IntegerToString(largeLosses) + " ØµÙÙ‚Ø§Øª\n");
    
    // ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªÙˆØ²ÙŠØ¹
    if(largeLosses > largeProfits) {
        FileWriteString(fileHandle, "   âš ï¸ ØªØ­Ø°ÙŠØ±: Ø§Ù„Ø®Ø³Ø§Ø¦Ø± Ø§Ù„ÙƒØ¨ÙŠØ±Ø© Ø£ÙƒØ«Ø± Ù…Ù† Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ Ø§Ù„ÙƒØ¨ÙŠØ±Ø©\n");
    }
    
    FileWriteString(fileHandle, "\n");
}

//+------------------------------------------------------------------+
//| ØªØ­Ù„ÙŠÙ„ Ø­Ø¬Ù… Ø§Ù„ØµÙÙ‚Ø§Øª ÙˆØ§Ù„Ù…Ø®Ø§Ø·Ø±                                     |
//+------------------------------------------------------------------+
void CreateVolumRiskAnalysis(int fileHandle)
{
    FileWriteString(fileHandle, "ğŸ’¼ ØªØ­Ù„ÙŠÙ„ Ø£Ø­Ø¬Ø§Ù… Ø§Ù„ØµÙÙ‚Ø§Øª ÙˆØ§Ù„Ù…Ø®Ø§Ø·Ø±:\n");
    
    if(stats.avgVolume <= 0) {
        FileWriteString(fileHandle, "   âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª ÙƒØ§ÙÙŠØ© Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ø­Ø¬Ø§Ù…\n\n");
        return;
    }
    
    double accountBalance = AccountInfoDouble(ACCOUNT_BALANCE);
    if(accountBalance <= 0) accountBalance = 10000; // Ø§ÙØªØ±Ø§Ø¶ÙŠ
    
    FileWriteString(fileHandle, "   ğŸ“Š Ù…ØªÙˆØ³Ø· Ø­Ø¬Ù… Ø§Ù„ØµÙÙ‚Ø©: " + DoubleToString(stats.avgVolume, 2) + " Ù„ÙˆØª\n");
    
    // ØªÙ‚Ø¯ÙŠØ± Ø§Ù„Ù…Ø®Ø§Ø·Ø±Ø© Ù„ÙƒÙ„ ØµÙÙ‚Ø©
    double avgRiskPerTrade = stats.avgLoss * stats.avgVolume;
    double riskPercentage = (avgRiskPerTrade / accountBalance) * 100;
    
    FileWriteString(fileHandle, "   ğŸ’° Ù…ØªÙˆØ³Ø· Ø§Ù„Ù…Ø®Ø§Ø·Ø±Ø© Ù„ÙƒÙ„ ØµÙÙ‚Ø©: " + DoubleToString(avgRiskPerTrade, 2) + 
                   "$ (" + DoubleToString(riskPercentage, 2) + "% Ù…Ù† Ø§Ù„Ø­Ø³Ø§Ø¨)\n");
    
    // ØªÙ‚ÙŠÙŠÙ… Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù…Ø®Ø§Ø·Ø±Ø©
    if(riskPercentage > 5.0) {
        FileWriteString(fileHandle, "   ğŸš¨ Ù…Ø³ØªÙˆÙ‰ Ù…Ø®Ø§Ø·Ø±Ø© Ø¹Ø§Ù„ÙŠ Ø¬Ø¯Ø§Ù‹ - ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ø£Ø­Ø¬Ø§Ù… Ø¶Ø±ÙˆØ±ÙŠ\n");
    } else if(riskPercentage > 2.0) {
        FileWriteString(fileHandle, "   âš ï¸ Ù…Ø³ØªÙˆÙ‰ Ù…Ø®Ø§Ø·Ø±Ø© Ø¹Ø§Ù„ÙŠ - ÙŠÙÙ†ØµØ­ Ø¨ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ø£Ø­Ø¬Ø§Ù…\n");
    } else if(riskPercentage > 1.0) {
        FileWriteString(fileHandle, "   âœ… Ù…Ø³ØªÙˆÙ‰ Ù…Ø®Ø§Ø·Ø±Ø© Ù…Ù‚Ø¨ÙˆÙ„\n");
    } else {
        FileWriteString(fileHandle, "   âœ… Ù…Ø³ØªÙˆÙ‰ Ù…Ø®Ø§Ø·Ø±Ø© Ù…Ø­Ø§ÙØ¸\n");
    }
    
    FileWriteString(fileHandle, "\n");
}

//+------------------------------------------------------------------+
//| ØªØ­Ù„ÙŠÙ„ Ù†Ø³Ø¨ Ø§Ù„Ù…Ø®Ø§Ø·Ø± Ù„Ù„Ø¹ÙˆØ§Ø¦Ø¯                                      |
//+------------------------------------------------------------------+
void CreateRiskRewardAnalysis(int fileHandle)
{
    FileWriteString(fileHandle, "âš–ï¸ ØªØ­Ù„ÙŠÙ„ Ù†Ø³Ø¨ Ø§Ù„Ù…Ø®Ø§Ø·Ø± Ù„Ù„Ø¹ÙˆØ§Ø¦Ø¯:\n");
    
    if(stats.avgRiskReward <= 0) {
        FileWriteString(fileHandle, "   âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª ÙƒØ§ÙÙŠØ© Ù„Ø­Ø³Ø§Ø¨ Ù†Ø³Ø¨ Ø§Ù„Ù…Ø®Ø§Ø·Ø± Ù„Ù„Ø¹ÙˆØ§Ø¦Ø¯\n\n");
        return;
    }
    
    FileWriteString(fileHandle, "   ğŸ“Š Ù…ØªÙˆØ³Ø· Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø®Ø·Ø·Ø©: 1:" + DoubleToString(stats.avgRiskReward, 1) + "\n");
    
    // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„ÙØ¹Ù„ÙŠØ©
    if(stats.avgLoss > 0 && stats.avgWin > 0) {
        double actualRR = stats.avgWin / stats.avgLoss;
        FileWriteString(fileHandle, "   ğŸ“ˆ Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„ÙØ¹Ù„ÙŠØ© Ø§Ù„Ù…Ø­Ù‚Ù‚Ø©: 1:" + DoubleToString(actualRR, 1) + "\n");
        
        // Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ù…Ø®Ø·Ø· Ø¨Ø§Ù„ÙØ¹Ù„ÙŠ
        if(actualRR < stats.avgRiskReward * 0.8) {
            FileWriteString(fileHandle, "   âš ï¸ Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„ÙØ¹Ù„ÙŠØ© Ø£Ù‚Ù„ Ø¨ÙƒØ«ÙŠØ± Ù…Ù† Ø§Ù„Ù…Ø®Ø·Ø· - Ù…Ø±Ø§Ø¬Ø¹Ø© Ù†Ù‚Ø§Ø· Ø§Ù„Ø®Ø±ÙˆØ¬\n");
        } else if(actualRR > stats.avgRiskReward * 1.2) {
            FileWriteString(fileHandle, "   âœ… Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„ÙØ¹Ù„ÙŠØ© Ø£ÙØ¶Ù„ Ù…Ù† Ø§Ù„Ù…Ø®Ø·Ø·\n");
        } else {
            FileWriteString(fileHandle, "   âœ… Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„ÙØ¹Ù„ÙŠØ© Ù‚Ø±ÙŠØ¨Ø© Ù…Ù† Ø§Ù„Ù…Ø®Ø·Ø·\n");
        }
    }
    
    // ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù†Ø³Ø¨Ø©
    if(stats.avgRiskReward >= 3.0) {
        FileWriteString(fileHandle, "   ğŸŒŸ Ù†Ø³Ø¨Ø© Ù…Ù…ØªØ§Ø²Ø© - Ø§Ø³ØªÙ…Ø± ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ø£Ø¯Ø§Ø¡\n");
    } else if(stats.avgRiskReward >= 2.0) {
        FileWriteString(fileHandle, "   âœ… Ù†Ø³Ø¨Ø© Ø¬ÙŠØ¯Ø©\n");
    } else if(stats.avgRiskReward >= 1.5) {
        FileWriteString(fileHandle, "   âš ï¸ Ù†Ø³Ø¨Ø© Ù…Ù‚Ø¨ÙˆÙ„Ø© - ÙŠÙ…ÙƒÙ† ØªØ­Ø³ÙŠÙ†Ù‡Ø§\n");
    } else {
        FileWriteString(fileHandle, "   ğŸš¨ Ù†Ø³Ø¨Ø© Ø¶Ø¹ÙŠÙØ© - ØªØ­ØªØ§Ø¬ ØªØ­Ø³ÙŠÙ† Ø¹Ø§Ø¬Ù„\n");
    }
    
    FileWriteString(fileHandle, "\n");
}

//+------------------------------------------------------------------+
//| ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø³Ø­Ø¨ ÙˆØ§Ù„ØªØ¹Ø§ÙÙŠ                                           |
//+------------------------------------------------------------------+
void CreateDrawdownAnalysis(int fileHandle)
{
    FileWriteString(fileHandle, "ğŸ“‰ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø³Ø­Ø¨ ÙˆØ§Ù„ØªØ¹Ø§ÙÙŠ:\n");
    
    if(stats.maxDrawdownPct <= 0) {
        FileWriteString(fileHandle, "   âœ… Ù„Ù… ÙŠØªÙ… Ø±ØµØ¯ Ø³Ø­Ø¨ ÙƒØ¨ÙŠØ±\n\n");
        return;
    }
    
    FileWriteString(fileHandle, "   ğŸ“Š Ø£Ù‚ØµÙ‰ Ø³Ø­Ø¨ Ù…Ø³Ø¬Ù„: " + DoubleToString(stats.maxDrawdownPct, 2) + "%\n");
    FileWriteString(fileHandle, "   ğŸ“Š Ù…ØªÙˆØ³Ø· Ø§Ù„Ø³Ø­Ø¨: " + DoubleToString(stats.avgDrawdownPct, 2) + "%\n");
    
    // ØªÙ‚ÙŠÙŠÙ… Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø³Ø­Ø¨
    if(stats.maxDrawdownPct > 20.0) {
        FileWriteString(fileHandle, "   ğŸš¨ Ø³Ø­Ø¨ Ø®Ø·ÙŠØ± Ø¬Ø¯Ø§Ù‹ - Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªØ¯Ø§ÙˆÙ„ ÙˆÙ…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ©\n");
    } else if(stats.maxDrawdownPct > 15.0) {
        FileWriteString(fileHandle, "   ğŸš¨ Ø³Ø­Ø¨ Ø¹Ø§Ù„ÙŠ Ø¬Ø¯Ø§Ù‹ - ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ù…Ø®Ø§Ø·Ø± ÙÙˆØ±Ø§Ù‹\n");
    } else if(stats.maxDrawdownPct > 10.0) {
        FileWriteString(fileHandle, "   âš ï¸ Ø³Ø­Ø¨ Ø¹Ø§Ù„ÙŠ - Ù…Ø±Ø§Ø¬Ø¹Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø§Ø·Ø±\n");
    } else if(stats.maxDrawdownPct > 5.0) {
        FileWriteString(fileHandle, "   âš ï¸ Ø³Ø­Ø¨ Ù…ØªÙˆØ³Ø· - Ù…Ø±Ø§Ù‚Ø¨Ø© Ù…Ø³ØªÙ…Ø±Ø©\n");
    } else {
        FileWriteString(fileHandle, "   âœ… Ø³Ø­Ø¨ Ù…Ù†Ø®ÙØ¶ - Ø¥Ø¯Ø§Ø±Ø© Ù…Ø®Ø§Ø·Ø± Ø¬ÙŠØ¯Ø©\n");
    }
    
    // Ù…Ø¹Ø§Ù…Ù„ Ø§Ù„Ø§Ø³ØªØ±Ø¯Ø§Ø¯
    if(stats.recoveryFactor > 0) {
        FileWriteString(fileHandle, "   ğŸ”„ Ù…Ø¹Ø§Ù…Ù„ Ø§Ù„Ø§Ø³ØªØ±Ø¯Ø§Ø¯: " + DoubleToString(stats.recoveryFactor, 2) + "\n");
        
        if(stats.recoveryFactor >= 3.0) {
            FileWriteString(fileHandle, "   âœ… Ù‚Ø¯Ø±Ø© ØªØ¹Ø§ÙÙŠ Ù…Ù…ØªØ§Ø²Ø©\n");
        } else if(stats.recoveryFactor >= 2.0) {
            FileWriteString(fileHandle, "   âœ… Ù‚Ø¯Ø±Ø© ØªØ¹Ø§ÙÙŠ Ø¬ÙŠØ¯Ø©\n");
        } else {
            FileWriteString(fileHandle, "   âš ï¸ Ù‚Ø¯Ø±Ø© ØªØ¹Ø§ÙÙŠ Ø¶Ø¹ÙŠÙØ©\n");
        }
    }
    
    FileWriteString(fileHandle, "\n");
}

//--- Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø¹Ø§Ø´Ø± ---
//+------------------------------------------------------------------+
//| Expert Advisor: Advanced Zigzag Analysis Bot - Part 11/15      |
//| Ù…Ø­Ù„Ù„ Ø¨ÙˆØª Ø§Ù„Ø²Ø¬Ø²Ø§Ø¬ Ø§Ù„Ø¹Ø¨Ù‚Ø±ÙŠ - Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø­Ø§Ø¯ÙŠ Ø¹Ø´Ø±: Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø«Ø§Ù„Ø«   |
//+------------------------------------------------------------------+

// ØªÙƒÙ…Ù„Ø© Ù„Ù„Ø£Ø¬Ø²Ø§Ø¡ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© - Ø¥Ù†Ø´Ø§Ø¡ ØªÙ‚Ø§Ø±ÙŠØ± ØªÙØµÙŠÙ„ÙŠØ© Ø¥Ø¶Ø§ÙÙŠØ© ÙˆÙ…Ø¤Ø´Ø±Ø§Øª Ù…ØªÙ‚Ø¯Ù…Ø©

//+------------------------------------------------------------------+
//| Ø¥Ù†Ø´Ø§Ø¡ ØªÙ‚Ø±ÙŠØ± ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„ØªÙ‚Ù†ÙŠ                                |
//+------------------------------------------------------------------+
void CreateTechnicalPerformanceReport(int fileHandle)
{
    FileWriteString(fileHandle, "âš™ï¸ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„ØªÙ‚Ù†ÙŠ:\n");
    FileWriteString(fileHandle, "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n");
    
    // ØªØ­Ù„ÙŠÙ„ Ø³Ø±Ø¹Ø© Ø§Ù„ØªÙ†ÙÙŠØ°
    CreateExecutionSpeedAnalysis(fileHandle);
    
    // ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø§Ù†Ø²Ù„Ø§Ù‚ ÙˆØ§Ù„Ø³Ø¨Ø±ÙŠØ¯
    CreateSlippageSpreadAnalysis(fileHandle);
    
    // ØªØ­Ù„ÙŠÙ„ Ø¬ÙˆØ¯Ø© Ø§Ù„ØªÙ†ÙÙŠØ°
    CreateExecutionQualityAnalysis(fileHandle);
    
    // ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„ØªÙ‚Ù†ÙŠØ©
    CreateTechnicalErrorAnalysis(fileHandle);
    
    FileWriteString(fileHandle, "\n");
}

//+------------------------------------------------------------------+
//| ØªØ­Ù„ÙŠÙ„ Ø³Ø±Ø¹Ø© Ø§Ù„ØªÙ†ÙÙŠØ°                                              |
//+------------------------------------------------------------------+
void CreateExecutionSpeedAnalysis(int fileHandle)
{
    FileWriteString(fileHandle, "âš¡ ØªØ­Ù„ÙŠÙ„ Ø³Ø±Ø¹Ø© Ø§Ù„ØªÙ†ÙÙŠØ°:\n");
    
    if(stats.executedOrders == 0) {
        FileWriteString(fileHandle, "   âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙÙ‚Ø§Øª Ù…Ù†ÙØ°Ø© Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø³Ø±Ø¹Ø©\n\n");
        return;
    }
    
    // Ø­Ø³Ø§Ø¨ Ù…ØªÙˆØ³Ø· ÙˆÙ‚Øª Ø§Ù„ØªÙ†ÙÙŠØ°
    int totalExecutionTime = 0;
    int validExecutionTimes = 0;
    int fastExecutions = 0; // Ø£Ù‚Ù„ Ù…Ù† Ø«Ø§Ù†ÙŠØ©
    int slowExecutions = 0; // Ø£ÙƒØ«Ø± Ù…Ù† 5 Ø«ÙˆØ§Ù†
    
    for(int i = 0; i < stats.totalOrders; i++) {
        if(orders[i].isExecuted && orders[i].executionDelay >= 0) {
            totalExecutionTime += orders[i].executionDelay;
            validExecutionTimes++;
            
            if(orders[i].executionDelay < 1) fastExecutions++;
            if(orders[i].executionDelay > 5) slowExecutions++;
        }
    }
    
    if(validExecutionTimes > 0) {
        double avgExecutionTime = (double)totalExecutionTime / validExecutionTimes;
        FileWriteString(fileHandle, "   â±ï¸ Ù…ØªÙˆØ³Ø· ÙˆÙ‚Øª Ø§Ù„ØªÙ†ÙÙŠØ°: " + DoubleToString(avgExecutionTime, 1) + " Ø«Ø§Ù†ÙŠØ©\n");
        
        double fastPercentage = CalculatePercentage(fastExecutions, validExecutionTimes);
        double slowPercentage = CalculatePercentage(slowExecutions, validExecutionTimes);
        
        FileWriteString(fileHandle, "   ğŸš€ ØªÙ†ÙÙŠØ° Ø³Ø±ÙŠØ¹ (<1 Ø«Ø§Ù†ÙŠØ©): " + IntegerToString(fastExecutions) + 
                       " (" + DoubleToString(fastPercentage, 1) + "%)\n");
        FileWriteString(fileHandle, "   ğŸŒ ØªÙ†ÙÙŠØ° Ø¨Ø·ÙŠØ¡ (>5 Ø«ÙˆØ§Ù†ÙŠ): " + IntegerToString(slowExecutions) + 
                       " (" + DoubleToString(slowPercentage, 1) + "%)\n");
        
        // ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø£Ø¯Ø§Ø¡
        if(avgExecutionTime < 1.0) {
            FileWriteString(fileHandle, "   âœ… Ø³Ø±Ø¹Ø© ØªÙ†ÙÙŠØ° Ù…Ù…ØªØ§Ø²Ø©\n");
        } else if(avgExecutionTime < 3.0) {
            FileWriteString(fileHandle, "   âœ… Ø³Ø±Ø¹Ø© ØªÙ†ÙÙŠØ° Ø¬ÙŠØ¯Ø©\n");
        } else if(avgExecutionTime < 5.0) {
            FileWriteString(fileHandle, "   âš ï¸ Ø³Ø±Ø¹Ø© ØªÙ†ÙÙŠØ° Ù…Ù‚Ø¨ÙˆÙ„Ø©\n");
        } else {
            FileWriteString(fileHandle, "   ğŸš¨ Ø³Ø±Ø¹Ø© ØªÙ†ÙÙŠØ° Ø¨Ø·ÙŠØ¦Ø© - ÙØ­Øµ Ø§Ù„Ø§ØªØµØ§Ù„ ÙˆØ§Ù„ÙˆØ³ÙŠØ·\n");
        }
    } else {
        FileWriteString(fileHandle, "   âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª ÙƒØ§ÙÙŠØ© Ù„ØªØ­Ù„ÙŠÙ„ Ø³Ø±Ø¹Ø© Ø§Ù„ØªÙ†ÙÙŠØ°\n");
    }
    
    FileWriteString(fileHandle, "\n");
}

//+------------------------------------------------------------------+
//| ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø§Ù†Ø²Ù„Ø§Ù‚ ÙˆØ§Ù„Ø³Ø¨Ø±ÙŠØ¯ Ø§Ù„ØªÙØµÙŠÙ„ÙŠ                              |
//+------------------------------------------------------------------+
void CreateSlippageSpreadAnalysis(int fileHandle)
{
    FileWriteString(fileHandle, "ğŸ“Š ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø§Ù†Ø²Ù„Ø§Ù‚ ÙˆØ§Ù„Ø³Ø¨Ø±ÙŠØ¯:\n");
    
    if(stats.executedOrders == 0) {
        FileWriteString(fileHandle, "   âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙÙ‚Ø§Øª Ù…Ù†ÙØ°Ø© Ù„Ù„ØªØ­Ù„ÙŠÙ„\n\n");
        return;
    }
    
    // Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø³Ø¨Ø±ÙŠØ¯
    if(stats.avgSpread > 0) {
        double avgSpreadPips = stats.avgSpread * 10000;
        double maxSpreadPips = stats.maxSpread * 10000;
        
        FileWriteString(fileHandle, "   ğŸ“ˆ Ø§Ù„Ø³Ø¨Ø±ÙŠØ¯:\n");
        FileWriteString(fileHandle, "      Ù…ØªÙˆØ³Ø· Ø§Ù„Ø³Ø¨Ø±ÙŠØ¯: " + DoubleToString(avgSpreadPips, 1) + " Ù†Ù‚Ø·Ø©\n");
        FileWriteString(fileHandle, "      Ø£Ø¹Ù„Ù‰ Ø³Ø¨Ø±ÙŠØ¯: " + DoubleToString(maxSpreadPips, 1) + " Ù†Ù‚Ø·Ø©\n");
        
        // ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø³Ø¨Ø±ÙŠØ¯
        if(avgSpreadPips < 1.0) {
            FileWriteString(fileHandle, "      âœ… Ø³Ø¨Ø±ÙŠØ¯ Ù…Ù…ØªØ§Ø² (Ù…Ù†Ø®ÙØ¶ Ø¬Ø¯Ø§Ù‹)\n");
        } else if(avgSpreadPips < 2.0) {
            FileWriteString(fileHandle, "      âœ… Ø³Ø¨Ø±ÙŠØ¯ Ø¬ÙŠØ¯\n");
        } else if(avgSpreadPips < 3.0) {
            FileWriteString(fileHandle, "      âš ï¸ Ø³Ø¨Ø±ÙŠØ¯ Ù…Ù‚Ø¨ÙˆÙ„\n");
        } else {
            FileWriteString(fileHandle, "      ğŸš¨ Ø³Ø¨Ø±ÙŠØ¯ Ø¹Ø§Ù„ÙŠ - ÙØ­Øµ Ø§Ù„ÙˆØ³ÙŠØ· Ø£Ùˆ ØªØºÙŠÙŠØ± Ø§Ù„Ø£ÙˆÙ‚Ø§Øª\n");
        }
    }
    
    // Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø§Ù†Ø²Ù„Ø§Ù‚
    if(stats.avgSlippage > 0) {
        FileWriteString(fileHandle, "   ğŸ“‰ Ø§Ù„Ø§Ù†Ø²Ù„Ø§Ù‚:\n");
        FileWriteString(fileHandle, "      Ù…ØªÙˆØ³Ø· Ø§Ù„Ø§Ù†Ø²Ù„Ø§Ù‚: " + DoubleToString(stats.avgSlippage, 1) + " Ù†Ù‚Ø·Ø©\n");
        FileWriteString(fileHandle, "      Ø£Ø¹Ù„Ù‰ Ø§Ù†Ø²Ù„Ø§Ù‚: " + DoubleToString(stats.maxSlippage, 1) + " Ù†Ù‚Ø·Ø©\n");
        
        // ØªØ­Ù„ÙŠÙ„ Ù†Ø³Ø¨Ø© Ø§Ù„Ø§Ù†Ø²Ù„Ø§Ù‚ Ù„Ù„Ø³Ø¨Ø±ÙŠØ¯
        if(stats.avgSpread > 0) {
            double slippageToSpreadRatio = stats.avgSlippage / (stats.avgSpread * 10000);
            FileWriteString(fileHandle, "      Ù†Ø³Ø¨Ø© Ø§Ù„Ø§Ù†Ø²Ù„Ø§Ù‚/Ø§Ù„Ø³Ø¨Ø±ÙŠØ¯: " + DoubleToString(slippageToSpreadRatio, 1) + "x\n");
            
            if(slippageToSpreadRatio < 1.0) {
                FileWriteString(fileHandle, "      âœ… Ø§Ù†Ø²Ù„Ø§Ù‚ Ù…Ù†Ø®ÙØ¶ Ù†Ø³Ø¨ÙŠØ§Ù‹\n");
            } else if(slippageToSpreadRatio < 2.0) {
                FileWriteString(fileHandle, "      âš ï¸ Ø§Ù†Ø²Ù„Ø§Ù‚ Ù…ØªÙˆØ³Ø·\n");
            } else {
                FileWriteString(fileHandle, "      ğŸš¨ Ø§Ù†Ø²Ù„Ø§Ù‚ Ø¹Ø§Ù„ÙŠ - Ù…Ø±Ø§Ø¬Ø¹Ø© Ù†ÙˆØ¹ Ø§Ù„Ø£ÙˆØ§Ù…Ø±\n");
            }
        }
        
        // ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø§Ù†Ø²Ù„Ø§Ù‚
        if(stats.avgSlippage < 1.0) {
            FileWriteString(fileHandle, "      âœ… Ø§Ù†Ø²Ù„Ø§Ù‚ Ù…Ù…ØªØ§Ø²\n");
        } else if(stats.avgSlippage < 2.0) {
            FileWriteString(fileHandle, "      âœ… Ø§Ù†Ø²Ù„Ø§Ù‚ Ø¬ÙŠØ¯\n");
        } else if(stats.avgSlippage < 3.0) {
            FileWriteString(fileHandle, "      âš ï¸ Ø§Ù†Ø²Ù„Ø§Ù‚ Ù…Ù‚Ø¨ÙˆÙ„\n");
        } else {
            FileWriteString(fileHandle, "      ğŸš¨ Ø§Ù†Ø²Ù„Ø§Ù‚ Ø¹Ø§Ù„ÙŠ - Ø§Ø³ØªØ®Ø¯Ù… Ø£ÙˆØ§Ù…Ø± Ù…Ø­Ø¯ÙˆØ¯Ø©\n");
        }
    }
    
    FileWriteString(fileHandle, "\n");
}

//+------------------------------------------------------------------+
//| ØªØ­Ù„ÙŠÙ„ Ø¬ÙˆØ¯Ø© Ø§Ù„ØªÙ†ÙÙŠØ°                                              |
//+------------------------------------------------------------------+
void CreateExecutionQualityAnalysis(int fileHandle)
{
    FileWriteString(fileHandle, "ğŸ¯ ØªØ­Ù„ÙŠÙ„ Ø¬ÙˆØ¯Ø© Ø§Ù„ØªÙ†ÙÙŠØ°:\n");
    
    double executionRate = CalculatePercentage(stats.executedOrders, stats.totalOrders);
    FileWriteString(fileHandle, "   ğŸ“Š Ù…Ø¹Ø¯Ù„ Ø§Ù„ØªÙ†ÙÙŠØ° Ø§Ù„Ø¹Ø§Ù…: " + DoubleToString(executionRate, 1) + "%\n");
    
    // ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„ØªÙŠ ÙˆØµÙ„ Ù„Ù‡Ø§ Ø§Ù„Ø³Ø¹Ø± ÙˆÙ„Ù… ØªÙ†ÙØ°
    if(stats.priceReachedButNotExecuted > 0) {
        double problematicRate = CalculatePercentage(stats.priceReachedButNotExecuted, stats.totalOrders);
        FileWriteString(fileHandle, "   ğŸš¨ Ø£ÙˆØ§Ù…Ø± ÙˆØµÙ„ Ù„Ù‡Ø§ Ø§Ù„Ø³Ø¹Ø± ÙˆÙ„Ù… ØªÙ†ÙØ°: " + IntegerToString(stats.priceReachedButNotExecuted) + 
                       " (" + DoubleToString(problematicRate, 1) + "%)\n");
        
        if(problematicRate > 10.0) {
            FileWriteString(fileHandle, "   âš ï¸ Ù…Ø´ÙƒÙ„Ø© Ø®Ø·ÙŠØ±Ø© ÙÙŠ Ø¬ÙˆØ¯Ø© Ø§Ù„ØªÙ†ÙÙŠØ° - ÙØ­Øµ Ø§Ù„ÙˆØ³ÙŠØ·\n");
        } else if(problematicRate > 5.0) {
            FileWriteString(fileHandle, "   âš ï¸ Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø¬ÙˆØ¯Ø© Ø§Ù„ØªÙ†ÙÙŠØ° - Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª\n");
        }
    }
    
    // ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ø¬Ø²Ø¦ÙŠØ©
    if(stats.partiallyFilled > 0) {
        double partialRate = CalculatePercentage(stats.partiallyFilled, stats.executedOrders);
        FileWriteString(fileHandle, "   âš¡ Ø£ÙˆØ§Ù…Ø± Ù…Ù†ÙØ°Ø© Ø¬Ø²Ø¦ÙŠØ§Ù‹: " + IntegerToString(stats.partiallyFilled) + 
                       " (" + DoubleToString(partialRate, 1) + "%)\n");
        
        if(partialRate > 15.0) {
            FileWriteString(fileHandle, "   âš ï¸ Ù†Ø³Ø¨Ø© Ø¹Ø§Ù„ÙŠØ© Ù…Ù† Ø§Ù„ØªÙ†ÙÙŠØ° Ø§Ù„Ø¬Ø²Ø¦ÙŠ - Ù…Ø±Ø§Ø¬Ø¹Ø© Ø£Ø­Ø¬Ø§Ù… Ø§Ù„ØµÙÙ‚Ø§Øª\n");
        }
    }
    
    // ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ù…Ø±ÙÙˆØ¶Ø©
    if(stats.pendingRejected > 0) {
        double rejectionRate = CalculatePercentage(stats.pendingRejected, stats.totalOrders);
        FileWriteString(fileHandle, "   ğŸš« Ø£ÙˆØ§Ù…Ø± Ù…Ø±ÙÙˆØ¶Ø©: " + IntegerToString(stats.pendingRejected) + 
                       " (" + DoubleToString(rejectionRate, 1) + "%)\n");
        
        if(rejectionRate > 5.0) {
            FileWriteString(fileHandle, "   ğŸš¨ Ù†Ø³Ø¨Ø© Ø±ÙØ¶ Ø¹Ø§Ù„ÙŠØ© - ÙØ­Øµ Ø§Ù„Ù‡Ø§Ù…Ø´ ÙˆØ¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨\n");
        }
    }
    
    // ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø¬ÙˆØ¯Ø© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©
    double qualityScore = executionRate;
    if(stats.priceReachedButNotExecuted > 0) {
        qualityScore -= CalculatePercentage(stats.priceReachedButNotExecuted, stats.totalOrders) * 2; // Ø¹Ù‚ÙˆØ¨Ø© Ù…Ø¶Ø§Ø¹ÙØ©
    }
    
    FileWriteString(fileHandle, "   ğŸ“ˆ Ù†Ù‚Ø§Ø· Ø¬ÙˆØ¯Ø© Ø§Ù„ØªÙ†ÙÙŠØ°: " + DoubleToString(qualityScore, 1) + "/100\n");
    
    if(qualityScore >= 90) {
        FileWriteString(fileHandle, "   ğŸŒŸ Ø¬ÙˆØ¯Ø© ØªÙ†ÙÙŠØ° Ù…Ù…ØªØ§Ø²Ø©\n");
    } else if(qualityScore >= 80) {
        FileWriteString(fileHandle, "   âœ… Ø¬ÙˆØ¯Ø© ØªÙ†ÙÙŠØ° Ø¬ÙŠØ¯Ø©\n");
    } else if(qualityScore >= 70) {
        FileWriteString(fileHandle, "   âš ï¸ Ø¬ÙˆØ¯Ø© ØªÙ†ÙÙŠØ° Ù…Ù‚Ø¨ÙˆÙ„Ø©\n");
    } else {
        FileWriteString(fileHandle, "   ğŸš¨ Ø¬ÙˆØ¯Ø© ØªÙ†ÙÙŠØ° Ø¶Ø¹ÙŠÙØ© - ØªØ­ØªØ§Ø¬ ØªØ­Ø³ÙŠÙ† Ø¹Ø§Ø¬Ù„\n");
    }
    
    FileWriteString(fileHandle, "\n");
}

//+------------------------------------------------------------------+
//| ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„ØªÙ‚Ù†ÙŠØ©                                          |
//+------------------------------------------------------------------+
void CreateTechnicalErrorAnalysis(int fileHandle)
{
    FileWriteString(fileHandle, "ğŸ”§ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„ØªÙ‚Ù†ÙŠØ©:\n");
    
    // Ø­Ø³Ø§Ø¨ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡
    int connectionErrors = 0;
    int serverErrors = 0;
    int accountErrors = 0;
    int unknownErrors = 0;
    
    for(int i = 0; i < stats.totalOrders; i++) {
        if(!orders[i].isExecuted) {
            string reason = orders[i].failureReason;
            
            if(StringFind(reason, "Ø±ÙØ¶ Ø§Ù„ÙˆØ³ÙŠØ·", 0) >= 0 || StringFind(reason, "Ù…Ø±ÙÙˆØ¶", 0) >= 0) {
                serverErrors++;
            } else if(StringFind(reason, "Ù‡Ø§Ù…Ø´", 0) >= 0 || StringFind(reason, "Ø±ØµÙŠØ¯", 0) >= 0) {
                accountErrors++;
            } else if(StringFind(reason, "Ø§ØªØµØ§Ù„", 0) >= 0 || StringFind(reason, "Ø´Ø¨ÙƒØ©", 0) >= 0) {
                connectionErrors++;
            } else if(orders[i].state == ORDER_STATE_REJECTED) {
                unknownErrors++;
            }
        }
    }
    
    int totalErrors = connectionErrors + serverErrors + accountErrors + unknownErrors;
    
    if(totalErrors == 0) {
        FileWriteString(fileHandle, "   âœ… Ù„Ù… ÙŠØªÙ… Ø±ØµØ¯ Ø£Ø®Ø·Ø§Ø¡ ØªÙ‚Ù†ÙŠØ© ÙˆØ§Ø¶Ø­Ø©\n");
    } else {
        FileWriteString(fileHandle, "   ğŸ“Š Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„ØªÙ‚Ù†ÙŠØ©: " + IntegerToString(totalErrors) + "\n");
        
        if(serverErrors > 0) {
            FileWriteString(fileHandle, "   ğŸ¢ Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„Ø®Ø§Ø¯Ù…/Ø§Ù„ÙˆØ³ÙŠØ·: " + IntegerToString(serverErrors) + "\n");
        }
        if(accountErrors > 0) {
            FileWriteString(fileHandle, "   ğŸ’° Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨/Ø§Ù„Ù‡Ø§Ù…Ø´: " + IntegerToString(accountErrors) + "\n");
        }
        if(connectionErrors > 0) {
            FileWriteString(fileHandle, "   ğŸŒ Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„Ø§ØªØµØ§Ù„: " + IntegerToString(connectionErrors) + "\n");
        }
        if(unknownErrors > 0) {
            FileWriteString(fileHandle, "   â“ Ø£Ø®Ø·Ø§Ø¡ ØºÙŠØ± Ù…Ø­Ø¯Ø¯Ø©: " + IntegerToString(unknownErrors) + "\n");
        }
        
        // ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„Ø£ÙƒØ«Ø± Ø´ÙŠÙˆØ¹Ø§Ù‹
        int maxErrors = MathMax(MathMax(serverErrors, accountErrors), MathMax(connectionErrors, unknownErrors));
        if(maxErrors == serverErrors && serverErrors > totalErrors * 0.5) {
            FileWriteString(fileHandle, "   ğŸ’¡ Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„Ø®Ø§Ø¯Ù… Ù‡ÙŠ Ø§Ù„Ø£ÙƒØ«Ø± - ÙØ­Øµ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ÙˆØ³ÙŠØ·\n");
        } else if(maxErrors == accountErrors && accountErrors > totalErrors * 0.5) {
            FileWriteString(fileHandle, "   ğŸ’¡ Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ Ù‡ÙŠ Ø§Ù„Ø£ÙƒØ«Ø± - ÙØ­Øµ Ø§Ù„Ù‡Ø§Ù…Ø´ Ø§Ù„Ù…ØªØ§Ø­\n");
        } else if(maxErrors == connectionErrors && connectionErrors > totalErrors * 0.5) {
            FileWriteString(fileHandle, "   ğŸ’¡ Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„Ø§ØªØµØ§Ù„ Ù‡ÙŠ Ø§Ù„Ø£ÙƒØ«Ø± - ÙØ­Øµ Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª Ùˆ VPS\n");
        }
    }
    
    FileWriteString(fileHandle, "\n");
}

//+------------------------------------------------------------------+
//| Ø¥Ù†Ø´Ø§Ø¡ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ù‚Ø§ÙŠÙŠØ³ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©                                  |
//+------------------------------------------------------------------+
void CreateAdvancedMetricsReport(int fileHandle)
{
    FileWriteString(fileHandle, "ğŸ“ˆ Ø§Ù„Ù…Ù‚Ø§ÙŠÙŠØ³ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©:\n");
    FileWriteString(fileHandle, "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n");
    
    // Ù…Ù‚Ø§ÙŠÙŠØ³ Ø§Ù„ÙƒÙØ§Ø¡Ø©
    CreateEfficiencyMetrics(fileHandle);
    
    // Ù…Ù‚Ø§ÙŠÙŠØ³ Ø§Ù„Ø§Ø³ØªÙ‚Ø±Ø§Ø±
    CreateStabilityMetrics(fileHandle);
    
    // Ù…Ù‚Ø§ÙŠÙŠØ³ Ø§Ù„ØªØ­Ø³Ù†
    CreateImprovementMetrics(fileHandle);
    
    FileWriteString(fileHandle, "\n");
}

//+------------------------------------------------------------------+
//| Ù…Ù‚Ø§ÙŠÙŠØ³ Ø§Ù„ÙƒÙØ§Ø¡Ø©                                                 |
//+------------------------------------------------------------------+
void CreateEfficiencyMetrics(int fileHandle)
{
    FileWriteString(fileHandle, "âš¡ Ù…Ù‚Ø§ÙŠÙŠØ³ Ø§Ù„ÙƒÙØ§Ø¡Ø©:\n");
    
    if(stats.executedOrders == 0) {
        FileWriteString(fileHandle, "   âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙÙ‚Ø§Øª Ù…Ù†ÙØ°Ø© Ù„Ø­Ø³Ø§Ø¨ Ù…Ù‚Ø§ÙŠÙŠØ³ Ø§Ù„ÙƒÙØ§Ø¡Ø©\n\n");
        return;
    }
    
    // ÙƒÙØ§Ø¡Ø© Ø§Ù„ØªÙ†ÙÙŠØ°
    double executionEfficiency = CalculatePercentage(stats.executedOrders, stats.totalOrders);
    FileWriteString(fileHandle, "   ğŸ“Š ÙƒÙØ§Ø¡Ø© Ø§Ù„ØªÙ†ÙÙŠØ°: " + DoubleToString(executionEfficiency, 1) + "%\n");
    
    // ÙƒÙØ§Ø¡Ø© Ø§Ù„Ø±Ø¨Ø­ (Ø§Ù„ØµÙÙ‚Ø§Øª Ø§Ù„Ø±Ø§Ø¨Ø­Ø© Ù…Ù† Ø§Ù„Ù…Ù†ÙØ°Ø©)
    double profitEfficiency = CalculatePercentage(stats.executedWins, stats.executedOrders);
    FileWriteString(fileHandle, "   ğŸ’° ÙƒÙØ§Ø¡Ø© Ø§Ù„Ø±Ø¨Ø­: " + DoubleToString(profitEfficiency, 1) + "%\n");
    
    // ÙƒÙØ§Ø¡Ø© Ø±Ø£Ø³ Ø§Ù„Ù…Ø§Ù„ (Ø§Ù„Ø±Ø¨Ø­ Ù„ÙƒÙ„ ÙˆØ­Ø¯Ø© Ù…Ø®Ø§Ø·Ø±Ø©)
    if(stats.avgLoss > 0) {
        double capitalEfficiency = stats.avgWin / stats.avgLoss;
        FileWriteString(fileHandle, "   ğŸ’¼ ÙƒÙØ§Ø¡Ø© Ø±Ø£Ø³ Ø§Ù„Ù…Ø§Ù„: " + DoubleToString(capitalEfficiency, 2) + "\n");
    }
    
    // ÙƒÙØ§Ø¡Ø© Ø§Ù„ÙˆÙ‚Øª (Ø§Ù„Ø±Ø¨Ø­ Ù„ÙƒÙ„ ÙˆØ­Ø¯Ø© Ø²Ù…Ù†ÙŠØ©)
    double avgHoldingTime = 0;
    int validTimes = 0;
    for(int i = 0; i < stats.totalOrders; i++) {
        if(orders[i].isExecuted && orders[i].holdingTimeMinutes > 0) {
            avgHoldingTime += orders[i].holdingTimeMinutes;
            validTimes++;
        }
    }
    
    if(validTimes > 0 && stats.totalProfit != 0) {
        avgHoldingTime /= validTimes;
        double timeEfficiency = stats.totalProfit / (avgHoldingTime / 60.0); // Ø±Ø¨Ø­ Ù„ÙƒÙ„ Ø³Ø§Ø¹Ø©
        FileWriteString(fileHandle, "   â° ÙƒÙØ§Ø¡Ø© Ø§Ù„ÙˆÙ‚Øª: " + DoubleToString(timeEfficiency, 2) + "$/Ø³Ø§Ø¹Ø©\n");
    }
    
    // Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ© Ù„Ù„ÙƒÙØ§Ø¡Ø©
    double efficiencyScore = (executionEfficiency + profitEfficiency + (stats.profitFactor * 20)) / 3;
    FileWriteString(fileHandle, "   ğŸ¯ Ù†Ù‚Ø§Ø· Ø§Ù„ÙƒÙØ§Ø¡Ø© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©: " + DoubleToString(efficiencyScore, 1) + "/100\n");
    
    FileWriteString(fileHandle, "\n");
}

//+------------------------------------------------------------------+
//| Ù…Ù‚Ø§ÙŠÙŠØ³ Ø§Ù„Ø§Ø³ØªÙ‚Ø±Ø§Ø±                                               |
//+------------------------------------------------------------------+
void CreateStabilityMetrics(int fileHandle)
{
    FileWriteString(fileHandle, "ğŸ›¡ï¸ Ù…Ù‚Ø§ÙŠÙŠØ³ Ø§Ù„Ø§Ø³ØªÙ‚Ø±Ø§Ø±:\n");
    
    if(stats.executedOrders < 5) {
        FileWriteString(fileHandle, "   âš ï¸ Ø¹Ø¯Ø¯ ØµÙÙ‚Ø§Øª Ù‚Ù„ÙŠÙ„ Ù„Ø­Ø³Ø§Ø¨ Ù…Ù‚Ø§ÙŠÙŠØ³ Ø§Ù„Ø§Ø³ØªÙ‚Ø±Ø§Ø±\n\n");
        return;
    }
    
    // Ø§Ø³ØªÙ‚Ø±Ø§Ø± Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ (Ø§Ù†Ø­Ø±Ø§Ù Ù…Ø¹ÙŠØ§Ø±ÙŠ Ù„Ù„Ø£Ø±Ø¨Ø§Ø­)
    double profitStability = CalculateReturnStandardDeviation();
    if(profitStability > 0) {
        FileWriteString(fileHandle, "   ğŸ“Š Ø§Ø³ØªÙ‚Ø±Ø§Ø± Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ (Ø§Ù†Ø­Ø±Ø§Ù Ù…Ø¹ÙŠØ§Ø±ÙŠ): " + DoubleToString(profitStability, 2) + "\n");
        
        if(profitStability < stats.avgWin * 0.5) {
            FileWriteString(fileHandle, "   âœ… Ø£Ø±Ø¨Ø§Ø­ Ù…Ø³ØªÙ‚Ø±Ø©\n");
        } else if(profitStability < stats.avgWin) {
            FileWriteString(fileHandle, "   âš ï¸ Ø£Ø±Ø¨Ø§Ø­ Ù…ØªÙ‚Ù„Ø¨Ø© Ù‚Ù„ÙŠÙ„Ø§Ù‹\n");
        } else {
            FileWriteString(fileHandle, "   ğŸš¨ Ø£Ø±Ø¨Ø§Ø­ Ù…ØªÙ‚Ù„Ø¨Ø© Ø¬Ø¯Ø§Ù‹\n");
        }
    }
    
    // Ø§Ø³ØªÙ‚Ø±Ø§Ø± Ø§Ù„Ø§Ù†Ø²Ù„Ø§Ù‚
    if(stats.maxSlippage > 0 && stats.avgSlippage > 0) {
        double slippageStability = stats.maxSlippage / stats.avgSlippage;
        FileWriteString(fileHandle, "   ğŸ“‰ Ø§Ø³ØªÙ‚Ø±Ø§Ø± Ø§Ù„Ø§Ù†Ø²Ù„Ø§Ù‚: " + DoubleToString(slippageStability, 1) + "x\n");
        
        if(slippageStability < 2.0) {
            FileWriteString(fileHandle, "   âœ… Ø§Ù†Ø²Ù„Ø§Ù‚ Ù…Ø³ØªÙ‚Ø±\n");
        } else if(slippageStability < 3.0) {
            FileWriteString(fileHandle, "   âš ï¸ Ø§Ù†Ø²Ù„Ø§Ù‚ Ù…ØªÙ‚Ù„Ø¨ Ù‚Ù„ÙŠÙ„Ø§Ù‹\n");
        } else {
            FileWriteString(fileHandle, "   ğŸš¨ Ø§Ù†Ø²Ù„Ø§Ù‚ Ù…ØªÙ‚Ù„Ø¨ Ø¬Ø¯Ø§Ù‹\n");
        }
    }
    
    // Ø§Ø³ØªÙ‚Ø±Ø§Ø± Ù…Ø¹Ø¯Ù„ Ø§Ù„ØªÙ†ÙÙŠØ° (Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø²Ù…Ù†ÙŠ)
    double executionStability = CalculateExecutionStability();
    if(executionStability >= 0) {
        FileWriteString(fileHandle, "   âš¡ Ø§Ø³ØªÙ‚Ø±Ø§Ø± Ø§Ù„ØªÙ†ÙÙŠØ°: " + DoubleToString(executionStability, 1) + "%\n");
        
        if(executionStability > 90) {
            FileWriteString(fileHandle, "   âœ… ØªÙ†ÙÙŠØ° Ù…Ø³ØªÙ‚Ø± Ø¬Ø¯Ø§Ù‹\n");
        } else if(executionStability > 80) {
            FileWriteString(fileHandle, "   âœ… ØªÙ†ÙÙŠØ° Ù…Ø³ØªÙ‚Ø±\n");
        } else {
            FileWriteString(fileHandle, "   âš ï¸ ØªÙ†ÙÙŠØ° ØºÙŠØ± Ù…Ø³ØªÙ‚Ø±\n");
        }
    }
    
    FileWriteString(fileHandle, "\n");
}

//+------------------------------------------------------------------+
//| Ø­Ø³Ø§Ø¨ Ø§Ø³ØªÙ‚Ø±Ø§Ø± Ø§Ù„ØªÙ†ÙÙŠØ°                                           |
//+------------------------------------------------------------------+
double CalculateExecutionStability()
{
    if(stats.totalOrders < 10) return -1; // Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± ÙƒØ§ÙÙŠØ©
    
    // ØªÙ‚Ø³ÙŠÙ… Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø¥Ù„Ù‰ Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø²Ù…Ù†ÙŠØ© ÙˆØ­Ø³Ø§Ø¨ Ù…Ø¹Ø¯Ù„ Ø§Ù„ØªÙ†ÙÙŠØ° Ù„ÙƒÙ„ Ù…Ø¬Ù…ÙˆØ¹Ø©
    int groupSize = stats.totalOrders / 5; // 5 Ù…Ø¬Ù…ÙˆØ¹Ø§Øª
    if(groupSize < 2) return -1;
    
    double executionRates[5];
    int groupIndex = 0;
    
    for(int group = 0; group < 5; group++) {
        int startIndex = group * groupSize;
        int endIndex = (group == 4) ? stats.totalOrders : (group + 1) * groupSize;
        int groupExecuted = 0;
        int groupTotal = endIndex - startIndex;
        
        for(int i = startIndex; i < endIndex; i++) {
            if(orders[i].isExecuted) groupExecuted++;
        }
        
        executionRates[group] = CalculatePercentage(groupExecuted, groupTotal);
    }
    
    // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø§Ù†Ø­Ø±Ø§Ù Ø§Ù„Ù…Ø¹ÙŠØ§Ø±ÙŠ Ù„Ù…Ø¹Ø¯Ù„Ø§Øª Ø§Ù„ØªÙ†ÙÙŠØ°
    double avgRate = 0;
    for(int i = 0; i < 5; i++) {
        avgRate += executionRates[i];
    }
    avgRate /= 5;
    
    double variance = 0;
    for(int i = 0; i < 5; i++) {
        variance += MathPow(executionRates[i] - avgRate, 2);
    }
    variance /= 5;
    
    double stability = 100 - MathSqrt(variance); // ÙƒÙ„Ù…Ø§ Ù‚Ù„ Ø§Ù„Ø§Ù†Ø­Ø±Ø§ÙØŒ Ø²Ø§Ø¯ Ø§Ù„Ø§Ø³ØªÙ‚Ø±Ø§Ø±
    return MathMax(0, stability);
}

//+------------------------------------------------------------------+
//| Ù…Ù‚Ø§ÙŠÙŠØ³ Ø§Ù„ØªØ­Ø³Ù†                                                  |
//+------------------------------------------------------------------+
void CreateImprovementMetrics(int fileHandle)
{
    FileWriteString(fileHandle, "ğŸ“ˆ Ù…Ù‚Ø§ÙŠÙŠØ³ Ø§Ù„ØªØ­Ø³Ù† Ø§Ù„Ù…Ø­ØªÙ…Ù„Ø©:\n");
    
    // Ø¥Ù…ÙƒØ§Ù†ÙŠØ© ØªØ­Ø³ÙŠÙ† Ù…Ø¹Ø¯Ù„ Ø§Ù„ØªÙ†ÙÙŠØ°
    double currentExecutionRate = CalculatePercentage(stats.executedOrders, stats.totalOrders);
    double potentialImprovement = 0;
    
    if(stats.priceReachedButNotExecuted > 0) {
        potentialImprovement = CalculatePercentage(stats.priceReachedButNotExecuted, stats.totalOrders);
        FileWriteString(fileHandle, "   ğŸ“Š ØªØ­Ø³Ù† Ù…Ø­ØªÙ…Ù„ ÙÙŠ Ø§Ù„ØªÙ†ÙÙŠØ°: +" + DoubleToString(potentialImprovement, 1) + "%\n");
        FileWriteString(fileHandle, "   ğŸ¯ Ù…Ø¹Ø¯Ù„ ØªÙ†ÙÙŠØ° Ù…Ø­ØªÙ…Ù„: " + DoubleToString(currentExecutionRate + potentialImprovement, 1) + "%\n");
    }
    
    // Ø¥Ù…ÙƒØ§Ù†ÙŠØ© ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø±Ø¨Ø­ÙŠØ©
    if(stats.almostTPFailures > 0 && stats.executedLosses > 0) {
        double profitabilityImprovement = CalculatePercentage(stats.almostTPFailures, stats.executedOrders);
        FileWriteString(fileHandle, "   ğŸ’° ØªØ­Ø³Ù† Ù…Ø­ØªÙ…Ù„ ÙÙŠ Ø§Ù„Ø±Ø¨Ø­ÙŠØ©: +" + DoubleToString(profitabilityImprovement, 1) + "%\n");
        FileWriteString(fileHandle, "   ğŸ¯ Ù…Ø¹Ø¯Ù„ Ø±Ø¨Ø­ Ù…Ø­ØªÙ…Ù„: " + DoubleToString(stats.winRate + profitabilityImprovement, 1) + "%\n");
    }
    
    // Ø¥Ù…ÙƒØ§Ù†ÙŠØ© ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ø®Ø³Ø§Ø¦Ø±
    if(stats.wrongDirectionFailures > 0) {
        double lossReduction = CalculatePercentage(stats.wrongDirectionFailures, stats.executedOrders);
        FileWriteString(fileHandle, "   ğŸ“‰ ØªÙ‚Ù„ÙŠÙ„ Ù…Ø­ØªÙ…Ù„ Ù„Ù„Ø®Ø³Ø§Ø¦Ø±: -" + DoubleToString(lossReduction, 1) + "%\n");
    }
    
    // ØªÙ‚Ø¯ÙŠØ± Ø§Ù„ØªØ­Ø³Ù† ÙÙŠ Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ
    if(stats.executedOrders > 0 && potentialImprovement > 0) {
        double potentialProfit = stats.totalProfit * (1 + potentialImprovement / 100);
        double profitIncrease = potentialProfit - stats.totalProfit;
        FileWriteString(fileHandle, "   ğŸ’µ Ø²ÙŠØ§Ø¯Ø© Ù…Ø­ØªÙ…Ù„Ø© ÙÙŠ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­: +" + DoubleToString(profitIncrease, 2) + "$\n");
    }
    
    FileWriteString(fileHandle, "\n");
}

//--- Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø­Ø§Ø¯ÙŠ Ø¹Ø´Ø± ---                |

//+------------------------------------------------------------------+
//| Expert Advisor: Advanced Zigzag Analysis Bot - Part 12/15      |
//| Ù…Ø­Ù„Ù„ Ø¨ÙˆØª Ø§Ù„Ø²Ø¬Ø²Ø§Ø¬ Ø§Ù„Ø¹Ø¨Ù‚Ø±ÙŠ - Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø¹Ø´Ø±: Ø§Ù„Ø­ÙØ¸ ÙÙŠ Ø§Ù„Ù…Ù„ÙØ§Øª  |
//+------------------------------------------------------------------+

// ØªÙƒÙ…Ù„Ø© Ù„Ù„Ø£Ø¬Ø²Ø§Ø¡ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© - Ø¯ÙˆØ§Ù„ Ø§Ù„Ø­ÙØ¸ ÙÙŠ Ø§Ù„Ù…Ù„ÙØ§Øª ÙˆØ¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±

//+------------------------------------------------------------------+
//| Ø­ÙØ¸ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…ØªÙ‚Ø¯Ù… Ø§Ù„ÙƒØ§Ù…Ù„ ÙÙŠ Ù…Ù„Ù                             |
//+------------------------------------------------------------------+
void SaveAdvancedReportToFile()
{
    Print("\nğŸ’¾ Ø¬Ø§Ø±ÙŠ Ø­ÙØ¸ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…ØªÙ‚Ø¯Ù… Ø§Ù„Ø´Ø§Ù…Ù„...");
    
    // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ø³Ù… Ù…Ù„Ù Ù…ÙØµÙ„ Ù…Ø¹ Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª
    MqlDateTime dt;
    TimeToStruct(TimeCurrent(), dt);
    
    string fileName = StringFormat("%s_Complete_%04d%02d%02d_%02d%02d.txt", 
                     ReportFileName, 
                     dt.year, dt.mon, dt.day, 
                     dt.hour, dt.min);
    
    // Ù…Ø­Ø§ÙˆÙ„Ø© ÙØªØ­ Ø§Ù„Ù…Ù„Ù Ø¨ØªØ±Ù…ÙŠØ² UTF-8 Ø£ÙˆÙ„Ø§Ù‹
    int fileHandle = FileOpen(fileName, FILE_WRITE|FILE_TXT|FILE_UNICODE);
    
    if(fileHandle == INVALID_HANDLE) {
        Print("âŒ ÙØ´Ù„ ÙÙŠ ÙØªØ­ Ø§Ù„Ù…Ù„Ù Ø¨Ù€ UNICODEØŒ Ù…Ø­Ø§ÙˆÙ„Ø© Ø¨Ù€ ANSI...");
        
        // Ù…Ø­Ø§ÙˆÙ„Ø© Ø«Ø§Ù†ÙŠØ© Ø¨ØªØ±Ù…ÙŠØ² ANSI
        string fallbackFileName = StringFormat("ZigzagReport_%04d%02d%02d_%02d%02d.txt", 
                                 dt.year, dt.mon, dt.day, dt.hour, dt.min);
        fileHandle = FileOpen(fallbackFileName, FILE_WRITE|FILE_TXT|FILE_ANSI);
        
        if(fileHandle != INVALID_HANDLE) {
            fileName = fallbackFileName;
        }
    }
    
    if(fileHandle != INVALID_HANDLE) {
        // ÙƒØªØ§Ø¨Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙƒØ§Ù…Ù„
        WriteCompleteAdvancedReport(fileHandle);
        FileClose(fileHandle);
        
        Print("âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…ØªÙ‚Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­: ", fileName);
        Print("ğŸ“ Ø§Ù„Ù…Ù„Ù Ù…Ø­ÙÙˆØ¸ ÙÙŠ: MQL5\\Files\\", fileName);
        Print("ğŸ“Š Ø­Ø¬Ù… Ø§Ù„ØªÙ‚Ø±ÙŠØ±: ØªÙ‚Ø±ÙŠØ± Ø´Ø§Ù…Ù„ Ù…Ø¹ ", stats.totalOrders, " Ø£Ù…Ø±");
        
        // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù Ù…Ù„Ø®Øµ Ø¥Ø¶Ø§ÙÙŠ
        CreateSummaryFile();
        
    } else {
        Print("âŒ ÙØ´Ù„ ÙÙŠ Ø­ÙØ¸ Ø§Ù„ØªÙ‚Ø±ÙŠØ± - ÙƒÙˆØ¯ Ø§Ù„Ø®Ø·Ø£: ", GetLastError());
        Print("ğŸ’¡ ØªØ­Ù‚Ù‚ Ù…Ù†:");
        Print("   â€¢ ÙˆØ¬ÙˆØ¯ Ù…Ø¬Ù„Ø¯ MQL5\\Files");
        Print("   â€¢ ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„ÙƒØªØ§Ø¨Ø©");
        Print("   â€¢ Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ù‚Ø±Øµ Ø§Ù„Ù…ØªØ§Ø­Ø©");
        Print("   â€¢ Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ù…Ù„Ù Ø¨Ù†ÙØ³ Ø§Ù„Ø§Ø³Ù… Ù…ÙØªÙˆØ­");
    }
}

//+------------------------------------------------------------------+
//| ÙƒØªØ§Ø¨Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…ØªÙ‚Ø¯Ù… Ø§Ù„ÙƒØ§Ù…Ù„                                   |
//+------------------------------------------------------------------+
void WriteCompleteAdvancedReport(int fileHandle)
{
    // ØªØ±ÙˆÙŠØ³Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ±
    WriteReportHeader(fileHandle);
    
    // Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„ØªÙ†ÙÙŠØ°ÙŠ
    CreateExecutiveSummaryReport(fileHandle);
    
    // Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¹Ø§Ù…Ø© Ø§Ù„Ø´Ø§Ù…Ù„Ø©
    WriteGeneralStatisticsToFile(fileHandle);
    
    // ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ù…Ù†ÙØ°Ø© (Ù„Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©)
    WriteExecutedAnalysisToFile(fileHandle);
    
    // ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£ÙˆØ§Ù…Ø± ØºÙŠØ± Ø§Ù„Ù…Ù†ÙØ°Ø© (Ù„Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ÙÙ‚Ø·)
    WriteNonExecutedAnalysisToFile(fileHandle);
    
    // Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…ÙØµÙ„
    WriteDetailedAnalysisToFile(fileHandle);
    
    // ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø±Ù…ÙˆØ² Ø§Ù„Ù…ØªØ¯Ø§ÙˆÙ„Ø©
    CreateSymbolAnalysisReport(fileHandle);
    
    // Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø²Ù…Ù†ÙŠ Ø§Ù„Ù…ÙØµÙ„
    CreateDetailedTimeAnalysisReport(fileHandle);
    
    // ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ø®Ø§Ø·Ø± Ø§Ù„Ù…ÙØµÙ„
    CreateDetailedRiskAnalysisReport(fileHandle);
    
    // ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„ØªÙ‚Ù†ÙŠ
    CreateTechnicalPerformanceReport(fileHandle);
    
    // Ø§Ù„Ù…Ù‚Ø§ÙŠÙŠØ³ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©
    CreateAdvancedMetricsReport(fileHandle);
    
    // Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªÙØµÙŠÙ„ÙŠ Ù„Ù„Ø£ÙˆØ§Ù…Ø± (Ø¹ÙŠÙ†Ø©)
    WriteDetailedOrdersToFile(fileHandle);
    
    // Ø§Ù„ØªÙˆØµÙŠØ§Øª Ø§Ù„Ø´Ø§Ù…Ù„Ø©
    WriteRecommendationsToFile(fileHandle);
    
    // ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ù‚Ø§Ø±Ù†Ø© (Ù„Ù„Ù…Ø³ØªÙ‚Ø¨Ù„)
    CreateComparisonReportPlaceholder(fileHandle);
    
    // Ø®Ø§ØªÙ…Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ±
    WriteReportFooter(fileHandle);
}

//+------------------------------------------------------------------+
//| Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù Ù…Ù„Ø®Øµ Ù…Ø¨Ø³Ø·                                           |
//+------------------------------------------------------------------+
void CreateSummaryFile()
{
    MqlDateTime dt;
    TimeToStruct(TimeCurrent(), dt);
    
    string summaryFileName = StringFormat("%s_Summary_%04d%02d%02d.txt", 
                            ReportFileName, dt.year, dt.mon, dt.day);
    
    int summaryHandle = FileOpen(summaryFileName, FILE_WRITE|FILE_TXT|FILE_UNICODE);
    
    if(summaryHandle != INVALID_HANDLE) {
        WriteSummaryReport(summaryHandle);
        FileClose(summaryHandle);
        Print("ğŸ“‹ ØªÙ… Ø­ÙØ¸ Ù…Ù„Ù Ø§Ù„Ù…Ù„Ø®Øµ: ", summaryFileName);
    }
}

//+------------------------------------------------------------------+
//| ÙƒØªØ§Ø¨Ø© ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø¨Ø³Ø·                                      |
//+------------------------------------------------------------------+
void WriteSummaryReport(int fileHandle)
{
    FileWriteString(fileHandle, "ğŸ“Š Ù…Ù„Ø®Øµ ØªØ­Ù„ÙŠÙ„ Ø¨ÙˆØª Ø§Ù„Ø²Ø¬Ø²Ø§Ø¬\n");
    FileWriteString(fileHandle, "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n");
    FileWriteString(fileHandle, "ğŸ“… Ø§Ù„ØªØ§Ø±ÙŠØ®: " + TimeToString(TimeCurrent(), TIME_DATE) + "\n");
    FileWriteString(fileHandle, "â±ï¸ ÙØªØ±Ø© Ø§Ù„ØªØ­Ù„ÙŠÙ„: " + IntegerToString(AnalysisPeriodDays) + " ÙŠÙˆÙ…\n\n");
    
    // Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
    FileWriteString(fileHandle, "ğŸ”¢ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©:\n");
    FileWriteString(fileHandle, "   Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£ÙˆØ§Ù…Ø±: " + IntegerToString(stats.totalOrders) + "\n");
    FileWriteString(fileHandle, "   Ø£ÙˆØ§Ù…Ø± Ù…Ù†ÙØ°Ø©: " + IntegerToString(stats.executedOrders) + "\n");
    FileWriteString(fileHandle, "   Ù…Ø¹Ø¯Ù„ Ø§Ù„ØªÙ†ÙÙŠØ°: " + DoubleToString(CalculatePercentage(stats.executedOrders, stats.totalOrders), 1) + "%\n");
    
    if(stats.executedOrders > 0) {
        FileWriteString(fileHandle, "   Ù…Ø¹Ø¯Ù„ Ø§Ù„Ù†Ø¬Ø§Ø­: " + DoubleToString(stats.winRate, 1) + "%\n");
        FileWriteString(fileHandle, "   ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­: " + DoubleToString(stats.totalProfit, 2) + "$\n");
        FileWriteString(fileHandle, "   Ù…Ø¹Ø§Ù…Ù„ Ø§Ù„Ø±Ø¨Ø­: " + DoubleToString(stats.profitFactor, 2) + "\n");
    }
    
    // Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø³Ø±ÙŠØ¹
    FileWriteString(fileHandle, "\nğŸ¯ Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø³Ø±ÙŠØ¹:\n");
    
    double executionRate = CalculatePercentage(stats.executedOrders, stats.totalOrders);
    if(executionRate >= 80) {
        FileWriteString(fileHandle, "   âœ… Ù…Ø¹Ø¯Ù„ Ø§Ù„ØªÙ†ÙÙŠØ°: Ù…Ù…ØªØ§Ø²\n");
    } else if(executionRate >= 70) {
        FileWriteString(fileHandle, "   âœ… Ù…Ø¹Ø¯Ù„ Ø§Ù„ØªÙ†ÙÙŠØ°: Ø¬ÙŠØ¯\n");
    } else {
        FileWriteString(fileHandle, "   âš ï¸ Ù…Ø¹Ø¯Ù„ Ø§Ù„ØªÙ†ÙÙŠØ°: ÙŠØ­ØªØ§Ø¬ ØªØ­Ø³ÙŠÙ†\n");
    }
    
    if(stats.executedOrders > 0) {
        if(stats.winRate >= 60) {
            FileWriteString(fileHandle, "   âœ… Ù…Ø¹Ø¯Ù„ Ø§Ù„Ù†Ø¬Ø§Ø­: Ø¬ÙŠØ¯\n");
        } else {
            FileWriteString(fileHandle, "   âš ï¸ Ù…Ø¹Ø¯Ù„ Ø§Ù„Ù†Ø¬Ø§Ø­: ÙŠØ­ØªØ§Ø¬ ØªØ­Ø³ÙŠÙ†\n");
        }
        
        if(stats.profitFactor >= 1.5) {
            FileWriteString(fileHandle, "   âœ… Ù…Ø¹Ø§Ù…Ù„ Ø§Ù„Ø±Ø¨Ø­: Ø¬ÙŠØ¯\n");
        } else {
            FileWriteString(fileHandle, "   âš ï¸ Ù…Ø¹Ø§Ù…Ù„ Ø§Ù„Ø±Ø¨Ø­: ÙŠØ­ØªØ§Ø¬ ØªØ­Ø³ÙŠÙ†\n");
        }
    }
    
    // Ø£Ù‡Ù… Ø§Ù„ØªÙˆØµÙŠØ§Øª
    FileWriteString(fileHandle, "\nğŸ’¡ Ø£Ù‡Ù… Ø§Ù„ØªÙˆØµÙŠØ§Øª:\n");
    
    if(executionRate < 70) {
        FileWriteString(fileHandle, "   1. ØªØ­Ø³ÙŠÙ† Ù…Ø¹Ø¯Ù„ Ø§Ù„ØªÙ†ÙÙŠØ°\n");
    }
    if(stats.executedOrders > 0 && stats.winRate < 50) {
        FileWriteString(fileHandle, "   2. ØªØ­Ø³ÙŠÙ† Ø¯Ù‚Ø© Ø§Ù„Ø¥Ø´Ø§Ø±Ø§Øª\n");
    }
    if(stats.highSpreadFailures > stats.totalOrders * 0.2) {
        FileWriteString(fileHandle, "   3. ØªØ¬Ù†Ø¨ Ø£ÙˆÙ‚Ø§Øª Ø§Ù„Ø³Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¹Ø§Ù„ÙŠ\n");
    }
    if(stats.wrongDirectionFailures > stats.executedOrders * 0.3) {
        FileWriteString(fileHandle, "   4. Ù…Ø±Ø§Ø¬Ø¹Ø© ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø§ØªØ¬Ø§Ù‡\n");
    }
    
    FileWriteString(fileHandle, "\nğŸ“‹ Ù„Ù„ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙƒØ§Ù…Ù„Ø©ØŒ Ø±Ø§Ø¬Ø¹ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…ÙØµÙ„.\n");
    FileWriteString(fileHandle, "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n");
}

//+------------------------------------------------------------------+
//| Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù CSV Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø®Ø§Ù…                                  |
//+------------------------------------------------------------------+
void CreateRawDataCSV()
{
    if(stats.totalOrders == 0) return;
    
    MqlDateTime dt;
    TimeToStruct(TimeCurrent(), dt);
    
    string csvFileName = StringFormat("%s_RawData_%04d%02d%02d.csv", 
                        ReportFileName, dt.year, dt.mon, dt.day);
    
    int csvHandle = FileOpen(csvFileName, FILE_WRITE|FILE_TXT|FILE_ANSI);
    
    if(csvHandle != INVALID_HANDLE) {
        WriteCSVData(csvHandle);
        FileClose(csvHandle);
        Print("ğŸ“Š ØªÙ… Ø­ÙØ¸ Ù…Ù„Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø®Ø§Ù…: ", csvFileName);
    }
}

//+------------------------------------------------------------------+
//| ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ù…Ù„Ù CSV                                      |
//+------------------------------------------------------------------+
void WriteCSVData(int fileHandle)
{
    // ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ†
    FileWriteString(fileHandle, "Ticket,Symbol,Type,Volume,OpenPrice,ActualPrice,SL,TP,Executed,NetProfit,");
    FileWriteString(fileHandle, "TimeSetup,TimeDone,ExecutionDelay,Slippage,PointsToTP,PointsToSL,");
    FileWriteString(fileHandle, "HitTP,HitSL,CorrectDirection,HoldingTime,DayOfWeek,Hour,WasWeekend,WasNews\n");
    
    // ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    for(int i = 0; i < stats.totalOrders; i++) {
        WriteOrderToCSV(fileHandle, i);
    }
}

//+------------------------------------------------------------------+
//| ÙƒØªØ§Ø¨Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø£Ù…Ø± ÙˆØ§Ø­Ø¯ ÙÙŠ CSV                                   |
//+------------------------------------------------------------------+
void WriteOrderToCSV(int fileHandle, int index)
{
    string line = "";
    
    // Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
    line += IntegerToString(orders[index].ticket) + ",";
    line += orders[index].symbol + ",";
    line += GetOrderTypeString(orders[index].type) + ",";
    line += DoubleToString(orders[index].volume, 2) + ",";
    line += DoubleToString(orders[index].priceOpen, 5) + ",";
    line += DoubleToString(orders[index].priceActual, 5) + ",";
    line += DoubleToString(orders[index].sl, 5) + ",";
    line += DoubleToString(orders[index].tp, 5) + ",";
    line += (orders[index].isExecuted ? "TRUE" : "FALSE") + ",";
    line += DoubleToString(orders[index].netProfit, 2) + ",";
    
    // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙˆÙ‚ÙŠØª
    line += TimeToString(orders[index].timeSetup, TIME_DATE|TIME_MINUTES) + ",";
    line += TimeToString(orders[index].timeDone, TIME_DATE|TIME_MINUTES) + ",";
    line += IntegerToString(orders[index].executionDelay) + ",";
    line += DoubleToString(orders[index].slippage, 5) + ",";
    line += DoubleToString(orders[index].pointsToTP, 1) + ",";
    line += DoubleToString(orders[index].pointsToSL, 1) + ",";
    
    // Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ­Ù„ÙŠÙ„ÙŠØ©
    line += (orders[index].hitTakeProfit ? "TRUE" : "FALSE") + ",";
    line += (orders[index].hitStopLoss ? "TRUE" : "FALSE") + ",";
    line += (orders[index].wasCorrectDirection ? "TRUE" : "FALSE") + ",";
    line += IntegerToString(orders[index].holdingTimeMinutes) + ",";
    line += orders[index].dayOfWeek + ",";
    line += IntegerToString(orders[index].hourOfDay) + ",";
    line += (orders[index].wasWeekend ? "TRUE" : "FALSE") + ",";
    line += (orders[index].wasNewsTime ? "TRUE" : "FALSE");
    
    FileWriteString(fileHandle, line + "\n");
}

//+------------------------------------------------------------------+
//| Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª JSON                                        |
//+------------------------------------------------------------------+
void CreateStatsJSONFile()
{
    MqlDateTime dt;
    TimeToStruct(TimeCurrent(), dt);
    
    string jsonFileName = StringFormat("%s_Stats_%04d%02d%02d.json", 
                         ReportFileName, dt.year, dt.mon, dt.day);
    
    int jsonHandle = FileOpen(jsonFileName, FILE_WRITE|FILE_TXT|FILE_ANSI);
    
    if(jsonHandle != INVALID_HANDLE) {
        WriteJSONStats(jsonHandle);
        FileClose(jsonHandle);
        Print("ğŸ“„ ØªÙ… Ø­ÙØ¸ Ù…Ù„Ù Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª JSON: ", jsonFileName);
    }
}

//+------------------------------------------------------------------+
//| ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ÙÙŠ Ù…Ù„Ù JSON                                   |
//+------------------------------------------------------------------+
void WriteJSONStats(int fileHandle)
{
    FileWriteString(fileHandle, "{\n");
    FileWriteString(fileHandle, "  \"report_info\": {\n");
    FileWriteString(fileHandle, "    \"generated_at\": \"" + TimeToString(TimeCurrent()) + "\",\n");
    FileWriteString(fileHandle, "    \"analysis_period_days\": " + IntegerToString(AnalysisPeriodDays) + ",\n");
    FileWriteString(fileHandle, "    \"version\": \"Advanced Zigzag Analyzer v1.0\"\n");
    FileWriteString(fileHandle, "  },\n");
    
    FileWriteString(fileHandle, "  \"general_stats\": {\n");
    FileWriteString(fileHandle, "    \"total_orders\": " + IntegerToString(stats.totalOrders) + ",\n");
    FileWriteString(fileHandle, "    \"executed_orders\": " + IntegerToString(stats.executedOrders) + ",\n");
    FileWriteString(fileHandle, "    \"execution_rate\": " + DoubleToString(CalculatePercentage(stats.executedOrders, stats.totalOrders), 2) + ",\n");
    FileWriteString(fileHandle, "    \"pending_expired\": " + IntegerToString(stats.pendingExpired) + ",\n");
    FileWriteString(fileHandle, "    \"pending_cancelled\": " + IntegerToString(stats.pendingCancelled) + ",\n");
    FileWriteString(fileHandle, "    \"pending_rejected\": " + IntegerToString(stats.pendingRejected) + "\n");
    FileWriteString(fileHandle, "  },\n");
    
    if(stats.executedOrders > 0) {
        FileWriteString(fileHandle, "  \"performance_stats\": {\n");
        FileWriteString(fileHandle, "    \"executed_wins\": " + IntegerToString(stats.executedWins) + ",\n");
        FileWriteString(fileHandle, "    \"executed_losses\": " + IntegerToString(stats.executedLosses) + ",\n");
        FileWriteString(fileHandle, "    \"win_rate\": " + DoubleToString(stats.winRate, 2) + ",\n");
        FileWriteString(fileHandle, "    \"total_profit\": " + DoubleToString(stats.totalProfit, 2) + ",\n");
        FileWriteString(fileHandle, "    \"gross_profit\": " + DoubleToString(stats.grossProfit, 2) + ",\n");
        FileWriteString(fileHandle, "    \"gross_loss\": " + DoubleToString(stats.grossLoss, 2) + ",\n");
        FileWriteString(fileHandle, "    \"profit_factor\": " + DoubleToString(stats.profitFactor, 2) + ",\n");
        FileWriteString(fileHandle, "    \"avg_win\": " + DoubleToString(stats.avgWin, 2) + ",\n");
        FileWriteString(fileHandle, "    \"avg_loss\": " + DoubleToString(stats.avgLoss, 2) + ",\n");
        FileWriteString(fileHandle, "    \"max_win\": " + DoubleToString(stats.maxWin, 2) + ",\n");
        FileWriteString(fileHandle, "    \"max_loss\": " + DoubleToString(stats.maxLoss, 2) + "\n");
        FileWriteString(fileHandle, "  },\n");
    }
    
    FileWriteString(fileHandle, "  \"failure_patterns\": {\n");
    FileWriteString(fileHandle, "    \"high_spread_failures\": " + IntegerToString(stats.highSpreadFailures) + ",\n");
    FileWriteString(fileHandle, "    \"wrong_direction_failures\": " + IntegerToString(stats.wrongDirectionFailures) + ",\n");
    FileWriteString(fileHandle, "    \"almost_tp_failures\": " + IntegerToString(stats.almostTPFailures) + ",\n");
    FileWriteString(fileHandle, "    \"slippage_failures\": " + IntegerToString(stats.slippageFailures) + ",\n");
    FileWriteString(fileHandle, "    \"liquidity_failures\": " + IntegerToString(stats.liquidityFailures) + ",\n");
    FileWriteString(fileHandle, "    \"timeout_failures\": " + IntegerToString(stats.timeoutFailures) + "\n");
    FileWriteString(fileHandle, "  },\n");
    
    FileWriteString(fileHandle, "  \"timing_stats\": {\n");
    FileWriteString(fileHandle, "    \"weekend_orders\": " + IntegerToString(stats.weekendOrders) + ",\n");
    FileWriteString(fileHandle, "    \"news_time_orders\": " + IntegerToString(stats.newsTimeOrders) + ",\n");
    FileWriteString(fileHandle, "    \"best_hour_execution\": " + IntegerToString(stats.bestHourExecution) + ",\n");
    FileWriteString(fileHandle, "    \"worst_hour_execution\": " + IntegerToString(stats.worstHourExecution) + ",\n");
    FileWriteString(fileHandle, "    \"best_hour_rate\": " + DoubleToString(stats.bestHourExecutionRate, 2) + ",\n");
    FileWriteString(fileHandle, "    \"worst_hour_rate\": " + DoubleToString(stats.worstHourExecutionRate, 2) + "\n");
    FileWriteString(fileHandle, "  }\n");
    
    FileWriteString(fileHandle, "}\n");
}

//+------------------------------------------------------------------+
//| Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¨Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„                                         |
//+------------------------------------------------------------------+
void SendReportByEmail()
{
    if(!SendEmailReport) return;
    
    Print("ğŸ“§ Ø¬Ø§Ø±ÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¨Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„...");
    
    string subject = CreateEmailSubject();
    string body = CreateEmailBody();
    
    if(SendMail(subject, body)) {
        Print("âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¨Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­");
    } else {
        Print("âŒ ÙØ´Ù„ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¨Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„");
        Print("ğŸ’¡ ØªØ­Ù‚Ù‚ Ù…Ù†:");
        Print("   â€¢ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª SMTP ÙÙŠ MetaTrader");
        Print("   â€¢ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª");
        Print("   â€¢ ØµØ­Ø© Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ");
    }
}

//+------------------------------------------------------------------+
//| Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„                                           |
//+------------------------------------------------------------------+
string CreateEmailSubject()
{
    string subject = "ØªÙ‚Ø±ÙŠØ± Ù…Ø­Ù„Ù„ Ø§Ù„Ø²Ø¬Ø²Ø§Ø¬ Ø§Ù„Ù…ØªÙ‚Ø¯Ù… - ";
    subject += TimeToString(TimeCurrent(), TIME_DATE);
    
    // Ø¥Ø¶Ø§ÙØ© Ù…Ù„Ø®Øµ Ø³Ø±ÙŠØ¹ Ù„Ù„Ø­Ø§Ù„Ø©
    double executionRate = CalculatePercentage(stats.executedOrders, stats.totalOrders);
    if(executionRate >= 80) {
        subject += " (Ø£Ø¯Ø§Ø¡ Ù…Ù…ØªØ§Ø²)";
    } else if(executionRate >= 70) {
        subject += " (Ø£Ø¯Ø§Ø¡ Ø¬ÙŠØ¯)";
    } else {
        subject += " (ÙŠØ­ØªØ§Ø¬ ØªØ­Ø³ÙŠÙ†)";
    }
    
    return subject;
}

//+------------------------------------------------------------------+
//| Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„                                            |
//+------------------------------------------------------------------+
string CreateEmailBody()
{
    string body = "ØªÙ‚Ø±ÙŠØ± Ù…Ø­Ù„Ù„ Ø¨ÙˆØª Ø§Ù„Ø²Ø¬Ø²Ø§Ø¬ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…\n";
    body += "=====================================\n\n";
    
    body += "ğŸ“Š Ù…Ù„Ø®Øµ Ø§Ù„Ø£Ø¯Ø§Ø¡:\n";
    body += "Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£ÙˆØ§Ù…Ø±: " + IntegerToString(stats.totalOrders) + "\n";
    body += "Ø£ÙˆØ§Ù…Ø± Ù…Ù†ÙØ°Ø©: " + IntegerToString(stats.executedOrders) + "\n";
    body += "Ù…Ø¹Ø¯Ù„ Ø§Ù„ØªÙ†ÙÙŠØ°: " + DoubleToString(CalculatePercentage(stats.executedOrders, stats.totalOrders), 1) + "%\n";
    
    if(stats.executedOrders > 0) {
        body += "Ù…Ø¹Ø¯Ù„ Ø§Ù„Ù†Ø¬Ø§Ø­: " + DoubleToString(stats.winRate, 1) + "%\n";
        body += "ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­: " + DoubleToString(stats.totalProfit, 2) + "$\n";
        body += "Ù…Ø¹Ø§Ù…Ù„ Ø§Ù„Ø±Ø¨Ø­: " + DoubleToString(stats.profitFactor, 2) + "\n";
    }
    
    body += "\nğŸ¯ Ø£Ø¨Ø±Ø² Ø§Ù„Ù†Ù‚Ø§Ø·:\n";
    
    // ØªØ­Ù„ÙŠÙ„ Ø³Ø±ÙŠØ¹ Ù„Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ù…Ù‡Ù…Ø©
    double executionRate = CalculatePercentage(stats.executedOrders, stats.totalOrders);
    if(executionRate < 70) {
        body += "â€¢ Ù…Ø¹Ø¯Ù„ Ø§Ù„ØªÙ†ÙÙŠØ° Ù…Ù†Ø®ÙØ¶ - ÙŠØ­ØªØ§Ø¬ ØªØ­Ø³ÙŠÙ†\n";
    }
    
    if(stats.priceReachedButNotExecuted > 0) {
        body += "â€¢ " + IntegerToString(stats.priceReachedButNotExecuted) + " Ø£ÙˆØ§Ù…Ø± ÙˆØµÙ„ Ù„Ù‡Ø§ Ø§Ù„Ø³Ø¹Ø± ÙˆÙ„Ù… ØªÙ†ÙØ°\n";
    }
    
    if(stats.wrongDirectionFailures > stats.executedOrders * 0.3) {
        body += "â€¢ Ù†Ø³Ø¨Ø© Ø¹Ø§Ù„ÙŠØ© Ù…Ù† Ø§Ù„ØµÙÙ‚Ø§Øª ÙÙŠ Ø§Ù„Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ø®Ø§Ø·Ø¦\n";
    }
    
    if(stats.highSpreadFailures > stats.totalOrders * 0.2) {
        body += "â€¢ ØªØ£Ø«Ø± Ø³Ù„Ø¨ÙŠ Ø¨Ø§Ù„Ø³Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¹Ø§Ù„ÙŠ\n";
    }
    
    body += "\nğŸ“‹ Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…ÙØµÙ„ Ø§Ù„ÙƒØ§Ù…Ù„ØŒ Ø±Ø§Ø¬Ø¹ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© ÙÙŠ Ù…Ø¬Ù„Ø¯ MQL5\\Files\n\n";
    
    body += "ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù‡Ø°Ø§ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¨ÙˆØ§Ø³Ø·Ø© Ù…Ø­Ù„Ù„ Ø§Ù„Ø²Ø¬Ø²Ø§Ø¬ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…\n";
    body += TimeToString(TimeCurrent()) + "\n";
    
    return body;
}

//+------------------------------------------------------------------+
//| Ø­ÙØ¸ Ø¬Ù…ÙŠØ¹ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±                                        |
//+------------------------------------------------------------------+
void SaveAllReportTypes()
{
    Print("ğŸ“ Ø¬Ø§Ø±ÙŠ Ø­ÙØ¸ Ø¬Ù…ÙŠØ¹ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±...");
    
    // Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ø§Ù„Ù…ÙØµÙ„
    SaveAdvancedReportToFile();
    
    // Ù…Ù„Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø®Ø§Ù… CSV
    CreateRawDataCSV();
    
    // Ù…Ù„Ù Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª JSON
    CreateStatsJSONFile();
    
    Print("âœ… ØªÙ… Ø­ÙØ¸ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø¨Ù†Ø¬Ø§Ø­");
    Print("ğŸ“Š Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©:");
    Print("   â€¢ ØªÙ‚Ø±ÙŠØ± Ù…ÙØµÙ„ (TXT)");
    Print("   â€¢ Ù…Ù„Ø®Øµ ØªÙ†ÙÙŠØ°ÙŠ (TXT)");
    Print("   â€¢ Ø¨ÙŠØ§Ù†Ø§Øª Ø®Ø§Ù… (CSV)");
    Print("   â€¢ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª (JSON)");
}

//--- Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø¹Ø´Ø± ---

